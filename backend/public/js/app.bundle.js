(()=>{var e,t={1663:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Ri});var i,a=n(1227),r=n.n(a);!function(e){e[e.ItemAdded=0]="ItemAdded",e[e.ItemUpdated=1]="ItemUpdated",e[e.ItemDeleted=2]="ItemDeleted",e[e.StateChanged=3]="StateChanged"}(i||(i={}));var s=r()("state-manager-delegate");const o=function(){function e(e){this.suppressEventEmits=!1,this.managerName=e,this.stateChangeListeners=[]}var t=e.prototype;return t.suppressEvents=function(){this.suppressEventEmits=!0},t.emitEvents=function(){this.suppressEventEmits=!1},t.informChangeListenersForStateWithName=function(e,t,n,a){var r=this;if(void 0===n&&(n=i.StateChanged),void 0===a&&(a=null),s("State Manager: Informing state listeners of "+e),this.suppressEventEmits)s("State Manager: Events suppressed");else{var o=this.stateChangeListeners.findIndex((function(t){return t.name===e}));o>=0&&(s("State Manager: Found state listeners of "+e+" with event type "+n),this.stateChangeListeners[o].listeners.forEach((function(o){s("State Manager: Found state listener of "+e+" with name "+o.getListenerName()+" - informing");try{switch(n){case i.StateChanged:o.stateChanged(r.managerName,e,t);break;case i.ItemAdded:o.stateChangedItemAdded(r.managerName,e,t);break;case i.ItemUpdated:o.stateChangedItemUpdated(r.managerName,e,a,t);break;case i.ItemDeleted:o.stateChangedItemRemoved(r.managerName,e,t)}}catch(e){console.log(e)}})))}},t.addChangeListenerForName=function(e,t){this.ensureListenerSetupForName(e),s("State Manager: Adding state listener for "+e+" with name "+t.getListenerName());var n=this.stateChangeListeners.findIndex((function(t){return t.name===e}));n>=0&&(s("State Manager: Adding state listener for "+e+" with name "+t.getListenerName()+" with index "+n),this.stateChangeListeners[n].listeners.push(t))},t.ensureListenerSetupForName=function(e){if(this.stateChangeListeners.findIndex((function(t){return t.name===e}))<0){var t={name:e,listeners:[]};this.stateChangeListeners.push(t)}},e}();var d=r()("state-manager-ts"),c=function(){function e(e){this.forceSaves=!0,this.managerName="",this.delegate=new o(e),this.managerName=e,this.emitEvents(),this.forceSaves=!0}var t=e.prototype;return t.suppressEvents=function(){this.delegate.suppressEvents()},t.emitEvents=function(){this.delegate.emitEvents()},t.dontForceSavesOnAddRemoveUpdate=function(){this.forceSaves=!1},t.forceSavesOnAddRemoveUpdate=function(){this.forceSaves=!0},t.informChangeListenersForStateWithName=function(e,t,n,a){void 0===n&&(n=i.StateChanged),void 0===a&&(a=null),this.delegate.informChangeListenersForStateWithName(e,t,n,a)},t.addChangeListenerForName=function(e,t){this.delegate.addChangeListenerForName(e,t)},t.addStateByName=function(e,t){this._ensureStatePresent(e);var n={name:e,value:t};return this._replaceNamedStateInStorage(n),this.informChangeListenersForStateWithName(e,t,i.StateChanged),t},t.getStateByName=function(e){var t;return this._ensureStatePresent(e),d("State Manager: Getting state for "+e),t=this._getState(e).value,d("State Manager: Found previous state for "+e),d(t),t},t.setStateByName=function(e,t,n){return void 0===n&&(n=!0),this._ensureStatePresent(e),d("State Manager: Setting state for "+e),d(t),this._getState(e).value=t,this.forceSaves&&this._saveState(e,t),n&&this.informChangeListenersForStateWithName(e,t),t},t.addNewItemToState=function(e,t,n){void 0===n&&(n=!1),this._ensureStatePresent(e),d("State Manager: Adding item to state "+e),this._addItemToState(e,t,n),this.informChangeListenersForStateWithName(e,t,i.ItemAdded)},t.findItemInState=function(e,t,n){this._ensureStatePresent(e);var i={},a=this.getStateByName(e),r=a.findIndex((function(e){return n(e,t)}));return d("Finding item in state "+e+" - found index "+r),d(t),r>=0&&(i=a[r]),i},t.isItemInState=function(e,t,n){this._ensureStatePresent(e);var i=!1;return this.getStateByName(e).findIndex((function(e){return n(e,t)}))>=0&&(i=!0),i},t.removeItemFromState=function(e,t,n,a){this._ensureStatePresent(e);var r=this.findItemInState(e,t,n);return d("State Manager: Found item - removing, is persisted "+a),this._removeItemFromState(e,t,n,a),this.informChangeListenersForStateWithName(e,r,i.ItemDeleted),!0},t.updateItemInState=function(e,t,n,a){this._ensureStatePresent(e);var r=this.findItemInState(e,t,n);return d("State Manager: Found item - replacing "),this._updateItemInState(e,t,n,a),this.informChangeListenersForStateWithName(e,t,i.ItemUpdated,r),!0},e}();function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=r()("state-manager-ms");const h=function(e){var t,n;function i(){var t;return(t=e.call(this,"memory")||this).applicationState=[],t.forceSaves=!0,t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,l(t,n),i.getInstance=function(){return i._instance||(i._instance=new i),i._instance};var a=i.prototype;return a._ensureStatePresent=function(e){if(this.applicationState.findIndex((function(t){return t.name===e}))<0){var t={name:e,value:[]};this.applicationState.push(t)}},a._addNewNamedStateToStorage=function(e){u("Adding new complete state "+name),u(e.value),this.applicationState.push(e)},a._replaceNamedStateInStorage=function(e){var t=this.applicationState.findIndex((function(t){return t.name===e.name}));t>=0&&(u("replacing complete state "+name),u(e.value),this.applicationState.splice(t,1,e))},a._getState=function(e){var t=this.applicationState.find((function(t){return t.name===e}));return u("getting complete state "+e),u(t.value),t},a._saveState=function(e,t){var n=this.applicationState.findIndex((function(t){return t.name===e}));if(n>=0){var i=this.applicationState[n];u("SAVING complete state "+e),u(i.value),i.value=t}},a._addItemToState=function(e,t,n){if(void 0===n&&(n=!1),n){var i=this.applicationState.findIndex((function(t){return t.name===e}));if(i>=0){var a=this.applicationState[i];u("adding item to state "+e),u(t),a.value.push(t)}}},a._removeItemFromState=function(e,t,n,i){var a=this.applicationState.findIndex((function(t){return t.name===e}));if(a>=0){var r=this.applicationState[a],s=r.value.findIndex((function(e){return n(e,t)}));s>=0&&(u("removing item from state "+e),u(t),r.value.splice(s,1))}},a._updateItemInState=function(e,t,n,i){var a=this.applicationState.findIndex((function(t){return t.name===e}));if(a>=0){var r=this.applicationState[a],s=r.value.findIndex((function(e){return n(e,t)}));s>=0&&(r.value.splice(s,1,t),u("updating item in state "+e),u(t))}else this._addItemToState(e,t,!0)},i}(c);var m,f;!function(e){e[e.Normal=0]="Normal",e[e.High=1]="High",e[e.Urgent=2]="Urgent"}(m||(m={})),function(e){e[e.ChatRoom=0]="ChatRoom",e[e.ScoreSheet=1]="ScoreSheet"}(f||(f={}));var g=r()("socket-ts");const v=function(){function e(){this.chatReceivers=[],this.callbackForMessage=this.callbackForMessage.bind(this),this.callbackForData=this.callbackForData.bind(this),this.listener=null,this.socket=null,this.chatReceivers=[],this.callbackForMessage=this.callbackForMessage.bind(this),this.callbackForLogin=this.callbackForLogin.bind(this),this.callbackForLogout=this.callbackForLogout.bind(this),this.callbackForJoinRoom=this.callbackForJoinRoom.bind(this),this.callbackForExitRoom=this.callbackForExitRoom.bind(this),this.callbackForInvite=this.callbackForInvite.bind(this),this.callbackForChat=this.callbackForChat.bind(this),this.callbackForQueue=this.callbackForQueue.bind(this),this.callbackForUserList=this.callbackForUserList.bind(this),this.callbackForDeclineInvite=this.callbackForDeclineInvite.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.addChatReceiver=function(e){this.chatReceivers.push(e)},t.setListener=function(e){g("Setting listener"),this.listener=e,g("Creating socket connection"),this.socket=io(),g("Waiting for messages"),this.socket.on("message",this.callbackForMessage),this.socket.on("data",this.callbackForData),this.socket.on("login",this.callbackForLogin),this.socket.on("logout",this.callbackForLogout),this.socket.on("joinroom",this.callbackForJoinRoom),this.socket.on("exitroom",this.callbackForExitRoom),this.socket.on("invite",this.callbackForInvite),this.socket.on("declineinvite",this.callbackForDeclineInvite),this.socket.on("chat",this.callbackForChat),this.socket.on("queue",this.callbackForQueue),this.socket.on("userlist",this.callbackForUserList)},t.login=function(e){this.socket.emit("login",{username:e})},t.logout=function(e){this.socket.emit("logout",{username:e})},t.joinChat=function(e,t,n){this.socket.emit("joinroom",{username:e,room:t,type:n})},t.leaveChat=function(e,t,n){this.socket.emit("exitroom",{username:e,room:t,type:n})},t.sendInvite=function(e,t,n,i,a,r,s){void 0===i&&(i=f.ChatRoom),void 0===a&&(a=!1),void 0===r&&(r=""),void 0===s&&(s={});var o={from:e,to:t,room:n,type:i,requiresAcceptDecline:a,subject:r,attachment:s};g("Sending invite"),g(o),this.socket.emit("invite",o)},t.sendMessage=function(e,t,n,i,a,r,s){void 0===r&&(r=m.Normal),void 0===s&&(s={});var o={from:e,room:t,message:n,created:i,priority:r,type:a,attachment:s};this.socket.emit("chat",o)},t.getUserList=function(){this.socket.emit("userlist")},t.sendDeclineInvite=function(e,t,n){this.socket.emit("declineinvite",{room:e,from:t,type:n})},t.callbackForMessage=function(e){g("Received message : "+e);try{g(e);var t=JSON.parse(e);this.chatReceivers.forEach((function(e){return e.receiveMessage(t)}))}catch(e){g(e),g("Not JSON data")}},t.callbackForLogin=function(e){g("Received login : "+e),this.chatReceivers.forEach((function(t){return t.receiveLogin(e)}))},t.callbackForUserList=function(e){g("Received user list : "+e),this.chatReceivers.forEach((function(t){return t.receiveUserList(e)}))},t.callbackForLogout=function(e){g("Received logout : "+e),this.chatReceivers.forEach((function(t){return t.receiveLogout(e)}))},t.callbackForJoinRoom=function(e){g("Received joined room : "+e);try{var t=JSON.parse(e);g(t),this.chatReceivers.forEach((function(e){return e.receiveJoinedRoom(t)}))}catch(e){g("Not JSON data")}},t.callbackForExitRoom=function(e){g("Received left room : "+e);try{var t=JSON.parse(e);g(t),this.chatReceivers.forEach((function(e){return e.receivedLeftRoom(t)}))}catch(e){g("Not JSON data")}},t.callbackForInvite=function(e){g("Received invite : "+e);try{var t=JSON.parse(e);g(t),this.chatReceivers.forEach((function(e){return e.receiveInvitation(t)}))}catch(e){g("Not JSON data")}},t.callbackForDeclineInvite=function(e){g("Received declined invite : "+e);try{var t=JSON.parse(e);g(t),this.chatReceivers.forEach((function(e){return e.receiveDecline(t.room,t.username,t.type)}))}catch(e){g(e),g("Not JSON data")}},t.callbackForChat=function(e){g("Received chat : "+e);try{var t=JSON.parse(e);g(t),this.chatReceivers.forEach((function(e){return e.receiveMessage(t)}))}catch(e){g("Not JSON data")}},t.callbackForQueue=function(e){g("Received queued items : "+e);try{var t=JSON.parse(e);g(t),t.invites&&t.invites.length>0&&this.chatReceivers.forEach((function(e){return e.receiveQueuedInvites(t.invites)})),t.messages&&t.messages.length>0&&this.chatReceivers.forEach((function(e){return e.receiveQueuedMessages(t.messages)}))}catch(e){g("Not JSON data")}},t.callbackForData=function(e){g("Received data");try{var t=JSON.parse(e);if(g(t),null===this.listener)return;t.user===this.listener.getCurrentUser()?g("change made by this user, ignoring"):(g("change made by another user, passing off to the application"),this.listener.handleDataChangedByAnotherUser(t))}catch(e){g("Not JSON data")}},e}();function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var I=r()("state-manager-async"),C=function(e){var t,n;function i(t,n){var i;(i=e.call(this,"async")||this).topLevelSM=t,i.wrappedSM=n,i.forceSaves=!1,i.wrappedSM.emitEvents();var a=i.wrappedSM.getConfiguredStateNames();return i.stateChanged=i.stateChanged.bind(p(i)),i.stateChangedItemAdded=i.stateChangedItemAdded.bind(p(i)),i.stateChangedItemRemoved=i.stateChangedItemRemoved.bind(p(i)),i.stateChangedItemUpdated=i.stateChangedItemUpdated.bind(p(i)),a.forEach((function(e){i.wrappedSM.addChangeListenerForName(e,p(i))})),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,b(t,n);var a=i.prototype;return a._addItemToState=function(e,t,n){void 0===n&&(n=!1),I("adding item to state "+e+" - is persisted "+n),this.wrappedSM.addNewItemToState(e,t,n)},a._getState=function(e){return I("getting state "+e),this.wrappedSM.getStateByName(e),{name:e,value:[]}},a._removeItemFromState=function(e,t,n,i){I("removing item from state "+e+" is persisted "+i),this.wrappedSM.removeItemFromState(e,t,n,i)},a._updateItemInState=function(e,t,n,i){I("updating item in state "+e),this.wrappedSM.updateItemInState(e,t,n,i)},a._ensureStatePresent=function(e){},a._addNewNamedStateToStorage=function(e){},a._replaceNamedStateInStorage=function(e){},a._saveState=function(e,t){},a.stateChangedItemRemoved=function(e,t,n){},a.stateChangedItemUpdated=function(e,t,n,i){},a.stateChanged=function(e,t,n){I("Wrapped SM has supplied new state "+t+" passing to top level SM"),I(n),this.topLevelSM.setStateByName(t,n)},a.stateChangedItemAdded=function(e,t,n){I("Wrapped SM has supplied new completed item for state "+t+" passing to top level SM"),this.topLevelSM.addNewItemToState(t,n,!0)},a.getListenerName=function(){return"Async Manager"},i}(c);function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w,E=r()("state-manager-aggregate"),S=function(e){var t,n;function i(){var t;return(t=e.call(this,"aggregate")||this).stateManagers=[],t.emitEvents(),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,y(t,n),i.getInstance=function(){return i._instance||(i._instance=new i),i._instance};var a=i.prototype;return a.addStateManager=function(e,t,n){void 0===t&&(t=[]);var i={manager:e,filters:t};this.stateManagers.push(i),n||e.suppressEvents(),E("adding state manager with/without filters")},a._addNewNamedStateToStorage=function(e){var t=this;this.stateManagers.forEach((function(n){t.stateNameInFilters(e.name,n.filters)||n.manager._addNewNamedStateToStorage(e)}))},a._getState=function(e){var t=this,n={name:e,value:[]};return this.stateManagers.forEach((function(i){t.stateNameInFilters(n.name,i.filters)||(E("get state from state manager for state "+e),E(i.manager),i.manager._getState(e))})),this.stateManagers.length>0&&(n=this.stateManagers[0].manager._getState(e)),n},a._ensureStatePresent=function(e){var t=this;this.stateManagers.forEach((function(n){t.stateNameInFilters(e,n.filters)||n.manager._ensureStatePresent(e)}))},a._replaceNamedStateInStorage=function(e){var t=this;this.stateManagers.forEach((function(n){t.stateNameInFilters(e.name,n.filters)||n.manager._replaceNamedStateInStorage(e)}))},a._saveState=function(e,t){var n=this;this.stateManagers.forEach((function(i){n.stateNameInFilters(e,i.filters)||(E("saving state in state manager for state "+e),E(i.manager),E(t),i.manager._saveState(e,t))}))},a._addItemToState=function(e,t,n){var i=this;void 0===n&&(n=!1),this.stateManagers.forEach((function(a){i.stateNameInFilters(e,a.filters)||(E("adding item to state in  state manager for state "+e+", is persisted = "+n),E(a.manager),E(t),a.manager._addItemToState(e,t,n))}))},a._removeItemFromState=function(e,t,n,i){var a=this;this.stateManagers.forEach((function(r){a.stateNameInFilters(e,r.filters)||(E("removing item from state in state manager for state "+e+", is persisted = "+i),E(r.manager),E(t),r.manager._removeItemFromState(e,t,n,i))}))},a._updateItemInState=function(e,t,n,i){var a=this;this.stateManagers.forEach((function(r){a.stateNameInFilters(e,r.filters)||(E("updating item in state in  state manager for state "+e),E(r.manager),E(t),r.manager._updateItemInState(e,t,n,i))}))},a.stateNameInFilters=function(e,t){return t.findIndex((function(t){return t===e}))>=0},i}(c);function L(e,t){return e.id===t.id}function F(e,t){return e._id===t._id}!function(e){e[e.Incomplete=0]="Incomplete",e[e.Complete=1]="Complete",e[e.Persisted=2]="Persisted",e[e.PersistedLocally=3]="PersistedLocally"}(w||(w={}));var N="user",k="chatLog",D="exerciseType",R="workout",T="recentUserSearch",U="/login",A="user",O="exerciseType",M="userSearch",x="favourites",j="exerciseTypes",_="exerciseTypes",B="exercises",V="exerciseTypeDetail",H="workoutDetail";function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var q=function(e){var t,n;function i(t){return e.call(this,t)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,P(t,n),i.prototype.show=function(e,t,n,i,a){var r=this;void 0===n&&(n=0),void 0===i&&(i="info"),void 0===a&&(a=3e3);var s=this.notificationManager.getContainerId(),o="";switch(i){case"info":o="bg-info";break;case"warning":o="bg-warning";break;case"message":o="bg-primary";break;case"priority":o="bg-danger";break;default:o="bg-info"}var d=document.createElement("div");d.className="notification toast",d.style.top=n+"px",d.setAttribute("role","alert"),d.setAttribute("data-autohide","false");var c=document.createElement("div");c.className="toast-header text-white "+o;var l=document.createElement("strong");l.className="mr-auto",l.textContent=e;var u=document.createElement("button");u.className="ml-2 mb-1 close",u.textContent="x",u.addEventListener("click",(function(){r.notificationManager.remove(d)}));var h=document.createElement("div");h.className="toast-body",h.textContent=t,c.appendChild(l),c.appendChild(u),d.appendChild(c),d.appendChild(h),d.classList.add("is-"+i);var m=document.getElementById(s);return m&&m.appendChild(d),$(".notification").toast("show"),a<=0&&(a=2e3),setTimeout((function(){r.notificationManager.remove(d)}),a),d},i}((function(e){this.show=this.show.bind(this),this.notificationManager=e,this.containerId=this.notificationManager.getContainerId()}));const W=new(function(){function e(){}return e.prototype.createNotification=function(e){return new q(e)},e}()),Y=function(){function e(){this.notifications=[],this.currentCount=0,this.offsetPerNotification=120,this.containerId="notifications",this.show=this.show.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getContainerId=function(){return this.containerId},t.show=function(e,t,n,i){void 0===n&&(n="info"),void 0===i&&(i=5e3);var a=W.createNotification(this).show(e,t,this.currentCount*this.offsetPerNotification,n,i);this.currentCount++,this.notifications.push(a)},t.remove=function(e){var t=this,n=this.notifications.findIndex((function(t){return t===e}));n>=0&&(this.notifications.splice(n,1),this.notifications.map((function(e,n){e.style.top=t.offsetPerNotification*n+"px"})));var i=e.parentElement;null!==i&&i.removeChild(e),this.currentCount--,this.currentCount<0&&(this.currentCount=0)},e}();var G=r()("socket-listener"),J=function(){function e(){}var t=e.prototype;return t.handleDataChangedByAnotherUser=function(e){G("Handling data change "+e.type+" on object type "+e.stateName+" made by user "+e.user);var t=Ge.getInstance().getStateManager().findItemInState(N,{_id:e.user},F),n="unknown";t&&(n=t.username),G("Handling data change "+e.type+" on object type "+e.stateName+" made by user "+n);var i=e.data;G(i);try{switch(e.type){case"create":switch(e.stateName){case N:Ge.getInstance().getStateManager().addNewItemToState(N,i,!0),Y.getInstance().show(i.username,i.username+" has just registered.","message");break;case D:Ge.getInstance().getStateManager().addNewItemToState(D,i,!0)}break;case"update":switch(e.stateName){case D:Ge.getInstance().getStateManager().updateItemInState(D,i,F,!0)}break;case"delete":switch(e.stateName){case D:Ge.getInstance().getStateManager().removeItemFromState(D,i,F,!0)}}}catch(e){G(e)}},t.handleMessage=function(e){G("Received message: "+e)},t.getCurrentUser=function(){return Ge.getInstance().getLoggedInUserId()},e}(),Q=n(381),z=n.n(Q);function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Z,X=r()("local-storage"),ee=function(e){var t,n;function i(t){var n;return void 0===t&&(t=!1),(n=e.call(this,"browser")||this).configuration=[],n.storage=window.sessionStorage,t&&(n.storage=window.localStorage),n.forceSaves=!0,n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,K(t,n),i.getInstance=function(e){return void 0===e&&(e=!1),i._instance||(i._instance=new i(e)),i._instance};var a=i.prototype;return a._ensureStatePresent=function(e){null===this.storage.getItem(e)&&this._addNewNamedStateToStorage({name:e,value:[]})},a._addNewNamedStateToStorage=function(e){X("Local Storage: Saving with key "+e.name),X(e);var t=JSON.stringify(e.value);X(t),this.storage.setItem(e.name,t)},a._replaceNamedStateInStorage=function(e){this._addNewNamedStateToStorage(e)},a._getState=function(e){var t=[];X("Local Storage: Loading with key "+e);var n=this.storage.getItem(e);return X(n),null!==n&&(t=JSON.parse(n)),{name:e,value:t}},a._saveState=function(e,t){this._addNewNamedStateToStorage({name:e,value:t})},a._addItemToState=function(e,t,n){if(void 0===n&&(n=!1),n){var i=this._getState(e);X("adding item to state "+e),X(t),i.value.push(t),this._replaceNamedStateInStorage(i)}},a._removeItemFromState=function(e,t,n,i){var a=this._getState(e),r=a.value.findIndex((function(e){return n(e,t)}));r>=0&&(X("removing item from state "+e),X(t),a.value.splice(r,1)),this._replaceNamedStateInStorage(a)},a._updateItemInState=function(e,t,n,i){var a=this._getState(e),r=a.value.findIndex((function(e){return n(e,t)}));r>=0&&(a.value.splice(r,1,t),X("updating item in state "+e),X(t)),this._replaceNamedStateInStorage(a)},a.forceResetForGet=function(e){},a.getConfiguredStateNames=function(){return this.configuration},a.hasCompletedRun=function(e){return!1},a.initialise=function(e){this.configuration=e},i}(c),te=n(4586);!function(e){e[e.LoggedOut=0]="LoggedOut",e[e.LoggedIn=1]="LoggedIn"}(Z||(Z={}));var ne=r()("chat-manager"),ie=function(){function e(){this.blockedList=[],this.favouriteList=[],this.loggedInUsers=[],this.currentUsername="",this.unreadListener=null,ne("Setting up chat logs, blocked list, and favourites"),this.chatLogs=[],this.chatListeners=[],this.chatUserListeners=[],this.localStorage=new ee(!0),v.getInstance().addChatReceiver(this),this.receiveLogin=this.receiveLogin.bind(this),this.receiveLogout=this.receiveLogout.bind(this),this.receiveInvitation=this.receiveInvitation.bind(this),this.receiveMessage=this.receiveMessage.bind(this),this.receiveQueuedMessages=this.receiveQueuedMessages.bind(this),this.receiveQueuedInvites=this.receiveQueuedInvites.bind(this),this.receiveJoinedRoom=this.receiveJoinedRoom.bind(this),this.receivedLeftRoom=this.receivedLeftRoom.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.addChatEventHandler=function(e){this.chatListeners.push(e)},t.addChatUserEventHandler=function(e){this.chatUserListeners.push(e)},t.isUserLoggedIn=function(e){return this.loggedInUsers.findIndex((function(t){return t===e}))>=0},t.receiveUserList=function(e){this.loggedInUsers=e,this.chatUserListeners.forEach((function(t){return t.handleLoggedInUsersUpdated(e)}))},t.addUserToBlockedList=function(e){var t=this;this.blockedList.findIndex((function(t){return t===e}))<0&&(this.blockedList.push(e),this.saveBlockedList(),this.chatUserListeners.forEach((function(e){return e.handleBlockedUsersChanged(t.favouriteList)})))},t.removeUserFromBlockedList=function(e){var t=this,n=this.blockedList.findIndex((function(t){return t===e}));n>=0&&(this.blockedList.splice(n,1),this.saveBlockedList(),this.chatUserListeners.forEach((function(e){return e.handleBlockedUsersChanged(t.favouriteList)})))},t.isUserInBlockedList=function(e){return this.blockedList.findIndex((function(t){return t===e}))>=0},t.addUserToFavouriteList=function(e){var t=this;this.favouriteList.findIndex((function(t){return t===e}))<0&&(this.favouriteList.push(e),this.saveFavouriteList(),this.chatUserListeners.forEach((function(e){return e.handleFavouriteUsersChanged(t.favouriteList)})))},t.removeUserFromFavouriteList=function(e){var t=this,n=this.favouriteList.findIndex((function(t){return t===e}));n>=0&&(this.favouriteList.splice(n,1),this.saveFavouriteList(),this.chatUserListeners.forEach((function(e){return e.handleFavouriteUsersChanged(t.favouriteList)})))},t.isUserInFavouriteList=function(e){return this.favouriteList.findIndex((function(t){return t===e}))>=0},t.getFavouriteUserList=function(){return[].concat(this.favouriteList)},t.getBlockedUserList=function(){return[].concat(this.blockedList)},t.setCurrentUser=function(t){ne("Setting current user "+t),this.currentUsername=t;var n=this.localStorage.getStateByName(e.chatLogKey+this.currentUsername);ne(n),n&&(this.chatLogs=n);var i=this.localStorage.getStateByName(e.blockedListKey+this.currentUsername);ne(i),i&&(this.blockedList=i);var a=this.localStorage.getStateByName(e.favouriteListKey+this.currentUsername);ne(a),a&&(this.favouriteList=a),this.chatListeners.forEach((function(e){return e.handleChatLogsUpdated()}))},t.getCurrentUser=function(){return this.currentUsername},t.receiveJoinedRoom=function(e){if(e.type===f.ChatRoom){var t=this.ensureChatLogExists(e.room);ne("User list for room "+e.room+" - "+e.userList.join(",")),t.users=e.userList;var n=parseInt(z()().format("YYYYMMDDHHmmss")),i=z()().format("DD/MM/YYYY HH:mm"),a={from:"",created:n,room:e.room,priority:0,type:f.ChatRoom,message:e.username+" joined the chat on "+i};t.messages.push(a),this.saveLogs(),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(t,!1)}))}},t.receivedLeftRoom=function(e){if(e.type===f.ChatRoom&&e.username!==this.currentUsername){var t=this.ensureChatLogExists(e.room);ne("User list for room "+e.room+" - "+e.userList.join(",")),t.users=e.userList;var n=parseInt(z()().format("YYYYMMDDHHmmss")),i=z()().format("DD/MM/YYYY HH:mm"),a={from:"",created:n,room:e.room,priority:0,type:f.ChatRoom,message:e.username+" left the chat on "+i};t.messages.push(a),this.saveLogs(),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(t,!1)}))}},t.receiveInvitation=function(e){if(e.type===f.ChatRoom)if(this.isUserInBlockedList(e.from))ne("User "+e.from+" blocked");else{ne("Invited to chat "+e.room);var t=this.doesChatRoomExist(e.room);ne(e),ne("Letting the listeners know, if they are all happy to accept then we will join the room");var n=!0;if(t||this.chatListeners.forEach((function(t){t.handleNewInviteReceived(e)||(n=!1)})),n){var i=this.ensureChatLogExists(e.room);i.type=e.type,e.userList&&e.userList.forEach((function(t){i.users.findIndex((function(e){return e===t}))<0&&i.users.push(e.from)})),i.users.findIndex((function(t){return t===e.from}))<0&&i.users.push(e.from),this.saveLogs(),ne("Joining chat "+e.room),v.getInstance().joinChat(this.getCurrentUser(),e.room,f.ChatRoom),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(i,!1)}))}}},t.receiveLogin=function(e){var t=this;ne("Handle login received for "+e),this.loggedInUsers.findIndex((function(t){return t===e}))<0&&this.loggedInUsers.push(e),ne(this.loggedInUsers),this.chatUserListeners.forEach((function(e){return e.handleLoggedInUsersUpdated(t.loggedInUsers)})),!this.isUserInBlockedList(e)&&this.isUserInFavouriteList(e)&&(ne("User "+e+" logging in"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedIn(e)})))},t.receiveLogout=function(e){var t=this,n=this.loggedInUsers.findIndex((function(t){return t===e}));n>=0&&this.loggedInUsers.splice(n,1),this.chatUserListeners.forEach((function(e){return e.handleLoggedInUsersUpdated(t.loggedInUsers)})),!this.isUserInBlockedList(e)&&this.isUserInFavouriteList(e)&&(ne("User "+e+" logging out"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedOut(e)})))},t.receiveDecline=function(e,t,n){n===f.ChatRoom&&t!==this.currentUsername&&(this.isUserInBlockedList(t)||(ne("User "+t+" declined invitation to room"),this.chatListeners.forEach((function(n){return n.handleInvitationDeclined(e,t)}))))},t.setUnreadCountListener=function(e){this.unreadListener=e},t.touchChatLog=function(e){var t=this.ensureChatLogExists(e);t.numOfNewMessages=0,t.lastViewed=parseInt(z()().format("YYYYMMDDHHmmss")),this.emitUnreadMessageCountChanged(),this.saveLogs()},t.getChatLog=function(e){var t=null,n=this.chatLogs.findIndex((function(t){return t.roomName===e}));return n>=0&&(t=this.chatLogs[n]),t},t.receiveMessage=function(e,t){if(void 0===t&&(t=!1),e.type===f.ChatRoom&&e.from!==this.getCurrentUser())if(this.isUserInBlockedList(e.from))ne("Message received from user "+e.from+" - is in blocked list, not passed on.");else{var n=this.ensureChatLogExists(e.room);this.addSenderToRoomIfNotAlreadyPresent(n,e.from),this.addMessageToChatLog(n,e),ne("Message received"),ne(e),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(n,t)}))}},t.receiveQueuedInvites=function(e){var t=this;e.forEach((function(e){t.receiveInvitation(e)}))},t.receiveQueuedMessages=function(e){var t=this;e.forEach((function(e){t.receiveMessage(e,!0)})),this.chatListeners.forEach((function(t){return t.handleOfflineMessagesReceived(e)}))},t.joinChat=function(e){0!==this.getCurrentUser().trim().length&&(this.ensureChatLogExists(e),v.getInstance().joinChat(this.getCurrentUser(),e,f.ChatRoom))},t.leaveChat=function(e){0!==this.getCurrentUser().trim().length&&(this.removeChatLog(e),v.getInstance().leaveChat(this.getCurrentUser(),e,f.ChatRoom),this.emitUnreadMessageCountChanged())},t.login=function(){var e=this;0!==this.getCurrentUser().trim().length&&(v.getInstance().login(this.getCurrentUser()),v.getInstance().getUserList(),this.chatLogs.forEach((function(t){t.type===f.ChatRoom&&v.getInstance().joinChat(e.currentUsername,t.roomName,f.ChatRoom)})))},t.logout=function(){0!==this.getCurrentUser().trim().length&&v.getInstance().logout(this.getCurrentUser())},t.declineInvite=function(e){0!==this.getCurrentUser().trim().length&&v.getInstance().sendDeclineInvite(e,this.getCurrentUser(),f.ChatRoom)},t.sendInvite=function(e,t,n,i,a){void 0===n&&(n=f.ChatRoom),void 0===i&&(i=!1),void 0===a&&(a=""),0!==this.getCurrentUser().trim().length&&(this.isUserInBlockedList(e)||this.ensureChatLogExists(t).users.findIndex((function(t){return t===e}))<0&&v.getInstance().sendInvite(this.getCurrentUser(),e,t,n,i,a))},t.sendMessage=function(e,t,n,i){if(void 0===n&&(n=m.Normal),0===this.getCurrentUser().trim().length)return null;var a=this.ensureChatLogExists(e),r=parseInt(z()().format("YYYYMMDDHHmmss"));v.getInstance().sendMessage(this.getCurrentUser(),e,t,r,f.ChatRoom,m.Normal,{}),i||(i={});var s={from:this.getCurrentUser(),room:e,message:t,created:r,priority:n,type:f.ChatRoom,attachment:i};return this.addMessageToChatLog(a,s),s},t.getChatLogs=function(){return[].concat(this.chatLogs)},t.startChatWithUser=function(e){var t=null;if(e){ne("Starting chat with "+e);var n=this.ensureChatLogExistsWithUser(e);this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(n,!1)})),v.getInstance().sendInvite(this.getCurrentUser(),e,n.roomName,f.ChatRoom,!1,""),v.getInstance().joinChat(this.getCurrentUser(),n.roomName,f.ChatRoom),t=n.roomName}return t},t.saveLogs=function(){this.localStorage.setStateByName(e.chatLogKey+this.currentUsername,this.chatLogs,!1)},t.saveBlockedList=function(){this.localStorage.setStateByName(e.blockedListKey+this.currentUsername,this.blockedList,!1)},t.saveFavouriteList=function(){this.localStorage.setStateByName(e.favouriteListKey+this.currentUsername,this.favouriteList,!1)},t.ensureChatLogExists=function(e){var t,n=this.chatLogs.findIndex((function(t){return t.roomName===e}));return n<0?(t={roomName:e,users:[this.getCurrentUser()],messages:[],lastViewed:parseInt(z()().format("YYYYMMDDHHmmss")),numOfNewMessages:0,type:f.ChatRoom},this.chatLogs.push(t),this.saveLogs()):t=this.chatLogs[n],t},t.ensureChatLogExistsWithUser=function(e){for(var t=null,n=0;n<this.chatLogs.length;){var i=this.chatLogs[n];2===i.users.length&&i.users.findIndex((function(t){return t===e}))>=0&&(t=i,n=this.chatLogs.length),n++}return t||(t={roomName:(0,te.Z)(),users:[this.getCurrentUser(),e],messages:[],lastViewed:parseInt(z()().format("YYYYMMDDHHmmss")),numOfNewMessages:0,type:f.ChatRoom},this.chatLogs.push(t),this.saveLogs()),t},t.doesChatRoomExist=function(e){return this.chatLogs.findIndex((function(t){return t.roomName===e}))>=0},t.emitUnreadMessageCountChanged=function(){var e,t=0;this.chatLogs.forEach((function(e){t+=e.numOfNewMessages})),null==(e=this.unreadListener)||e.countChanged(t)},t.addMessageToChatLog=function(e,t){e.numOfNewMessages++,e.messages.push(t),this.emitUnreadMessageCountChanged(),t.from===this.getCurrentUser()?this.touchChatLog(e.roomName):this.saveLogs()},t.addSenderToRoomIfNotAlreadyPresent=function(e,t){e.users.findIndex((function(e){return e===t}))<0&&e.users.push(t)},t.removeChatLog=function(e){var t=this.chatLogs.findIndex((function(t){return t.roomName===e}));if(t>=0){ne("Removing Chat log for room "+e);var n=this.chatLogs.splice(t,1);ne(n.length),this.saveLogs()}},e}();ie.chatLogKey="im-board-chat-logs",ie.blockedListKey="im-board-blocked-list",ie.favouriteListKey="im-board-favourite-list";var ae,re,se=r()("notification-controller"),oe=function(){function e(){this.doNotDisturb=!1,this.chatManager=ie.getInstance(),this.doNotDisturb=!1,this.chatListeners=[],this.chatUserListeners=[],this.handleChatLogUpdated=this.handleChatLogUpdated.bind(this),this.handleLoggedInUsersUpdated=this.handleLoggedInUsersUpdated.bind(this),this.handleFavouriteUserLoggedIn=this.handleFavouriteUserLoggedIn.bind(this),this.handleFavouriteUserLoggedOut=this.handleFavouriteUserLoggedOut.bind(this),this.chatManager.addChatEventHandler(this),this.chatManager.addChatUserEventHandler(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.handleInvitationDeclined=function(e,t){this.doNotDisturb||Y.getInstance().show("Room","User "+t+" has declined the invitation to join you.","info",7e3)},t.handleNewInviteReceived=function(e){return e.type===f.ScoreSheet||(this.doNotDisturb&&!e.requiresAcceptDecline||e.requiresAcceptDecline||Y.getInstance().show("Chat Room","User "+e.from+" has invited you.","info",7e3),!0)},t.addListener=function(e){this.chatListeners.push(e)},t.addUserListener=function(e){this.chatUserListeners.push(e)},t.setDoNotDisturb=function(e){void 0===e&&(e=!0),this.doNotDisturb=e},t.blackListUser=function(e,t){void 0===t&&(t=!0),t?this.chatManager.addUserToBlockedList(e):this.chatManager.removeUserFromBlockedList(e)},t.favouriteUser=function(e,t){void 0===t&&(t=!0),t?this.chatManager.addUserToFavouriteList(e):this.chatManager.removeUserFromFavouriteList(e)},t.isFavouriteUser=function(e){return this.chatManager.isUserInFavouriteList(e)},t.isBlockedUser=function(e){return this.chatManager.isUserInBlockedList(e)},t.handleChatLogsUpdated=function(){this.chatListeners.forEach((function(e){return e.handleChatLogsUpdated()}))},t.handleChatLogUpdated=function(e,t){if(void 0===t&&(t=!1),se("Handle chat log updated"),se(e),this.chatListeners.forEach((function(n){return n.handleChatLogUpdated(e,t)})),!this.doNotDisturb&&!t&&e.messages.length>0){var n=e.messages[e.messages.length-1];Y.getInstance().show(n.from,n.message,"message",3e3)}},t.handleLoggedInUsersUpdated=function(e){se("Handle logged in users updated"),se(e),this.chatUserListeners.forEach((function(t){return t.handleLoggedInUsersUpdated(e)}))},t.handleFavouriteUserLoggedIn=function(e){se("Handle favourite user "+e+" logged in"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedIn(e)})),this.doNotDisturb||Y.getInstance().show(e,"User "+e+" has logged in.","warning",5e3)},t.handleFavouriteUserLoggedOut=function(e){se("Handle favourite user "+e+" logged out"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedOut(e)})),this.doNotDisturb||Y.getInstance().show(e,"User "+e+" has logged out.","priority",4e3)},t.handleBlockedUsersChanged=function(e){se("Handle blocked users changed to "+e),this.chatUserListeners.forEach((function(t){return t.handleBlockedUsersChanged(e)}))},t.handleFavouriteUsersChanged=function(e){se("Handle favourite users changed to "+e),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUsersChanged(e)}))},t.startChatWithUser=function(e){return ie.getInstance().startChatWithUser(e)},t.handleChatStarted=function(e){this.chatListeners.forEach((function(t){return t.handleChatStarted(e)}))},t.handleOfflineMessagesReceived=function(e){this.doNotDisturb||0!==e.length&&Y.getInstance().show("Offline messages received","You have received "+e.length+" messages since you last logged out.")},e}();function de(){return(de=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function ce(e,t,n,i,a,r,s){try{var o=e[r](s),d=o.value}catch(e){return void n(e)}o.done?t(d):Promise.resolve(d).then(i,a)}!function(e){e[e.POST=0]="POST",e[e.GET=1]="GET",e[e.PUT=2]="PUT",e[e.DELETE=3]="DELETE"}(ae||(ae={})),function(e){e[e.PRIORITY=0]="PRIORITY",e[e.BACKGROUND=1]="BACKGROUND"}(re||(re={}));var le=r()("api-ts");const ue=new(function(){function e(){}var t=e.prototype;return t.postFetchJSON=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n})},e.next=3,fetch(t,i);case 3:return a=e.sent,e.abrupt("return",a.json());case 5:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function s(e){ce(r,i,a,s,o,"next",e)}function o(e){ce(r,i,a,s,o,"throw",e)}s(void 0)}))});return function(e,n){return t.apply(this,arguments)}}(),t.apiFetchJSONWithPost=function(e){le("Executing fetch with URL "+e.originalRequest.url+" with body "+e.originalRequest.params);try{JSON.stringify(e.originalRequest.params)}catch(t){le("Unable to convert parameters to JSON"),le(e.originalRequest.params,100),e.callback(null,404,e.queueType,e.requestId)}var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(de({},e.originalRequest.params))};this.fetchJSON(e.originalRequest.url,t,e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithGet=function(e){le("Executing GET fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id),e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,{method:"GET",headers:{"Content-Type":"application/json"}},e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithDelete=function(e){le("Executing DELETE fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id),e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,{method:"DELETE",headers:{"Content-Type":"application/json"}},e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithPut=function(e){le("Executing PUT fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id);var t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(de({},e.originalRequest.params))};e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,t,e.callback,e.queueType,e.requestId)},t.fetchJSON=function(e,t,n,i,a){fetch(e,t).then((function(e){if(le("Response code was "+e.status),e.status>=200&&e.status<=299)return e.json();400===e.status&&le(e.json())})).then((function(e){le(e),n(e,200,i,a)})).catch((function(e){le(e),n(null,500,i,a)}))},e}());function he(e,t,n,i,a,r,s){try{var o=e[r](s),d=o.value}catch(e){return void n(e)}o.done?t(d):Promise.resolve(d).then(i,a)}function me(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function s(e){he(r,i,a,s,o,"next",e)}function o(e){he(r,i,a,s,o,"throw",e)}s(void 0)}))}}var fe=r()("api-ts");const ge=function(){function e(){this.backgroundQueue=[],this.priorityQueue=[],this.inProgress=[],this.backgroundChangeListener=null,this.priorityChangeListener=null,this.callbackForQueueRequest=this.callbackForQueueRequest.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.setBackgroundChangeListener=function(e){this.backgroundChangeListener=e},t.setPriorityChangeListener=function(e){this.priorityChangeListener=e},t.getPriorityQueueCount=function(){return this.priorityQueue.length},t.getBackgroundQueueCount=function(){return this.backgroundQueue.length},t.addQLApiRequest=function(e,t,n,i,a,r){void 0===r&&(r=!1);var s={url:e,type:ae.POST,params:{query:t,variables:n},callback:i,associatedStateName:a};this.addApiRequest(s,r)},t.addQLMutationRequest=function(e,t,n,i,a,r){void 0===r&&(r=!1);var s={url:e,type:ae.POST,params:{mutation:t,variables:n},callback:i,associatedStateName:a};this.addApiRequest(s,r)},t.addApiRequest=function(e,t){void 0===t&&(t=!1);var n=(0,te.Z)();if(fe("Download Manger: Adding Queue Request "+n),fe(e,200),t){var i={originalRequest:e,requestId:n,queueType:re.PRIORITY,callback:this.callbackForQueueRequest};this.priorityQueue.push(i),this.priorityChangeListener&&this.priorityChangeListener.handleEventAddToQueue()}else{var a={originalRequest:e,requestId:n,queueType:re.BACKGROUND,callback:this.callbackForQueueRequest};this.backgroundQueue.push(a),this.backgroundChangeListener&&this.backgroundChangeListener.handleEventAddToQueue()}this.processQueues()},t.processPriorityQueue=function(){var e=me(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==(t=this.priorityQueue.shift())&&this.inProgress.push(t),void 0!==t&&this.initiateFetchForQueueItem(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processBackgroundQueue=function(){var e=me(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==(t=this.backgroundQueue.shift())&&this.inProgress.push(t),void 0!==t&&this.initiateFetchForQueueItem(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processQueues=function(){var e=me(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.priorityQueue.length+this.backgroundQueue.length;case 1:if(!(t>0)){e.next=14;break}if(fe("Download Manager: processing queue, items remaining "+t),!(this.priorityQueue.length>0)){e.next=8;break}return e.next=6,this.processPriorityQueue();case 6:e.next=11;break;case 8:if(!(this.backgroundQueue.length>0)){e.next=11;break}return e.next=11,this.processBackgroundQueue();case 11:t=this.priorityQueue.length+this.backgroundQueue.length,e.next=1;break;case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.callbackForQueueRequest=function(e,t,n,i){n===re.PRIORITY?this.priorityChangeListener&&this.priorityChangeListener.handleEventRemoveFromQueue():this.backgroundChangeListener&&this.backgroundChangeListener.handleEventRemoveFromQueue(),fe("Download Manager: received callback for queue "+n+" request "+i+" with status "+t);var a=this.inProgress.findIndex((function(e){return e.requestId===i}));if(a>=0){var r=this.inProgress[a];this.inProgress.splice(a,1),fe(r),fe("Download Manager: finished for queue item "+r.requestId),r.originalRequest.callback(e,t,r.originalRequest.associatedStateName)}},t.initiateFetchForQueueItem=function(e){if(fe("Download Manager: initiating fetch for queue item "+e.requestId),fe(e),null!==e.originalRequest.url&&null!=e.originalRequest.params&&null!=e.originalRequest.callback)switch(e.originalRequest.type){case ae.POST:ue.apiFetchJSONWithPost(e);break;case ae.GET:ue.apiFetchJSONWithGet(e);break;case ae.DELETE:ue.apiFetchJSONWithDelete(e);break;case ae.PUT:ue.apiFetchJSONWithPut(e)}},e}();var ve,pe=r()("state-manager-api"),be=function(){function e(){this.configuration=[],this.delegate=new o("restapi"),this.emitEvents(),this.bHasCompletedRun=[],this.callbackForAddItem=this.callbackForAddItem.bind(this),this.callbackForRemoveItem=this.callbackForRemoveItem.bind(this),this.callbackForUpdateItem=this.callbackForUpdateItem.bind(this),this.callbackForGetItems=this.callbackForGetItems.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getConfiguredStateNames=function(){var e=[];return this.configuration.forEach((function(t){e.push(t.stateName)})),e},t.hasCompletedRun=function(e){var t=!1,n=this.configuration.findIndex((function(t){return t.stateName===e}));return n>=0&&(t=this.bHasCompletedRun[n]),t},t.setCompletedRun=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!0)},t.forceResetForGet=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!1)},t.initialise=function(e){this.configuration=e;var t=[];this.configuration.forEach((function(e){t.push(!1)})),this.bHasCompletedRun=t},t._addNewNamedStateToStorage=function(e){},t._getState=function(e){if(pe("Getting All "+e),this.hasCompletedRun(e))pe("Getting All "+e+" - not done - previously retrieved");else{var t=this.getConfigurationForStateName(e);if(t.isActive){var n={url:t.serverURL+t.api,type:ae.GET,params:{},callback:this.callbackForGetItems,associatedStateName:e};ge.getInstance().addApiRequest(n,!0)}else pe("No configuration for state "+e)}return{name:e,value:[]}},t._ensureStatePresent=function(e){},t._replaceNamedStateInStorage=function(e){},t._saveState=function(e,t){},t._addItemToState=function(e,t,n){if(void 0===n&&(n=!1),!n){pe("Adding item to "+e),pe(t);var i=this.getConfigurationForStateName(e);if(i.isActive){var a={url:i.serverURL+i.api,type:ae.POST,params:t,callback:this.callbackForAddItem,associatedStateName:e};ge.getInstance().addApiRequest(a,!0)}else pe("No configuration for state "+e)}},t._removeItemFromState=function(e,t,n,i){if(!i){pe("Removing item from "+e),pe(t);var a=this.getConfigurationForStateName(e),r=t.id;if(a.idField&&(r=t[a.idField]),a.isActive){var s={url:a.serverURL+a.api,type:ae.DELETE,params:{id:r},callback:this.callbackForRemoveItem,associatedStateName:e};ge.getInstance().addApiRequest(s,!0)}else pe("No configuration for state "+e)}},t._updateItemInState=function(e,t,n,i){if(!i){pe("Updating item in "+e),pe(t);var a=this.getConfigurationForStateName(e);if(a.isActive){var r={url:a.serverURL+a.api,type:ae.PUT,params:t,callback:this.callbackForUpdateItem,associatedStateName:e};ge.getInstance().addApiRequest(r,!0)}else pe("No configuration for state "+e)}},t.addChangeListenerForName=function(e,t){this.delegate.addChangeListenerForName(e,t)},t.addNewItemToState=function(e,t,n){this._addItemToState(e,t,n)},t.emitEvents=function(){this.delegate.emitEvents()},t.findItemInState=function(e,t,n){throw Error("not implemented")},t.getStateByName=function(e){this._getState(e)},t.informChangeListenersForStateWithName=function(e,t,n,i){this.delegate.informChangeListenersForStateWithName(e,t,n,i)},t.isItemInState=function(e,t,n){return!0},t.removeItemFromState=function(e,t,n,i){return pe("Removing item from state "+e+" is persisted "+i),pe(t),this._removeItemFromState(e,t,n,i),!0},t.setStateByName=function(e,t,n){},t.suppressEvents=function(){this.delegate.suppressEvents()},t.updateItemInState=function(e,t,n,i){return this._updateItemInState(e,t,n,i),!0},t.getConfigurationForStateName=function(e){var t={stateName:e,serverURL:"",api:"",isActive:!1},n=this.configuration.findIndex((function(t){return t.stateName===e}));return n>=0&&(t=this.configuration[n]),t},t.callbackForRemoveItem=function(e,t,n){pe("callback for remove item for state "+n+" with status "+t+" - not forwarded"),t>=200&&t<=299&&pe(e)},t.callbackForUpdateItem=function(e,t,n){pe("callback for update item for state "+n+" with status "+t+" - not forwarded"),t>=200&&t<=299&&pe(e)},t.callbackForGetItems=function(e,t,n){pe("callback for get items for state "+n+" with status "+t+" - FORWARDING"),t>=200&&t<=299&&(pe(e),this.setCompletedRun(n),this.delegate.informChangeListenersForStateWithName(n,e,i.StateChanged,null))},t.callbackForAddItem=function(e,t,n){pe("callback for add item for state "+n+" with status "+t+" - FORWARDING"),t>=200&&t<=299&&(pe(e),this.delegate.informChangeListenersForStateWithName(n,e,i.ItemAdded,null))},e}();!function(e){e.id="Id",e.uuid="UUID",e.text="Text",e.integer="Integer",e.float="Number",e.date="Date",e.time="Time",e.shortTime="Short Time",e.datetime="Datetime",e.email="Email",e.password="Password",e.boolean="True/False",e.userId="User",e.choice="Choice",e.limitedChoice="Limited Choice",e.largeText="TextArea",e.collection="Collection",e.duration="Duration"}(ve||(ve={}));var Ie,Ce,ye,we,Ee="text/plain",Se="view-extra-action";!function(e){e[e.normal=0]="normal",e[e.active=1]="active",e[e.inactive=2]="inactive",e[e.warning=3]="warning"}(Ie||(Ie={})),function(e){e[e.number=0]="number",e[e.string=1]="string",e[e.boolean=2]="boolean",e[e.collection=3]="collection"}(Ce||(Ce={})),function(e){e[e.top=0]="top",e[e.right=1]="right",e[e.left=2]="left",e[e.bottom=3]="bottom"}(ye||(ye={})),function(e){e[e.first=0]="first",e[e.last=1]="last"}(we||(we={}));var Le=992,Fe=769,Ne=415,ke=r()("basic-field-operations-formatter"),De=r()("basic-field-operations-validator"),Re=r()("basic-field-operations-generator"),Te=r()("basic-field-operations-renderer"),Ue=function(){function e(){this.previousFieldValues=[]}var t=e.prototype;return t.setSubElements=function(e){},t.formatValue=function(e,t){ke("Handling format value for field "+e.displayName+" with value "+t);var n=t;switch(e.type){case ve.date:n=z()(t,"DD/MM/YYYY").format("YYYYMMDD");break;case ve.datetime:n=z()(t,"DD/MM/YYYY HH:mm:ss").format("YYYYMMDDHHmmss");break;case ve.boolean:n="true"===t.toLowerCase();break;case ve.id:e.idType===Ce.number&&(n=parseInt(t));break;case ve.float:var i=parseFloat(t);isNaN(i)||(n=i);break;case ve.integer:var a=parseFloat(t);isNaN(a)||(n=a)}return ke("Handling format value for field "+e.displayName+" with value "+t+" - result is "+n),n},t.isValidValue=function(t,n){De("Handling is valid value for field "+t.displayName+" with value "+n);var i={isValid:!0,resetOnFailure:!1};if(t.mandatory){if(!n||0===n.trim().length)return i.isValid=!1,i.message=t.displayName+" is required. Please enter a valid value.",De("Handling is valid value for field "+t.displayName+" with value "+n+" - is valid is "+i.isValid+" with message "+i.message),i;if(t.type===ve.boolean&&"true"!==n.trim().toLowerCase())return i.isValid=!1,i.message=t.displayName+" is required and must be selected.",De("Handling is valid value for field "+t.displayName+" with value "+n+" - is valid is "+i.isValid+" with message "+i.message),i}if(n)switch(t.type){case ve.datetime:i.isValid=e.dateTimeRegex.test(n),i.isValid||(i.message=t.displayName+" must be DD/MM/YYYY hh:mm");break;case ve.date:i.isValid=e.dateRegex.test(n),i.isValid||(i.message=t.displayName+" must be DD/MM/YYYY");break;case ve.float:i.isValid=e.floatRegexp.test(n),i.isValid||(i.message=t.displayName+" must be 00.00");break;case ve.id:i.isValid=e.integerRegex.test(n),i.isValid||(i.message=t.displayName+" must be an integer");break;case ve.email:i.isValid=e.emailRegex.test(n),i.isValid||(i.message=t.displayName+" must be an email address");break;case ve.integer:i.isValid=e.integerRegex.test(n),i.isValid||(i.message=t.displayName+" must be an integer");break;case ve.text:break;case ve.password:i.isValid=e.basicPasswordRegex.test(n),i.isValid||(i.message=t.displayName+" must be 8 to 15 letters and digits only");break;case ve.time:i.isValid=e.timeRegex.test(n),i.isValid||(i.message=t.displayName+" must be 24 hour time format HH:MM:SS");break;case ve.shortTime:i.isValid=e.shortTimeRegex.test(n),i.isValid||(i.message=t.displayName+" must be 24 hour time format HH:MM");break;case ve.duration:i.isValid=e.durationRegexp.test(n),i.isValid||(i.message=t.displayName+" must be in the format MM:SS or 999:MM:SS");break;case ve.boolean:i.isValid=e.booleanRegexp.test(n),i.isValid||(i.message=t.displayName+" must be true or false")}return De("Handling is valid value for field "+t.displayName+" with value "+n+" - is valid is "+i.isValid+" with message "+i.message),i},t.setPreviousValue=function(e,t){var n;Te("Storing previous value for field "+e.displayName+" with  new value "+t);var i=this.previousFieldValues.findIndex((function(t){return t.id===e.id}));i>=0?(n=this.previousFieldValues[i],Te("Storing previous value for field "+e.displayName+" with new value "+t+" - old value was "+n),n.value=t):(n={id:e.id,value:t},Te("Storing previous value for field "+e.displayName+" with new value "+t+" - NO previous"),this.previousFieldValues.push(n))},t.renderValue=function(e,t){if(Te("Rendering value for field "+e.displayName+" with new value "+t),t){var n=t;switch(e.type){case ve.date:n=z()(t,"YYYYMMDD").format("DD/MM/YYYY");break;case ve.datetime:n=z()(t,"YYYYMMDDHHmmss").format("DD/MM/YYYY HH:mm:ss")}return this.setPreviousValue(e,n),Te("Rendering value for field "+e.displayName+" with new value "+t+" - rendered to "+n),n}return Te("Rendering value for field "+e.displayName+" with new value is empty - no rendering required"),null},t.generateValue=function(e){var t="";switch(e.type){case ve.datetime:t=z()().format("YYYYMMDDHHmmss");break;case ve.date:t=z()().format("YYYYMMDD");break;case ve.float:t="0.0";break;case ve.id:t="-1";break;case ve.email:t="me@me.com";break;case ve.integer:t="0";break;case ve.text:case ve.password:t="";break;case ve.time:t="00:00:00";break;case ve.shortTime:case ve.duration:t="00:00";break;case ve.boolean:t="false";break;case ve.uuid:t=(0,te.Z)();break;case ve.userId:t=""+Ge.getInstance().getLoggedInUsername()}return t},t.generate=function(e,t){var n="";return e.generator&&(e.generator.onCreation&&t&&(n=this.generateValue(e),Re("Generating value for field "+e.displayName+" with on creation "+n)),e.generator.onModify&&!t&&(n=this.generateValue(e),Re("Generating value for field "+e.displayName+" with on modify "+n))),n},e}();Ue.dateRegex=/^(0[1-9]|1\d|2\d|3[01])\/(0[1-9]|1[0-2])\/(19|20)\d{2}$/,Ue.emailRegex=/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()\.,;\s@\"]+\.{0,1})+([^<>()\.,;:\s@\"]{2,}|[\d\.]+))$/,Ue.shortTimeRegex=/^([01]\d|2[0-3]):?([0-5]\d)$/,Ue.timeRegex=/^([01]\d|2[0-3]):?([0-5]\d):?([0-5]\d)$/,Ue.dateTimeRegex=/^(0[1-9]|1\d|2\d|3[01])\/(0[1-9]|1[0-2])\/(19|20)\d{2}\s([01]\d|2[0-3]):?([0-5]\d):?([0-5]\d)$/,Ue.basicPasswordRegex=/^[a-zA-Z0-9]{8,15}$/,Ue.integerRegex=/^[+-]?\d+$/,Ue.floatRegexp=/^[+-]?\d+(\.\d+)?$/,Ue.booleanRegexp=/^true|false$/,Ue.durationRegexp=/^(\d+:)?[0-5]?\d:[0-5]\d$/;var Ae="createdOn",Oe="modifiedOn",Me="Created By",xe="Last Modified By",je="Created On",_e="Last Modified On",Be=function(){function e(){}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.generateStartingDisplayOrder=function(e){var t=[];return e.fields.forEach((function(e,n){var i={fieldId:e.id,displayOrder:n};e.id===Ae&&(i.displayOrder+=100),e.id===Oe&&(i.displayOrder+=101),e.type===ve.userId&&(i.displayOrder+=100),t.push(i)})),t},t.createBasicObjectDefinition=function(e,t,n,i,a,r){void 0===a&&(a=!0),void 0===r&&(r="id");var s={id:e,displayName:t,fields:[]},o=new Ue;if(n){var d=ve.id;i&&(d=ve.uuid);var c={id:r,isKey:!0,idType:Ce.number,type:d,displayName:"Id",mandatory:!0,generator:{generator:o,onModify:!1,onCreation:!0}};s.fields.push(c)}return a&&(this.addCreatedDateToArray(s.fields),this.addCreatedByToArray(s.fields),this.addModifiedByToArray(s.fields),this.addModifiedDateToArray(s.fields)),s},t.addCreatedDateToArray=function(e){var t=this.addStringFieldToArray(e,Ae,je,ve.datetime,!0,je);t.generator={generator:new Ue,onCreation:!0,onModify:!1},t.displayOnly=!0},t.addModifiedDateToArray=function(e){var t=this.addStringFieldToArray(e,Oe,_e,ve.datetime,!0,_e);t.generator={generator:new Ue,onCreation:!0,onModify:!0},t.displayOnly=!0},t.addCreatedByToArray=function(e){var t=this.addNumericFieldToArray(e,"createdBy",Me,ve.userId,!0,Me);t.generator={generator:new Ue,onCreation:!0,onModify:!1},t.displayOnly=!0},t.addModifiedByToArray=function(e){var t=this.addStringFieldToArray(e,"modifiedBy",xe,ve.userId,!0,xe);t.generator={generator:new Ue,onCreation:!0,onModify:!0},t.displayOnly=!0},t.addFieldToArray=function(e,t,n,i,a,r,s,o){void 0===r&&(r=!1),void 0===s&&(s=null),void 0===o&&(o=null);var d={id:n,isKey:!1,idType:t,type:a,displayName:i,mandatory:r,displayOnly:!1};return r&&(d.generator={generator:new Ue,onCreation:!0,onModify:!1}),s&&(d.description=s),o&&(d.dataSource=o),e.push(d),d},t.addStringFieldToArray=function(e,t,n,i,a,r,s){return void 0===a&&(a=!1),void 0===r&&(r=null),void 0===s&&(s=null),this.addFieldToArray(e,Ce.string,t,n,i,a,r,s)},t.addNumericFieldToArray=function(e,t,n,i,a,r,s){return void 0===a&&(a=!1),void 0===r&&(r=null),void 0===s&&(s=null),this.addFieldToArray(e,Ce.string,t,n,i,a,r,s)},t.addStringFieldToObjDefinition=function(e,t,n,i,a,r,s){return void 0===a&&(a=!1),void 0===r&&(r=null),void 0===s&&(s=null),this.addStringFieldToArray(e.fields,t,n,i,a,r,s)},t.addNumericFieldToObjDefinition=function(e,t,n,i,a,r,s){return void 0===a&&(a=!1),void 0===r&&(r=null),void 0===s&&(s=null),this.addNumericFieldToArray(e.fields,t,n,i,a,r,s)},e}(),Ve=r()("object-definition-registry"),He=function(){function e(){this.definitions=[]}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.findDefinition=function(e){var t=null,n=this.definitions.findIndex((function(t){return t.id===e}));return n>=0&&(t=this.definitions[n]),t},t.addDefinition=function(e,t,n,i,a,r){void 0===a&&(a=!0),void 0===r&&(r="id"),Ve("Adding definition for "+e+" with name "+t);var s=this.findDefinition(e);if(s)return s;var o=Be.getInstance().createBasicObjectDefinition(e,t,n,i,a,r);return this.definitions.push(o),o},t.createInstanceFromDef=function(e){Ve("Creating instance for definition "+e.displayName);var t={},n=new Ue;return e.fields.forEach((function(e){if(e.generator&&e.generator.onCreation){var i=e.generator.generator.generate(e,!0);switch(e.type){case ve.date:case ve.datetime:break;default:i=n.formatValue(e,i)}Ve("Setting default values for "+e.displayName+" to "+i),t[e.id]=i}e.type===ve.collection&&(t[e.id]=[])})),t},t.createInstance=function(e){Ve("Creating instance for definition "+e);var t={},n=this.findDefinition(e);return n&&(t=this.createInstanceFromDef(n)),t},e}(),Pe=function(){function e(e){this.options=e,this.listeners=[]}var t=e.prototype;return t.addValueOption=function(e,t){var n=this;this.options.push({name:e,value:t}),this.listeners.forEach((function(e){return e.optionsChanged(n.options)}))},t.addListener=function(e){this.listeners.push(e)},t.getOptions=function(){return this.options},e}();function qe(){return(qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var We=r()("controller-ts"),Ye=r()("controller-ts-detail"),Ge=function(){function e(){}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.connectToApplication=function(e,t){this.applicationView=e,this.clientSideStorage=t;var n=be.getInstance();n.initialise([{stateName:N,serverURL:"",api:"/api/users",isActive:!0},{stateName:D,serverURL:"",api:"/api/exercise-types",isActive:!0,idField:"_id"},{stateName:R,serverURL:"",api:"/api/workouts",isActive:!0,idField:"_id"}]);var i=S.getInstance(),a=h.getInstance(),r=new C(i,n);return i.addStateManager(a,[],!1),i.addStateManager(r,[],!1),this.stateManager=i,this.stateChanged=this.stateChanged.bind(this),this.stateChangedItemAdded=this.stateChangedItemAdded.bind(this),this.stateChangedItemRemoved=this.stateChangedItemRemoved.bind(this),this.stateChangedItemUpdated=this.stateChangedItemUpdated.bind(this),this.setupDataObjectDefinitions(),this},t.setupDataObjectDefinitions=function(){var e=He.getInstance().addDefinition(D,"Exercise",!0,!0,!0,"_id");Be.getInstance().addStringFieldToObjDefinition(e,"name","Name",ve.text,!0,"Exercise name"),Be.getInstance().addStringFieldToObjDefinition(e,"type","Type",ve.limitedChoice,!0,"Choose cardio or strength",new Pe([{name:"Cardio",value:"cardio"},{name:"Strength",value:"strength"}])),Be.getInstance().addStringFieldToObjDefinition(e,"duration","Duration",ve.duration,!0,"Exercise time"),Be.getInstance().addStringFieldToObjDefinition(e,"sets","Sets",ve.integer,!1,"Number of sets"),Be.getInstance().addStringFieldToObjDefinition(e,"reps","Repetitions",ve.integer,!1,"Number of reps"),Be.getInstance().addStringFieldToObjDefinition(e,"weight","Weight",ve.float,!1,"Weight used"),Be.getInstance().addStringFieldToObjDefinition(e,"distance","Distance",ve.float,!1,"Distance travelled"),We("Exercise type data object definition"),We(e),Ye(He.getInstance().findDefinition("exerciseType"));var t=He.getInstance().addDefinition(R,"Workout",!0,!0,!0,"_id");Be.getInstance().addStringFieldToObjDefinition(t,"completed","Completed",ve.boolean,!0,"Have completed the workout");var n=Be.getInstance().addStringFieldToObjDefinition(t,"exercises","Exercises",ve.collection,!0,"Exercises in this workout");n.idType=Ce.collection,n.collectionOfDataObjectId=e.id,We("Workout data object definition"),We(t),Ye(He.getInstance().findDefinition("workout"))},t.initialise=function(){We("Initialising data state");var e=new J;if(v.getInstance().setListener(e),We("Setting up chat system for user "+this.getLoggedInUserId()+": "+this.getLoggedInUsername()),this.getLoggedInUserId().trim().length>0){var t=ie.getInstance();oe.getInstance(),t.setCurrentUser(this.getLoggedInUsername()),t.setUnreadCountListener(this.applicationView),t.login(),this.getStateManager().getStateByName(N),this.getStateManager().getStateByName(D),this.getStateManager().getStateByName(R)}},t.getStateManager=function(){return this.stateManager},t.getListenerName=function(){return"Controller"},t.isLoggedIn=function(){var e=!1;try{loggedInUser&&(e=!0)}catch(e){}return e},t.getLoggedInUserId=function(){var e="";try{loggedInUser&&(e=loggedInUser._id)}catch(e){}return Ye("Logged in user id is "+e),e},t.getLoggedInUsername=function(){var e="";try{loggedInUser&&(e=loggedInUser.username)}catch(e){}return Ye("Logged in user is "+e),e},t.handleMessage=function(e){We(e)},t.getCurrentUser=function(){return this.getLoggedInUserId()},t.stateChangedItemAdded=function(e,t,n){},t.stateChangedItemRemoved=function(e,t,n){},t.stateChangedItemUpdated=function(e,t,n,i){},t.stateChanged=function(e,t,n){},t.getServerAPIURL=function(){var e="";return window.ENV&&window.ENV.serverURL&&(e=window.ENV.serverURL),e},t.handleShowChat=function(e){this.applicationView.handleShowChat(e)},t.create=function(e,t,n){switch(t){case D:We("Handling create new exercise type"),Ye(n),this.stateManager.addNewItemToState(t,n,!1)}},t.delete=function(e,t,n){switch(t){case D:We("Handling delete exercise type - already managed by stateful collection view"),Ye(n)}},t.update=function(e,t,n){switch(t){case D:We("Handling update exercise type"),Ye(n),this.stateManager.updateItemInState(t,n,F,!1)}},t.addExerciseToCurrentWorkout=function(e){var t=qe({},e);t._id=(0,te.Z)(),this.applicationView.addingExerciseToCurrentWorkout(t)},t.addWorkoutExercisesToCurrentWorkout=function(e){var t=this;e.exercises&&e.exercises.forEach((function(e){t.addExerciseToCurrentWorkout(e)}))},e}(),Je=function(){function e(){this.suppressEventEmits=!1,this.viewListeners=[]}var t=e.prototype;return t.addListener=function(e){this.viewListeners.push(e)},t.suppressEvents=function(){this.suppressEventEmits=!0},t.emitEvents=function(){this.suppressEventEmits=!1},t.itemDeleted=function(e,t){this.suppressEventEmits||this.viewListeners.forEach((function(n){return n.itemDeleted(e,t)}))},t.documentLoaded=function(e){this.suppressEventEmits||this.viewListeners.forEach((function(t){return t.documentLoaded(e)}))},t.itemAction=function(e,t,n){this.suppressEventEmits||this.viewListeners.forEach((function(i){return i.itemAction(e,t,n)}))},t.canDeleteItem=function(e,t){var n=!0;return this.suppressEventEmits||this.viewListeners.forEach((function(i){i.canDeleteItem(e,t)||(n=!1)})),n},t.hideRequested=function(e){this.suppressEventEmits||this.viewListeners.forEach((function(t){return t.hideRequested(e)}))},t.showRequested=function(e){this.suppressEventEmits||this.viewListeners.forEach((function(t){return t.showRequested(e)}))},t.itemDropped=function(e,t){this.suppressEventEmits||this.viewListeners.forEach((function(n){return n.itemDropped(e,t)}))},e}(),Qe=r()("abstract-view-ts"),ze=r()("abstract-view-ts-detail"),$e=function(){function e(e){this.containerEl=null,this.uiConfig=e,this.viewEl=null,this.eventForwarder=new Je,this.handleDrop=this.handleDrop.bind(this)}var t=e.prototype;return t.getUIConfig=function(){return this.uiConfig},t.addEventListener=function(e){this.eventForwarder.addListener(e)},t.onDocumentLoaded=function(){this.viewEl=document.getElementById(this.uiConfig.resultsContainerId),this.eventForwarder.documentLoaded(this)},t.setContainedBy=function(e){this.containerEl=e},t.getName=function(){return this.uiConfig.dataSourceId},t.hasChanged=function(){return!1},t.getDataSourceKeyId=function(){return e.DATA_SOURCE},t.handleDrop=function(e){Qe("view "+this.getName()+": drop event"),ze(e.target);var t=e.dataTransfer.getData(Ee),n=JSON.parse(t);ze(n);var i=n.draggedType,a=n.draggedFrom;if(Qe("view "+this.getName()+": drop event from "+a+" with type "+i),this.uiConfig.drop){var r=this.uiConfig.drop.acceptTypes.findIndex((function(e){return e===i}))>=0,s=!0;r&&(this.uiConfig.drop.acceptFrom&&(s=this.uiConfig.drop.acceptFrom.findIndex((function(e){return e===a}))>=0),ze("view "+this.getName()+": accepted type? "+r+" and from? "+s),r&&s&&this.eventForwarder.itemDropped(this,n))}},e}();function Ke(e,t){return(Ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}$e.DATA_SOURCE="data-source";var Ze,Xe,et=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).collectionViewListeners=[],t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ke(t,n);var a=i.prototype;return a.addListener=function(t){e.prototype.addListener.call(this,t),this.collectionViewListeners.push(t)},a.itemDragStarted=function(e,t){this.suppressEventEmits||this.collectionViewListeners.forEach((function(n){return n.itemDragStarted(e,t)}))},a.itemSelected=function(e,t){this.suppressEventEmits||this.collectionViewListeners.forEach((function(n){return n.itemSelected(e,t)}))},a.itemDeselected=function(e,t){this.suppressEventEmits||this.collectionViewListeners.forEach((function(n){return n.itemDeselected(e,t)}))},a.canSelectItem=function(e,t){var n=!0;return this.suppressEventEmits||this.collectionViewListeners.forEach((function(i){i.canSelectItem(e,t)||(n=!1)})),n},i}(Je);(Xe=Ze||(Ze={}))[Xe.cancelled=0]="cancelled",Xe[Xe.confirmed=1]="confirmed";var tt="d-none",nt="d-block",it=r()("alert"),at=function(){function e(){this.alertDiv=document.getElementById("alert"),this.alertTitle=document.getElementById("alert-title"),this.alertContent=document.getElementById("alert-content"),this.cancelButton=document.getElementById("alert-cancel"),this.confirmButton=document.getElementById("alert-confirm")}return e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.startAlert=function(e,t,n,i){var a=this;this.alertTitle.innerHTML=t,this.alertContent.innerHTML=n,this.alertDiv.classList.remove(tt),this.alertDiv.classList.add(nt),this.confirmButton.addEventListener("click",(function t(n){it("Handling confirm event from alert"),e.completed({outcome:Ze.confirmed,context:i}),a.alertDiv.classList.add(tt),a.alertDiv.classList.remove(nt),n.target.removeEventListener("click",t)})),this.cancelButton.addEventListener("click",(function t(n){it("Handling cancel event from alert"),e.completed({outcome:Ze.cancelled,context:i}),a.alertDiv.classList.add(tt),a.alertDiv.classList.remove(nt),n.target.removeEventListener("click",t)}))},e}();function rt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function st(e,t){return(st=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ot=r()("collection-view-ts"),dt=r()("collection-view-ts-detail"),ct=function(e){var t,n;function i(t,n){var i;return(i=e.call(this,t.viewConfig)||this).collectionUIConfig=t,i.collectionName=n,i.renderer=null,i.selectedItem=null,i.eventForwarder=new et,i.eventStartDrag=i.eventStartDrag.bind(rt(i)),i.eventActionClicked=i.eventActionClicked.bind(rt(i)),i.eventClickItem=i.eventClickItem.bind(rt(i)),i.eventDeleteClickItem=i.eventDeleteClickItem.bind(rt(i)),i.updateViewForNamedCollection=i.updateViewForNamedCollection.bind(rt(i)),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,st(t,n);var a=i.prototype;return a.getCollectionUIConfig=function(){return this.collectionUIConfig},a.addEventCollectionListener=function(e){this.eventForwarder.addListener(e)},a.setContainedBy=function(t){e.prototype.setContainedBy.call(this,t),this.uiConfig.drop&&(dt("view "+this.getName()+": Adding dragover events to "+this.uiConfig.dataSourceId),dt(t),t.addEventListener("dragover",(function(e){e.preventDefault()})),t.addEventListener("drop",this.handleDrop))},a.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.renderer&&this.renderer.onDocumentLoaded()},a.getDragData=function(e){var t=e.target.getAttribute(this.collectionUIConfig.keyId),n=e.target.getAttribute($e.DATA_SOURCE);this.collectionUIConfig.keyType===Ce.number&&(t=parseInt(t)),dt("view "+this.getName()+": Item with id "+t+" getting drag data from "+n);var i={};i[this.collectionUIConfig.keyId]=t;var a,r,s={};return(s=this.getItemInNamedCollection(this.collectionName,i))&&(s.draggedType=null==(a=this.collectionUIConfig.detail.drag)?void 0:a.type,s.draggedFrom=null==(r=this.collectionUIConfig.detail.drag)?void 0:r.from),s},a.renderBackgroundForItemInNamedCollection=function(e,t,n){},a.compareItemsForEquality=function(e,t){return L(e,t)},a.getModifierForItemInNamedCollection=function(e,t){return Ie.normal},a.getSecondaryModifierForItemInNamedCollection=function(e,t){return Ie.normal},a.getBadgeValueForItemInNamedCollection=function(e,t){return 0},a.getBackgroundImageForItemInNamedCollection=function(e,t){return""},a.updateViewForNamedCollection=function(e,t){this.viewEl&&this.renderer&&this.renderer.setDisplayElementsForCollectionInContainer(this.viewEl,e,t)},a.eventStartDrag=function(e){ot("view "+this.getName()+": drag start"),dt(e.target);var t=JSON.stringify(this.getDragData(e));dt(t),e.dataTransfer.setData(Ee,t),this.eventForwarder.itemDragStarted(this,t)},a.eventClickItem=function(e){e.preventDefault(),e.stopPropagation();var t=e.target.getAttribute(this.collectionUIConfig.keyId),n=e.target.getAttribute($e.DATA_SOURCE);this.collectionUIConfig.keyType===Ce.number&&(t=parseInt(t)),dt("view "+this.getName()+": Item with id "+t+" clicked from "+n);var i={};i[this.collectionUIConfig.keyId]=t,dt(i);var a=this.getItemInNamedCollection(this.collectionName,i);if(console.log(a),a){var r=this.eventForwarder.canSelectItem(this,a);dt("view "+this.getName()+": Item with id "+t+" attempting selected from "+n+" - "+r),r&&(this.selectedItem=a,dt(a),this.eventForwarder.itemSelected(this,a))}},a.eventDeleteClickItem=function(e){e.preventDefault(),e.stopPropagation();var t=e.target.getAttribute(this.collectionUIConfig.keyId),n=e.target.getAttribute($e.DATA_SOURCE);this.collectionUIConfig.keyType===Ce.number&&(t=parseInt(t)),dt("view "+this.getName()+": Item with id "+t+" attempting delete from "+n);var i={};i[this.collectionUIConfig.keyId]=t,dt(i);var a=this.getItemInNamedCollection(this.collectionName,i);if(a){var r=this.eventForwarder.canDeleteItem(this,a);dt("view "+this.getName()+": Item with id "+t+" attempting delete from "+n+" - "+r),r&&(this.collectionUIConfig.detail.quickDelete?(this.selectedItem=null,this.eventForwarder.itemDeleted(this,a)):at.getInstance().startAlert(this,this.getName(),"Are you sure you want to delete this information?",a))}},a.eventActionClicked=function(e){e.preventDefault(),e.stopPropagation();var t=e.target.getAttribute(this.collectionUIConfig.keyId),n=e.target.getAttribute($e.DATA_SOURCE),i=e.target.getAttribute(Se);this.collectionUIConfig.keyType===Ce.number&&(t=parseInt(t)),dt("view "+this.getName()+": Item with id "+t+" attempting delete from "+n);var a={};a[this.collectionUIConfig.keyId]=t,dt(a);var r=this.getItemInNamedCollection(this.collectionName,a);if(r){var s=this.eventForwarder.canSelectItem(this,r);dt("view "+this.getName()+": Item with id "+t+" attempting action "+i+" from "+n+" - "+s),s&&(this.selectedItem=r,dt(r),this.eventForwarder.itemAction(this,i,r))}},a.hasPermissionToDeleteItemInNamedCollection=function(e,t){return!0},a.hasPermissionToUpdateItemInNamedCollection=function(e,t){return!0},a.hasPermissionToActionItemInNamedCollection=function(e,t,n){return!0},a.setRenderer=function(e){this.renderer=e},a.completed=function(e){dt(e.context),e.outcome===Ze.confirmed&&(this.selectedItem=null,this.eventForwarder.itemDeleted(this,e.context))},i}($e);function lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ut(e,t){return(ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ht=r()("ab-stateful-collection-view"),mt=function(e){var t,n;function i(t,n,i){var a;return(a=e.call(this,t,i)||this).stateManager=n,a.stateChanged=a.stateChanged.bind(lt(a)),a.stateManager.addChangeListenerForName(a.collectionName,lt(a)),a}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ut(t,n);var a=i.prototype;return a.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.addEventCollectionListener(this)},a.getItemInNamedCollection=function(e,t){return this.stateManager.findItemInState(e,t,this.compareItemsForEquality)},a.stateChanged=function(e,t,n){ht("handling state "+t+" changed"),ht(n),this.updateViewForNamedCollection(t,n)},a.stateChangedItemAdded=function(e,t,n){ht("handling state "+t+" new item added"),ht(n),this.stateManager&&this.collectionName&&this.updateViewForNamedCollection(t,this.stateManager.getStateByName(t))},a.stateChangedItemRemoved=function(e,t,n){ht("handling state "+t+" new item removed"),ht(n),this.stateManager&&this.collectionName&&this.updateViewForNamedCollection(t,this.stateManager.getStateByName(t))},a.stateChangedItemUpdated=function(e,t,n,i){ht("handling state "+t+" new item updated"),ht(i),this.stateManager&&this.collectionName&&this.updateViewForNamedCollection(t,this.stateManager.getStateByName(t))},a.render=function(){this.updateViewForNamedCollection(this.collectionName,this.stateManager.getStateByName(this.collectionName))},a.show=function(){},a.hidden=function(){},a.documentLoaded=function(e){},a.hideRequested=function(e){},a.itemDragStarted=function(e,t){},a.itemDropped=function(e,t){},a.showRequested=function(e){},a.itemDeselected=function(e,t){},a.itemSelected=function(e,t){},a.itemAction=function(e,t,n){},a.itemDeleted=function(e,t){this.stateManager.removeItemFromState(this.collectionName,t,this.compareItemsForEquality,!1)},a.canSelectItem=function(e,t){return!0},a.canDeleteItem=function(e,t){return!0},a.getListenerName=function(){return this.getName()},i}(ct);const ft=new(function(){function e(){}var t=e.prototype;return t.scrollSmoothToId=function(e){var t=document.getElementById(e);null!==t&&t.scrollIntoView({block:"start",behavior:"smooth"})},t.scrollToBottomNow=function(e){e&&(e.scrollTop=e.scrollHeight-e.clientHeight+100)},t.scrollToBottomSmooth=function(e){e&&(e.scrollIntoView({behavior:"smooth"}),e.scrollTop=e.scrollHeight-e.clientHeight+100)},t.scrollSmoothTo=function(e){e.scrollIntoView({block:"start",behavior:"smooth"})},t.scrollTo=function(e){e.scrollIntoView({block:"start"})},t.removeAllChildren=function(e){if(e&&e.firstChild)for(;e.firstChild;){var t=e.lastChild;t&&e.removeChild(t)}},t.addRemoveClasses=function(e,t,n){void 0===n&&(n=!0),t.split(" ").forEach((function(t){t.trim().length>0&&(n?e.classList.add(t):e.classList.remove(t))}))},t.addAttributes=function(e,t){t&&t.forEach((function(t){e.setAttribute(t.name,t.value)}))},t.removeAttributes=function(e,t){t.forEach((function(t){e.removeAttribute(t)}))},e}());var gt=r()("list-view-renderer"),vt=function(){function e(e,t){this.view=e,this.eventHandler=t}var t=e.prototype;return t.createDisplayElementForCollectionItem=function(e,t){var n=this,i=this.view.hasPermissionToDeleteItemInNamedCollection(e,t),a=this.view.getCollectionUIConfig(),r=this.view.getDataSourceKeyId();gt("view "+this.view.getName()+": creating List item"),gt(t);var s=this.view.getIdForItemInNamedCollection(e,t),o=document.createElement(a.resultsElementType);ft.addRemoveClasses(o,a.resultsClasses),ft.addAttributes(o,a.resultsElementAttributes),o.setAttribute(a.keyId,s),o.setAttribute(r,a.viewConfig.dataSourceId);var d=o;if(a.detail.containerClasses){var c=document.createElement("div");if(ft.addRemoveClasses(c,a.detail.containerClasses),c.setAttribute(a.keyId,s),c.setAttribute(r,a.viewConfig.dataSourceId),d=document.createElement(a.detail.textElementType),ft.addRemoveClasses(d,a.detail.textElementClasses),d.setAttribute(a.keyId,s),d.setAttribute(r,a.viewConfig.dataSourceId),c.appendChild(d),a.detail.background){var l=document.createElement(a.detail.background.elementType);ft.addRemoveClasses(l,a.detail.background.elementClasses),l.setAttribute("src",this.view.getBackgroundImageForItemInNamedCollection(e,t)),o.appendChild(l)}var u=document.createElement("div");if(c.appendChild(u),a.detail.badge){var h=this.view.getBadgeValueForItemInNamedCollection(e,t);if(h>0){var m=document.createElement(a.detail.badge.elementType);ft.addRemoveClasses(m,a.detail.badge.elementClasses),ft.addAttributes(m,a.detail.badge.elementAttributes),m.setAttribute(a.keyId,s),m.setAttribute(r,a.viewConfig.dataSourceId),u.appendChild(m),m.innerHTML="&nbsp;&nbsp;&nbsp;"+h+"&nbsp;&nbsp;&nbsp;"}}if(a.extraActions&&a.extraActions.forEach((function(i){if(n.view.hasPermissionToActionItemInNamedCollection(i.name,e,t)){var o=document.createElement("button");if(o.setAttribute("type","button"),ft.addRemoveClasses(o,i.buttonClasses),ft.addAttributes(o,i.attributes),i.buttonText&&(o.innerHTML=i.buttonText),i.iconClasses){var d=document.createElement("i");ft.addRemoveClasses(d,i.iconClasses),d.setAttribute(a.keyId,s),d.setAttribute(r,a.viewConfig.dataSourceId),d.setAttribute(Se,i.name),o.appendChild(d)}o.setAttribute(a.keyId,s),o.setAttribute(r,a.viewConfig.dataSourceId),o.setAttribute(Se,i.name),o.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),n.eventHandler.eventActionClicked(e)})),u.appendChild(o)}})),a.detail.delete&&i){var f=document.createElement("button");if(f.setAttribute("type","button"),ft.addRemoveClasses(f,a.detail.delete.buttonClasses),ft.addAttributes(f,a.detail.delete.attributes),a.detail.delete.buttonText&&(f.innerHTML=a.detail.delete.buttonText),a.detail.delete.iconClasses){var g=document.createElement("i");ft.addRemoveClasses(g,a.detail.delete.iconClasses),g.setAttribute(a.keyId,s),g.setAttribute(r,a.viewConfig.dataSourceId),f.appendChild(g)}f.setAttribute(a.keyId,s),f.setAttribute(r,a.viewConfig.dataSourceId),f.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),n.eventHandler.eventDeleteClickItem(e)})),u.appendChild(f)}o.appendChild(c),a.detail.drag&&(o.setAttribute("draggable","true"),o.addEventListener("dragstart",this.eventHandler.eventStartDrag)),a.detail.select&&o.addEventListener("click",this.eventHandler.eventClickItem)}if(d.setAttribute(a.keyId,s),d.setAttribute(r,a.viewConfig.dataSourceId),this.view.renderDisplayForItemInNamedCollection(d,e,t),a.detail.icons&&a.detail.icons(e,t).forEach((function(e){var t=document.createElement("i");ft.addRemoveClasses(t,e),t.setAttribute(a.keyId,s),t.setAttribute(r,a.viewConfig.dataSourceId),d.appendChild(t)})),a.modifiers){var v=this.view.getModifierForItemInNamedCollection(e,t),p=this.view.getSecondaryModifierForItemInNamedCollection(e,t);switch(v){case Ie.normal:if(gt("view "+this.view.getName()+": normal item"),ft.addRemoveClasses(o,a.modifiers.normal),a.icons&&a.icons.normal){var b=document.createElement("i");ft.addRemoveClasses(b,a.icons.normal),b.setAttribute(a.keyId,s),b.setAttribute(r,a.viewConfig.dataSourceId),d.appendChild(b)}switch(p){case Ie.warning:if(ft.addRemoveClasses(o,a.modifiers.normal,!1),ft.addRemoveClasses(o,a.modifiers.warning,!0),a.icons&&a.icons.warning){var I=document.createElement("i");ft.addRemoveClasses(I,a.icons.warning),I.setAttribute(a.keyId,s),I.setAttribute(r,a.viewConfig.dataSourceId),d.appendChild(I)}break;case Ie.active:if(a.icons&&a.icons.active){var C=document.createElement("i");ft.addRemoveClasses(C,a.icons.active),C.setAttribute(a.keyId,s),C.setAttribute(r,a.viewConfig.dataSourceId),d.appendChild(C)}}break;case Ie.active:if(gt("view "+this.view.getName()+": active item"),ft.addRemoveClasses(o,a.modifiers.active),a.icons&&a.icons.active){var y=document.createElement("i");ft.addRemoveClasses(y,a.icons.active),y.setAttribute(a.keyId,s),y.setAttribute(r,a.viewConfig.dataSourceId),d.appendChild(y)}switch(p){case Ie.warning:if(ft.addRemoveClasses(o,a.modifiers.active,!1),ft.addRemoveClasses(o,a.modifiers.warning,!0),a.icons&&a.icons.warning){var w=document.createElement("i");ft.addRemoveClasses(w,a.icons.warning),w.setAttribute(a.keyId,s),w.setAttribute(r,a.viewConfig.dataSourceId),d.appendChild(w)}}break;case Ie.inactive:if(gt("view "+this.view.getName()+": inactive item"),ft.addRemoveClasses(o,a.modifiers.inactive),a.icons&&a.icons.inactive){var E=document.createElement("i");ft.addRemoveClasses(E,a.icons.inactive),E.setAttribute(a.keyId,s),E.setAttribute(r,a.viewConfig.dataSourceId),d.appendChild(E)}switch(p){case Ie.warning:if(a.icons&&a.icons.warning){ft.addRemoveClasses(o,a.modifiers.inactive,!1),ft.addRemoveClasses(o,a.modifiers.warning,!0);var S=document.createElement("i");ft.addRemoveClasses(S,a.icons.warning),S.setAttribute(a.keyId,s),S.setAttribute(r,a.viewConfig.dataSourceId),d.appendChild(S)}break;case Ie.active:if(a.icons&&a.icons.active){var L=document.createElement("i");ft.addRemoveClasses(L,a.icons.active),L.setAttribute(a.keyId,s),L.setAttribute(r,a.viewConfig.dataSourceId),d.appendChild(L)}}}}return o},t.setDisplayElementsForCollectionInContainer=function(e,t,n){var i=this;gt("view "+this.view.getName()+": creating Results"),gt(n),ft.removeAllChildren(e),n.map((function(n,a){var r=i.createDisplayElementForCollectionItem(t,n);gt("view "+i.view.getName()+":  Adding child "+i.view.getIdForItemInNamedCollection(t,n)),e.appendChild(r)})),$('[data-toggle="tooltip"]').tooltip()},t.onDocumentLoaded=function(){},e}();function pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bt(e,t){return(bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var It=r()("user-search"),Ct=r()("user-search-detail"),yt=function(e){var t,n;function i(t){var n;return(n=e.call(this,i.DOMConfig,t,N)||this).loggedInUsers=[],n.renderer=new vt(pt(n),pt(n)),n.updateViewForNamedCollection=n.updateViewForNamedCollection.bind(pt(n)),n.eventUserSelected=n.eventUserSelected.bind(pt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(pt(n)),n.handleFavouriteUserLoggedIn=n.handleFavouriteUserLoggedIn.bind(pt(n)),n.handleFavouriteUserLoggedOut=n.handleFavouriteUserLoggedOut.bind(pt(n)),n.handleFavouriteUsersChanged=n.handleFavouriteUsersChanged.bind(pt(n)),n.handleBlockedUsersChanged=n.handleBlockedUsersChanged.bind(pt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(pt(n)),n.itemDeleted=n.itemDeleted.bind(pt(n)),n.localisedSM=new ee(!0),n.localisedSM.addChangeListenerForName(T,pt(n)),oe.getInstance().addUserListener(pt(n)),It(n.localisedSM.getStateByName(T)),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,bt(t,n);var a=i.prototype;return a.handleLoggedInUsersUpdated=function(e){It("Received new list of users who are logged in "),It(e),this.loggedInUsers=e,this.updateViewForNamedCollection(T,{})},a.handleFavouriteUserLoggedIn=function(e){It("Handle Favourite User "+e+" logged in"),this.updateViewForNamedCollection(T,{})},a.handleFavouriteUserLoggedOut=function(e){It("Handle Favourite User "+e+" logged in"),this.updateViewForNamedCollection(T,{})},a.handleFavouriteUsersChanged=function(e){It("Handle Favourite Users changed to "+e),this.updateViewForNamedCollection(T,{})},a.handleBlockedUsersChanged=function(e){It("Handle Blocked Users changed to "+e),this.updateViewForNamedCollection(T,{})},a.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),$("#"+i.fastSearchInputId).on("autocompleteselect",this.eventUserSelected)},a.getIdForItemInNamedCollection=function(e,t){return t._id},a.renderDisplayForItemInNamedCollection=function(e,t,n){e.innerHTML=n.username},a.getModifierForItemInNamedCollection=function(e,t){var n=Ie.normal;return Ct("Checking for item modifiers"),Ct(t),ie.getInstance().isUserLoggedIn(t.username)||(n=Ie.inactive),n},a.getSecondaryModifierForItemInNamedCollection=function(e,t){var n=Ie.normal;return Ct("Checking for item secondary modifiers "+t.username),oe.getInstance().isFavouriteUser(t.username)&&(Ct("is favourite"),n=Ie.active),oe.getInstance().isBlockedUser(t.username)&&(Ct("is blocked"),n=Ie.warning),n},a.eventUserSelected=function(e,t){if(e.preventDefault(),e.stopPropagation(),It("User "+t.item.label+" with id "+t.item.value+" selected"),e.target.innerText="",!this.localisedSM.isItemInState(T,{_id:t.item.value},F)){var n=this.localisedSM.getStateByName(T);if(It("saved searches too long? recentUserSearch"),n.length>=i.dataLimit){It("saved searches too long - removing first");var a=n.shift();this.localisedSM.removeItemFromState(T,a,F,!0)}this.localisedSM.addNewItemToState(T,{_id:t.item.value,username:t.item.label},!0)}},a.updateViewForNamedCollection=function(t,n){if(t===T&&(It("Updating for recent searches"),n=this.localisedSM.getStateByName(T),It(n),e.prototype.updateViewForNamedCollection.call(this,t,n)),t===N){var a=Ge.getInstance().getLoggedInUsername(),r=$("#"+i.fastSearchInputId),s=[];n.forEach((function(e){var t={label:e.username,value:e._id};a!==e.username&&s.push(t)})),r.autocomplete({source:s}),r.autocomplete("option",{disabled:!1,minLength:1})}},a.itemAction=function(e,t,n){if(t===this.collectionUIConfig.extraActions[0].name){if(ie.getInstance().isUserInFavouriteList(n.username))return void It(n.username+" already in fav list, ignoring");ie.getInstance().addUserToFavouriteList(n.username)}if(t===this.collectionUIConfig.extraActions[1].name){if(ie.getInstance().isUserInBlockedList(n.username))return void It(n.username+" already in blocked list, ignoring");ie.getInstance().addUserToBlockedList(n.username)}},a.compareItemsForEquality=function(e,t){return L(e,t)},a.itemDeleted=function(e,t){Ct(t),It("Recent search user "+t.username+" with id "+t.id+" deleted - removing"),this.localisedSM.removeItemFromState(T,t,this.compareItemsForEquality,!0)},a.itemSelected=function(e,t){var n=oe.getInstance().startChatWithUser(t.username);Ge.getInstance().handleShowChat(n)},i}(mt);yt.fastSearchInputId="fastSearchUserNames",yt.dataLimit=10,yt.DOMConfig={viewConfig:{resultsContainerId:"recentUserSearches",dataSourceId:"userSearch"},resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"_id",keyType:Ce.number,modifiers:{normal:"list-group-item-primary",inactive:"list-group-item-light",active:"list-group-item-info",warning:"list-group-item-danger"},icons:{normal:"fas fa-comment",inactive:"fas fa-comment",active:"fas fa-heart",warning:"fas fa-exclamation-circle"},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,quickDelete:!0,delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-sm",iconClasses:"fas fa-trash-alt"},drag:{type:A,from:M}},extraActions:[{name:"favourite",buttonClasses:"btn bg-info text-white btn-circle btn-sm mr-1",iconClasses:"fas fa-user-plus"},{name:"block",buttonClasses:"btn bg-warning text-white btn-circle btn-sm mr-1",iconClasses:"fas fa-user-slash"}]};const wt=yt;function Et(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function St(e,t){return(St=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Lt=r()("chat-sidebar"),Ft=function(e){var t,n;function i(){var t;return(t=e.call(this,i.DOMConfig,new h,k)||this).selectedChatLog=null,t.renderer=new vt(Et(t),Et(t)),t.handleChatLogsUpdated=t.handleChatLogsUpdated.bind(Et(t)),t.handleChatLogUpdated=t.handleChatLogUpdated.bind(Et(t)),t.handleChatStarted=t.handleChatStarted.bind(Et(t)),oe.getInstance().addListener(Et(t)),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,St(t,n);var a=i.prototype;return a.compareItemsForEquality=function(e,t){return function(e,t){return e.roomName===t.roomName}(e,t)},a.updateStateManager=function(){Lt("Updating state with chat manager");var e=ie.getInstance().getChatLogs();Lt(e),this.stateManager.setStateByName(k,e,!0)},a.handleNewInviteReceived=function(e){return!0},a.handleChatLogUpdated=function(e){Lt("Handling chat log updates"),this.updateStateManager()},a.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.addEventCollectionListener(this),this.updateStateManager()},a.getIdForItemInNamedCollection=function(e,t){return t.roomName},a.renderDisplayForItemInNamedCollection=function(e,t,n){e.innerHTML=n.users.join(",")},a.getModifierForItemInNamedCollection=function(e,t){var n=Ie.inactive;return this.selectedChatLog&&this.selectedChatLog.roomName===t.roomName&&(n=Ie.active),n},a.getSecondaryModifierForItemInNamedCollection=function(e,t){return this.getModifierForItemInNamedCollection(e,t)},a.selectChatRoom=function(e){var t=ie.getInstance().getChatLog(e);this.selectedChatLog=t,this.eventForwarder.itemSelected(this,this.selectedChatLog),this.updateStateManager()},a.handleChatLogsUpdated=function(){this.selectedChatLog&&ie.getInstance().touchChatLog(this.selectedChatLog.roomName),this.updateStateManager()},a.handleChatStarted=function(e){this.selectedChatLog=e,this.eventForwarder.itemSelected(this,this.selectedChatLog),this.updateStateManager()},a.getBadgeValueForItemInNamedCollection=function(e,t){return t.numOfNewMessages},a.canDeleteItem=function(e,t){return!0},a.itemDeleted=function(e,t){Lt("Deleting chat "+t.roomName),ie.getInstance().leaveChat(t.roomName),this.selectedChatLog&&this.selectedChatLog.roomName===t.roomName&&(this.eventForwarder.itemDeselected(this,this.selectedChatLog),this.selectedChatLog=null),this.updateStateManager()},a.hideRequested=function(e){this.selectedChatLog&&(this.eventForwarder.itemDeselected(this,this.selectedChatLog),this.selectedChatLog=null)},a.hidden=function(){this.hideRequested(this)},a.documentLoaded=function(e){},a.itemAction=function(e,t,n){},a.itemDragStarted=function(e,t){},a.itemDropped=function(e,t){},a.itemSelected=function(e,t){this.selectedChatLog=t,this.updateStateManager()},a.itemDeselected=function(e,t){this.selectedChatLog=null,this.updateStateManager()},a.showRequested=function(e){},a.handleOfflineMessagesReceived=function(e){},a.handleInvitationDeclined=function(e,t){},a.canSelectItem=function(e,t){return!0},i}(mt);Ft.DOMConfig={viewConfig:{resultsContainerId:"chatLogs",dataSourceId:"chatLogs"},resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"roomName",keyType:Ce.string,modifiers:{normal:"",inactive:"list-group-item-dark",active:"list-group-item-primary",warning:""},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-sm",iconClasses:"text-black fas fa-sign-out-alt"},badge:{elementType:"span",elementClasses:"badge badge-pill badge-primary mr-1"}}};const Nt=Ft;var kt=r()("sidebar-container");const Dt=function(){function e(e){this.prefs=e,this.views=[],this.eventHide=this.eventHide.bind(this),this.eventShow=this.eventShow.bind(this)}var t=e.prototype;return t.addView=function(e,t){kt("Adding view to container, with containing div of "+t.containerId);var n=document.getElementById(t.containerId);n&&(kt("Adding view to container, with containing div of "+t.containerId+" - FOUND"),e.setContainedBy(n)),this.views.push(e),e.addEventListener(this)},t.onDocumentLoaded=function(){this.eventHide(null);var e=document.getElementById(this.prefs.id);if(null!==e){var t=e.querySelector(".close");t&&t.addEventListener("click",this.eventHide),this.views.forEach((function(e){e.onDocumentLoaded()}))}},t.eventHide=function(e){e&&e.preventDefault(),this.showHide("0%"),this.views.forEach((function(e){e.hidden()}))},t.eventShow=function(e){var t=this.prefs.expandedSize;window.innerWidth<769&&(t="50%"),window.innerWidth<415&&(t="100%"),this.showHide(t)},t.showHide=function(e){var t=document.getElementById(this.prefs.id);if(null!==t)switch(this.prefs.location){case ye.left:case ye.right:t.style.width=e;break;case ye.bottom:case ye.top:t.style.height=e}},t.documentLoaded=function(e){},t.itemAction=function(e,t,n){},t.canDeleteItem=function(e,t){return!0},t.itemDeleted=function(e,t){},t.itemDragStarted=function(e,t){},t.itemSelected=function(e,t){},t.itemDeselected=function(e,t){},t.itemDropped=function(e,t){},t.showRequested=function(e){this.eventShow(null)},t.hideRequested=function(e){this.eventHide(null)},t.canSelectItem=function(e,t){return!0},e}();function Rt(e,t){return(Rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tt=function(e){var t,n;function i(){return e.call(this,i.SidebarPrefs)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Rt(t,n),i}(Dt);Tt.SidebarPrefs={id:"userSearchSideBar",expandedSize:"35%",location:ye.left},Tt.SidebarContainers={recentSearches:"userSearchZone",favourites:"favouriteUsersDropZone",blocked:"blockedUsersDropZone"};const Ut=Tt;function At(e,t){return(At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ot=function(e){var t,n;function i(){return e.call(this,i.SidebarPrefs)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,At(t,n),i}(Dt);Ot.SidebarPrefs={id:"chatSideBar",expandedSize:"35%",location:ye.right},Ot.SidebarContainers={chatLogs:"chatLogs",chatLog:"chatLogRoom"};const Mt=Ot;function xt(e,t){return(xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var jt=function(e){var t,n;function i(){return e.call(this,i.SidebarPrefs)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,xt(t,n),i}(Dt);jt.SidebarPrefs={id:"exerciseTypesSidebar",expandedSize:"50%",location:ye.left},jt.SidebarContainers={container:"exerciseTypesContainer"};var _t=r()("chat-sidebar:detail"),Bt=function(){function e(e){this.stateManager=e,this.selectedChatLog=null,this.handleAddMessage=this.handleAddMessage.bind(this),this.handleChatLogsUpdated=this.handleChatLogsUpdated.bind(this),this.handleChatLogUpdated=this.handleChatLogUpdated.bind(this),this.handleChatStarted=this.handleChatStarted.bind(this),this.handleUserDrop=this.handleUserDrop.bind(this),this.leaveChat=this.leaveChat.bind(this),this.eventUserSelected=this.eventUserSelected.bind(this),oe.getInstance().addListener(this),this.stateManager.addChangeListenerForName(N,this)}var t=e.prototype;return t.getListenerName=function(){return"Chat Log Details"},t.canSelectItem=function(e,t){return!0},t.hasPermissionToDeleteItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.hasPermissionToUpdateItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.hasChanged=function(){throw new Error("Method not implemented.")},t.setContainedBy=function(e){},t.addEventListener=function(e){},t.getIdForItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.getDisplayValueForItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.compareItemsForEquality=function(e,t){throw new Error("Method not implemented.")},t.getModifierForItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.getSecondaryModifierForItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.getBadgeValueForItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.getBackgroundImageForItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.updateViewForNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.itemDeselected=function(e,t){_t("Chat Log with id "+t.roomName+" deselected"),this.selectedChatLog&&t.roomName===this.selectedChatLog.roomName&&(this.selectedChatLog=null,this.checkCanComment(),this.clearChatLog())},t.itemSelected=function(e,t){this.selectedChatLog=t,this.selectedChatLog&&(_t("Chat Log with id "+t.roomName+" selected"),this.checkCanComment(),this.renderChatLog(this.selectedChatLog))},t.canDeleteItem=function(e,t){return!0},t.itemDeleted=function(e,t){_t("Chat Log with "+t.roomName+" deleting"),this.selectedChatLog&&this.selectedChatLog.roomName===t.roomName&&(this.checkCanComment(),this.renderChatLog(this.selectedChatLog))},t.hideRequested=function(e){this.selectedChatLog=null,this.checkCanComment(),this.clearChatLog()},t.handleUserDrop=function(e){if(_t("drop event on current chat room"),this.selectedChatLog){var t=e.dataTransfer.getData(Ee),n=JSON.parse(t);_t(n),n.draggedType===A&&(ie.getInstance().sendInvite(n.username,this.selectedChatLog.roomName),Y.getInstance().show("Chat","Invited "+n.username+" to the chat."))}},t.handleChatLogUpdated=function(e){_t("Handling chat log updates"),this.checkCanComment(),this.renderChatLog(e)},t.handleAddMessage=function(e){if(e.preventDefault(),e.stopPropagation(),_t("Handling message event"),this.selectedChatLog){if(this.commentEl&&0===this.commentEl.value.trim().length)return;var t=this.commentEl.value.trim();this.commentEl.value="";var n=ie.getInstance().sendMessage(this.selectedChatLog.roomName,t,m.Normal,{});if(n){var i=this.addChatMessage(n);ft.scrollSmoothTo(i)}}},t.onDocumentLoaded=function(){var t=this;this.chatLogDiv=document.getElementById(e.chatLogId),this.commentEl=document.getElementById(e.commentId),this.chatForm=document.getElementById(e.newFormId),this.sendMessageButton=document.getElementById(e.submitCommentId),this.leaveChatButton=document.getElementById(e.leaveChatId),this.chatRoomDiv=document.getElementById(e.chatLogRoomId),this.fastUserSearch=document.getElementById(e.chatFastSearchUserNames),this.chatRoomDiv.addEventListener("dragover",(function(e){_t("Dragged over"),t.selectedChatLog&&e.preventDefault()})),this.chatRoomDiv.addEventListener("drop",this.handleUserDrop),this.chatForm.addEventListener("submit",this.handleAddMessage),this.leaveChatButton.addEventListener("click",this.leaveChat),this.checkCanComment(),$("#"+e.chatFastSearchUserNames).on("autocompleteselect",this.eventUserSelected)},t.eventUserSelected=function(e,t){e.preventDefault(),e.stopPropagation(),_t("User "+t.item.label+" with id "+t.item.value+" selected"),e.target.innerText="",this.selectedChatLog&&ie.getInstance().sendInvite(t.item.label,this.selectedChatLog.roomName),Y.getInstance().show("Chat","Invited "+t.item.label+" to the chat.")},t.addChatMessage=function(e){var t=document.createElement("div");if(ft.addRemoveClasses(t,"message"),0===e.from.trim().length){var n=document.createElement("div");ft.addRemoveClasses(n,"message-sender"),n.innerText=e.message,t.appendChild(n)}else{if(e.from===ie.getInstance().getCurrentUser())ft.addRemoveClasses(t,"my-message");else{var i=document.createElement("div");ft.addRemoveClasses(i,"message-sender"),i.innerText=e.from+"   "+z()(e.created,"YYYYMMDDHHmmss").format("DD/MM/YYYY "),t.appendChild(i)}var a=document.createElement("div");e.from===ie.getInstance().getCurrentUser()?ft.addRemoveClasses(a,"my-message-content"):ft.addRemoveClasses(a,"message-content"),a.innerText=e.message,t.appendChild(a)}return this.chatLogDiv.appendChild(t),t},t.reRenderChatMessages=function(e){var t=this;ft.removeAllChildren(this.chatLogDiv);var n=null;e.messages.forEach((function(e){n=t.addChatMessage(e)})),n&&ft.scrollTo(n)},t.renderChatLog=function(e){_t("Chat Log "+e.roomName+" rendering"),this.selectedChatLog&&this.selectedChatLog.roomName===e.roomName&&(this.selectedChatLog=e,ie.getInstance().touchChatLog(e.roomName),this.reRenderChatMessages(e))},t.handleChatLogsUpdated=function(){this.selectedChatLog&&(ie.getInstance().touchChatLog(this.selectedChatLog.roomName),this.reRenderChatMessages(this.selectedChatLog)),this.checkCanComment()},t.handleChatStarted=function(e){this.selectedChatLog=e,this.renderChatLog(e)},t.leaveChat=function(e){e.preventDefault(),e.stopPropagation(),this.selectedChatLog&&(ie.getInstance().leaveChat(this.selectedChatLog.roomName),this.selectedChatLog=null,this.clearChatLog(),this.checkCanComment())},t.checkCanComment=function(){this.selectedChatLog?(this.commentEl&&this.commentEl.removeAttribute("readonly"),this.commentEl&&this.commentEl.removeAttribute("disabled"),this.sendMessageButton&&this.sendMessageButton.removeAttribute("disabled"),this.leaveChatButton&&this.leaveChatButton.removeAttribute("disabled"),this.fastUserSearch&&this.fastUserSearch.removeAttribute("disabled")):(this.commentEl&&this.commentEl.setAttribute("readonly","true"),this.commentEl&&this.commentEl.setAttribute("disabled","true"),this.sendMessageButton&&this.sendMessageButton.setAttribute("disabled","true"),this.leaveChatButton&&this.leaveChatButton.setAttribute("disabled","true"),this.fastUserSearch&&this.fastUserSearch.setAttribute("disabled","true"))},t.clearChatLog=function(){ft.removeAllChildren(this.chatLogDiv)},t.stateChanged=function(t,n,i){if(n===N){var a=$("#"+e.ssFastSearchUserNames),r=Ge.getInstance().getLoggedInUsername(),s=[];i.forEach((function(e){var t={label:e.username,value:e._id};r!==e.username&&s.push(t)})),a.autocomplete({source:s}),a.autocomplete("option",{disabled:!1,minLength:1})}},t.stateChangedItemAdded=function(e,t,n){this.stateChanged(e,t,this.stateManager.getStateByName(t))},t.stateChangedItemRemoved=function(e,t,n){},t.stateChangedItemUpdated=function(e,t,n,i){},t.handleOfflineMessagesReceived=function(e){},t.handleInvitationDeclined=function(e,t){},t.handleNewInviteReceived=function(e){return!0},t.itemDragStarted=function(e,t){},t.itemAction=function(e,t,n){},t.documentLoaded=function(e){},t.showRequested=function(e){},t.itemDropped=function(e,t){},t.getName=function(){return"chatLog"},t.hidden=function(){this.hideRequested(this)},t.getDataSourceKeyId=function(){return""},t.getUIConfig=function(){},t.render=function(){},t.show=function(){},e}();Bt.newFormId="newMessage",Bt.commentId="message",Bt.submitCommentId="submitMessage",Bt.chatLogId="chatLog",Bt.chatLogRoomId="chatLogRoom",Bt.leaveChatId="leaveChat",Bt.chatFastSearchUserNames="chatFastSearchUserNames";const Vt=Bt;function Ht(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pt(e,t){return(Pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qt=r()("user-search-sidebar"),Wt=r()("user-search-sidebar:detail"),Yt=function(e){var t,n;function i(t){var n;return(n=e.call(this,i.DOMConfig,t,N)||this).renderer=new vt(Ht(n),Ht(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(Ht(n)),n.handleFavouriteUserLoggedIn=n.handleFavouriteUserLoggedIn.bind(Ht(n)),n.handleFavouriteUserLoggedOut=n.handleFavouriteUserLoggedOut.bind(Ht(n)),n.handleFavouriteUsersChanged=n.handleFavouriteUsersChanged.bind(Ht(n)),n.handleBlockedUsersChanged=n.handleBlockedUsersChanged.bind(Ht(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(Ht(n)),oe.getInstance().addUserListener(Ht(n)),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Pt(t,n);var a=i.prototype;return a.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.addEventCollectionListener(this)},a.handleLoggedInUsersUpdated=function(e){qt("Received new list of users who are logged in "),this.updateViewForNamedCollection("",{})},a.handleFavouriteUserLoggedIn=function(e){qt("Handle Favourite User "+e+" logged in"),this.updateViewForNamedCollection("",{})},a.handleFavouriteUserLoggedOut=function(e){qt("Handle Favourite User "+e+" logged in"),this.updateViewForNamedCollection("",{})},a.handleFavouriteUsersChanged=function(e){qt("Handle Favourite Users changed to "+e),this.updateViewForNamedCollection("",{})},a.getIdForItemInNamedCollection=function(e,t){return t._id},a.renderDisplayForItemInNamedCollection=function(e,t,n){e.innerHTML=n.username},a.getModifierForItemInNamedCollection=function(e,t){var n=Ie.normal;return ie.getInstance().isUserLoggedIn(t.username)||(n=Ie.inactive),n},a.getSecondaryModifierForItemInNamedCollection=function(e,t){var n=Ie.normal;return Wt("Checking for item secondary modifiers "+t.username),oe.getInstance().isFavouriteUser(t.username)&&(Wt("is favourite"),n=Ie.active),oe.getInstance().isBlockedUser(t.username)&&(Wt("is blocked"),n=Ie.warning),n},a.updateViewForNamedCollection=function(t,n){var i,a=[],r=null==(i=this.stateManager)?void 0:i.getStateByName(N);r&&r.forEach((function(e){ie.getInstance().isUserInFavouriteList(e.username)&&a.push(e)})),e.prototype.updateViewForNamedCollection.call(this,t,a)},a.documentLoaded=function(e){},a.handleBlockedUsersChanged=function(e){this.updateViewForNamedCollection("",{})},a.hideRequested=function(e){},a.itemAction=function(e,t,n){if(t===this.collectionUIConfig.extraActions[0].name){if(ie.getInstance().isUserInBlockedList(n.username))return void qt(n.username+" already in fav list, ignoring");ie.getInstance().addUserToBlockedList(n.username)}},a.canDeleteItem=function(e,t){return!0},a.itemDeleted=function(e,t){qt("Favourite user "+t.username+" with id "+t.id+" deleted - removing"),ie.getInstance().removeUserFromFavouriteList(t.username)},a.itemDragStarted=function(e,t){},a.itemDeselected=function(e,t){},a.itemDropped=function(e,t){qt("Handling item dropped "+t.username),ie.getInstance().isUserInFavouriteList(t.username)?qt(t.username+" already in fav list, ignoring"):ie.getInstance().addUserToFavouriteList(t.username)},a.itemSelected=function(e,t){var n=oe.getInstance().startChatWithUser(t.username);Ge.getInstance().handleShowChat(n)},a.showRequested=function(e){},a.canSelectItem=function(e,t){return!0},i}(mt);Yt.DOMConfig={viewConfig:{resultsContainerId:"favouriteUsers",drop:{acceptFrom:[M],acceptTypes:[A]},dataSourceId:"favouriteUsers"},resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"_id",keyType:Ce.string,modifiers:{normal:"list-group-item-primary",inactive:"list-group-item-light",active:"list-group-item-info",warning:"list-group-item-danger"},icons:{normal:"fas fa-comment",inactive:"fas fa-comment",active:"fas fa-heart",warning:"fas fa-exclamation-circle"},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,quickDelete:!0,delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-sm",iconClasses:"fas fa-trash-alt"},drag:{type:A,from:x}},extraActions:[{name:"block",buttonClasses:"btn bg-warning text-white btn-circle btn-sm mr-1",iconClasses:"fas fa-user-slash"}]};const Gt=Yt;function Jt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qt(e,t){return(Qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var zt=r()("user-search-sidebar"),$t=function(e){var t,n;function i(t){var n;return(n=e.call(this,i.DOMConfig,t,N)||this).renderer=new vt(Jt(n),Jt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(Jt(n)),n.handleFavouriteUserLoggedIn=n.handleFavouriteUserLoggedIn.bind(Jt(n)),n.handleFavouriteUserLoggedOut=n.handleFavouriteUserLoggedOut.bind(Jt(n)),n.handleFavouriteUsersChanged=n.handleFavouriteUsersChanged.bind(Jt(n)),n.handleBlockedUsersChanged=n.handleBlockedUsersChanged.bind(Jt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(Jt(n)),oe.getInstance().addUserListener(Jt(n)),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Qt(t,n);var a=i.prototype;return a.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.addEventListener(this)},a.canDeleteItem=function(e,t){return!0},a.documentLoaded=function(e){},a.itemDeleted=function(e,t){zt("Blocked user "+t.username+" with id "+t.id+" deleted - removing"),ie.getInstance().removeUserFromBlockedList(t.username)},a.itemSelected=function(e,t){throw new Error("Method not implemented.")},a.itemDragStarted=function(e,t){throw new Error("Method not implemented.")},a.itemAction=function(e,t,n){throw new Error("Method not implemented.")},a.hideRequested=function(e){throw new Error("Method not implemented.")},a.showRequested=function(e){throw new Error("Method not implemented.")},a.handleLoggedInUsersUpdated=function(e){},a.handleFavouriteUserLoggedIn=function(e){},a.handleFavouriteUserLoggedOut=function(e){},a.handleFavouriteUsersChanged=function(e){},a.handleBlockedUsersChanged=function(e){zt("Handle Blocked Users changed to "+e),this.updateViewForNamedCollection("",{})},a.renderDisplayForItemInNamedCollection=function(e,t,n){e.innerHTML=n.username},a.getSecondaryModifierForItemInNamedCollection=function(e,t){return Ie.warning},a.getIdForItemInNamedCollection=function(e,t){return t._id},a.updateViewForNamedCollection=function(t,n){var i,a=[],r=null==(i=this.stateManager)?void 0:i.getStateByName(N);r&&r.forEach((function(e){ie.getInstance().isUserInBlockedList(e.username)&&a.push(e)})),e.prototype.updateViewForNamedCollection.call(this,t,a)},a.itemDropped=function(e,t){ie.getInstance().isUserInBlockedList(t.username)?zt(t.username+" already in blocked list, ignoring"):ie.getInstance().addUserToBlockedList(t.username)},a.itemDeselected=function(e,t){},a.canSelectItem=function(e,t){return!1},i}(mt);$t.DOMConfig={viewConfig:{resultsContainerId:"blockedUsers",dataSourceId:"blockedUsers",drop:{acceptFrom:[M,x],acceptTypes:[A]}},resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"_id",keyType:Ce.string,modifiers:{normal:"list-group-item-primary",inactive:"list-group-item-light",active:"list-group-item-info",warning:"list-group-item-danger"},icons:{normal:"fas fa-comment",inactive:"fas fa-comment",active:"fas fa-heart",warning:"fas fa-exclamation-circle"},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,quickDelete:!0,delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-sm",iconClasses:"fas fa-trash-alt"}}};const Kt=$t;var Zt=r()("carousel-renderer"),Xt=function(){function e(e,t,n){this.lastRenderedContainer=null,this.lastRenderedCollectionName=null,this.lastRenderedCollection=null,this.previousWindowWidth=0,this.view=e,this.eventHandler=t,this.config=n}var t=e.prototype;return t.onDocumentLoaded=function(){var e=this;this.previousWindowWidth=window.innerWidth,window.addEventListener("resize",(function(t){var n=window.innerWidth,i=!1;n<e.previousWindowWidth?(e.previousWindowWidth>Le&&n<=Le&&(i=!0,Zt("window reduced and is now smaller or equal to large")),e.previousWindowWidth>Fe&&n<=Fe&&(i=!0,Zt("window reduced and is now smaller or equal to medium")),e.previousWindowWidth>Ne&&n<=Ne&&(i=!0,Zt("window reduced and is now smaller or equal to small"))):(e.previousWindowWidth<=Ne&&n>Ne&&(Zt("window increased and is now larger than small"),i=!0),e.previousWindowWidth<=Fe&&n>Fe&&(Zt("window increased and is now larger than medium"),i=!0),e.previousWindowWidth<=Le&&n>Le&&(Zt("window increased and is now larger than large"),i=!0)),e.previousWindowWidth=n,e.lastRenderedContainer&&e.lastRenderedCollection&&e.lastRenderedCollectionName&&i&&e.setDisplayElementsForCollectionInContainer(e.lastRenderedContainer,e.lastRenderedCollectionName,e.lastRenderedCollection)}))},t.createDisplayElementForCollectionItem=function(e,t){var n=this,i=this.view.getDataSourceKeyId(),a=this.view.getIdForItemInNamedCollection(e,t),r=this.view.hasPermissionToDeleteItemInNamedCollection(e,t);Zt("view "+this.view.getName()+": creating carousel item"),Zt(t);var s=this.view.getCollectionUIConfig(),o=document.createElement(s.resultsElementType);if(ft.addRemoveClasses(o,s.resultsClasses),ft.addAttributes(o,s.resultsElementAttributes),o.setAttribute(s.keyId,a),o.setAttribute(i,s.viewConfig.dataSourceId),s.detail.background){var d=document.createElement(s.detail.background.elementType);ft.addRemoveClasses(d,s.detail.background.elementClasses),ft.addAttributes(d,s.detail.background.elementAttributes),d.setAttribute(s.keyId,a),d.setAttribute(i,s.viewConfig.dataSourceId),o.appendChild(d),this.view.renderBackgroundForItemInNamedCollection(d,e,t)}var c=o;if(s.detail.containerClasses){var l=document.createElement("div");if(ft.addRemoveClasses(l,s.detail.containerClasses),l.setAttribute(s.keyId,a),l.setAttribute(i,s.viewConfig.dataSourceId),c=document.createElement(s.detail.textElementType),ft.addRemoveClasses(c,s.detail.textElementClasses),c.setAttribute(s.keyId,a),c.setAttribute(i,s.viewConfig.dataSourceId),l.appendChild(c),s.extraActions||s.detail.delete){var u=document.createElement(this.config.actionContainer.elementType);if(ft.addRemoveClasses(u,this.config.actionContainer.elementClasses),l.appendChild(u),s.extraActions&&s.extraActions.forEach((function(r){if(n.view.hasPermissionToActionItemInNamedCollection(r.name,e,t)){var o=document.createElement("button");if(o.setAttribute("type","button"),ft.addRemoveClasses(o,r.buttonClasses),ft.addAttributes(o,r.attributes),r.buttonText&&(o.innerHTML=r.buttonText),r.iconClasses){var d=document.createElement("i");ft.addRemoveClasses(d,r.iconClasses),d.setAttribute(s.keyId,a),d.setAttribute(i,s.viewConfig.dataSourceId),d.setAttribute(Se,r.name),o.appendChild(d)}o.setAttribute(s.keyId,a),o.setAttribute(i,s.viewConfig.dataSourceId),o.setAttribute(Se,r.name),o.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),n.eventHandler.eventActionClicked(e)})),u.appendChild(o)}})),s.detail.delete&&s&&r){var h=document.createElement("button");if(h.setAttribute("type","button"),ft.addRemoveClasses(h,s.detail.delete.buttonClasses),ft.addAttributes(h,s.detail.delete.attributes),s.detail.delete.buttonText&&(h.innerHTML=s.detail.delete.buttonText),s.detail.delete.iconClasses){var m=document.createElement("i");ft.addRemoveClasses(m,s.detail.delete.iconClasses),m.setAttribute(s.keyId,a),m.setAttribute(i,s.viewConfig.dataSourceId),h.appendChild(m)}h.setAttribute(s.keyId,a),h.setAttribute(i,s.viewConfig.dataSourceId),h.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),n.eventHandler.eventDeleteClickItem(e)})),u.appendChild(h)}}o.appendChild(l),s.detail.drag&&(o.setAttribute("draggable","true"),o.addEventListener("dragstart",this.eventHandler.eventStartDrag)),s.detail.select&&o.addEventListener("click",this.eventHandler.eventClickItem)}if(c.setAttribute(s.keyId,a),c.setAttribute(i,s.viewConfig.dataSourceId),this.view.renderDisplayForItemInNamedCollection(c,e,t),s.modifiers){var f=this.view.getModifierForItemInNamedCollection(e,t),g=this.view.getSecondaryModifierForItemInNamedCollection(e,t);switch(f){case Ie.normal:if(Zt("view "+this.view.getName()+": normal item"),ft.addRemoveClasses(o,s.modifiers.normal),s.icons&&s.icons.normal){var v=document.createElement("i");ft.addRemoveClasses(v,s.icons.normal),v.setAttribute(s.keyId,a),v.setAttribute(i,s.viewConfig.dataSourceId),c.appendChild(v)}switch(g){case Ie.warning:if(ft.addRemoveClasses(o,s.modifiers.normal,!1),ft.addRemoveClasses(o,s.modifiers.warning,!0),s.icons&&s.icons.warning){var p=document.createElement("i");ft.addRemoveClasses(p,s.icons.warning),p.setAttribute(s.keyId,a),p.setAttribute(i,s.viewConfig.dataSourceId),c.appendChild(p)}break;case Ie.active:if(s.icons&&s.icons.active){var b=document.createElement("i");ft.addRemoveClasses(b,s.icons.active),b.setAttribute(s.keyId,a),b.setAttribute(i,s.viewConfig.dataSourceId),c.appendChild(b)}}break;case Ie.active:if(Zt("view "+this.view.getName()+": active item"),ft.addRemoveClasses(o,s.modifiers.active),s.icons&&s.icons.active){var I=document.createElement("i");ft.addRemoveClasses(I,s.icons.active),I.setAttribute(s.keyId,a),I.setAttribute(i,s.viewConfig.dataSourceId),c.appendChild(I)}switch(g){case Ie.warning:if(ft.addRemoveClasses(o,s.modifiers.active,!1),ft.addRemoveClasses(o,s.modifiers.warning,!0),s.icons&&s.icons.warning){var C=document.createElement("i");ft.addRemoveClasses(C,s.icons.warning),C.setAttribute(s.keyId,a),C.setAttribute(i,s.viewConfig.dataSourceId),c.appendChild(C)}}break;case Ie.inactive:if(Zt("view "+this.view.getName()+": inactive item"),ft.addRemoveClasses(o,s.modifiers.inactive),s.icons&&s.icons.inactive){var y=document.createElement("i");ft.addRemoveClasses(y,s.icons.inactive),y.setAttribute(s.keyId,a),y.setAttribute(i,s.viewConfig.dataSourceId),c.appendChild(y)}switch(g){case Ie.warning:if(s.icons&&s.icons.warning){ft.addRemoveClasses(o,s.modifiers.inactive,!1),ft.addRemoveClasses(o,s.modifiers.warning,!0);var w=document.createElement("i");ft.addRemoveClasses(w,s.icons.warning),w.setAttribute(s.keyId,a),w.setAttribute(i,s.viewConfig.dataSourceId),c.appendChild(w)}break;case Ie.active:if(s.icons&&s.icons.active){var E=document.createElement("i");ft.addRemoveClasses(E,s.icons.active),E.setAttribute(s.keyId,a),E.setAttribute(i,s.viewConfig.dataSourceId),c.appendChild(E)}}}}return o},t.setDisplayElementsForCollectionInContainer=function(e,t,n){Zt("view "+this.view.getName()+": creating carousel results"),Zt(n),ft.removeAllChildren(e);var i=n.length,a=this.config.itemsPerRow.xlarge;window.innerWidth<=Le&&(a=this.config.itemsPerRow.large),window.innerWidth<=Fe&&(a=this.config.itemsPerRow.medium),window.innerWidth<=Ne&&(a=this.config.itemsPerRow.small);var r=Math.ceil(i/a);Zt("view "+this.view.getName()+": creating carousel with number of results per row of "+a+" with rows "+r);for(var s=0;s<r;s++){var o=document.createElement(this.config.rowContainer.elementType);ft.addRemoveClasses(o,this.config.rowContainer.elementClasses),ft.addAttributes(o,this.config.rowContainer.elementAttributes);var d=document.createElement(this.config.row.elementType);ft.addRemoveClasses(d,this.config.row.elementClasses),ft.addAttributes(d,this.config.row.elementAttributes),o.appendChild(d),(0===s&&this.config.activeRowPosition===we.first||s===r-1&&this.config.activeRowPosition===we.last)&&(ft.addRemoveClasses(o,this.config.activeRow.elementClasses),ft.addAttributes(o,this.config.activeRow.elementAttributes));for(var c=s*a;c<(s+1)*a&&c<i;){Zt("rowIndex "+s+" item index "+c);var l=n[c],u=d;this.config.multipleItemsPerRowContainer&&(u=document.createElement(this.config.multipleItemsPerRowContainer.elementType),ft.addRemoveClasses(u,this.config.multipleItemsPerRowContainer.elementClasses),ft.addAttributes(u,this.config.multipleItemsPerRowContainer.elementAttributes),d.appendChild(u));var h=this.createDisplayElementForCollectionItem(t,l);u.appendChild(h),c++}e.appendChild(o)}$('[data-toggle="tooltip"]').tooltip(),this.lastRenderedContainer=e,this.lastRenderedCollectionName=t,this.lastRenderedCollection=n},e}();function en(e,t){var n=/^(\d+:)?[0-5]?\d:[0-5]\d$/,i=n.test(e),a=n.test(t);if(i&&a){var r=e.split(":"),s=t.split(":"),o=0,d=parseInt(r[r.length-1])+parseInt(s[s.length-1]);d>=60&&(o=1,d-=60);var c=parseInt(r[r.length-2])+parseInt(s[s.length-2])+o;c>=60&&(o=1,c-=60);var l=0;3==r.length&&(l=parseInt(r[0]));var u=0;3==s.length&&(u=parseInt(s[0]));var h=l+u+o;return(h>0?h+":":"")+(c<10?"0"+c:c)+":"+(d<10?"0"+d:d)}return"00:00"}var tn=n(9403);function nn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function an(e,t){return(an=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rn=r()("workouts-view"),sn=function(e){var t,n;function i(){var t;return(t=e.call(this,i.DOMConfig.collectionConfig,Ge.getInstance().getStateManager(),R)||this).currentChart=null,t.renderer=new Xt(nn(t),nn(t),i.DOMConfig),t.addEventCollectionListener(nn(t)),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,an(t,n);var a=i.prototype;return a.canDeleteItem=function(e,t){return t.completed},a.compareItemsForEquality=function(e,t){return F(e,t)},a.getIdForItemInNamedCollection=function(e,t){return t._id},a.calculateExerciseSummary=function(e){var t={weight:0,distance:0,duration:"00:00"};if(e.exercises)for(var n=0;n<e.exercises.length;n++){var i=e.exercises[n];t.weight+=i.weight,t.distance+=i.distance,t.duration=en(t.duration,i.duration)}return t},a.renderDisplayForItemInNamedCollection=function(e,t,n){var i=this.calculateExerciseSummary(n),a="";a+='<h5 class="card-title">'+z()(n.createdOn,"YYYYMMDDHHmmss").format("ddd, DD/MM/YYYY HH:mm")+"</h5>",a+='<ul class="list-group list-group-flush">',a+='<li class="list-group-item"><strong>Duration:</strong> '+i.duration+"</li>",i.weight>0&&(a+='<li class="list-group-item"><strong>Total Weight:</strong> '+i.weight+"</li>"),i.distance>0&&(a+='<li class="list-group-item"><strong>Total Distance: </strong> '+i.distance+"</li>"),a+="</ul>",e.innerHTML=a},a.hasPermissionToDeleteItemInNamedCollection=function(e,t){return t.completed},a.hasPermissionToActionItemInNamedCollection=function(e,t,n){var i=!1;return"template"===e&&n.completed&&!0===n.completed&&(i=!0),"continue"===e&&!1===n.completed&&(i=!0),i},a.getModifierForItemInNamedCollection=function(e,t){var n=Ie.inactive;return t.completed&&!0!==t.completed&&(n=Ie.active),n},a.renderBackgroundForItemInNamedCollection=function(e,t,n){if(this.currentChart&&this.currentChart.destroy(),n.exercises){var a=this.getDataSourceKeyId(),r=this.getIdForItemInNamedCollection(t,n),s=document.createElement("canvas");ft.addAttributes(s,[{name:"style",value:"height:100%; width:100%"}]),s.setAttribute(this.collectionUIConfig.keyId,r),s.setAttribute(a,this.collectionUIConfig.viewConfig.dataSourceId);var o=[],d=[],c=[],l=[];n.exercises.forEach((function(e){var t;o.push((10,(t=e.name).length<=10?t:t.slice(0,10)+"...")),"cardio"===e.type?(d.push(e.distance),c.push(i.bgCardio),l.push(i.borderCardio)):(d.push(e.weight),c.push(i.bgStrength),l.push(i.borderStrength))}));var u={type:"bar",data:{labels:o,datasets:[{label:"Exercises",data:d,backgroundColor:c,borderColor:l,borderWidth:1}]},options:{responsive:!1,animation:!1,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}};rn(u),this.currentChart=new tn.Z(s,u),e.appendChild(s)}},a.itemAction=function(t,n,a){e.prototype.itemAction.call(this,t,n,a),n===i.DOMConfig.collectionConfig.extraActions[0].name&&Ge.getInstance().addWorkoutExercisesToCurrentWorkout(a),n===i.DOMConfig.collectionConfig.extraActions[1].name&&Ri.getInstance().showCurrentWorkout()},i}(mt);function on(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dn(e,t){return(dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}sn.DOMConfig={itemsPerRow:{small:1,medium:2,large:2,xlarge:2},rowContainer:{elementClasses:"carousel-item",elementType:"div"},activeRow:{elementType:"",elementClasses:"active"},activeRowPosition:we.last,row:{elementClasses:"row",elementType:"div"},multipleItemsPerRowContainer:{elementType:"div",elementClasses:"col-sm-12 col-md-6 mb-2"},actionContainer:{elementType:"div",elementClasses:"card-footer d-flex w-100 justify-content-end"},collectionConfig:{viewConfig:{resultsContainerId:"workouts",dataSourceId:"workouts",drop:{acceptTypes:[O],acceptFrom:[j]}},resultsElementType:"div",resultsClasses:"card",keyId:"_id",keyType:Ce.string,modifiers:{normal:"bg-light",inactive:"bg-light",active:"bg-light",warning:"bg-light"},detail:{containerClasses:"card-body",textElementType:"div",textElementClasses:"",select:!0,delete:{buttonClasses:"btn btn-warning btn-circle btn-md",iconClasses:"fas fa-trash text-white",attributes:[{name:"data-toggle",value:"tooltip"},{name:"data-placement",value:"top"},{name:"title",value:"Delete this workout"}]},background:{elementType:"div",elementClasses:""}},extraActions:[{name:"template",buttonText:"",buttonClasses:"btn btn-primary btn-circle btn-md mr-2",iconClasses:"fas fa-copy",attributes:[{name:"data-toggle",value:"tooltip"},{name:"data-placement",value:"top"},{name:"title",value:"Add the exercises from this workout to the current workout."}]},{name:"continue",buttonText:"",iconClasses:"fas fa-clipboard-list",buttonClasses:"btn btn-primary btn-circle btn-md mr-2",attributes:[{name:"data-toggle",value:"tooltip"},{name:"data-placement",value:"top"},{name:"title",value:"Continue this current workout"}]}]}},sn.bgStrength="rgba(255, 0, 0, 0.2)",sn.bgCardio="rgba(0, 50, 255, 0.2)",sn.borderStrength="rgb(255, 50, 0)",sn.borderCardio="rgb(0, 50 , 255)";var cn,ln,un=r()("exercise-types-view"),hn=function(e){var t,n;function i(t){var n;return(n=e.call(this,i.DOMConfig,t,D)||this).renderer=new vt(on(n),on(n)),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,dn(t,n);var a=i.prototype;return a.canDeleteItem=function(e,t){return un("Can Delete "+t),un(t.createdBy),!(!t.createdBy||t.createdBy!==Ge.getInstance().getLoggedInUsername())},a.compareItemsForEquality=function(e,t){return F(e,t)},a.getIdForItemInNamedCollection=function(e,t){return t._id},a.renderDisplayForItemInNamedCollection=function(e,t,n){e.innerHTML=n.name},a.hasPermissionToDeleteItemInNamedCollection=function(e,t){return un("Has delete permission "+t),un(t.createdBy),!(!t.createdBy||t.createdBy!==Ge.getInstance().getLoggedInUsername())},a.itemAction=function(t,n,a){e.prototype.itemAction.call(this,t,n,a),n===i.DOMConfig.extraActions[0].name&&Ge.getInstance().addExerciseToCurrentWorkout(a)},i}(mt);hn.DOMConfig={viewConfig:{resultsContainerId:"exerciseTypes",dataSourceId:_},resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"_id",keyType:Ce.string,modifiers:{normal:"",inactive:"list-group-item-light",active:"list-group-item-primary",warning:""},icons:{normal:"",inactive:"",active:"",warning:""},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,icons:function(e,t){return t.type?"cardio"===t.type?["fas fa-running ml-2"]:["fas fa-dumbbell ml-2"]:[]},delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-md",iconClasses:"text-black fas fa-sign-out-alt",attributes:[{name:"data-toggle",value:"tooltip"},{name:"data-placement",value:"right"},{name:"title",value:"Delete this exercise type."}]},drag:{type:O,from:j}},extraActions:[{name:"addToWorkout",buttonClasses:"btn bg-primary text-white btn-circle btn-md mr-1",iconClasses:"fas fa-arrow-alt-circle-right",attributes:[{name:"data-toggle",value:"tooltip"},{name:"data-placement",value:"right"},{name:"title",value:"Add this exercise to the current workout."}]}]},function(e){e[e.checkbox=0]="checkbox",e[e.email=1]="email",e[e.hidden=2]="hidden",e[e.number=3]="number",e[e.password=4]="password",e[e.text=5]="text",e[e.textarea=6]="textarea",e[e.select=7]="select",e[e.radioGroup=8]="radioGroup"}(cn||(cn={})),function(e){e[e.unset=-1]="unset",e[e.create=0]="create",e[e.update=1]="update"}(ln||(ln={}));var mn,fn,gn,vn="data-id";!function(e){e.SHOWN="shown",e.HIDDEN="hidden",e.CANCELLING="cancelling",e.CANCELLING_ABORTED="cancelling-aborted",e.CANCELLED="cancelled",e.SAVING="saving",e.SAVE_ABORTED="save-aborted",e.SAVED="saved",e.DELETING="deleting",e.DELETE_ABORTED="delete-aborted",e.DELETED="deleted",e.CREATING="creating",e.MODIFYING="modifying",e.RESETTING="reset"}(mn||(mn={})),function(e){e[e.equals=0]="equals",e[e.lessThan=1]="lessThan",e[e.lessThanEqual=2]="lessThanEqual",e[e.greaterThan=3]="greaterThan",e[e.greaterThanEqual=4]="greaterThanEqual",e[e.isNull=5]="isNull",e[e.isNotNull=6]="isNotNull",e[e.hasValue=7]="hasValue"}(fn||(fn={})),function(e){e[e.show=0]="show",e[e.hide=1]="hide",e[e.invalid=2]="invalid",e[e.valid=3]="valid"}(gn||(gn={}));var pn=r()("validation-manager"),bn=r()("validation-manager-rule-failure"),In=function(){function e(){this.formRules=[]}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getName=function(){return"Validation Manager"},t.addRuleToForm=function(e,t){var n=this;pn("Adding rule on form "+e.getId()+" for target field "+t.targetDataFieldId);var i=e.getFieldFromDataFieldId(t.targetDataFieldId);if(!i)return bn("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - NOT FOUND in form"),!1;var a={targetField:i,response:t.response,fieldConditions:[],valueConditions:[]};t.conditions.forEach((function(r){if(!r.values&&!r.sourceDataFieldId)return bn("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - a condition is missing both values and source field"),!1;if(r.values&&r.sourceDataFieldId){pn("Rule adding for form "+e.getId()+" for target field "+t.targetDataFieldId+" - source field "+r.sourceDataFieldId+" with values "+r.values);var s=e.getFieldFromDataFieldId(r.sourceDataFieldId);if(!s)return bn("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - source field "+r.sourceDataFieldId+" NOT FOUND"),!1;a.fieldConditions.push({sourceField:s,comparison:r.comparison,values:r.values}),s.addFieldListener(n)}else if(r.values)pn("Rule adding for form "+e.getId()+" for target field "+t.targetDataFieldId+" - values "+r.values),a.valueConditions.push({values:r.values,comparison:r.comparison}),i.addFieldListener(n);else if(r.sourceDataFieldId){pn("Rule adding for form "+e.getId()+" for target field "+t.targetDataFieldId+" - source field "+r.sourceDataFieldId);var o=e.getFieldFromDataFieldId(r.sourceDataFieldId);if(!o)return bn("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - source field "+r.sourceDataFieldId+" NOT FOUND"),!1;var d=o.getFieldDefinition().type;switch(i.getFieldDefinition().type){case ve.date:case ve.datetime:if(d!==ve.datetime&&d!==ve.date)return bn("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - target is date(time), source is NOT"),!1;break;case ve.time:case ve.shortTime:if(d!==ve.time&&d!==ve.shortTime)return bn("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - target is time, source is NOT"),!1;break;case ve.boolean:if(d!==ve.boolean)return bn("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - target is boolean, source is NOT"),!1;break;case ve.integer:case ve.float:if(d!==ve.integer&&d!==ve.float)return bn("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - target is number, source is NOT"),!1}a.fieldConditions.push({sourceField:o,comparison:r.comparison}),o.addFieldListener(n)}})),pn("Converted rule to "),pn(a);var r,s=this.formRules.findIndex((function(t){return t.form.getId()===e.getId()}));return s<0?(r={form:e,rules:[a]},this.formRules.push(r)):(r=this.formRules[s]).rules.push(a),pn("Current set of rules for form "+e.getId()),pn(r),!0},t.areTwoFieldsEqual=function(e,t){return e.getValue()!==t.getValue()?{ruleFailed:!0,message:e.getName()+" must be equal to "+t.getName()}:{ruleFailed:!1}},t.compareTwoValuesWithTypes=function(e,t,n,i,a){if(!t||!i)return!1;switch(e){case ve.date:t+=" 00:00:00",n===ve.date&&(i+=" 00:00:00");break;case ve.datetime:n===ve.date&&(i+=" 00:00:00");break;case ve.time:n===ve.shortTime&&(i+=":00");break;case ve.shortTime:t+=":00",n===ve.shortTime&&(i+=":00")}switch(pn("Comparing "+t+" of type "+e+" against "+i+" of type "+n),a){case fn.lessThan:return t<i;case fn.lessThanEqual:return t<=i;case fn.greaterThanEqual:return t>=i;case fn.greaterThan:return t>i;case fn.equals:return t===i}return!1},t.isTargetLessThanSource=function(e,t){var n=t.getFieldDefinition().type,i=e.getFieldDefinition().type,a=t.getValue(),r=e.getValue();return this.compareTwoValuesWithTypes(i,r,n,a,fn.lessThan)?{ruleFailed:!1}:{ruleFailed:!0,message:e.getName()+" must be less than "+t.getName()}},t.isTargetLessThanEqualSource=function(e,t){var n=this.areTwoFieldsEqual(e,t);return n.ruleFailed&&(n=this.isTargetLessThanSource(e,t)).ruleFailed?{ruleFailed:!0,message:e.getName()+" must be less than or equal to "+t.getName()}:{ruleFailed:!1}},t.isTargetGreaterThan=function(e,t){var n=t.getFieldDefinition().type,i=e.getFieldDefinition().type,a=t.getValue(),r=e.getValue();return this.compareTwoValuesWithTypes(i,r,n,a,fn.greaterThan)?{ruleFailed:!1}:{ruleFailed:!0,message:e.getName()+" must be greater than "+t.getName()}},t.isSourceNull=function(e){var t=e.getValue();return t&&t.trim().length>0?{ruleFailed:!0,message:e.getName()+" must be empty"}:{ruleFailed:!1}},t.isSourceNotNull=function(e){var t=e.getValue();return!t||t.trim().length>0?{ruleFailed:!0,message:e.getName()+" must not be empty"}:{ruleFailed:!1}},t.doesFieldHaveValue=function(e,t){var n=e.getValue();if(pn("does field "+e.getId()+" have value from "+t+" - current value is "+e.getValue()),n){var i=t.split(","),a=!1;if(i.forEach((function(i){n===i&&(pn("does field "+e.getId()+" have value from "+t+" - current value is "+e.getValue()+" - found in value(s)"),a=!0)})),a)return{ruleFailed:!1}}return{ruleFailed:!0,message:e.getName()+" must be have a value in "+t}},t.doesTargetFieldHaveValue=function(e,t){return this.doesFieldHaveValue(e,t)},t.doesSourceFieldHaveValue=function(e,t){return this.doesFieldHaveValue(e,t)},t.isTargetGreaterThanEqualSource=function(e,t){var n=this.areTwoFieldsEqual(e,t);return n.ruleFailed&&(n=this.isTargetGreaterThan(e,t)).ruleFailed?{ruleFailed:!0,message:e.getName()+" must be greater than or equal to "+t.getName()}:{ruleFailed:!1}},t.compareFields=function(e,t,n,i){switch(n){case fn.equals:return this.areTwoFieldsEqual(e,t);case fn.lessThan:return this.isTargetLessThanSource(e,t);case fn.lessThanEqual:return this.isTargetLessThanEqualSource(e,t);case fn.greaterThan:return this.isTargetGreaterThan(e,t);case fn.greaterThanEqual:return this.isTargetGreaterThanEqualSource(e,t);case fn.isNull:return this.isSourceNull(t);case fn.isNotNull:return this.isSourceNotNull(t);case fn.hasValue:return this.doesSourceFieldHaveValue(t,i)}},t.executeRule=function(e){var t=this,n={field:e.targetField,ruleFailed:!1,response:e.response};return pn("Executing rule for target "+e.targetField.getId()),pn(e),e.fieldConditions.every((function(i){pn("field condition rule"),pn(i);var a=i.values?i.values:"",r=t.compareFields(e.targetField,i.sourceField,i.comparison,a);return r.ruleFailed?(bn("field condition rule FAILED"),n.ruleFailed=!0,e.response===gn.invalid&&(n.message=r.message),!1):(pn("field condition rule PASSED"),!0)})),n.ruleFailed||e.valueConditions.forEach((function(i){pn("value condition rule"),pn(i);var a=t.compareFields(e.targetField,e.targetField,fn.hasValue,i.values);return a.ruleFailed?(bn("value condition rule FAILED"),n.ruleFailed=!0,n.message=a.message,!1):(pn("value condition rule PASSED"),!0)})),n},t.getRulesForFieldChange=function(e,t,n){var i=[];pn("Finding rules for form "+e+" and data field "+t);var a=this.formRules.findIndex((function(t){return t.form.getId()===e}));return a>=0&&this.formRules[a].rules.forEach((function(e){e.targetField.getId()===t?(pn("Found rule where data field "+t+" is target"),e.targetField.isValid()?i.push(e):bn("Found rule where data field "+t+" is target but value is not currently valid")):n&&e.fieldConditions.every((function(n){return n.sourceField.getId()!==t||(pn("Found rule where data field "+t+" is source"),n.sourceField.isValid()?i.push(e):bn("Found rule where data field "+t+" is source but value is not currently valid"),!1)}))})),i},t.failedValidation=function(e,t,n,i){},t.applyRulesToTargetField=function(e,t,n){var i=this;pn("Checking invalidation only rules for form "+e+", data field "+t.id);var a=this.getRulesForFieldChange(e,t.id,!1),r={ruleFailed:!1};return a.every((function(a){if(n&&a.response===n||!n){var s=i.executeRule(a);if(s.ruleFailed)return bn("Rule failed for form "+e+" with field "+t.displayName+" with message "+s.message),r.ruleFailed=!0,r.message=s.message,!1}return!0})),r},t.valueChanged=function(e,t,n){var i=this;pn("Handling field change - form "+e+", data field "+t.id+", value "+n);var a=this.getRulesForFieldChange(e,t.id,!0),r=[];a.forEach((function(e){var t=i.executeRule(e);t.ruleFailed&&r.push(t)})),pn("Have "+r.length+" failed rules - applying each"),r.forEach((function(e){switch(e.response){case gn.hide:pn("Apply hide "+e.field.getId()),e.field.hide();break;case gn.show:pn("Apply show "+e.field.getId()),e.field.show();break;case gn.invalid:pn("Apply invalid "+e.field.getId()),e.message&&e.field.setInvalid(e.message);break;case gn.valid:pn("Apply valid "+e.field.getId()),e.field.setValid()}}))},e}();function Cn(){return(Cn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var yn=r()("abstract-form"),wn=r()("abstract-form-detail"),En=r()("abstract-form-detail-validation"),Sn=function(){function e(e,t){if(this.formListeners=[],this.fieldListeners=[],this.uiDef=null,this.isVisible=!1,this.fields=[],this.isInitialised=!1,this.hasChangedBoolean=!1,this.isDisplayOnly=!1,this.containerEl=document.getElementById(e),!this.containerEl)throw new Error("container "+e+" for form "+t.id+" does not exist");this.map=[],this.dataObjDef=t,this.currentDataObj={},this.addFormListener(this)}var t=e.prototype;return t.hasChanged=function(){return this.hasChangedBoolean},t.getName=function(){return this.dataObjDef.displayName},t.valueChanged=function(e,t,n){this.hasChangedBoolean=!0,this.setUnsavedMessage(),yn("Form has changed")},t.failedValidation=function(e,t,n,i){this.hasChangedBoolean=!0,yn("Form has changed")},t.initialise=function(e,t,n){void 0===n&&(n=!1),this.isInitialised||(this.isInitialised=!0,this._initialise(e,t,n))},t.addFieldListener=function(e){this.fieldListeners.push(e)},t.addFormListener=function(e){this.formListeners.push(e)},t.informFormListeners=function(e,t){this.formListeners.forEach((function(n){return n.formChanged(e,t)}))},t.findFieldUiConfig=function(e){wn("Finding field UI Config for field "+e.displayName);var t=null;if(this.uiDef)for(var n=0;n<this.uiDef.fieldGroups.length;){if(t=this.uiDef.fieldGroups[n].fields.find((function(t){return t.field.id===e.id}))){wn("Finding field UI Config for field "+e.displayName+" - Found");break}n++}return t},t.reset=function(){if(yn("Resetting form"),this.clearUnsavedMessage(),this.isDisplayOnly=!1,this.hasChangedBoolean=!1,this.uiDef){var e={formId:this.uiDef.id,target:this,eventType:mn.RESETTING};this.informFormListeners(e,this.currentDataObj)}this.currentDataObj={},this._reset(),this.fields.forEach((function(e){e.reset()})),this.hasChangedBoolean=!1},t.setIsVisible=function(e){if(yn("Changing visibility to "+e),this.isVisible=e,this.uiDef){var t=mn.HIDDEN;this.isVisible?(this._visible(),t=mn.SHOWN):this._hidden();var n={formId:this.uiDef.id,target:this,eventType:t};this.informFormListeners(n,this.currentDataObj)}e&&!this.isDisplayOnly&&this.checkFormValidationOnDisplay(),e&&this.isDisplayOnly&&this.checkForVisualValidationForDisplayOnly()},t.checkForVisualValidationForDisplayOnly=function(){var e=this;yn("Checking display validation for display only"),this.fields.forEach((function(t){t.show();var n=In.getInstance().applyRulesToTargetField(e.uiDef.id,t.getFieldDefinition(),gn.hide);n.ruleFailed&&(t.hide(),En("Field "+t.getId()+" is hidden from validation manager with message "+n.message))}))},t.checkFormValidationOnDisplay=function(){var e=this;yn("Checking display validation"),console.log("stuff"),this.fields.forEach((function(t){if(t.show(),t.getValue(),t.isValid()){var n=In.getInstance().applyRulesToTargetField(e.uiDef.id,t.getFieldDefinition(),gn.invalid);n.ruleFailed&&(t.setInvalid(n.message),En("Field "+t.getId()+" is invalid from validation manager with message "+n.message)),(n=In.getInstance().applyRulesToTargetField(e.uiDef.id,t.getFieldDefinition(),gn.hide)).ruleFailed&&(t.hide(),En("Field "+t.getId()+" is hidden from validation manager with message "+n.message))}else yn("Field "+t.getId()+" is invalid"),t.setInvalid(t.getName()+" has an invalid format or is required.")}))},t.startCreateNew=function(){if(this.clearUnsavedMessage(),yn("Starting create new"),this.reset(),this.currentDataObj={},this.isDisplayOnly=!1,this.hasChangedBoolean=!1,this.uiDef){var e=mn.CREATING,t={formId:this.uiDef.id,target:this,eventType:e};this._startCreate(),this.informFormListeners(t,this.currentDataObj)}return this.clearReadOnly(),this.currentDataObj},t.startUpdate=function(e){if(this.clearUnsavedMessage(),yn("Starting modify existing on "),this.isDisplayOnly=!1,this.hasChangedBoolean=!1,yn(e),this.currentDataObj=Cn({},e),this.uiDef){var t=mn.MODIFYING,n={formId:this.uiDef.id,target:this,eventType:t};this._startUpdate(),this.informFormListeners(n,this.currentDataObj)}this.clearReadOnly()},t.displayOnly=function(e){this.clearUnsavedMessage(),yn("Starting display only "),yn(e),this.isDisplayOnly=!0,this.hasChangedBoolean=!1,this.currentDataObj=Cn({},e),this.uiDef&&this._displayOnly(),this.setReadOnly()},t.formChanged=function(e,t){var n=this,i=!1;switch(e.eventType){case mn.CANCELLING:if(yn("Form is cancelling"),this.hasChangedBoolean&&!this.isDisplayOnly)this.uiDef&&at.getInstance().startAlert(this,this.uiDef.displayName,"Lose any unsaved changes?",mn.CANCELLING);else if(this.uiDef){var a={formId:this.uiDef.id,target:this,eventType:mn.CANCELLED};this.informFormListeners(a,this.currentDataObj)}break;case mn.CANCELLING_ABORTED:yn("Form is cancelling - aborted");break;case mn.CANCELLED:yn("Form is cancelled - resetting"),this.isDisplayOnly=!0,this.reset(),this.setReadOnly();break;case mn.DELETING:yn("Form is deleting"),this.uiDef&&at.getInstance().startAlert(this,this.uiDef.displayName,"Are you sure you want to delete this information?",mn.DELETING);break;case mn.DELETE_ABORTED:yn("Form is deleting - aborted");break;case mn.DELETED:yn("Form is deleted - resetting"),this.reset();break;case mn.SAVE_ABORTED:this._saveFinishedOrAborted(),yn("Form save cancelled");break;case mn.SAVED:this._saveFinishedOrAborted(),yn("Form is saved with data"),yn(t),this.isDisplayOnly=!1,this.hasChangedBoolean=!1;break;case mn.SAVING:if(yn("Form is saving, checking validation and storing values"),this._saveIsActive(),this.uiDef){var r=!0;if(this.fields.forEach((function(e){var t=e.getValue();if(e.isValid()){var i=In.getInstance().applyRulesToTargetField(n.uiDef.id,e.getFieldDefinition(),gn.invalid);i.ruleFailed?(e.setInvalid(i.message),En("Field "+e.getId()+" is invalid from validation manager with message "+i.message),r=!1):n.setFieldValueToDataObject(n.currentDataObj,e,t)}else En("Field "+e.getId()+" is invalid"),e.setInvalid(e.getName()+" has an invalid format or is required."),r=!1})),r){yn("formatted data object is");var s=this.getFormattedDataObject(),o={formId:this.uiDef.id,target:this,eventType:mn.SAVED};this.informFormListeners(o,s)}else{yn("Form is saving, checking validation - FAILED");var d={formId:this.uiDef.id,target:this,eventType:mn.SAVE_ABORTED};this.informFormListeners(d,this.currentDataObj),i=!0}break}}return i},t.getId=function(){var e="";return this.uiDef&&(e=this.uiDef.id),e},t.getFieldFromDataFieldId=function(e){var t=void 0;wn("Finding field for attribute "+e+" ");var n=this.map.find((function(t){return t.attributeId===e}));return n&&(wn("Mapped attribute "+n.attributeId+" to field "+n.fieldId),t=this.fields.find((function(e){return e.getId()===n.attributeId}))),t},t.completed=function(e){if(yn("Handling alert completed"),yn(e),e.context&&this.uiDef)switch(e.context){case mn.CANCELLING:if(e.outcome===Ze.confirmed){var t={formId:this.uiDef.id,target:this,eventType:mn.CANCELLED};this.informFormListeners(t,this.currentDataObj)}else{var n={formId:this.uiDef.id,target:this,eventType:mn.CANCELLING_ABORTED};this.informFormListeners(n,this.currentDataObj)}break;case mn.DELETING:if(e.outcome===Ze.confirmed){var i={formId:this.uiDef.id,target:this,eventType:mn.DELETED};this.informFormListeners(i,this.currentDataObj)}else{var a={formId:this.uiDef.id,target:this,eventType:mn.DELETE_ABORTED};this.informFormListeners(a,this.currentDataObj)}}},t.clearReadOnly=function(){this.fields.forEach((function(e){e.clearReadOnly()}))},t.setReadOnly=function(){this.fields.forEach((function(e){e.setReadOnly()}))},t.isDisplayingItem=function(e){return!!this.currentDataObj&&this._isSameObjectAsDisplayed(e)},t.isReadOnly=function(){return this.isDisplayOnly},e}(),Ln=r()("basic-field-operations-formatter"),Fn=r()("basic-field-operations-validator"),Nn=(r()("basic-field-operations-generator"),r()("basic-field-operations-renderer")),kn=function(){function e(){this.radioButtons=[]}var t=e.prototype;return t.formatValue=function(e,t){Ln("Handling format value for RBG "+e.displayName+" with value "+t);var n=t;return this.radioButtons.forEach((function(t){t.checked&&(n=t.value,e.idType===Ce.number&&(n=parseInt(n)))})),Ln("Handling format value for field "+e.displayName+" with value "+t+" - result is "+n),n},t.isValidValue=function(e,t){Fn("Handling is valid value for field "+e.displayName+" with value "+t);var n={isValid:!1,resetOnFailure:!1};if(e.mandatory){if(this.radioButtons.forEach((function(e){e.checked&&(n.isValid=!0)})),!n.isValid)return n.message=e.displayName+" is required. Please select one of the values.",Fn("Handling is valid value for field "+e.displayName+" with value "+t+" - is valid is "+n.isValid+" with message "+n.message),n}else n.isValid=!0;return Fn("Handling is valid value for field "+e.displayName+" with value "+t+" - is valid is "+n.isValid+" with message "+n.message),n},t.renderValue=function(e,t){return Nn("Rendering value for field "+e.displayName+" with new value "+t),this.radioButtons.forEach((function(e){e.value===t&&(e.checked=!0)})),null},t.generate=function(e,t){return""},t.setSubElements=function(e){this.radioButtons=e},e}(),Dn=r()("bootstrap-form-config-helper"),Rn=function(){function e(){}return e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.generateFormConfig=function(e,t,n,i){void 0===i&&(i=!1);var a=new Ue,r=new kn,s=[];e.fields.forEach((function(e,n){var o=cn.text;switch(e.type){case ve.time:case ve.text:case ve.date:case ve.shortTime:case ve.duration:break;case ve.datetime:i&&(e.id===Ae&&(o=cn.hidden),e.id===Oe&&(o=cn.hidden));break;case ve.userId:o=i?cn.hidden:cn.text;break;case ve.uuid:case ve.id:o=cn.hidden;break;case ve.integer:case ve.float:o=cn.number;break;case ve.email:o=cn.email;break;case ve.password:o=cn.password;break;case ve.boolean:o=cn.checkbox;break;case ve.largeText:o=cn.textarea;break;case ve.choice:o=cn.select;break;case ve.limitedChoice:o=cn.radioGroup}var d=t.find((function(t){return t.fieldId===e.id})),c=n;d&&(c=d.displayOrder);var l={field:e,displayOrder:c,elementType:o,elementClasses:"form-control col-sm-9",renderer:a,formatter:a};e.type!==ve.id&&e.type!==ve.uuid&&o!==cn.hidden&&(l.containedBy={elementType:"div",elementClasses:"form-group row"},l.label={label:e.displayName,classes:"col-md-12 col-lg-3 col-form-label"},e.description&&(l.describedBy={message:e.description,elementType:"small",elementClasses:"text-muted col-md-12 col-lg-9 offset-lg-3 mt-1"}),e.displayOnly||(l.validator={validator:a,messageDisplay:{elementType:"div",elementClasses:"invalid-feedback col-md-12 col-lg-9 offset-lg-3"},validClasses:"is-valid",invalidClasses:"is-invalid"})),e.type===ve.largeText&&(l.textarea={rows:5,cols:20}),e.type===ve.choice&&(l.subElement={element:{elementType:"option",elementClasses:""}},l.datasource=e.dataSource),e.type===ve.limitedChoice&&(l.subElement={element:{elementType:"input",elementClasses:"form-check-input",elementAttributes:[{name:"type",value:"radio"}]},container:{elementType:"div",elementClasses:"form-check form-check-inline"},label:{label:"label",classes:"form-check-label"}},l.renderer=r,l.validator&&(l.validator.validator=r),l.formatter=r,l.datasource=e.dataSource),s.push(l)}));var o={containedBy:{elementType:"div",elementClasses:"col-sm-12"},fields:s},d={id:e.id,displayName:e.displayName,fieldGroups:[o],unsavedChanges:{elementType:"div",elementClasses:"invalid-feedback text-right col-md-12 col-lg-9 offset-lg-3",elementAttributes:[{name:"style",value:"display:block"}],innerHTML:"Pending changes to "+e.displayName},buttonsContainedBy:{elementType:"div",elementClasses:"d-flex w-100 justify-space-between"},cancelButton:{buttonText:"Cancel  ",buttonClasses:"btn-info rounded p-1 mr-2 mt-2 w-100",iconClasses:"fas fa-ban"},submitButton:{buttonText:"Save  ",buttonClasses:"btn-primary rounded p-1 mt-2 w-100",iconClasses:"fas fa-save"},activeSave:'<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;'};return d.fieldGroups.forEach((function(e){e.fields.sort((function(e,t){return e.displayOrder-t.displayOrder}))})),n&&(d.deleteButton={buttonText:"Delete  ",buttonClasses:"btn-warning rounded p-1 mr-2 mt-2 w-100",iconClasses:"fas fa-trash-alt"}),Dn(d),d},e}(),Tn=function(){function e(e,t,n,i){void 0===i&&(i=null),this.formId=e,this.fieldConfig=t,this.listeners=n,this.subElements=i,this.handleEvent=this.handleEvent.bind(this)}var t=e.prototype;return t.setValidationStatusAndMessage=function(e,t,n,i,a){var r=this;if(void 0===i&&(i=void 0),void 0===a&&(a=!1),this.fieldConfig.validator&&e){var s=this.fieldConfig.field,o=e;if(this.subElements&&(this.fieldConfig.validator.validator.setSubElements(this.subElements),this.fieldConfig.subElement)){var d=e.parentElement;d&&(o=d,this.fieldConfig.subElement.container&&(d=d.parentElement)&&(o=d))}var c=document.getElementById(this.formId+".field."+this.fieldConfig.field.id+".error"),l=document.getElementById(this.formId+".field."+this.fieldConfig.field.id+".error.message");if(null==c||c.setAttribute("style","display:none"),l&&(l.innerHTML=""),this.fieldConfig.validator.invalidClasses&&ft.addRemoveClasses(o,this.fieldConfig.validator.invalidClasses,!1),this.fieldConfig.validator.validClasses&&ft.addRemoveClasses(o,this.fieldConfig.validator.validClasses),!t){if(this.fieldConfig.validator.invalidClasses&&ft.addRemoveClasses(o,this.fieldConfig.validator.invalidClasses),this.fieldConfig.validator.validClasses&&ft.addRemoveClasses(o,this.fieldConfig.validator.validClasses,!1),i||(i=s.displayName+" does not have a valid value."),null==c||c.setAttribute("style","display:block"),l&&(l.innerHTML=i),a)switch(s.type){case ve.boolean:e.checked=!1;break;case ve.integer:e.value="0";break;case ve.float:e.value="0.0";break;default:e.value=""}this.listeners.forEach((function(e){return e.failedValidation(r.formId,s,n,i)}))}}},t.processValidation=function(e){if(this.fieldConfig.validator&&e){var t=this.fieldConfig.field,n=e.value;this.fieldConfig.elementType===cn.checkbox&&(n=""+e.checked),this.subElements&&(n="",this.subElements.forEach((function(e){e.checked&&(n=e.value)})));var i=this.fieldConfig.validator.validator.isValidValue(t,n);this.setValidationStatusAndMessage(e,i.isValid,n,i.message,i.resetOnFailure)}},t.handleEvent=function(e){e.preventDefault(),e.stopPropagation();var t=e.target;this.processValidation(t)},e}(),Un=function(){function e(e,t,n){this.formId=e,this.fieldConfig=t,this.listeners=n,this.handleEvent=this.handleEvent.bind(this)}return e.prototype.handleEvent=function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=e.target;if(this.fieldConfig.editor){var i=this.fieldConfig.field,a=n.value,r=this.fieldConfig.editor.editValue(i,a);r&&(n.value=r,this.listeners.forEach((function(e){return e.valueChanged(t.formId,i,r)})))}},e}(),An=function(){function e(e,t,n){this.formId=e,this.parentElement=t,this.fieldUIConfig=n}return e.prototype.optionsChanged=function(e){ft.removeAllChildren(this.parentElement),On.createSubElements(this.formId,this.parentElement,this.fieldUIConfig,e)},e}(),On=function(){function e(){}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.initialiseFieldElementAndEventHandlers=function(e,t,n,i,a){if(void 0===a&&(a=null),e.setAttribute("id",t+".field."+n.field.id),e.setAttribute(vn,n.field.id),e.setAttribute("name",n.field.id),n.elementAttributes&&ft.addAttributes(e,n.elementAttributes),n.elementClasses&&ft.addRemoveClasses(e,n.elementClasses),n.field.displayOnly&&ft.addAttributes(e,[{name:"disabled",value:"true"},{name:"readonly",value:"true"}]),n.validator){var r=new Tn(t,n,i,a);a?a.forEach((function(e){e.addEventListener("blur",r)})):e.addEventListener("blur",r)}n.editor&&e.addEventListener("focus",new Un(t,n,i)),n.field.type===ve.date&&($(e).datepicker(),$(e).datepicker("option","dateFormat","dd/mm/yy"))},e.createFieldComponentsAndContainer=function(e,t,n,i,a){var r=null;if(i.validator){(r=document.createElement("div")).setAttribute("id",t+".field."+i.field.id+".error"),r.setAttribute("style","display: none"),ft.addRemoveClasses(r,i.validator.messageDisplay.elementClasses);var s=document.createElement(i.validator.messageDisplay.elementType);s&&(s.setAttribute("id",t+".field."+i.field.id+".error.message"),i.validator.messageDisplay.elementAttributes&&ft.addAttributes(s,i.validator.messageDisplay.elementAttributes),r.appendChild(s))}if(i.containedBy){var o=document.createElement(i.containedBy.elementType);if(o){if(ft.addRemoveClasses(o,i.containedBy.elementClasses),o.setAttribute("id",t+".field."+i.field.id+".container"),i.containedBy.elementAttributes&&ft.addAttributes(n,i.containedBy.elementAttributes),i.label){var d=document.createElement("label");d.setAttribute("for",t+".field."+i.field.id),d.innerHTML=i.field.displayName,i.label.attributes&&ft.addAttributes(d,i.label.attributes),i.label.classes&&ft.addRemoveClasses(d,i.label.classes),o.appendChild(d)}if(i.describedBy){var c=document.createElement(i.describedBy.elementType);c?(c.setAttribute("id",t+".field."+i.field.id+".desc"),i.field.description&&(c.innerHTML=i.field.description),e.setAttribute("aria-describedby",t+".field."+i.field.id+".desc"),i.describedBy.elementClasses&&ft.addRemoveClasses(c,i.describedBy.elementClasses),o.appendChild(e),o.appendChild(c),r&&o.appendChild(r)):(o.appendChild(e),r&&o.appendChild(r))}else o.appendChild(e),r&&o.appendChild(r);n.appendChild(o)}else n.appendChild(e),r&&n.appendChild(r)}else n.appendChild(e),r&&n.appendChild(r)};var t=e.prototype;return t.createInputFormFieldComponentElement=function(t,n,i,a){var r=document.createElement("input");switch(i.elementType){case cn.checkbox:r.setAttribute("type","checkbox"),r.setAttribute("value",i.field.id);break;case cn.email:r.setAttribute("type","email");break;case cn.hidden:r.setAttribute("type","hidden");break;case cn.number:r.setAttribute("type","number");break;case cn.password:r.setAttribute("type","password");break;case cn.text:r.setAttribute("type","text")}return e.initialiseFieldElementAndEventHandlers(r,t,i,a),e.createFieldComponentsAndContainer(r,t,n,i,a),r},t.createTAFormFieldComponentElement=function(t,n,i,a){var r=document.createElement("textarea");return i.textarea&&(r.setAttribute("rows",""+i.textarea.rows),r.setAttribute("cols",""+i.textarea.cols)),e.initialiseFieldElementAndEventHandlers(r,t,i,a),e.createFieldComponentsAndContainer(r,t,n,i,a),r},e.createSubElements=function(e,t,n,i){var a=[];return i.forEach((function(i,r){if(n.subElement){var s=t;n.subElement.container&&(s=document.createElement(n.subElement.container.elementType),ft.addRemoveClasses(s,n.subElement.container.elementClasses),n.subElement.container.elementAttributes&&ft.addAttributes(s,n.subElement.container.elementAttributes),t.appendChild(s));var o=document.createElement(n.subElement.element.elementType);if(o.setAttribute("value",i.value),o.setAttribute("id",e+".field."+n.field.id+"."+r),o.setAttribute("name",e+".field."+n.field.id),ft.addRemoveClasses(o,n.subElement.element.elementClasses),n.subElement.element.elementAttributes&&ft.addAttributes(o,n.subElement.element.elementAttributes),s.appendChild(o),n.subElement.label){var d=document.createElement("label");n.subElement.label.classes&&ft.addRemoveClasses(d,n.subElement.label.classes),n.subElement.label.attributes&&ft.addAttributes(d,n.subElement.label.attributes),d.innerHTML=i.name,s.appendChild(d)}else o.innerHTML=i.name;a.push(o)}})),a},t.createSelectFormFieldComponentElement=function(t,n,i,a){var r=document.createElement("select");return i.datasource&&(e.createSubElements(t,r,i,i.datasource.getOptions()),i.datasource.addListener(new An(t,r,i))),e.initialiseFieldElementAndEventHandlers(r,t,i,a),e.createFieldComponentsAndContainer(r,t,n,i,a),r},t.createRadioGroupFormFieldComponentElement=function(t,n,i,a){var r=document.createElement("div");i.elementAttributes&&ft.addAttributes(r,i.elementAttributes),i.elementClasses&&ft.addRemoveClasses(r,i.elementClasses);var s=[];return i.datasource&&(s=e.createSubElements(t,r,i,i.datasource.getOptions()),i.datasource.addListener(new An(t,r,i)),i.validator&&i.validator.validator.setSubElements(s),i.renderer&&i.renderer.setSubElements(s),i.formatter&&i.formatter.setSubElements(s)),e.initialiseFieldElementAndEventHandlers(r,t,i,a,s),e.createFieldComponentsAndContainer(r,t,n,i,a),{container:r,radioButtons:s}},e}(),Mn=function(){function e(){}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.createFormButton=function(e,t,n,i,a){var r=document.createElement("button");if(ft.addRemoveClasses(r,i.buttonClasses),r.setAttribute("id",t.id+"."+a),i.buttonText&&(r.innerText=i.buttonText),i.iconClasses){var s=document.createElement("i");s&&(ft.addRemoveClasses(s,i.iconClasses),r.appendChild(s))}return r.addEventListener("click",(function(i){i.preventDefault(),i.stopPropagation();var r={target:e,formId:t.id,eventType:a};n.forEach((function(e){return e.formChanged(r)}))})),r},t.createFormElements=function(e,t,n,i){var a=document.createElement("form");a.setAttribute("id",n.id),a.setAttribute("name",n.displayName),n.classes&&ft.addRemoveClasses(a,n.classes);var r=[],s=[],o=[],d=[],c=document.createElement(n.unsavedChanges.elementType);ft.addRemoveClasses(c,n.unsavedChanges.elementClasses),n.unsavedChanges.elementAttributes&&ft.addAttributes(c,n.unsavedChanges.elementAttributes),a.appendChild(c),n.fieldGroups.forEach((function(e){var t=a;e.containedBy&&(t=document.createElement(e.containedBy.elementType))&&(e.containedBy.elementAttributes&&ft.addAttributes(t,e.containedBy.elementAttributes),e.containedBy.elementClasses&&ft.addRemoveClasses(t,e.containedBy.elementClasses),a.appendChild(t)),e.fields.forEach((function(e){switch(e.elementType){case cn.textarea:var a=On.getInstance().createTAFormFieldComponentElement(n.id,t,e,i);s.push(a);break;case cn.select:var c=On.getInstance().createSelectFormFieldComponentElement(n.id,t,e,i);d.push(c);break;case cn.radioGroup:var l=On.getInstance().createRadioGroupFormFieldComponentElement(n.id,t,e,i);o.push(l);break;default:var u=On.getInstance().createInputFormFieldComponentElement(n.id,t,e,i);r.push(u)}}))}));var l=a;n.buttonsContainedBy&&((l=document.createElement(n.buttonsContainedBy.elementType))?(n.buttonsContainedBy.elementAttributes&&ft.addAttributes(l,n.buttonsContainedBy.elementAttributes),ft.addRemoveClasses(l,n.buttonsContainedBy.elementClasses),a.appendChild(l)):l=a);var u=void 0;n.deleteButton&&(u=this.createFormButton(e,n,t,n.deleteButton,mn.DELETING),l.appendChild(u));var h=this.createFormButton(e,n,t,n.cancelButton,mn.CANCELLING);l.appendChild(h);var m=this.createFormButton(e,n,t,n.submitButton,mn.SAVING);return l.appendChild(m),{form:a,unsavedMessage:c,fields:r,selectFields:d,radioButtonGroups:o,textFields:s,deleteButton:u,cancelButton:h,submitButton:m}},e}(),xn=function(){function e(e,t,n,i){void 0===i&&(i=null),this.formId=e,this.fieldConfig=t,this.listeners=n,this.subElements=i,this.handleEvent=this.handleEvent.bind(this)}var t=e.prototype;return t.processRendering=function(e){var t="";if(this.fieldConfig.renderer){var n=this.fieldConfig.field,i=e.value;this.subElements&&this.fieldConfig.renderer.setSubElements(this.subElements),(t=this.fieldConfig.renderer.renderValue(n,i))&&(e.value=t,this.listeners.forEach((function(e){return e.valueChanged(n,t)})))}return t||""},t.handleEvent=function(e){e.preventDefault(),e.stopPropagation();var t=e.target;this.processRendering(t)},e}(),jn=r()("abstract-field"),_n=function(){function e(e,t,n,i,a){var r=this;void 0===a&&(a=null),this.config=null,this.subElements=[],this.listeners=[],this.hidden=!1,this.formId=e,this.config=t,this.definition=n,this.element=i,a&&(this.subElements=a),this.validationHandler=new Tn(e,t,[this],a),this.renderingHandler=new xn(e,t,[this],a),this.handleChangeEvent=this.handleChangeEvent.bind(this),this.subElements?this.subElements.forEach((function(e){e.addEventListener("change",r.handleChangeEvent)})):this.element.addEventListener("change",this.handleChangeEvent)}var t=e.prototype;return t.isHidden=function(){return this.hidden},t.handleChangeEvent=function(e){var t=this;if(jn("Handling change event"),this.config){var n=this.getValue();jn("Handling change event - informing listeners"),this.listeners.forEach((function(e){return e.valueChanged(t.formId,t.definition,n)}))}},t.addFieldListener=function(e){jn(this.getName()+" - adding listener "+e.getName()),this.listeners.findIndex((function(t){return t.getName()===e.getName()}))<0?this.listeners.push(e):jn(this.getName()+" - duplicate listener "+e.getName()+" ignored")},t.getFieldDefinition=function(){return this.definition},t.setInvalid=function(e){var t=this;this.validationHandler.setValidationStatusAndMessage(this.element,!1,"",e,!1),this.listeners.forEach((function(n){return n.failedValidation(t.formId,t.definition,t.getValue(),e)}))},t.initialise=function(){},t.getValue=function(){var e=this,t=null;if(this.config&&this.element)switch(this.config.elementType){case cn.radioGroup:jn(this.definition.id+" - getting value - rbg"),this.subElements&&this.subElements.forEach((function(n){n.checked&&(jn(e.definition.id+" - getting value - rbg - checked "+n.value),t=n.value)}));break;case cn.checkbox:t=""+this.element.checked;break;default:t=this.element.value}return jn(this.definition.id+" - getting value - "+t),t},t.getFormattedValue=function(){var e=null;return this.config&&this.element&&(e=this.element.value,this.config.elementType===cn.checkbox&&(e=""+this.element.checked),this.config.formatter&&(e=this.config.formatter.formatValue(this.definition,e))),e},t.isValid=function(){var e=!0;return this.config&&this.element&&this.config.validator&&this.config.validator.validator&&(e=this.config.validator.validator.isValidValue(this.definition,this.getValue()).isValid),e},t.getId=function(){return this.definition.id},t.setValue=function(e){if(e=""+e,this.element&&this.config)switch(this.config.elementType){case cn.radioGroup:this.subElements&&this.subElements.forEach((function(t){t.value===e&&(t.checked=!0)}));break;case cn.checkbox:this.element.checked="true"===e.toLowerCase();break;case cn.select:console.log(this.definition.id+" - setting value - "+e);for(var t=this.element,n=-1,i=0;i<t.options.length;i++){var a=t.options.item(i);console.log(this.definition.id+" - option value - "+a.value),a.value===e&&(console.log(this.definition.id+" - option value - "+a.value+" - SELECTED"),a.selected=!0,n=i)}console.log(this.definition.id+" - selected index "+n),t.selectedIndex=n;break;default:jn(this.definition.id+" - setting value - "+e),this.element.value=e}},t.reset=function(){if(this.element)switch(this.definition.type){case ve.boolean:this.element.checked=!1;break;case ve.integer:this.element.value="0";break;case ve.float:this.element.value="0.0";break;case ve.limitedChoice:this.subElements&&this.subElements.forEach((function(e){e.checked=!1}));break;default:this.element.value=""}this.show()},t.clearValue=function(){this.reset()},t.validate=function(){this.element&&this.validationHandler.processValidation(this.element)},t.render=function(e){var t,n=e;if(null!=(t=this.config)&&t.renderer){var i=this.config.renderer.renderValue(this.definition,e);i&&(n=i)}return n},t.failedValidation=function(e,t,n,i){},t.valueChanged=function(e,t,n){},t.getName=function(){return this.definition.displayName},t.hide=function(){if(this.config)if(this.config.containedBy){var e=this.element.parentElement;e&&e.setAttribute("style","display:none")}else this.setReadOnly();this.hidden=!0},t.setValid=function(){this.validationHandler.setValidationStatusAndMessage(this.element,!0,"")},t.show=function(){if(this.config)if(this.config.containedBy){var e=this.element.parentElement;e&&e.removeAttribute("style")}else this.clearReadOnly();this.hidden=!0},t.clearReadOnly=function(){this.definition.displayOnly||(this.element.removeAttribute("readonly"),this.element.removeAttribute("disabled"),this.subElements&&this.subElements.forEach((function(e){e.removeAttribute("readonly"),e.removeAttribute("disabled")})))},t.setReadOnly=function(){this.element.setAttribute("readonly","true"),this.element.setAttribute("disabled","true"),this.subElements&&this.subElements.forEach((function(e){e.setAttribute("readonly","true"),e.setAttribute("disabled","true")}))},e}();function Bn(e,t){return(Bn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Vn=function(e){var t,n;function i(t,n,i,a){return e.call(this,t,n,i,a)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Bn(t,n),i}(_n);function Hn(e,t){return(Hn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pn=function(e){var t,n;function i(t,n,i,a,r){return e.call(this,t,n,i,a,r)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Hn(t,n),i}(_n);function qn(e,t){return(qn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Wn=function(e){var t,n;function i(t,n,i,a){return e.call(this,t,n,i,a)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,qn(t,n),i}(_n);function Yn(e,t){return(Yn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Gn=function(e){var t,n;function i(t,n,i,a){return e.call(this,t,n,i,a)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Yn(t,n),i}(_n);function Jn(e,t){return(Jn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qn=r()("basic-form"),zn=r()("basic-form-detail"),$n=function(e){var t,n;function i(t,n){var i;return(i=e.call(this,t,n)||this).factoryElements=null,i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Jn(t,n);var a=i.prototype;return a._hidden=function(){var e;this.factoryElements&&(null==(e=this.containerEl)||e.removeChild(this.factoryElements.form))},a.setupFieldObject=function(e,t){void 0===t&&(t=[]);var n=e.getAttribute(vn),i=e.getAttribute("id");if(zn("Converting field input element "+i+" with data-id of "+n),n&&i){this.dataObjDef.fields.findIndex((function(e){return e.id===n}));var a=this.dataObjDef.fields.find((function(e){return e.id===n}));if(a){zn("Converting field input element "+i+" with data-id of "+n+" field definition is"),Qn(a);var r=this.findFieldUiConfig(a);if(zn("Converting field input element "+i+" with data-id of "+n+" field ui config is"),Qn(r),r&&this.uiDef){var s;switch(r.elementType){case cn.textarea:s=new Vn(this.uiDef.id,r,a,e);break;case cn.radioGroup:s=new Pn(this.uiDef.id,r,a,e,t);break;case cn.select:s=new Wn(this.uiDef.id,r,a,e);break;default:s=new Gn(this.uiDef.id,r,a,e)}this.fields.push(s),s.addFieldListener(this),this.map.push({attributeId:n,fieldId:i})}}else zn("Converting field input element "+i+" with data-id of "+n+" field definition is NOT FOUND")}},a.clearUnsavedMessage=function(){this.factoryElements&&(this.factoryElements.unsavedMessage.innerHTML="")},a.setUnsavedMessage=function(){this.factoryElements&&this.uiDef&&this.uiDef.unsavedChanges.innerHTML?this.factoryElements.unsavedMessage.innerHTML=this.uiDef.unsavedChanges.innerHTML:this.factoryElements&&(this.factoryElements.unsavedMessage.innerHTML="Pending changes to save")},a._initialise=function(e,t,n){var i=this;void 0===n&&(n=!1),Qn("Initialising"),this.uiDef=Rn.getInstance().generateFormConfig(this.dataObjDef,e,t,n),Qn(this.uiDef),this.factoryElements=Mn.getInstance().createFormElements(this,this.formListeners,this.uiDef,this.fieldListeners),Qn(this.factoryElements),Qn("Converting field input elements to Field objects"),this.factoryElements.fields.forEach((function(e){e.addEventListener("keyup",(function(e){zn("key up in form "+i.getName()),i.hasChangedBoolean=!0,i.setUnsavedMessage()})),i.setupFieldObject(e)})),Qn("Converting field text area elements to Field objects"),this.factoryElements.textFields.forEach((function(e){e.addEventListener("keyup",(function(e){zn("key up in form "+i.getName()),i.hasChangedBoolean=!0,i.setUnsavedMessage()})),i.setupFieldObject(e)})),Qn("Converting field select elements to Field objects"),this.factoryElements.selectFields.forEach((function(e){zn("key up in form "+i.getName())})),Qn("Converting field rbg elements to Field objects"),this.factoryElements.radioButtonGroups.forEach((function(e){i.setupFieldObject(e.container,e.radioButtons)})),Qn("field/data map is "),Qn(this.map),Qn("fields are"),Qn(this.fields)},a._reset=function(){this.clearUnsavedMessage()},a.validateField=function(e){var t=this.getFieldFromDataFieldId(e.id);t&&t.validate()},a.renderField=function(e,t){var n=t,i=this.getFieldFromDataFieldId(e.id);return i&&(n=i.render(n)),n},a._startCreate=function(){var e=this;this.clearUnsavedMessage(),this.dataObjDef.fields.forEach((function(t){if(t.generator&&t.generator.onCreation){var n=t.generator.generator.generate(t,!0);zn("Setting default values for "+t.displayName+" to "+n),e.currentDataObj[t.id]=n}var i=e.currentDataObj[t.id];i&&(i=e.renderField(t,i),e.setFieldValueFromDataObject(t,i)),e.validateField(t)})),this.factoryElements&&this.factoryElements.deleteButton&&ft.addAttributes(this.factoryElements.deleteButton,[{name:"style",value:"display:none"}])},a._startUpdate=function(){var e=this;this.clearUnsavedMessage(),Qn(this.currentDataObj),this.dataObjDef.fields.forEach((function(t){if(t.generator&&t.generator.onModify){var n=t.generator.generator.generate(t,!1);zn("Setting default modified values for "+t.displayName+" to "+n),e.currentDataObj[t.id]=n}var i=e.currentDataObj[t.id];i&&(i=e.renderField(t,i)),e.setFieldValueFromDataObject(t,i),e.validateField(t)})),this.factoryElements&&this.factoryElements.deleteButton&&ft.removeAttributes(this.factoryElements.deleteButton,["style"])},a._displayOnly=function(){var e=this;this.clearUnsavedMessage(),Qn(this.currentDataObj),this.dataObjDef.fields.forEach((function(t){var n=e.currentDataObj[t.id];n&&(n=e.renderField(t,n)),e.setFieldValueFromDataObject(t,n)})),this.factoryElements&&this.factoryElements.deleteButton&&this.factoryElements&&ft.addAttributes(this.factoryElements.deleteButton,[{name:"style",value:"display:none"}])},a._visible=function(){var e;this.factoryElements&&(null==(e=this.containerEl)||e.appendChild(this.factoryElements.form))},a.setFieldValueToDataObject=function(e,t,n){var i=this.map.find((function(e){return e.attributeId===t.getId()}));i?(zn("Mapped field "+i.fieldId+" to attribute "+i.attributeId+" with value "+n),this.currentDataObj[i.attributeId]=n):Qn("Mapped field "+t.getId()+" to attribute NOT FOUND")},a.setFieldValueFromDataObject=function(e,t){var n=this.getFieldFromDataFieldId(e.id);n&&(t?n.setValue(t):n.clearValue())},a.getFormattedFieldValue=function(e){var t=null,n=this.map.find((function(t){return t.attributeId===e.id}));if(n){zn("Mapped attribute "+n.attributeId+" to field "+n.fieldId+" with for getting formatted value");var i=this.fields.find((function(e){return e.getId()===n.attributeId}));i&&(t=i.getFormattedValue())}return t},a.getFormattedDataObject=function(){var e=this;Qn("Getting current formatted data");var t={};return this.dataObjDef.fields.forEach((function(n){e.currentDataObj[n.id],t[n.id]=e.getFormattedFieldValue(n)})),Qn(t),t},a._isSameObjectAsDisplayed=function(e){var t=this,n=!1;return zn("is same object as current"),zn(e),zn(this.currentDataObj),this.dataObjDef.fields.every((function(i){if(i.isKey){var a,r=null==(a=t.getFieldFromDataFieldId(i.id))?void 0:a.getValue(),s=e[i.id];return zn("is same object id "+s+" as current "+r),(r&&!s||r&&!s)&&(n=!1),r&&s&&r==s&&(n=!0),!1}return!0})),n},a.enableButtons=function(){this.factoryElements&&this.uiDef&&(this.factoryElements.deleteButton&&this.factoryElements.deleteButton.removeAttribute("disabled"),this.factoryElements.cancelButton.removeAttribute("disabled"),this.factoryElements.submitButton.removeAttribute("disabled"),this.factoryElements.submitButton.innerHTML=this.uiDef.submitButton.buttonText)},a.disableButtons=function(){this.factoryElements&&(this.factoryElements.deleteButton&&this.factoryElements.deleteButton.setAttribute("disabled","true"),this.factoryElements.cancelButton.setAttribute("disabled","true"),this.factoryElements.submitButton.setAttribute("disabled","true"))},a.clearReadOnly=function(){e.prototype.clearReadOnly.call(this),this.enableButtons()},a.setReadOnly=function(){e.prototype.setReadOnly.call(this),this.disableButtons()},a._saveFinishedOrAborted=function(){zn("save is finished or aborted"),this.enableButtons(),this.clearUnsavedMessage()},a._saveIsActive=function(){zn("save is active"),this.disableButtons(),this.factoryElements&&this.uiDef&&this.uiDef.activeSave&&(zn("save is active "+this.uiDef.activeSave),this.factoryElements.submitButton.innerHTML=this.uiDef.activeSave+this.uiDef.submitButton.buttonText)},i}(Sn),Kn=r()("form-detail-view-renderer"),Zn=function(){function e(e,t,n){this.form=null,this.containerId=e,this.objDef=t,this.currentItem={},this.isNewItem=!1,this.forwarder=null,this.view=null,this.permissionChecker=n}var t=e.prototype;return t.setEventForwarder=function(e){this.forwarder=e},t.setView=function(e){this.view=e},t.onDocumentLoaded=function(){this.form=new $n(this.containerId,this.objDef),this.form.addFormListener(this)},t.reset=function(){this.form&&this.form.reset()},t.initialise=function(e,t,n){this.form&&this.form.initialise(e,t,n)},t.displayItemReadonly=function(e){this.isNewItem=!1,this.form&&this.form.displayOnly(e)},t.getName=function(){return this.objDef.displayName},t.setContainedBy=function(e){throw new Error("Method not implemented.")},t.addEventListener=function(e){throw new Error("Method not implemented.")},t.hasChanged=function(){var e=!1;return this.form&&(e=this.form.hasChanged()),e},t.getUIConfig=function(){throw new Error("Method not implemented.")},t.getDataSourceKeyId=function(){throw new Error("Method not implemented.")},t.clearDisplay=function(){this.isNewItem=!1,this.form&&this.form.reset()},t.clearReadOnly=function(){this.form&&this.form.clearReadOnly()},t.setReadOnly=function(){this.form&&this.form.setReadOnly()},t.isReadOnly=function(){var e=!1;return this.form&&(e=this.form.isReadOnly()),e},t.createItem=function(){var e;return this.currentItem={},Kn("Creating new item with form "+(null==(e=this.form)?void 0:e.getId())),this.form&&(this.isNewItem=!0,this.currentItem=this.form.startCreateNew()),$('[data-toggle="tooltip"]').tooltip(),this.currentItem},t.displayItem=function(e){this.currentItem=e,this.isNewItem=!1,this.hasPermissionToUpdateItem(e)?this.form&&this.form.startUpdate(e):this.form&&this.form.displayOnly(e),$('[data-toggle="tooltip"]').tooltip()},t.hidden=function(){this.form&&this.form.setIsVisible(!1)},t.show=function(){this.form&&this.form.setIsVisible(!0)},t.render=function(){this.displayItem(this.currentItem),this.show()},t.hasPermissionToDeleteItem=function(e){return this.permissionChecker.hasPermissionToDeleteItem(e)},t.hasPermissionToUpdateItem=function(e){return this.permissionChecker.hasPermissionToUpdateItem(e)},t.getForm=function(){return this.form},t.handleActionItem=function(e,t){},t.isDisplayingItem=function(e){var t=!1;return this.currentItem&&this.form&&(t=this.form.isDisplayingItem(e)),t},t.formChanged=function(e,t){switch(e.eventType){case mn.CANCELLING:Kn("Form is cancelling");break;case mn.CANCELLING_ABORTED:Kn("Form is cancelling - aborted");break;case mn.CANCELLED:Kn("Form is cancelled - resetting"),this.currentItem=t,this.forwarder&&this.view&&this.forwarder.cancelled(this.view,this.currentItem);break;case mn.DELETING:Kn("Form is deleting");break;case mn.DELETE_ABORTED:Kn("Form is deleting - aborted");break;case mn.DELETED:Kn("Form is deleted - resetting"),this.currentItem=t,this.forwarder&&this.view&&this.forwarder.deletedItem(this.view,this.currentItem);break;case mn.SAVE_ABORTED:Kn("Form save cancelled");break;case mn.SAVED:if(Kn("Form is saved with data"),this.form){var n,i=null==(n=this.form)?void 0:n.getFormattedDataObject();this.isNewItem?this.forwarder&&this.view&&this.forwarder.saveNewItem(this.view,i):this.forwarder&&this.view&&this.forwarder.updateItem(this.view,i),this.isNewItem=!1}break;case mn.SAVING:Kn("Form is saving")}return!1},e}(),Xn=function(){function e(){}var t=e.prototype;return t.hasPermissionToUpdateItem=function(e){var t=!1;return e.createdBy&&(t=e.createdBy===Ge.getInstance().getLoggedInUsername()),t},t.hasPermissionToDeleteItem=function(e){var t=!1;return e.createdBy&&(t=e.createdBy===Ge.getInstance().getLoggedInUsername()),t},e}();function ei(e,t){return(ei=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ti=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).detailViewListeners=[],t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ei(t,n);var a=i.prototype;return a.addListener=function(t){e.prototype.addListener.call(this,t),this.detailViewListeners.push(t)},a.saveNewItem=function(e,t){this.suppressEventEmits||this.detailViewListeners.forEach((function(n){return n.saveNewItem(e,t)}))},a.updateItem=function(e,t){this.suppressEventEmits||this.detailViewListeners.forEach((function(n){return n.updateItem(e,t)}))},a.deletedItem=function(e,t){this.suppressEventEmits||this.detailViewListeners.forEach((function(n){return n.deletedItem(e,t)}))},a.cancelled=function(e,t){this.suppressEventEmits||this.detailViewListeners.forEach((function(n){return n.cancelled(e,t)}))},i}(Je);function ni(e,t){return(ni=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ii=function(e){var t,n;function i(t,n){var i;(i=e.call(this,t)||this).currentItem=null,i.renderer=n;var a=new ti;return i.eventForwarder=a,i.renderer.setView(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i)),i.renderer.setEventForwarder(a),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ni(t,n);var a=i.prototype;return a.addEventDetailListener=function(e){this.eventForwarder.addListener(e)},a.clearDisplay=function(){this.renderer.reset()},a.clearReadOnly=function(){this.renderer.clearReadOnly()},a.setReadOnly=function(){this.renderer.setReadOnly()},a.isReadOnly=function(){return this.renderer.isReadOnly()},a.createItem=function(){return this.renderer.createItem()},a.displayItem=function(e){this.currentItem=e,this.renderer.hasPermissionToUpdateItem(e)?this.renderer.displayItem(e):this.renderer.displayItemReadonly(e),this.show()},a.hidden=function(){this.renderer.hidden()},a.show=function(){this.renderer.show()},a.render=function(){this.displayItem(this.currentItem)},a.onDocumentLoaded=function(){this.renderer.onDocumentLoaded(),e.prototype.onDocumentLoaded.call(this)},a.hasPermissionToDeleteItem=function(e){return this.renderer.hasPermissionToDeleteItem(e)},a.hasPermissionToUpdateItem=function(e){return this.renderer.hasPermissionToUpdateItem(e)},a.handleActionItem=function(e,t){this.renderer.handleActionItem(e,t)},a.isDisplayingItem=function(e){return this.renderer.isDisplayingItem(e)},a.hasChanged=function(){return this.renderer.hasChanged()},a.initialise=function(e,t,n){void 0===n&&(n=!1),this.renderer.initialise(e,t,n)},i}($e),ai=function(){function e(e){this.isCreatingNew=!1,this.typeName=e,this.listeners=[]}var t=e.prototype;return t.addListener=function(e){this.listeners.push(e)},t.informListenersOfCreate=function(e){var t=this;this.isCreatingNew=!1,this.listeners.forEach((function(n){return n.create(t,t.typeName,e)}))},t.informListenersOfUpdate=function(e){var t=this;this.isCreatingNew=!1,this.listeners.forEach((function(n){return n.update(t,t.typeName,e)}))},t.informListenersOfDelete=function(e){var t=this;this.isCreatingNew=!1,this.listeners.forEach((function(n){return n.delete(t,t.typeName,e)}))},t.startNewObject=function(){var e=!1;return this.isCreatingNew||(e=this._startNewObject(),this.isCreatingNew=e),e},t.isCreatingNewObject=function(){return this.isCreatingNew},e}();function ri(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function si(e,t){return(si=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var oi=r()("linked-controller"),di=r()("linked-controller-detail"),ci=function(){function e(e){this.controller=e}var t=e.prototype;return t.addView=function(e){e.addEventListener(this)},t.canDeleteItem=function(e,t){return!0},t.documentLoaded=function(e){},t.hideRequested=function(e){},t.itemAction=function(e,t,n){},t.itemDeleted=function(e,t){},t.itemDropped=function(e,t){},t.showRequested=function(e){},t.cancelled=function(e,t){this.controller.cancelled(e,t)},t.deletedItem=function(e,t){this.controller.deletedItem(e,t)},t.saveNewItem=function(e,t){this.controller.saveNewItem(e,t)},t.updateItem=function(e,t){this.controller.updateItem(e,t)},e}(),li=function(e){var t,n;function i(t,n){var i;return(i=e.call(this,t)||this).children=[],oi("Starting with parent view "+n.getName()),i.parentView=n,i.delegate=new ci(ri(i)),i.parentView.addEventListener(ri(i)),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,si(t,n);var a=i.prototype;return a.addLinkedDetailView=function(e){oi("Adding child view "+e.getName()),this.children.push(e),this.delegate.addView(e)},a.initialise=function(){},a.canDeleteItem=function(e,t){return oi("Handling delete item from view "+e.getName()),di(t),this.parentView.hasPermissionToDeleteItemInNamedCollection("",t)},a.documentLoaded=function(e){oi("Handling document loaded view "+e.getName()),this.children.forEach((function(e){e.onDocumentLoaded()}))},a.hideRequested=function(e){oi("Handling hide  from view "+e.getName()),this.children.forEach((function(e){e.hidden()}))},a.itemAction=function(e,t,n){oi("Handling item action "+t+" from view "+e.getName()),di(n),this.children.forEach((function(e){e.handleActionItem(t,n)}))},a.itemDeleted=function(e,t){oi("Handling item deleted from view "+e.getName()),di(t),this.children.forEach((function(e){e.clearDisplay(),e.setReadOnly()}))},a.itemDeselected=function(e,t){oi("Handling item deselected from view "+e.getName()),di(t),this.children.forEach((function(e){e.clearDisplay(),e.setReadOnly()}))},a.itemDragStarted=function(e,t){},a.itemDropped=function(e,t){},a.itemSelected=function(e,t){oi("Handling item selected from view "+e.getName()),di(t),this.children.forEach((function(e){e.displayItem(t)}))},a.showRequested=function(e){oi("Handling show from view "+e.getName()),this.children.forEach((function(e){e.show()}))},a.canSelectItem=function(e,t){if(oi("Handling can select item from view "+e.getName()),di(t),this.isCreatingNew)return!1;var n=!0;return this.children.forEach((function(e){e.hasChanged()&&(di("child view "+e.getName()+" has changed - cancelling"),n=!1)})),n||(n=confirm(e.getName()+" - unsaved changes.  Discard them?")),n},a.cancelled=function(e,t){oi("Handling cancelled from child view "+e.getName()),di(t),this.isCreatingNew=!1},a.deletedItem=function(e,t){oi("Handling deleted from child view "+e.getName()),di(t),this.informListenersOfDelete(t)},a.saveNewItem=function(e,t){oi("Handling save new from child view "+e.getName()),di(t),this.informListenersOfCreate(t)},a.updateItem=function(e,t){oi("Handling update from child view "+e.getName()),di(t),this.informListenersOfUpdate(t)},a._startNewObject=function(){oi("Handling start new object");var e=!0;return this.children.forEach((function(t){t.hasChanged()&&(di("child view "+t.getName()+" has changed - cancelling"),e=!1)})),e||(e=confirm("There are unsaved changes.  Discard them?")),this.children.length>0&&(oi("Handling start new object with child view "+this.children[0].getName()),this.children[0].createItem()&&(e=!0,this.children[0].show())),e},i}(ai),ui=function(){function e(){}return e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.setupValidationForExerciseTypeDetailsForm=function(e){var t={targetDataFieldId:"sets",response:gn.show,conditions:[{sourceDataFieldId:"type",comparison:fn.hasValue,values:"cardio"}]};In.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"reps",response:gn.show,conditions:[{sourceDataFieldId:"type",comparison:fn.hasValue,values:"cardio"}]},In.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"weight",response:gn.show,conditions:[{sourceDataFieldId:"type",comparison:fn.hasValue,values:"cardio"}]},In.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"reps",response:gn.hide,conditions:[{sourceDataFieldId:"type",comparison:fn.hasValue,values:"strength"}]},In.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"sets",response:gn.hide,conditions:[{sourceDataFieldId:"type",comparison:fn.hasValue,values:"strength"}]},In.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"weight",response:gn.hide,conditions:[{sourceDataFieldId:"type",comparison:fn.hasValue,values:"strength"}]},In.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"distance",response:gn.show,conditions:[{sourceDataFieldId:"type",comparison:fn.hasValue,values:"strength"}]},In.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"distance",response:gn.hide,conditions:[{sourceDataFieldId:"type",comparison:fn.hasValue,values:"cardio"}]},In.getInstance().addRuleToForm(e,t)},e}(),hi=r()("exercise-types-composite-view"),mi=function(){function e(e){this.sideBar=e}return e.prototype.onDocumentLoaded=function(){var e=new hn(Ge.getInstance().getStateManager());this.sideBar.addView(e,{containerId:jt.SidebarContainers.container});var t=He.getInstance().findDefinition(D);if(t){var n=new Zn(V,t,new Xn),i=new ii({resultsContainerId:V,dataSourceId:_},n),a=new li(D,e);a.addLinkedDetailView(i),this.sideBar.onDocumentLoaded();var r=Be.getInstance().generateStartingDisplayOrder(t);i.initialise(r,!1,!0);var s=n.getForm();s&&(hi("Setting up validation rules for "+s.getId()),hi(s),ui.getInstance().setupValidationForExerciseTypeDetailsForm(s));var o=document.getElementById("addNewExerciseType");hi("Setting up button for creating exercise types"),hi(o),o&&o.addEventListener("click",(function(e){hi("Asking view linker to start a new object"),a.startNewObject()})),a.addListener(Ge.getInstance())}},e}();function fi(e,t){return(fi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gi=function(e){var t,n;function i(){return e.call(this,i.SidebarPrefs)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,fi(t,n),i}(Dt);gi.SidebarPrefs={id:"workoutSummarySidebar",expandedSize:"100%",location:ye.bottom},gi.SidebarContainers={container:"workoutSummary"};var vi=r()("workout-summary-renderer"),pi=function(){function e(e,t){this.currentChart=null,this.view=e,this.eventHandler=t}var t=e.prototype;return t.generateRandomExerciseColourAndBorder=function(e){void 0===e&&(e=!0);var t=0,n=0,i=Math.floor(100*Math.random())+155;return e&&(t=i),e||(n=i),["rgba("+t+",50,"+n+",0.4)","rgb("+t+",50,"+n+")"]},t.createDisplayElementForCollectionItem=function(e,t){return document.createElement("a")},t.setDisplayElementsForCollectionInContainer=function(e,t,n){var i=this;vi("view "+this.view.getName()+": creating workout summary"),vi(n),this.currentChart&&this.currentChart.destroy();var a=n;n.length>7&&(a=n.slice(n.length-7));var r=[],s=[],o=[],d=[],c=[];a.forEach((function(e){var t=z()(e.createdOn,"YYYYMMDDHHmmss").format("ddd DD/MM/YYYY HH:mm");c.push(t),vi("Added label "+t),e.exercises&&e.exercises.forEach((function(e){var t=e.name;if(r.findIndex((function(e){return e==t}))<0){vi("Adding exercise "+t+" of type "+e.type+" to datasets"),r.push(t),d.push(e.type);var n=i.generateRandomExerciseColourAndBorder("strength"===e.type);s.push(n[0]),o.push(n[1])}}))}));var l=[];r.forEach((function(e,t){var n=d[t],i=s[t],r=o[t];vi("Constructing dataset "+e+" of type "+n+" to datasets");var c=[],u=[],h=[];a.forEach((function(t){u.push(i),h.push(r),t.exercises?t.exercises.every((function(t){return t.name!=e||("strength"===n?(vi("Found exercise "+e+" with value "+t.weight),c.push(t.weight)):(vi("Found exercise "+e+" with value "+t.distance),c.push(t.distance)),!1)}))&&c.push(0):c.push(0)}));var m={label:e,data:c,backgroundColor:u,borderColor:h,borderWidth:1,order:1};vi(m),l.push(m)}));var u={labels:c,datasets:l},h={type:"bar",data:u,options:{responsive:!0,animation:!0,maintainAspectRatio:!0,scales:{y:{beginAtZero:!0}}}};vi(u),this.currentChart=new tn.Z(e,h)},t.onDocumentLoaded=function(){},e}();function bi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ii(e,t){return(Ii=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ci=function(e){var t,n;function i(){var t;return(t=e.call(this,i.DOMConfig,Ge.getInstance().getStateManager(),R)||this).renderer=new pi(bi(t),bi(t)),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ii(t,n);var a=i.prototype;return a.canDeleteItem=function(e,t){return!1},a.compareItemsForEquality=function(e,t){return F(e,t)},a.getIdForItemInNamedCollection=function(e,t){return t._id},a.renderDisplayForItemInNamedCollection=function(e,t,n){},a.hasPermissionToDeleteItemInNamedCollection=function(e,t){return!1},a.hasPermissionToActionItemInNamedCollection=function(e,t,n){return!1},a.renderBackgroundForItemInNamedCollection=function(e,t,n){},i}(mt);function yi(e,t){return(yi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Ci.DOMConfig={viewConfig:{resultsContainerId:"workoutSummaryChart",dataSourceId:"workoutSummary"},resultsElementType:"canvas",resultsClasses:"",keyId:"_id",keyType:Ce.string,detail:{containerClasses:"",textElementType:"",textElementClasses:"",select:!1}};var wi=function(e){var t,n;function i(){return e.call(this,i.SidebarPrefs)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,yi(t,n),i}(Dt);wi.SidebarPrefs={id:"currentWorkoutSidebar",expandedSize:"50%",location:ye.right},wi.SidebarContainers={list:"exercises",detail:"workoutDetail"};var Ei=function(){function e(){}var t=e.prototype;return t.hasPermissionToUpdateItem=function(e){return!0},t.hasPermissionToDeleteItem=function(e){return!0},e}();function Si(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Li(e,t){return(Li=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}r()("current-workout-exercises-view");var Fi=function(e){var t,n;function i(t){var n;return(n=e.call(this,i.DOMConfig,t,D)||this).renderer=new vt(Si(n),Si(n)),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Li(t,n);var a=i.prototype;return a.canDeleteItem=function(e,t){return!0},a.compareItemsForEquality=function(e,t){return F(e,t)},a.getIdForItemInNamedCollection=function(e,t){return t._id},a.renderDisplayForItemInNamedCollection=function(e,t,n){e.innerHTML=n.name},a.hasPermissionToDeleteItemInNamedCollection=function(e,t){return!0},a.itemDropped=function(e,t){Ge.getInstance().addExerciseToCurrentWorkout(t)},i}(mt);Fi.DOMConfig={viewConfig:{resultsContainerId:"exercises",dataSourceId:B,drop:{acceptFrom:[j],acceptTypes:[O]}},resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"_id",keyType:Ce.string,modifiers:{normal:"",inactive:"list-group-item-light",active:"list-group-item-primary",warning:""},icons:{normal:"",inactive:"",active:"",warning:""},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,icons:function(e,t){return t.type?"cardio"===t.type?["fas fa-running ml-2"]:["fas fa-dumbbell ml-2"]:[]},delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-md",iconClasses:"text-black fas fa-sign-out-alt",attributes:[{name:"data-toggle",value:"tooltip"},{name:"data-placement",value:"right"},{name:"title",value:"Delete this exercise from the workout."}]}}};var Ni=r()("current-workout-composite-view"),ki=function(){function e(e){this.currentWorkout={},this.workoutDef=null,this.sideBar=e,this.stateManager=new h,this.stateManager.addChangeListenerForName(D,this),Ge.getInstance().getStateManager().addChangeListenerForName(R,this)}var t=e.prototype;return t.getListenerName=function(){return"Current Workout Composite View"},t.onDocumentLoaded=function(){var e=this;if(this.workoutDef=He.getInstance().findDefinition(R),!this.workoutDef)throw new Error("Workout definition not found");var t=new Fi(this.stateManager);this.sideBar.addView(t,{containerId:"exerciseDropZone"});var n=He.getInstance().findDefinition(D);if(n){var i=new Zn(H,n,new Ei),a=new ii({resultsContainerId:H,dataSourceId:B},i),r=new li(D,t);r.addLinkedDetailView(a),this.sideBar.onDocumentLoaded();var s=Be.getInstance().generateStartingDisplayOrder(n);a.initialise(s,!1,!0);var o=i.getForm();o&&(Ni("Setting up validation rules for "+o.getId()),Ni(o),ui.getInstance().setupValidationForExerciseTypeDetailsForm(o));var d=document.getElementById("completeWorkout");Ni("Setting up button for completing the workout"),Ni(d),d&&d.addEventListener("click",(function(t){Ni("Completing the workout"),e.currentWorkout.completed=!0,e.saveWorkout(),e.createWorkout()})),r.addListener(this)}},t.getStateManager=function(){return this.stateManager},t.createWorkout=function(){Ni("Creating new current workout"),this.currentWorkout=He.getInstance().createInstance(R),Ni(this.currentWorkout),Ge.getInstance().getStateManager().addNewItemToState(R,this.currentWorkout,!1),this.stateManager.setStateByName(D,this.currentWorkout.exercises,!0)},t.saveWorkout=function(){Ni("Saving current workout"),Ni(this.currentWorkout),Ge.getInstance().getStateManager().updateItemInState(R,this.currentWorkout,F,!1)},t.stateChanged=function(e,t,n){var i=this;Ni(e+","+t),t===R&&(Ni("Workouts loaded"),this.currentWorkout=null,n.forEach((function(e){e.completed&&"false"!==e.completed||(i.currentWorkout=e)})),this.currentWorkout?(Ni("Workouts loaded found existing current workout"),this.stateManager.setStateByName(D,this.currentWorkout.exercises,!0)):(Ni("Workouts loaded no existing current workout, creating and saving"),this.createWorkout()))},t.stateChangedItemAdded=function(e,t,n){t===D&&(Ni("Added a new exercise to workout"),Ni(n),console.log(n),this.currentWorkout.exercises.push(n),this.saveWorkout())},t.stateChangedItemRemoved=function(e,t,n){if(t===D){var i=this.currentWorkout.exercises.findIndex((function(e){return e._id===n._id}));Ni("Removing exercise to workout at index "+i),Ni(n),i>=0&&this.currentWorkout.exercises.splice(i,1),this.saveWorkout()}},t.stateChangedItemUpdated=function(e,t,n,i){if(t===D){var a=this.currentWorkout.exercises.findIndex((function(e){return e._id===i._id}));Ni("Updating exercise to workout at index "+a),Ni(i),a>=0&&this.currentWorkout.exercises.splice(a,1,i),this.saveWorkout()}},t.create=function(e,t,n){Ni("Added a new exercise to workout from view"),Ni(n),this.stateManager.addNewItemToState(D,n,!1)},t.update=function(e,t,n){Ni("Updating exercise in workout from view"),Ni(n),this.stateManager.updateItemInState(D,n,F,!1)},t.delete=function(e,t,n){Ni("Deleting exercise from workout from view"),Ni(n),this.stateManager.removeItemFromState(D,n,F,!1)},e}();localStorage.debug="current-workout-composite-view",r().log=console.info.bind(console);var Di=r()("app"),Ri=function(){function e(){this.handleShowUserSearch=this.handleShowUserSearch.bind(this),this.handleShowExerciseTypes=this.handleShowExerciseTypes.bind(this),this.handleShowChat=this.handleShowChat.bind(this),this.handleShowWorkoutSummary=this.handleShowWorkoutSummary.bind(this),this.handleShowCurrentWorkout=this.handleShowCurrentWorkout.bind(this),Ge.getInstance().connectToApplication(this,window.localStorage)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getCurrentUser=function(){return Ge.getInstance().getLoggedInUserId()},t.setupNavigationItemHandling=function(){document.getElementById("navigationItemUserSearch").addEventListener("click",this.handleShowUserSearch),document.getElementById("navigationItemExerciseTypes").addEventListener("click",this.handleShowExerciseTypes),document.getElementById("navigationItemWorkoutSummary").addEventListener("click",this.handleShowWorkoutSummary),document.getElementById("navigationItemCurrentWorkout").addEventListener("click",this.handleShowCurrentWorkout),this.chatNavigationItem=document.getElementById("navigationItemChat"),this.chatNavigationItem.addEventListener("click",this.handleShowChat)},t.setupUserSearchViews=function(){this.userSearchSidebar=new Ut;var e=new wt(Ge.getInstance().getStateManager());this.userSearchSidebar.addView(e,{containerId:Ut.SidebarContainers.recentSearches});var t=new Gt(Ge.getInstance().getStateManager());this.userSearchSidebar.addView(t,{containerId:Ut.SidebarContainers.favourites});var n=new Kt(Ge.getInstance().getStateManager());this.userSearchSidebar.addView(n,{containerId:Ut.SidebarContainers.blocked}),this.userSearchSidebar.onDocumentLoaded()},t.setupChatViews=function(){this.chatSidebar=new Mt,this.chatView=new Nt,this.chatSidebar.addView(this.chatView,{containerId:Mt.SidebarContainers.chatLogs});var e=new Vt(Ge.getInstance().getStateManager());this.chatSidebar.addView(e,{containerId:Mt.SidebarContainers.chatLog}),this.chatView.addEventListener(e),this.chatSidebar.onDocumentLoaded()},t.onDocumentLoad=function(){Di("document loaded"),this.thisEl=document.getElementById("root"),this.setupUserSearchViews(),this.setupChatViews(),this.setupNavigationItemHandling(),this.exerciseTypesSidebar=new jt,new mi(this.exerciseTypesSidebar).onDocumentLoaded(),(new sn).onDocumentLoaded(),this.workoutSummarySidebar=new gi,this.workoutSummarySidebar.addView(new Ci,{containerId:gi.SidebarContainers.container}),this.workoutSummarySidebar.onDocumentLoaded(),this.currentWorkoutSidebar=new wi,this.currentWorkoutView=new ki(this.currentWorkoutSidebar),this.currentWorkoutView.onDocumentLoaded(),Ge.getInstance().initialise()},t.hideAllSideBars=function(){this.chatSidebar.eventHide(null),this.userSearchSidebar.eventHide(null),this.exerciseTypesSidebar.eventHide(null)},t.handleShowUserSearch=function(e){Di("Handling Show User Search"),e.preventDefault(),Ge.getInstance().isLoggedIn()?this.userSearchSidebar.eventShow(e):window.location.href=U},t.handleShowWorkoutSummary=function(e){Di("Handling Show Workout Summary"),e.preventDefault(),Ge.getInstance().isLoggedIn()?this.workoutSummarySidebar.eventShow(e):window.location.href=U},t.handleShowCurrentWorkout=function(e){Di("Handling Show Current Workout"),e.preventDefault(),Ge.getInstance().isLoggedIn()?this.currentWorkoutSidebar.eventShow(e):window.location.href=U},t.handleShowExerciseTypes=function(e){Di("Handling Show Exercise Types"),e.preventDefault(),Ge.getInstance().isLoggedIn()?this.exerciseTypesSidebar.eventShow(e):window.location.href=U},t.handleShowChat=function(e){Di("Handling Show Chat"),Ge.getInstance().isLoggedIn()?(this.chatSidebar.eventShow(null),e&&this.chatView.selectChatRoom(e)):window.location.href=U},t.countChanged=function(e){var t='Chat <i class="fas fa-inbox"></i>';e>0&&(t+=' <span class="badge badge-pill badge-primary">&nbsp;'+e+"&nbsp;</span>"),this.chatNavigationItem&&(this.chatNavigationItem.innerHTML=""+t)},t.addingExerciseToCurrentWorkout=function(e){this.exerciseTypesSidebar.eventHide(null),this.currentWorkoutSidebar.eventShow(null),this.currentWorkoutView.getStateManager().addNewItemToState(D,e,!1)},t.showCurrentWorkout=function(){this.currentWorkoutSidebar.eventShow(null)},e}();$((function(){Ri.getInstance().onDocumentLoad()}))},6700:(e,t,n)=>{var i={"./af":2786,"./af.js":2786,"./ar":867,"./ar-dz":4130,"./ar-dz.js":4130,"./ar-kw":6135,"./ar-kw.js":6135,"./ar-ly":6440,"./ar-ly.js":6440,"./ar-ma":7702,"./ar-ma.js":7702,"./ar-sa":6040,"./ar-sa.js":6040,"./ar-tn":7100,"./ar-tn.js":7100,"./ar.js":867,"./az":1083,"./az.js":1083,"./be":9808,"./be.js":9808,"./bg":8338,"./bg.js":8338,"./bm":7438,"./bm.js":7438,"./bn":8905,"./bn-bd":6225,"./bn-bd.js":6225,"./bn.js":8905,"./bo":1560,"./bo.js":1560,"./br":1278,"./br.js":1278,"./bs":622,"./bs.js":622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":877,"./cv.js":877,"./cy":7373,"./cy.js":7373,"./da":4780,"./da.js":4780,"./de":9740,"./de-at":217,"./de-at.js":217,"./de-ch":894,"./de-ch.js":894,"./de.js":9740,"./dv":5300,"./dv.js":5300,"./el":837,"./el.js":837,"./en-au":8348,"./en-au.js":8348,"./en-ca":7925,"./en-ca.js":7925,"./en-gb":2243,"./en-gb.js":2243,"./en-ie":6436,"./en-ie.js":6436,"./en-il":7207,"./en-il.js":7207,"./en-in":4175,"./en-in.js":4175,"./en-nz":6319,"./en-nz.js":6319,"./en-sg":1662,"./en-sg.js":1662,"./eo":2915,"./eo.js":2915,"./es":5655,"./es-do":5251,"./es-do.js":5251,"./es-mx":6112,"./es-mx.js":6112,"./es-us":1146,"./es-us.js":1146,"./es.js":5655,"./et":5603,"./et.js":5603,"./eu":7763,"./eu.js":7763,"./fa":6959,"./fa.js":6959,"./fi":1897,"./fi.js":1897,"./fil":2549,"./fil.js":2549,"./fo":4694,"./fo.js":4694,"./fr":4470,"./fr-ca":3049,"./fr-ca.js":3049,"./fr-ch":2330,"./fr-ch.js":2330,"./fr.js":4470,"./fy":5044,"./fy.js":5044,"./ga":9295,"./ga.js":9295,"./gd":2101,"./gd.js":2101,"./gl":8794,"./gl.js":8794,"./gom-deva":7884,"./gom-deva.js":7884,"./gom-latn":3168,"./gom-latn.js":3168,"./gu":5349,"./gu.js":5349,"./he":4206,"./he.js":4206,"./hi":94,"./hi.js":94,"./hr":316,"./hr.js":316,"./hu":2138,"./hu.js":2138,"./hy-am":1423,"./hy-am.js":1423,"./id":9218,"./id.js":9218,"./is":135,"./is.js":135,"./it":626,"./it-ch":150,"./it-ch.js":150,"./it.js":626,"./ja":9183,"./ja.js":9183,"./jv":4286,"./jv.js":4286,"./ka":2105,"./ka.js":2105,"./kk":7772,"./kk.js":7772,"./km":8758,"./km.js":8758,"./kn":9282,"./kn.js":9282,"./ko":3730,"./ko.js":3730,"./ku":1408,"./ku.js":1408,"./ky":3291,"./ky.js":3291,"./lb":6841,"./lb.js":6841,"./lo":5466,"./lo.js":5466,"./lt":7010,"./lt.js":7010,"./lv":7595,"./lv.js":7595,"./me":9861,"./me.js":9861,"./mi":5493,"./mi.js":5493,"./mk":5966,"./mk.js":5966,"./ml":7341,"./ml.js":7341,"./mn":5115,"./mn.js":5115,"./mr":370,"./mr.js":370,"./ms":9847,"./ms-my":1237,"./ms-my.js":1237,"./ms.js":9847,"./mt":2126,"./mt.js":2126,"./my":6165,"./my.js":6165,"./nb":4924,"./nb.js":4924,"./ne":6744,"./ne.js":6744,"./nl":3901,"./nl-be":9814,"./nl-be.js":9814,"./nl.js":3901,"./nn":3877,"./nn.js":3877,"./oc-lnc":2135,"./oc-lnc.js":2135,"./pa-in":5858,"./pa-in.js":5858,"./pl":4495,"./pl.js":4495,"./pt":9520,"./pt-br":7971,"./pt-br.js":7971,"./pt.js":9520,"./ro":6459,"./ro.js":6459,"./ru":1793,"./ru.js":1793,"./sd":950,"./sd.js":950,"./se":490,"./se.js":490,"./si":124,"./si.js":124,"./sk":4249,"./sk.js":4249,"./sl":4985,"./sl.js":4985,"./sq":1104,"./sq.js":1104,"./sr":9131,"./sr-cyrl":9915,"./sr-cyrl.js":9915,"./sr.js":9131,"./ss":5893,"./ss.js":5893,"./sv":8760,"./sv.js":8760,"./sw":1172,"./sw.js":1172,"./ta":7333,"./ta.js":7333,"./te":3110,"./te.js":3110,"./tet":2095,"./tet.js":2095,"./tg":7321,"./tg.js":7321,"./th":9041,"./th.js":9041,"./tk":9005,"./tk.js":9005,"./tl-ph":5768,"./tl-ph.js":5768,"./tlh":9444,"./tlh.js":9444,"./tr":2397,"./tr.js":2397,"./tzl":8254,"./tzl.js":8254,"./tzm":1106,"./tzm-latn":699,"./tzm-latn.js":699,"./tzm.js":1106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":7691,"./uk.js":7691,"./ur":3795,"./ur.js":3795,"./uz":6791,"./uz-latn":588,"./uz-latn.js":588,"./uz.js":6791,"./vi":5666,"./vi.js":5666,"./x-pseudo":4378,"./x-pseudo.js":4378,"./yo":5805,"./yo.js":5805,"./zh-cn":3839,"./zh-cn.js":3839,"./zh-hk":5726,"./zh-hk.js":5726,"./zh-mo":9807,"./zh-mo.js":9807,"./zh-tw":4152,"./zh-tw.js":4152};function a(e){var t=r(e);return n(t)}function r(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=r,e.exports=a,a.id=6700}},n={};function i(e){var a=n[e];if(void 0!==a)return a.exports;var r=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}i.m=t,e=[],i.O=(t,n,a,r)=>{if(!n){var s=1/0;for(l=0;l<e.length;l++){for(var[n,a,r]=e[l],o=!0,d=0;d<n.length;d++)(!1&r||s>=r)&&Object.keys(i.O).every((e=>i.O[e](n[d])))?n.splice(d--,1):(o=!1,r<s&&(s=r));if(o){e.splice(l--,1);var c=a();void 0!==c&&(t=c)}}return t}r=r||0;for(var l=e.length;l>0&&e[l-1][2]>r;l--)e[l]=e[l-1];e[l]=[n,a,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={143:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var a,r,[s,o,d]=n,c=0;if(s.some((t=>0!==e[t]))){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(d)var l=d(i)}for(t&&t(n);c<s.length;c++)r=s[c],i.o(e,r)&&e[r]&&e[r][0](),e[s[c]]=0;return i.O(l)},n=self.webpackChunktemplate_feo_react_babel=self.webpackChunktemplate_feo_react_babel||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=i.O(void 0,[736],(()=>i(1663)));a=i.O(a)})();
//# sourceMappingURL=app.bundle.js.map