(()=>{var e,t={3610:(e,t,n)=>{"use strict";var a,i=n(7294),s=n(3935),r=n(1227),o=n.n(r);!function(e){e[e.ItemAdded=0]="ItemAdded",e[e.ItemUpdated=1]="ItemUpdated",e[e.ItemDeleted=2]="ItemDeleted",e[e.StateChanged=3]="StateChanged"}(a||(a={}));var c=o()("state-manager-delegate");const d=function(){function e(e){this.suppressEventEmits=!1,this.managerName=e,this.stateChangeListeners=[]}var t=e.prototype;return t.suppressEvents=function(){this.suppressEventEmits=!0},t.emitEvents=function(){this.suppressEventEmits=!1},t.informChangeListenersForStateWithName=function(e,t,n,i){if(void 0===n&&(n=a.StateChanged),void 0===i&&(i=null),c("State Manager: Informing state listeners of "+e),this.suppressEventEmits)c("State Manager: Events suppressed");else{var s=this.stateChangeListeners.findIndex((function(t){return t.name===e}));if(s>=0){c("State Manager: Found state listeners of "+e+" with event type "+n);for(var r=this.stateChangeListeners[s],o=0;o<r.listeners.length;o++){c("State Manager: Found state listener of "+e+" - informing");var d=r.listeners[o];switch(n){case a.StateChanged:d.stateChanged(this.managerName,e,t);break;case a.ItemAdded:d.stateChangedItemAdded(this.managerName,e,t);break;case a.ItemUpdated:d.stateChangedItemUpdated(this.managerName,e,i,t);break;case a.ItemDeleted:d.stateChangedItemRemoved(this.managerName,e,t)}}}}},t.addChangeListenerForName=function(e,t){this.ensureListenerSetupForName(e),c("State Manager: Adding state listener for "+e);var n=this.stateChangeListeners.findIndex((function(t){return t.name===e}));n>=0&&this.stateChangeListeners[n].listeners.push(t)},t.ensureListenerSetupForName=function(e){if(this.stateChangeListeners.findIndex((function(t){return t.name===e}))<0){var t={name:e,listeners:[]};this.stateChangeListeners.push(t)}},e}();var h=o()("state-manager-ts"),u=function(){function e(e){this.forceSaves=!0,this.managerName="",this.delegate=new d(e),this.managerName=e,this.emitEvents(),this.forceSaves=!0}var t=e.prototype;return t.suppressEvents=function(){this.delegate.suppressEvents()},t.emitEvents=function(){this.delegate.emitEvents()},t.dontForceSavesOnAddRemoveUpdate=function(){this.forceSaves=!1},t.forceSavesOnAddRemoveUpdate=function(){this.forceSaves=!0},t.informChangeListenersForStateWithName=function(e,t,n,i){void 0===n&&(n=a.StateChanged),void 0===i&&(i=null),this.delegate.informChangeListenersForStateWithName(e,t,n,i)},t.addChangeListenerForName=function(e,t){this.delegate.addChangeListenerForName(e,t)},t.addStateByName=function(e,t){this._ensureStatePresent(e);var n={name:e,value:t};return this._replaceNamedStateInStorage(n),this.informChangeListenersForStateWithName(e,t,a.StateChanged),t},t.getStateByName=function(e){var t;return this._ensureStatePresent(e),h("State Manager: Getting state for "+e),t=this._getState(e).value,h("State Manager: Found previous state for "+e),h(t),t},t.setStateByName=function(e,t,n){return void 0===n&&(n=!0),this._ensureStatePresent(e),h("State Manager: Setting state for "+e),h(t),this._getState(e).value=t,this.forceSaves&&this._saveState(e,t),n&&this.informChangeListenersForStateWithName(e,t),t},t.addNewItemToState=function(e,t,n){void 0===n&&(n=!1),this._ensureStatePresent(e),h("State Manager: Adding item to state "+e),this._addItemToState(e,t,n),this.informChangeListenersForStateWithName(e,t,a.ItemAdded)},t.findItemInState=function(e,t,n){this._ensureStatePresent(e);var a={},i=this.getStateByName(e),s=i.findIndex((function(e){return n(e,t)}));return h("Finding item in state "+e+" - found index "+s),h(t),s>=0&&(a=i[s]),a},t.isItemInState=function(e,t,n){this._ensureStatePresent(e);var a=!1;return this.getStateByName(e).findIndex((function(e){return n(e,t)}))>=0&&(a=!0),a},t.removeItemFromState=function(e,t,n,i){this._ensureStatePresent(e);var s=this.findItemInState(e,t,n);return h("State Manager: Found item - removing "),this._removeItemFromState(e,t,n,i),this.informChangeListenersForStateWithName(e,s,a.ItemDeleted),!0},t.updateItemInState=function(e,t,n,i){this._ensureStatePresent(e);var s=this.findItemInState(e,t,n);return h("State Manager: Found item - replacing "),this._updateItemInState(e,t,n,i),this.informChangeListenersForStateWithName(e,t,a.ItemUpdated,s),!0},e}();function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=o()("state-manager-ms");const g=function(e){var t,n;function a(){var t;return(t=e.call(this,"memory")||this).applicationState=[],t.forceSaves=!0,t}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,l(t,n),a.getInstance=function(){return a._instance||(a._instance=new a),a._instance};var i=a.prototype;return i._ensureStatePresent=function(e){if(this.applicationState.findIndex((function(t){return t.name===e}))<0){var t={name:e,value:[]};this.applicationState.push(t)}},i._addNewNamedStateToStorage=function(e){m("Adding new complete state "+name),m(e.value),this.applicationState.push(e)},i._replaceNamedStateInStorage=function(e){var t=this.applicationState.findIndex((function(t){return t.name===e.name}));t>=0&&(m("replacing complete state "+name),m(e.value),this.applicationState.splice(t,1,e))},i._getState=function(e){var t=this.applicationState.find((function(t){return t.name===e}));return m("getting complete state "+e),m(t.value),t},i._saveState=function(e,t){var n=this.applicationState.findIndex((function(t){return t.name===e}));if(n>=0){var a=this.applicationState[n];m("SAVING complete state "+e),m(a.value),a.value=t}},i._addItemToState=function(e,t,n){if(void 0===n&&(n=!1),n){var a=this.applicationState.findIndex((function(t){return t.name===e}));if(a>=0){var i=this.applicationState[a];m("adding item to state "+e),m(t),i.value.push(t)}}},i._removeItemFromState=function(e,t,n,a){var i=this.applicationState.findIndex((function(t){return t.name===e}));if(i>=0){var s=this.applicationState[i],r=s.value.findIndex((function(e){return n(e,t)}));r>=0&&(m("removing item from state "+e),m(t),s.value.splice(r,1))}},i._updateItemInState=function(e,t,n,a){var i=this.applicationState.findIndex((function(t){return t.name===e}));if(i>=0){var s=this.applicationState[i],r=s.value.findIndex((function(e){return n(e,t)}));r>=0&&(s.value.splice(r,1,t),m("updating item in state "+e),m(t))}else this._addItemToState(e,t,!0)},a}(u);var f,v;!function(e){e[e.Normal=0]="Normal",e[e.High=1]="High",e[e.Urgent=2]="Urgent"}(f||(f={})),function(e){e[e.ChatRoom=0]="ChatRoom",e[e.ScoreSheet=1]="ScoreSheet"}(v||(v={}));var p=o()("socket-ts");const S=function(){function e(){this.chatReceivers=[],this.callbackForMessage=this.callbackForMessage.bind(this),this.callbackForData=this.callbackForData.bind(this),this.listener=null,this.socket=null,this.chatReceivers=[],this.callbackForMessage=this.callbackForMessage.bind(this),this.callbackForLogin=this.callbackForLogin.bind(this),this.callbackForLogout=this.callbackForLogout.bind(this),this.callbackForJoinRoom=this.callbackForJoinRoom.bind(this),this.callbackForExitRoom=this.callbackForExitRoom.bind(this),this.callbackForInvite=this.callbackForInvite.bind(this),this.callbackForChat=this.callbackForChat.bind(this),this.callbackForQueue=this.callbackForQueue.bind(this),this.callbackForUserList=this.callbackForUserList.bind(this),this.callbackForDeclineInvite=this.callbackForDeclineInvite.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.addChatReceiver=function(e){this.chatReceivers.push(e)},t.setListener=function(e){p("Setting listener"),this.listener=e,p("Creating socket connection"),this.socket=io(),p("Waiting for messages"),this.socket.on("message",this.callbackForMessage),this.socket.on("data",this.callbackForData),this.socket.on("login",this.callbackForLogin),this.socket.on("logout",this.callbackForLogout),this.socket.on("joinroom",this.callbackForJoinRoom),this.socket.on("exitroom",this.callbackForExitRoom),this.socket.on("invite",this.callbackForInvite),this.socket.on("declineinvite",this.callbackForDeclineInvite),this.socket.on("chat",this.callbackForChat),this.socket.on("queue",this.callbackForQueue),this.socket.on("userlist",this.callbackForUserList)},t.login=function(e){this.socket.emit("login",{username:e})},t.logout=function(e){this.socket.emit("logout",{username:e})},t.joinChat=function(e,t,n){this.socket.emit("joinroom",{username:e,room:t,type:n})},t.leaveChat=function(e,t,n){this.socket.emit("exitroom",{username:e,room:t,type:n})},t.sendInvite=function(e,t,n,a,i,s,r){void 0===a&&(a=v.ChatRoom),void 0===i&&(i=!1),void 0===s&&(s=""),void 0===r&&(r={});var o={from:e,to:t,room:n,type:a,requiresAcceptDecline:i,subject:s,attachment:r};p("Sending invite"),p(o),this.socket.emit("invite",o)},t.sendMessage=function(e,t,n,a,i,s,r){void 0===s&&(s=f.Normal),void 0===r&&(r={});var o={from:e,room:t,message:n,created:a,priority:s,type:i,attachment:r};this.socket.emit("chat",o)},t.getUserList=function(){this.socket.emit("userlist")},t.sendDeclineInvite=function(e,t,n){this.socket.emit("declineinvite",{room:e,from:t,type:n})},t.callbackForMessage=function(e){p("Received message : "+e);try{p(e);var t=JSON.parse(e);this.chatReceivers.forEach((function(e){return e.receiveMessage(t)}))}catch(e){p(e),p("Not JSON data")}},t.callbackForLogin=function(e){p("Received login : "+e),this.chatReceivers.forEach((function(t){return t.receiveLogin(e)}))},t.callbackForUserList=function(e){p("Received user list : "+e),this.chatReceivers.forEach((function(t){return t.receiveUserList(e)}))},t.callbackForLogout=function(e){p("Received logout : "+e),this.chatReceivers.forEach((function(t){return t.receiveLogout(e)}))},t.callbackForJoinRoom=function(e){p("Received joined room : "+e);try{var t=JSON.parse(e);p(t),this.chatReceivers.forEach((function(e){return e.receiveJoinedRoom(t)}))}catch(e){p("Not JSON data")}},t.callbackForExitRoom=function(e){p("Received left room : "+e);try{var t=JSON.parse(e);p(t),this.chatReceivers.forEach((function(e){return e.receivedLeftRoom(t)}))}catch(e){p("Not JSON data")}},t.callbackForInvite=function(e){p("Received invite : "+e);try{var t=JSON.parse(e);p(t),this.chatReceivers.forEach((function(e){return e.receiveInvitation(t)}))}catch(e){p("Not JSON data")}},t.callbackForDeclineInvite=function(e){p("Received declined invite : "+e);try{var t=JSON.parse(e);p(t),this.chatReceivers.forEach((function(e){return e.receiveDecline(t.room,t.username,t.type)}))}catch(e){p(e),p("Not JSON data")}},t.callbackForChat=function(e){p("Received chat : "+e);try{var t=JSON.parse(e);p(t),this.chatReceivers.forEach((function(e){return e.receiveMessage(t)}))}catch(e){p("Not JSON data")}},t.callbackForQueue=function(e){p("Received queued items : "+e);try{var t=JSON.parse(e);p(t),t.invites&&t.invites.length>0&&this.chatReceivers.forEach((function(e){return e.receiveQueuedInvites(t.invites)})),t.messages&&t.messages.length>0&&this.chatReceivers.forEach((function(e){return e.receiveQueuedMessages(t.messages)}))}catch(e){p("Not JSON data")}},t.callbackForData=function(e){p("Received data");try{var t=JSON.parse(e);if(p(t),null===this.listener)return;t.user===this.listener.getCurrentUser()?p("change made by this user, ignoring"):(p("change made by another user, passing off to the application"),this.listener.handleDataChangedByAnotherUser(t))}catch(e){p("Not JSON data")}},e}();function I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var C=o()("state-manager-async"),y=function(e){var t,n;function a(t,n){var a;(a=e.call(this,"async")||this).topLevelSM=t,a.wrappedSM=n,a.forceSaves=!1,a.wrappedSM.emitEvents();var i=a.wrappedSM.getConfiguredStateNames();return a.stateChanged=a.stateChanged.bind(I(a)),a.stateChangedItemAdded=a.stateChangedItemAdded.bind(I(a)),a.stateChangedItemRemoved=a.stateChangedItemRemoved.bind(I(a)),a.stateChangedItemUpdated=a.stateChangedItemUpdated.bind(I(a)),i.forEach((function(e){a.wrappedSM.addChangeListenerForName(e,I(a))})),a}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,b(t,n);var i=a.prototype;return i._addItemToState=function(e,t,n){void 0===n&&(n=!1),C("adding item to state "+e+" - is persisted "+n),this.wrappedSM.addNewItemToState(e,t,n)},i._getState=function(e){return C("getting state "+e),this.wrappedSM.getStateByName(e),{name:e,value:[]}},i._removeItemFromState=function(e,t,n,a){C("removing item from state "+e),this.wrappedSM.removeItemFromState(e,t,n,a)},i._updateItemInState=function(e,t,n,a){C("updating item in state "+e),this.wrappedSM.updateItemInState(e,t,n,a)},i._ensureStatePresent=function(e){},i._addNewNamedStateToStorage=function(e){},i._replaceNamedStateInStorage=function(e){},i._saveState=function(e,t){},i.stateChangedItemRemoved=function(e,t,n){},i.stateChangedItemUpdated=function(e,t,n,a){},i.stateChanged=function(e,t,n){C("Wrapped SM has supplied new state "+t+" passing to top level SM"),C(n),this.topLevelSM.setStateByName(t,n)},i.stateChangedItemAdded=function(e,t,n){C("Wrapped SM has supplied new completed item for state "+t+" passing to top level SM"),this.topLevelSM.addNewItemToState(t,n,!0)},a}(u);function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w,E=o()("state-manager-aggregate"),U=function(e){var t,n;function a(){var t;return(t=e.call(this,"aggregate")||this).stateManagers=[],t.emitEvents(),t}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,L(t,n),a.getInstance=function(){return a._instance||(a._instance=new a),a._instance};var i=a.prototype;return i.addStateManager=function(e,t,n){void 0===t&&(t=[]);var a={manager:e,filters:t};this.stateManagers.push(a),n||e.suppressEvents(),E("adding state manager with/without filters")},i._addNewNamedStateToStorage=function(e){var t=this;this.stateManagers.forEach((function(n){t.stateNameInFilters(e.name,n.filters)||n.manager._addNewNamedStateToStorage(e)}))},i._getState=function(e){var t=this,n={name:e,value:[]};return this.stateManagers.forEach((function(a){t.stateNameInFilters(n.name,a.filters)||(E("get state from state manager for state "+e),E(a.manager),a.manager._getState(e))})),this.stateManagers.length>0&&(n=this.stateManagers[0].manager._getState(e)),n},i._ensureStatePresent=function(e){var t=this;this.stateManagers.forEach((function(n){t.stateNameInFilters(e,n.filters)||n.manager._ensureStatePresent(e)}))},i._replaceNamedStateInStorage=function(e){var t=this;this.stateManagers.forEach((function(n){t.stateNameInFilters(e.name,n.filters)||n.manager._replaceNamedStateInStorage(e)}))},i._saveState=function(e,t){var n=this;this.stateManagers.forEach((function(a){n.stateNameInFilters(e,a.filters)||(E("saving state in state manager for state "+e),E(a.manager),E(t),a.manager._saveState(e,t))}))},i._addItemToState=function(e,t,n){var a=this;void 0===n&&(n=!1),this.stateManagers.forEach((function(i){a.stateNameInFilters(e,i.filters)||(E("adding item to state in  state manager for state "+e+", is persisted = "+n),E(i.manager),E(t),i.manager._addItemToState(e,t,n))}))},i._removeItemFromState=function(e,t,n,a){var i=this;this.stateManagers.forEach((function(s){i.stateNameInFilters(e,s.filters)||(E("removing item from state in state manager for state "+e),E(s.manager),E(t),s.manager._removeItemFromState(e,t,n,a))}))},i._updateItemInState=function(e,t,n,a){var i=this;this.stateManagers.forEach((function(s){i.stateNameInFilters(e,s.filters)||(E("updating item in state in  state manager for state "+e),E(s.manager),E(t),s.manager._updateItemInState(e,t,n,a))}))},i.stateNameInFilters=function(e,t){return t.findIndex((function(t){return t===e}))>=0},a}(u);function R(e,t){return e.id===t.id}function k(e,t){return e.gameId===t.gameId}!function(e){e[e.Incomplete=0]="Incomplete",e[e.Complete=1]="Complete",e[e.Persisted=2]="Persisted",e[e.PersistedLocally=3]="PersistedLocally"}(w||(w={}));var N="users",D="boardGames",j="scores",F="recentUserSearches",T="bggSearchResults",B="scoreSheet",A="chatLogs",M="/login",O="/graphql",x="query getDetails($gameId:Int!) {getBoardGameDetails(gameId:$gameId) {gameId,thumb,image,name,description,year, minPlayers, maxPlayers, minPlayTime, maxPlayTime, minAge, designers, artists, publisher, numOfRaters, averageScore, rank, categories}}",G="getBoardGameDetails",_="query {findUsers {id, username}}",P="findUsers",H="mutation addBoardGame($userId: Int!, $boardGame: BoardGameDetailInput!){addToMyCollection(userId: $userId, boardGame: $boardGame) {id,gameId}}",q="addToMyCollection",V="mutation removeBoardGame($userId: Int!, $boardGameId: Int!) {removeFromMyCollection(userId: $userId, boardGameId: $boardGameId) {result}}",Y="removeFromMyCollection",Q="query myCollection($userId: Int!) {getMyBoardGameCollection(userId: $userId) {id,gameId,thumb,image,name,description,year, minPlayers, maxPlayers, minPlayTime, maxPlayTime, minAge, designers, artists, publisher, numOfRaters, averageScore, rank, categories,scoresheets {id, player1, score1, player2, score2, player3, score3, player4, score4, player5, score5, player6, score6, player7, score7, createdOn}}}",J="getMyBoardGameCollection",z="mutation addScore($userId: Int!, $boardGameId: Int!, $sheet: ScoreSheetInput) {addScoreSheetToBoardGame(userId: $userId, boardGameId: $boardGameId, sheet: $sheet){id}}",W="mutation removeSheet($sheetId: String!) {removeScoreSheet(sheetId: $sheetId) {result}}",K="d-none",Z="d-block",X="boardGame",ee="user",te="userSearch",ne="favourites";function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ie=function(e){var t,n;function a(t){return e.call(this,t)||this}return n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,ae(t,n),a.prototype.show=function(e,t,n,a,i){var s=this;void 0===n&&(n=0),void 0===a&&(a="info"),void 0===i&&(i=3e3);var r=this.notificationManager.getContainerId(),o="";switch(a){case"info":o="bg-info";break;case"warning":o="bg-warning";break;case"message":o="bg-primary";break;case"priority":o="bg-danger";break;default:o="bg-info"}var c=document.createElement("div");c.className="notification toast",c.style.top=n+"px",c.setAttribute("role","alert"),c.setAttribute("data-autohide","false");var d=document.createElement("div");d.className="toast-header text-white "+o;var h=document.createElement("strong");h.className="mr-auto",h.textContent=e;var u=document.createElement("button");u.className="ml-2 mb-1 close",u.textContent="x",u.addEventListener("click",(function(){s.notificationManager.remove(c)}));var l=document.createElement("div");l.className="toast-body",l.textContent=t,d.appendChild(h),d.appendChild(u),c.appendChild(d),c.appendChild(l),c.classList.add("is-"+a);var m=document.getElementById(r);return m&&m.appendChild(c),$(".notification").toast("show"),i<=0&&(i=2e3),setTimeout((function(){s.notificationManager.remove(c)}),i),c},a}((function(e){this.show=this.show.bind(this),this.notificationManager=e,this.containerId=this.notificationManager.getContainerId()}));const se=new(function(){function e(){}return e.prototype.createNotification=function(e){return new ie(e)},e}()),re=function(){function e(){this.notifications=[],this.currentCount=0,this.offsetPerNotification=120,this.containerId="notifications",this.show=this.show.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getContainerId=function(){return this.containerId},t.show=function(e,t,n,a){void 0===n&&(n="info"),void 0===a&&(a=5e3);var i=se.createNotification(this).show(e,t,this.currentCount*this.offsetPerNotification,n,a);this.currentCount++,this.notifications.push(i)},t.remove=function(e){var t=this,n=this.notifications.findIndex((function(t){return t===e}));n>=0&&(this.notifications.splice(n,1),this.notifications.map((function(e,n){e.style.top=t.offsetPerNotification*n+"px"})));var a=e.parentElement;null!==a&&a.removeChild(e),this.currentCount--,this.currentCount<0&&(this.currentCount=0)},e}();var oe=o()("socket-listener"),ce=function(){function e(){}var t=e.prototype;return t.handleDataChangedByAnotherUser=function(e){oe("Handling data change "+e.type+" on object type "+e.stateName+" made by user "+e.user);var t=Ke.getInstance().getStateManager().findItemInState(N,{id:e.user},R),n="unknown";t&&(n=t.username),oe("Handling data change "+e.type+" on object type "+e.stateName+" made by user "+n);var a=e.data;oe(a);try{switch(e.type){case"create":switch(e.stateName){case N:Ke.getInstance().getStateManager().addNewItemToState(N,a,!0),re.getInstance().show(a.username,a.username+" has just registered.","message")}}}catch(e){oe(e)}},t.handleMessage=function(e){oe("Received message: "+e)},t.getCurrentUser=function(){return Ke.getInstance().getLoggedInUserId()},e}(),de=n(381),he=n.n(de);function ue(e,t){return(ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var le=o()("local-storage"),me=function(e){var t,n;function a(t){var n;return void 0===t&&(t=!1),(n=e.call(this,"browser")||this).configuration=[],n.storage=window.sessionStorage,t&&(n.storage=window.localStorage),n.forceSaves=!0,n}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,ue(t,n),a.getInstance=function(e){return void 0===e&&(e=!1),a._instance||(a._instance=new a(e)),a._instance};var i=a.prototype;return i._ensureStatePresent=function(e){null===this.storage.getItem(e)&&this._addNewNamedStateToStorage({name:e,value:[]})},i._addNewNamedStateToStorage=function(e){le("Local Storage: Saving with key "+e.name),le(e);var t=JSON.stringify(e.value);le(t),this.storage.setItem(e.name,t)},i._replaceNamedStateInStorage=function(e){this._addNewNamedStateToStorage(e)},i._getState=function(e){var t=[];le("Local Storage: Loading with key "+e);var n=this.storage.getItem(e);return le(n),null!==n&&(t=JSON.parse(n)),{name:e,value:t}},i._saveState=function(e,t){this._addNewNamedStateToStorage({name:e,value:t})},i._addItemToState=function(e,t,n){if(void 0===n&&(n=!1),n){var a=this._getState(e);le("adding item to state "+e),le(t),a.value.push(t),this._replaceNamedStateInStorage(a)}},i._removeItemFromState=function(e,t,n,a){var i=this._getState(e),s=i.value.findIndex((function(e){return n(e,t)}));s>=0&&(le("removing item from state "+e),le(t),i.value.splice(s,1)),this._replaceNamedStateInStorage(i)},i._updateItemInState=function(e,t,n,a){var i=this._getState(e),s=i.value.findIndex((function(e){return n(e,t)}));s>=0&&(i.value.splice(s,1,t),le("updating item in state "+e),le(t)),this._replaceNamedStateInStorage(i)},i.forceResetForGet=function(e){},i.getConfiguredStateNames=function(){return this.configuration},i.hasCompletedRun=function(e){return!1},i.initialise=function(e){this.configuration=e},a}(u);const ge=new(function(){function e(){}return e.prototype.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},e}());var fe;!function(e){e[e.LoggedOut=0]="LoggedOut",e[e.LoggedIn=1]="LoggedIn"}(fe||(fe={}));var ve=o()("chat-manager"),pe=function(){function e(){this.blockedList=[],this.favouriteList=[],this.loggedInUsers=[],this.currentUsername="",this.unreadListener=null,ve("Setting up chat logs, blocked list, and favourites"),this.chatLogs=[],this.chatListeners=[],this.chatUserListeners=[],this.localStorage=new me(!0),S.getInstance().addChatReceiver(this),this.receiveLogin=this.receiveLogin.bind(this),this.receiveLogout=this.receiveLogout.bind(this),this.receiveInvitation=this.receiveInvitation.bind(this),this.receiveMessage=this.receiveMessage.bind(this),this.receiveQueuedMessages=this.receiveQueuedMessages.bind(this),this.receiveQueuedInvites=this.receiveQueuedInvites.bind(this),this.receiveJoinedRoom=this.receiveJoinedRoom.bind(this),this.receivedLeftRoom=this.receivedLeftRoom.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.addChatEventHandler=function(e){this.chatListeners.push(e)},t.addChatUserEventHandler=function(e){this.chatUserListeners.push(e)},t.isUserLoggedIn=function(e){return this.loggedInUsers.findIndex((function(t){return t===e}))>=0},t.receiveUserList=function(e){this.loggedInUsers=e,this.chatUserListeners.forEach((function(t){return t.handleLoggedInUsersUpdated(e)}))},t.addUserToBlockedList=function(e){var t=this;this.blockedList.findIndex((function(t){return t===e}))<0&&(this.blockedList.push(e),this.saveBlockedList(),this.chatUserListeners.forEach((function(e){return e.handleBlockedUsersChanged(t.favouriteList)})))},t.removeUserFromBlockedList=function(e){var t=this,n=this.blockedList.findIndex((function(t){return t===e}));n>=0&&(this.blockedList.splice(n,1),this.saveBlockedList(),this.chatUserListeners.forEach((function(e){return e.handleBlockedUsersChanged(t.favouriteList)})))},t.isUserInBlockedList=function(e){return this.blockedList.findIndex((function(t){return t===e}))>=0},t.addUserToFavouriteList=function(e){var t=this;this.favouriteList.findIndex((function(t){return t===e}))<0&&(this.favouriteList.push(e),this.saveFavouriteList(),this.chatUserListeners.forEach((function(e){return e.handleFavouriteUsersChanged(t.favouriteList)})))},t.removeUserFromFavouriteList=function(e){var t=this,n=this.favouriteList.findIndex((function(t){return t===e}));n>=0&&(this.favouriteList.splice(n,1),this.saveFavouriteList(),this.chatUserListeners.forEach((function(e){return e.handleFavouriteUsersChanged(t.favouriteList)})))},t.isUserInFavouriteList=function(e){return this.favouriteList.findIndex((function(t){return t===e}))>=0},t.getFavouriteUserList=function(){return[].concat(this.favouriteList)},t.getBlockedUserList=function(){return[].concat(this.blockedList)},t.setCurrentUser=function(t){ve("Setting current user "+t),this.currentUsername=t;var n=this.localStorage.getStateByName(e.chatLogKey+this.currentUsername);ve(n),n&&(this.chatLogs=n);var a=this.localStorage.getStateByName(e.blockedListKey+this.currentUsername);ve(a),a&&(this.blockedList=a);var i=this.localStorage.getStateByName(e.favouriteListKey+this.currentUsername);ve(i),i&&(this.favouriteList=i),this.chatListeners.forEach((function(e){return e.handleChatLogsUpdated()}))},t.getCurrentUser=function(){return this.currentUsername},t.receiveJoinedRoom=function(e){if(e.type===v.ChatRoom){var t=this.ensureChatLogExists(e.room);ve("User list for room "+e.room+" - "+e.userList.join(",")),t.users=e.userList;var n=parseInt(he()().format("YYYYMMDDHHmmss")),a=he()().format("DD/MM/YYYY HH:mm"),i={from:"",created:n,room:e.room,priority:0,type:v.ChatRoom,message:e.username+" joined the chat on "+a};t.messages.push(i),this.saveLogs(),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(t,!1)}))}},t.receivedLeftRoom=function(e){if(e.type===v.ChatRoom&&e.username!==this.currentUsername){var t=this.ensureChatLogExists(e.room);ve("User list for room "+e.room+" - "+e.userList.join(",")),t.users=e.userList;var n=parseInt(he()().format("YYYYMMDDHHmmss")),a=he()().format("DD/MM/YYYY HH:mm"),i={from:"",created:n,room:e.room,priority:0,type:v.ChatRoom,message:e.username+" left the chat on "+a};t.messages.push(i),this.saveLogs(),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(t,!1)}))}},t.receiveInvitation=function(e){if(e.type===v.ChatRoom)if(this.isUserInBlockedList(e.from))ve("User "+e.from+" blocked");else{ve("Invited to chat "+e.room);var t=this.doesChatRoomExist(e.room);ve(e),ve("Letting the listeners know, if they are all happy to accept then we will join the room");var n=!0;if(t||this.chatListeners.forEach((function(t){t.handleNewInviteReceived(e)||(n=!1)})),n){var a=this.ensureChatLogExists(e.room);a.type=e.type,e.userList&&e.userList.forEach((function(t){a.users.findIndex((function(e){return e===t}))<0&&a.users.push(e.from)})),a.users.findIndex((function(t){return t===e.from}))<0&&a.users.push(e.from),this.saveLogs(),ve("Joining chat "+e.room),S.getInstance().joinChat(this.getCurrentUser(),e.room,v.ChatRoom),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(a,!1)}))}}},t.receiveLogin=function(e){var t=this;ve("Handle login received for "+e),this.loggedInUsers.findIndex((function(t){return t===e}))<0&&this.loggedInUsers.push(e),ve(this.loggedInUsers),this.chatUserListeners.forEach((function(e){return e.handleLoggedInUsersUpdated(t.loggedInUsers)})),!this.isUserInBlockedList(e)&&this.isUserInFavouriteList(e)&&(ve("User "+e+" logging in"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedIn(e)})))},t.receiveLogout=function(e){var t=this,n=this.loggedInUsers.findIndex((function(t){return t===e}));n>=0&&this.loggedInUsers.splice(n,1),this.chatUserListeners.forEach((function(e){return e.handleLoggedInUsersUpdated(t.loggedInUsers)})),!this.isUserInBlockedList(e)&&this.isUserInFavouriteList(e)&&(ve("User "+e+" logging out"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedOut(e)})))},t.receiveDecline=function(e,t,n){n===v.ChatRoom&&t!==this.currentUsername&&(this.isUserInBlockedList(t)||(ve("User "+t+" declined invitation to room"),this.chatListeners.forEach((function(n){return n.handleInvitationDeclined(e,t)}))))},t.setUnreadCountListener=function(e){this.unreadListener=e},t.touchChatLog=function(e){var t=this.ensureChatLogExists(e);t.numOfNewMessages=0,t.lastViewed=parseInt(he()().format("YYYYMMDDHHmmss")),this.emitUnreadMessageCountChanged(),this.saveLogs()},t.getChatLog=function(e){var t=null,n=this.chatLogs.findIndex((function(t){return t.roomName===e}));return n>=0&&(t=this.chatLogs[n]),t},t.receiveMessage=function(e,t){if(void 0===t&&(t=!1),e.type===v.ChatRoom&&e.from!==this.getCurrentUser())if(this.isUserInBlockedList(e.from))ve("Message received from user "+e.from+" - is in blocked list, not passed on.");else{var n=this.ensureChatLogExists(e.room);this.addSenderToRoomIfNotAlreadyPresent(n,e.from),this.addMessageToChatLog(n,e),ve("Message received"),ve(e),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(n,t)}))}},t.receiveQueuedInvites=function(e){var t=this;e.forEach((function(e){t.receiveInvitation(e)}))},t.receiveQueuedMessages=function(e){var t=this;e.forEach((function(e){t.receiveMessage(e,!0)})),this.chatListeners.forEach((function(t){return t.handleOfflineMessagesReceived(e)}))},t.joinChat=function(e){0!==this.getCurrentUser().trim().length&&(this.ensureChatLogExists(e),S.getInstance().joinChat(this.getCurrentUser(),e,v.ChatRoom))},t.leaveChat=function(e){0!==this.getCurrentUser().trim().length&&(this.removeChatLog(e),S.getInstance().leaveChat(this.getCurrentUser(),e,v.ChatRoom),this.emitUnreadMessageCountChanged())},t.login=function(){var e=this;0!==this.getCurrentUser().trim().length&&(S.getInstance().login(this.getCurrentUser()),S.getInstance().getUserList(),this.chatLogs.forEach((function(t){t.type===v.ChatRoom&&S.getInstance().joinChat(e.currentUsername,t.roomName,v.ChatRoom)})))},t.logout=function(){0!==this.getCurrentUser().trim().length&&S.getInstance().logout(this.getCurrentUser())},t.declineInvite=function(e){0!==this.getCurrentUser().trim().length&&S.getInstance().sendDeclineInvite(e,this.getCurrentUser(),v.ChatRoom)},t.sendInvite=function(e,t,n,a,i){void 0===n&&(n=v.ChatRoom),void 0===a&&(a=!1),void 0===i&&(i=""),0!==this.getCurrentUser().trim().length&&(this.isUserInBlockedList(e)||this.ensureChatLogExists(t).users.findIndex((function(t){return t===e}))<0&&S.getInstance().sendInvite(this.getCurrentUser(),e,t,n,a,i))},t.sendMessage=function(e,t,n,a){if(void 0===n&&(n=f.Normal),0===this.getCurrentUser().trim().length)return null;var i=this.ensureChatLogExists(e),s=parseInt(he()().format("YYYYMMDDHHmmss"));S.getInstance().sendMessage(this.getCurrentUser(),e,t,s,v.ChatRoom,f.Normal,{}),a||(a={});var r={from:this.getCurrentUser(),room:e,message:t,created:s,priority:n,type:v.ChatRoom,attachment:a};return this.addMessageToChatLog(i,r),r},t.getChatLogs=function(){return[].concat(this.chatLogs)},t.startChatWithUser=function(e){var t=null;if(e){ve("Starting chat with "+e);var n=this.ensureChatLogExistsWithUser(e);this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(n,!1)})),S.getInstance().sendInvite(this.getCurrentUser(),e,n.roomName,v.ChatRoom,!1,""),S.getInstance().joinChat(this.getCurrentUser(),n.roomName,v.ChatRoom),t=n.roomName}return t},t.saveLogs=function(){this.localStorage.setStateByName(e.chatLogKey+this.currentUsername,this.chatLogs,!1)},t.saveBlockedList=function(){this.localStorage.setStateByName(e.blockedListKey+this.currentUsername,this.blockedList,!1)},t.saveFavouriteList=function(){this.localStorage.setStateByName(e.favouriteListKey+this.currentUsername,this.favouriteList,!1)},t.ensureChatLogExists=function(e){var t,n=this.chatLogs.findIndex((function(t){return t.roomName===e}));return n<0?(t={roomName:e,users:[this.getCurrentUser()],messages:[],lastViewed:parseInt(he()().format("YYYYMMDDHHmmss")),numOfNewMessages:0,type:v.ChatRoom},this.chatLogs.push(t),this.saveLogs()):t=this.chatLogs[n],t},t.ensureChatLogExistsWithUser=function(e){for(var t=null,n=0;n<this.chatLogs.length;){var a=this.chatLogs[n];2===a.users.length&&a.users.findIndex((function(t){return t===e}))>=0&&(t=a,n=this.chatLogs.length),n++}return t||(t={roomName:ge.getUniqueId(),users:[this.getCurrentUser(),e],messages:[],lastViewed:parseInt(he()().format("YYYYMMDDHHmmss")),numOfNewMessages:0,type:v.ChatRoom},this.chatLogs.push(t),this.saveLogs()),t},t.doesChatRoomExist=function(e){return this.chatLogs.findIndex((function(t){return t.roomName===e}))>=0},t.emitUnreadMessageCountChanged=function(){var e,t=0;this.chatLogs.forEach((function(e){t+=e.numOfNewMessages})),null==(e=this.unreadListener)||e.countChanged(t)},t.addMessageToChatLog=function(e,t){e.numOfNewMessages++,e.messages.push(t),this.emitUnreadMessageCountChanged(),t.from===this.getCurrentUser()?this.touchChatLog(e.roomName):this.saveLogs()},t.addSenderToRoomIfNotAlreadyPresent=function(e,t){e.users.findIndex((function(e){return e===t}))<0&&e.users.push(t)},t.removeChatLog=function(e){var t=this.chatLogs.findIndex((function(t){return t.roomName===e}));if(t>=0){ve("Removing Chat log for room "+e);var n=this.chatLogs.splice(t,1);ve(n.length),this.saveLogs()}},e}();pe.chatLogKey="im-board-chat-logs",pe.blockedListKey="im-board-blocked-list",pe.favouriteListKey="im-board-favourite-list";var Se,Ie,be=o()("notification-controller"),Ce=function(){function e(){this.doNotDisturb=!1,this.chatManager=pe.getInstance(),this.doNotDisturb=!1,this.chatListeners=[],this.chatUserListeners=[],this.handleChatLogUpdated=this.handleChatLogUpdated.bind(this),this.handleLoggedInUsersUpdated=this.handleLoggedInUsersUpdated.bind(this),this.handleFavouriteUserLoggedIn=this.handleFavouriteUserLoggedIn.bind(this),this.handleFavouriteUserLoggedOut=this.handleFavouriteUserLoggedOut.bind(this),this.chatManager.addChatEventHandler(this),this.chatManager.addChatUserEventHandler(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.handleInvitationDeclined=function(e,t){this.doNotDisturb||re.getInstance().show("Room","User "+t+" has declined the invitation to join you.","info",7e3)},t.handleNewInviteReceived=function(e){return e.type===v.ScoreSheet||(this.doNotDisturb&&!e.requiresAcceptDecline||e.requiresAcceptDecline||re.getInstance().show("Chat Room","User "+e.from+" has invited you.","info",7e3),!0)},t.addListener=function(e){this.chatListeners.push(e)},t.addUserListener=function(e){this.chatUserListeners.push(e)},t.setDoNotDisturb=function(e){void 0===e&&(e=!0),this.doNotDisturb=e},t.blackListUser=function(e,t){void 0===t&&(t=!0),t?this.chatManager.addUserToBlockedList(e):this.chatManager.removeUserFromBlockedList(e)},t.favouriteUser=function(e,t){void 0===t&&(t=!0),t?this.chatManager.addUserToFavouriteList(e):this.chatManager.removeUserFromFavouriteList(e)},t.isFavouriteUser=function(e){return this.chatManager.isUserInFavouriteList(e)},t.isBlockedUser=function(e){return this.chatManager.isUserInBlockedList(e)},t.handleChatLogsUpdated=function(){this.chatListeners.forEach((function(e){return e.handleChatLogsUpdated()}))},t.handleChatLogUpdated=function(e,t){if(void 0===t&&(t=!1),be("Handle chat log updated"),be(e),this.chatListeners.forEach((function(n){return n.handleChatLogUpdated(e,t)})),!this.doNotDisturb&&!t&&e.messages.length>0){var n=e.messages[e.messages.length-1];re.getInstance().show(n.from,n.message,"message",3e3)}},t.handleLoggedInUsersUpdated=function(e){be("Handle logged in users updated"),be(e),this.chatUserListeners.forEach((function(t){return t.handleLoggedInUsersUpdated(e)}))},t.handleFavouriteUserLoggedIn=function(e){be("Handle favourite user "+e+" logged in"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedIn(e)})),this.doNotDisturb||re.getInstance().show(e,"User "+e+" has logged in.","warning",5e3)},t.handleFavouriteUserLoggedOut=function(e){be("Handle favourite user "+e+" logged out"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedOut(e)})),this.doNotDisturb||re.getInstance().show(e,"User "+e+" has logged out.","priority",4e3)},t.handleBlockedUsersChanged=function(e){be("Handle blocked users changed to "+e),this.chatUserListeners.forEach((function(t){return t.handleBlockedUsersChanged(e)}))},t.handleFavouriteUsersChanged=function(e){be("Handle favourite users changed to "+e),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUsersChanged(e)}))},t.startChatWithUser=function(e){return pe.getInstance().startChatWithUser(e)},t.handleChatStarted=function(e){this.chatListeners.forEach((function(t){return t.handleChatStarted(e)}))},t.handleOfflineMessagesReceived=function(e){this.doNotDisturb||0!==e.length&&re.getInstance().show("Offline messages received","You have received "+e.length+" messages since you last logged out.")},e}();function ye(){return(ye=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Le(e,t,n,a,i,s,r){try{var o=e[s](r),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(a,i)}!function(e){e[e.POST=0]="POST",e[e.GET=1]="GET",e[e.PUT=2]="PUT",e[e.DELETE=3]="DELETE"}(Se||(Se={})),function(e){e[e.PRIORITY=0]="PRIORITY",e[e.BACKGROUND=1]="BACKGROUND"}(Ie||(Ie={}));var we=o()("api-ts");const Ee=new(function(){function e(){}var t=e.prototype;return t.postFetchJSON=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n})},e.next=3,fetch(t,a);case 3:return i=e.sent,e.abrupt("return",i.json());case 5:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(a,i){var s=e.apply(t,n);function r(e){Le(s,a,i,r,o,"next",e)}function o(e){Le(s,a,i,r,o,"throw",e)}r(void 0)}))});return function(e,n){return t.apply(this,arguments)}}(),t.apiFetchJSONWithPost=function(e){we("Executing fetch with URL "+e.originalRequest.url+" with body "+e.originalRequest.params);try{JSON.stringify(e.originalRequest.params)}catch(t){we("Unable to convert parameters to JSON"),we(e.originalRequest.params,100),e.callback(null,404,e.queueType,e.requestId)}var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ye({},e.originalRequest.params))};this.fetchJSON(e.originalRequest.url,t,e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithGet=function(e){we("Executing GET fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id),e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,{method:"GET",headers:{"Content-Type":"application/json"}},e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithDelete=function(e){we("Executing DELETE fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id),e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,{method:"DELETE",headers:{"Content-Type":"application/json"}},e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithPut=function(e){we("Executing PUT fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id);var t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ye({},e.originalRequest.params))};e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,t,e.callback,e.queueType,e.requestId)},t.fetchJSON=function(e,t,n,a,i){fetch(e,t).then((function(e){if(we("Response code was "+e.status),e.status>=200&&e.status<=299)return e.json();400===e.status&&we(e.json())})).then((function(e){we(e),n(e,200,a,i)})).catch((function(e){we(e),n(null,500,a,i)}))},e}());function Ue(e,t,n,a,i,s,r){try{var o=e[s](r),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(a,i)}function Re(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var s=e.apply(t,n);function r(e){Ue(s,a,i,r,o,"next",e)}function o(e){Ue(s,a,i,r,o,"throw",e)}r(void 0)}))}}var ke=o()("api-ts");const Ne=function(){function e(){this.backgroundQueue=[],this.priorityQueue=[],this.inProgress=[],this.backgroundChangeListener=null,this.priorityChangeListener=null,this.callbackForQueueRequest=this.callbackForQueueRequest.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.setBackgroundChangeListener=function(e){this.backgroundChangeListener=e},t.setPriorityChangeListener=function(e){this.priorityChangeListener=e},t.getPriorityQueueCount=function(){return this.priorityQueue.length},t.getBackgroundQueueCount=function(){return this.backgroundQueue.length},t.addQLApiRequest=function(e,t,n,a,i,s){void 0===s&&(s=!1);var r={url:e,type:Se.POST,params:{query:t,variables:n},callback:a,associatedStateName:i};this.addApiRequest(r,s)},t.addQLMutationRequest=function(e,t,n,a,i,s){void 0===s&&(s=!1);var r={url:e,type:Se.POST,params:{mutation:t,variables:n},callback:a,associatedStateName:i};this.addApiRequest(r,s)},t.addApiRequest=function(e,t){void 0===t&&(t=!1);var n=ge.getUniqueId();if(ke("Download Manger: Adding Queue Request "+n),ke(e,200),t){var a={originalRequest:e,requestId:n,queueType:Ie.PRIORITY,callback:this.callbackForQueueRequest};this.priorityQueue.push(a),this.priorityChangeListener&&this.priorityChangeListener.handleEventAddToQueue()}else{var i={originalRequest:e,requestId:n,queueType:Ie.BACKGROUND,callback:this.callbackForQueueRequest};this.backgroundQueue.push(i),this.backgroundChangeListener&&this.backgroundChangeListener.handleEventAddToQueue()}this.processQueues()},t.processPriorityQueue=function(){var e=Re(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==(t=this.priorityQueue.shift())&&this.inProgress.push(t),void 0!==t&&this.initiateFetchForQueueItem(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processBackgroundQueue=function(){var e=Re(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==(t=this.backgroundQueue.shift())&&this.inProgress.push(t),void 0!==t&&this.initiateFetchForQueueItem(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processQueues=function(){var e=Re(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.priorityQueue.length+this.backgroundQueue.length;case 1:if(!(t>0)){e.next=14;break}if(ke("Download Manager: processing queue, items remaining "+t),!(this.priorityQueue.length>0)){e.next=8;break}return e.next=6,this.processPriorityQueue();case 6:e.next=11;break;case 8:if(!(this.backgroundQueue.length>0)){e.next=11;break}return e.next=11,this.processBackgroundQueue();case 11:t=this.priorityQueue.length+this.backgroundQueue.length,e.next=1;break;case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.callbackForQueueRequest=function(e,t,n,a){n===Ie.PRIORITY?this.priorityChangeListener&&this.priorityChangeListener.handleEventRemoveFromQueue():this.backgroundChangeListener&&this.backgroundChangeListener.handleEventRemoveFromQueue(),ke("Download Manager: received callback for queue "+n+" request "+a+" with status "+t);var i=this.inProgress.findIndex((function(e){return e.requestId===a}));if(i>=0){var s=this.inProgress[i];this.inProgress.splice(i,1),ke(s),ke("Download Manager: finished for queue item "+s.requestId),s.originalRequest.callback(e,t,s.originalRequest.associatedStateName)}},t.initiateFetchForQueueItem=function(e){if(ke("Download Manager: initiating fetch for queue item "+e.requestId),ke(e),null!==e.originalRequest.url&&null!=e.originalRequest.params&&null!=e.originalRequest.callback)switch(e.originalRequest.type){case Se.POST:Ee.apiFetchJSONWithPost(e);break;case Se.GET:Ee.apiFetchJSONWithGet(e);break;case Se.DELETE:Ee.apiFetchJSONWithDelete(e);break;case Se.PUT:Ee.apiFetchJSONWithPut(e)}},e}();var De=o()("state-manager-graphql"),je=function(){function e(){this.configuration=[],this.delegate=new d("graphql"),this.emitEvents(),this.bHasCompletedRun=[],this.callbackForAddItem=this.callbackForAddItem.bind(this),this.callbackForRemoveItem=this.callbackForRemoveItem.bind(this),this.callbackForUpdateItem=this.callbackForUpdateItem.bind(this),this.callbackForGetItems=this.callbackForGetItems.bind(this)}var t=e.prototype;return t.getConfiguredStateNames=function(){var e=[];return this.configuration.forEach((function(t){e.push(t.stateName)})),e},t.hasCompletedRun=function(e){var t=!1,n=this.configuration.findIndex((function(t){return t.stateName===e}));return n>=0&&(t=this.bHasCompletedRun[n]),t},t.setCompletedRun=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!0)},t.forceResetForGet=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!1)},t.initialise=function(e){this.configuration=e;var t=[];this.configuration.forEach((function(e){t.push(!1)})),this.bHasCompletedRun=t},t._addNewNamedStateToStorage=function(e){},t._getState=function(e){if(De("Getting All "+e),this.hasCompletedRun(e))De("Getting All "+e+" - not done - previously retrieved");else{var t=this.getConfigurationForStateName(e);if(t.isActive){var n=t.apis.findAll,a={url:t.apiURL,type:Se.POST,params:{query:n},callback:this.callbackForGetItems,associatedStateName:e};De("Getting All "+e+' with query "'+n+'"'),Ne.getInstance().addApiRequest(a,!0)}else De("No configuration for state "+e)}return{name:e,value:[]}},t._ensureStatePresent=function(e){},t._replaceNamedStateInStorage=function(e){},t._saveState=function(e,t){},t._addItemToState=function(e,t,n){if(void 0===n&&(n=!1),!n){De("Adding item to "+e),De(t);var a=this.getConfigurationForStateName(e);if(a.isActive){var i={};i[a.apis.create]={};var s={url:a.apiURL,type:Se.POST,params:{mutation:i},callback:this.callbackForAddItem,associatedStateName:e};Ne.getInstance().addApiRequest(s,!0)}else De("No configuration for state "+e)}},t._removeItemFromState=function(e,t,n,a){if(!a){De("Removing item to "+e),De(t);var i=this.getConfigurationForStateName(e);if(i.isActive){var s={};s[i.apis.destroy]={};var r={url:i.apiURL,type:Se.POST,params:{mutation:s},callback:this.callbackForRemoveItem,associatedStateName:e};Ne.getInstance().addApiRequest(r,!0)}else De("No configuration for state "+e)}},t._updateItemInState=function(e,t,n,a){if(!a){De("Updating item in "+e),De(t);var i=this.getConfigurationForStateName(e);if(i.isActive){var s={};s[i.apis.destroy]={};var r={url:i.apiURL,type:Se.POST,params:{mutation:s},callback:this.callbackForUpdateItem,associatedStateName:e};Ne.getInstance().addApiRequest(r,!0)}else De("No configuration for state "+e)}},t.addChangeListenerForName=function(e,t){this.delegate.addChangeListenerForName(e,t)},t.addNewItemToState=function(e,t,n){this._addItemToState(e,t,n)},t.emitEvents=function(){this.delegate.emitEvents()},t.findItemInState=function(e,t,n){throw Error("not implemented")},t.getStateByName=function(e){this._getState(e)},t.informChangeListenersForStateWithName=function(e,t,n,a){this.delegate.informChangeListenersForStateWithName(e,t,n,a)},t.isItemInState=function(e,t,n){return!0},t.removeItemFromState=function(e,t,n,a){return this._removeItemFromState(e,t,n,a),!0},t.setStateByName=function(e,t,n){},t.suppressEvents=function(){this.delegate.suppressEvents()},t.updateItemInState=function(e,t,n,a){return this._updateItemInState(e,t,n,a),!0},t.getConfigurationForStateName=function(e){var t={stateName:e,apiURL:"/graphql",apis:{findAll:"",create:"",destroy:"",update:"",find:""},data:{findAll:"",create:"",destroy:"",update:"",find:""},isActive:!1},n=this.configuration.findIndex((function(t){return t.stateName===e}));return n>=0&&(t=this.configuration[n]),t},t.callbackForRemoveItem=function(e,t,n){De("callback for remove item for state "+n+" with status "+t+" - not forwarded"),t>=200&&t<=299&&De(e)},t.callbackForUpdateItem=function(e,t,n){De("callback for update item for state "+n+" with status "+t+" - not forwarded"),t>=200&&t<=299&&De(e)},t.callbackForGetItems=function(e,t,n){if(De("callback for get items for state "+n+" with status "+t+" - FORWARDING"),t>=200&&t<=299){De(e);var i=this.getConfigurationForStateName(n).data.findAll;this.setCompletedRun(n),this.delegate.informChangeListenersForStateWithName(n,e.data[i],a.StateChanged,null)}},t.callbackForAddItem=function(e,t,n){De("callback for add item for state "+n+" with status "+t+" - FORWARDING"),t>=200&&t<=299&&(De(e),this.delegate.informChangeListenersForStateWithName(n,e,a.ItemAdded,null))},e}(),Fe=n(5338);const Te=new(function(){function e(){}var t=e.prototype;return t.scrollSmoothToId=function(e){var t=document.getElementById(e);null!==t&&t.scrollIntoView({block:"start",behavior:"smooth"})},t.scrollToBottomNow=function(e){e&&(e.scrollTop=e.scrollHeight-e.clientHeight+100)},t.scrollToBottomSmooth=function(e){e&&(e.scrollIntoView({behavior:"smooth"}),e.scrollTop=e.scrollHeight-e.clientHeight+100)},t.scrollSmoothTo=function(e){e.scrollIntoView({block:"start",behavior:"smooth"})},t.scrollTo=function(e){e.scrollIntoView({block:"start"})},t.removeAllChildren=function(e){if(e&&e.firstChild)for(;e.firstChild;){var t=e.lastChild;t&&e.removeChild(t)}},t.addRemoveClasses=function(e,t,n){void 0===n&&(n=!0),t.split(" ").forEach((function(t){t.trim().length>0&&(n?e.classList.add(t):e.classList.remove(t))}))},t.addAttributes=function(e,t){t&&t.forEach((function(t){e.setAttribute(t.name,t.value)}))},e}());var Be,Ae,Me,Oe=o()("template-manager"),xe=function(){function e(){}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getScoreSheetTemplate=function(e){return 270314===e.gameId?this.getOhanamiTemplate():333201===e.gameId?this.getSkullKingTemplate():this.getDefaultScoreSheetTemplate(e)},t.getScoreSheetStartingData=function(e){return 270314===e.gameId?this.getOhanamiStartingData():333201===e.gameId?this.getSkullKingStartingData():this.getDefaultScoreSheetStartingData(e)},t.getSaveData=function(e,t){return 270314===e.gameId?this.getOhanamiSaveData(t):333201===e.gameId?this.getSkullKingSaveData(t):this.getDefaultSaveData(t)},t.transformDataAfterUserChange=function(e,t){var n=!1;return 270314===e.gameId&&(n=!0,this.transformOhanamiData(t)),333201===e.gameId&&(n=!0,this.transformSkullKingData(t)),n},t.getOhanamiTemplate=function(){var e={colHeaders:!1,rowHeaders:!1,licenseKey:"non-commercial-and-evaluation",manualColumnResize:!1,manualRowResize:!1,selectionMode:"single",cells:function(e,t){if(0===t||1===t||8===e)return{readOnly:!0,className:"bg-readonly-heading"};if(t>1){if(1===e||2===e||4===e)return{className:"bg-ohanami-blue",forceNumeric:!0};if(3===e||5===e)return{className:"bg-ohanami-green",forceNumeric:!0};if(6===e)return{className:"bg-ohanami-grey",forceNumeric:!0};if(7===e)return{className:"bg-ohanami-pink",forceNumeric:!0}}}};return Oe(e),e},t.getSkullKingTemplate=function(){var e={colHeaders:!1,rowHeaders:!1,licenseKey:"non-commercial-and-evaluation",manualColumnResize:!1,manualRowResize:!1,selectionMode:"single",cells:function(e,t){return 0===t||1===t||21===e?{readOnly:!0,className:"bg-readonly-heading"}:t%2==0&&e%2==0?{className:"bg-readonly"}:void 0}};return Oe(e),e},t.getSkullKingStartingData=function(){return[["Round","","P 1","","P 2","","P 3","","P 4",""],["1","bid","","","","","","","",""],["","bonus","","","","","","","",""],["2","bid","","","","","","","",""],["","bonus","","","","","","","",""],["3","bid","","","","","","","",""],["","bonus","","","","","","","",""],["4","bid","","","","","","","",""],["","bonus","","","","","","","",""],["5","bid","","","","","","","",""],["","bonus","","","","","","","",""],["6","bid","","","","","","","",""],["","bonus","","","","","","","",""],["7","bid","","","","","","","",""],["","bonus","","","","","","","",""],["8","bid","","","","","","","",""],["","bonus","","","","","","","",""],["9","bid","","","","","","","",""],["","bonus","","","","","","","",""],["10","bid","","","","","","","",""],["","bonus","","","","","","","",""],["Total","","","","","","","","",""]]},t.getOhanamiStartingData=function(){return[["Round","Mult.","P 1","P 2","P 3","P 4"],["1","x3","0","0","0","0"],["2","x3","0","0","0","0"],["","x4","0","0","0","0"],["3","x3","0","0","0","0"],["","x4","0","0","0","0"],["","x7","0","0","0","0"],["","var","0","0","0","0"],["Total","","0","0","0","0"]]},t.getDefaultScoreSheetTemplate=function(e){return{colHeaders:!1,rowHeaders:!1,licenseKey:"non-commercial-and-evaluation",manualColumnResize:!1,manualRowResize:!1,selectionMode:"single",columnSummary:[{destinationRow:0,destinationColumn:0,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:1,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:2,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:3,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:4,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:5,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:6,reversedRowCoords:!0,type:"sum",forceNumeric:!0}]}},t.getDefaultScoreSheetStartingData=function(e){return[["P 1","P 2","P 3","P 4","P 5","P 6","P 7"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"]]},t.getDefaultSaveData=function(e){var t={id:e.room,jsonData:JSON.stringify(e),createdOn:he()().format("YYYYMMDDHHmmss"),players:[],scores:[]},n=e.data[0],a=e.data[e.data.length-1];return a.forEach((function(e,t){var n=parseInt(e);isNaN(n)?a[t]=0:a[t]=n})),t.players=n,t.scores=a,t},t.getOhanamiSaveData=function(e){for(var t={id:e.room,jsonData:JSON.stringify(e),createdOn:he()().format("YYYYMMDDHHmmss"),players:[],scores:[]},n=e.data[0],a=e.data[e.data.length-1],i=2;i<n.length;i++){t.players.push(n[i]);var s=parseInt(a[i]);isNaN(s)&&(s=0),t.scores.push(s)}return Oe("Save data for ohanami is"),Oe(t),t},t.getSkullKingSaveData=function(e){for(var t={id:e.room,jsonData:JSON.stringify(e),createdOn:he()().format("YYYYMMDDHHmmss"),players:[],scores:[]},n=e.data[0],a=e.data[e.data.length-1],i=3;i<n.length;i+=2){t.players.push(n[i]);var s=parseInt(a[i]);isNaN(s)&&(s=0),t.scores.push(s)}return Oe("Save data for skull king is"),Oe(t),t},t.calculateOhanamiPinkScore=function(e){var t=0;if(e>0)for(e>15&&(e=15);e>0;)t+=e,e--;return t},t.transformOhanamiData=function(e){for(var t=0;t<4;t++){var n=0,a=parseInt(e.data[1][t+2]);isNaN(a)||(n+=3*a),a=parseInt(e.data[2][t+2]),isNaN(a)||(n+=3*a),a=parseInt(e.data[4][t+2]),isNaN(a)||(n+=3*a),a=parseInt(e.data[3][t+2]),isNaN(a)||(n+=4*a),a=parseInt(e.data[5][t+2]),isNaN(a)||(n+=4*a),a=parseInt(e.data[6][t+2]),isNaN(a)||(n+=7*a),a=parseInt(e.data[7][t+2]),isNaN(a)||(n+=this.calculateOhanamiPinkScore(a)),e.data[8][t+2]=n}},t.transformSkullKingData=function(e){for(var t=2;t<10;t+=2){for(var n=0,a=1;a<=10;a++){var i=2*a-1,s=parseInt(e.data[i][t]),r=parseInt(e.data[i][t+1]),o=parseInt(e.data[i+1][t+1]);isNaN(s)||isNaN(r)||(0===s&&0===r&&(n+=10*a),s===r&&(n+=20*s),s>0&&s!==r&&(n-=10*Math.abs(s-r)),isNaN(o)||(n+=o))}e.data[21][t+1]=n}},e}(),Ge="text/plain",_e="view-extra-action";!function(e){e[e.normal=0]="normal",e[e.active=1]="active",e[e.inactive=2]="inactive",e[e.warning=3]="warning"}(Be||(Be={})),function(e){e[e.number=0]="number",e[e.string=1]="string"}(Ae||(Ae={})),function(e){e[e.top=0]="top",e[e.right=1]="right",e[e.left=2]="left",e[e.bottom=3]="bottom"}(Me||(Me={}));var Pe=o()("score-sheet-view"),He=function(){function e(){this.thisEl=null,this.boardGameTitleEl=null,this.startStopTimer=null,this.timerEl=null,this.endOrLeaveEl=null,this.scoreSheetEl=null,this.table=null,this.controller=Qe.getInstance(),this.stateManager=Ke.getInstance().getStateManager(),this.eventUserSelected=this.eventUserSelected.bind(this),this.stateManager.addChangeListenerForName(N,this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.onDocumentLoaded=function(){this.resetDisplay(),this.ssFastSearchUserNames=document.getElementById(e.ScoreSheetDom.ssFastSearchUserNames),$("#"+e.ScoreSheetDom.ssFastSearchUserNames).on("autocompleteselect",this.eventUserSelected),Qe.getInstance().getStateManager().addChangeListenerForName(B,this),this.thisEl=document.getElementById(e.ScoreSheetDom.dropZone),this.boardGameTitleEl=document.getElementById(e.ScoreSheetDom.boardGame),this.startStopTimer=document.getElementById(e.ScoreSheetDom.startStopTimer),this.timerEl=document.getElementById(e.ScoreSheetDom.timer),this.endOrLeaveEl=document.getElementById(e.ScoreSheetDom.end),this.scoreSheetEl=document.getElementById(e.ScoreSheetDom.scoreSheet),this.handleStartStopTimer=this.handleStartStopTimer.bind(this),this.handleEndOrLeave=this.handleEndOrLeave.bind(this),this.handleUserDrop=this.handleUserDrop.bind(this),this.startStopTimer&&this.startStopTimer.addEventListener("click",this.handleStartStopTimer),this.endOrLeaveEl&&this.endOrLeaveEl.addEventListener("click",this.handleEndOrLeave),this.thisEl&&(this.thisEl.addEventListener("dragover",(function(e){e.preventDefault()})),this.thisEl.addEventListener("drop",this.handleUserDrop))},t.eventUserSelected=function(e,t){e.preventDefault(),e.stopPropagation(),Pe("User "+t.item.label+" with id "+t.item.value+" selected"),e.target.innerText="",Qe.getInstance().isSheetOwner()?Qe.getInstance().inviteUser(t.item.label):alert("Only the score sheet creator can invite users.")},t.handleEndOrLeave=function(e){if(Pe("leave or end"),this.controller.hasActiveScoreSheet()&&this.controller.isSheetOwner()){if(!confirm("Are you sure you want to close the score sheet"))return;this.controller.endScoreSheet(),this.resetDisplay()}else{if(!confirm("Are you sure you want to leave the score sheet"))return;this.controller.leave(),this.resetDisplay()}},t.handleStartStopTimer=function(e){Pe("start/pause timer"),this.controller.isTimerGoing()?this.controller.pauseTimer():this.controller.startTimer()},t.handleUserDrop=function(e){if(Pe("drop event on current score sheet"),this.controller.hasActiveScoreSheet()&&this.controller.isSheetOwner()){var t=e.dataTransfer.getData(Ge),n=JSON.parse(t);Pe(n),n.draggedType===ee&&this.controller.inviteUser(n.username)}},t.resetDisplay=function(){this.table=null,this.boardGameTitleEl&&(this.boardGameTitleEl.innerText=""),this.startStopTimer&&(this.startStopTimer.innerHTML="Start "+e.ScoreSheetDom.iconStart,this.startStopTimer.setAttribute("disabled","true"),Te.addRemoveClasses(this.startStopTimer,"btn-warning",!1),Te.addRemoveClasses(this.startStopTimer,"btn-success",!0)),this.timerEl&&(this.timerEl.innerText=this.createTimerDisplay(0)),this.endOrLeaveEl&&(this.endOrLeaveEl.innerHTML=e.ScoreSheetDom.iconLeave),this.scoreSheetEl&&Te.removeAllChildren(this.scoreSheetEl)},t.updateTimer=function(t,n){void 0===n&&(n=!1),Pe("Updating timer "+t+" "+n),this.startStopTimer&&(n?(this.startStopTimer.innerHTML="Start   "+e.ScoreSheetDom.iconStart,Te.addRemoveClasses(this.startStopTimer,"btn-warning",!1),Te.addRemoveClasses(this.startStopTimer,"btn-success",!0)):(this.startStopTimer.innerHTML="Pause   "+e.ScoreSheetDom.iconInProgress,Te.addRemoveClasses(this.startStopTimer,"btn-warning",!0),Te.addRemoveClasses(this.startStopTimer,"btn-success",!1)),this.startStopTimer.removeAttribute("disabled")),this.timerEl&&(this.timerEl.innerText=this.createTimerDisplay(t))},t.stateChanged=function(t,n,a){if(n===N){var i=$("#"+e.ScoreSheetDom.ssFastSearchUserNames),s=Ke.getInstance().getLoggedInUsername(),r=[];a.forEach((function(e){var t={label:e.username,value:e.id};s!==e.username&&r.push(t)})),i.autocomplete({source:r}),i.autocomplete("option",{disabled:!1,minLength:1})}else{var o=a;if(Pe("Processing new state"),Pe(o),this.startStopTimer&&this.startStopTimer.removeAttribute("disabled"),this.boardGameTitleEl&&(this.boardGameTitleEl.innerText=""+o.boardGameName),this.table){var c=[];o.data.forEach((function(e,t){e.forEach((function(e,n){c.push([t,n,e])}))})),Pe("Table data is "),Pe(c),this.table.setDataAtCell(c,Qe.SOURCE_View)}else if(this.scoreSheetEl){var d=this.controller.getSelectedBoardGame();d&&(o.sheetLayoutOptions=xe.getInstance().getScoreSheetTemplate(d)),o.sheetLayoutOptions.data=o.data,this.table=new Fe.Z(this.scoreSheetEl,o.sheetLayoutOptions),this.table.addHook("afterChange",this.controller.userChangedValue)}this.timerEl&&(this.timerEl.innerText=this.createTimerDisplay(o.timer))}},t.getTableData=function(){return this.table?this.table.getData():[]},t.stateChangedItemAdded=function(e,t,n){this.stateChanged(e,t,this.stateManager.getStateByName(t))},t.createTimerDisplay=function(e){var t="";if(0===e)t="00:00";else if(e>=60){var n=Math.floor(e/3600),a=Math.floor(e/60),i=e-3600*n-60*a;n>0&&(t+=n+":"),t+=a>0?a<10?"0"+a+":":a+":":"00:",t+=i>0?i<10?"0"+i:""+i:"00"}else t="00:",t+=e>0?e<10?"0"+e:""+e:"00";return t},t.stateChangedItemRemoved=function(e,t,n){},t.stateChangedItemUpdated=function(e,t,n,a){},e}();He.ScoreSheetDom={dropZone:"scoreSheetZone",boardGame:"selectedBoardGame",startStopTimer:"startStopTimer",timer:"timerDisplay",end:"leaveScoreSheet",scoreSheet:"scoreSheet",iconStart:"<i class='fas fa-hourglass-start'></i>",iconInProgress:"<i class='fas fa-hourglass-half'></i>",iconEnd:"<i class='fas fa-hourglass-end'></i>",iconLeave:"<i class='fas fa-sign-out-alt'></i>",ssFastSearchUserNames:"ssFastSearchUserNames",webrtc:"webrtc"};var qe=o()("call-manager"),Ve=function(){function e(){this.peer=null,this.webrtcDiv=null,this.myVideoStream=null,this.myVideo=null,this.callUser=this.callUser.bind(this),this.currentUserList=[]}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.startPeerConnection=function(){Ke.getInstance().isLoggedIn()&&(this.peer=new Peer(Ke.getInstance().getLoggedInUsername(),{path:"/peerjs",host:"/",debug:2,secure:!0}),this.peer.on("open",(function(e){qe("My peer ID is: "+e)})))},t.initialise=function(){this.startPeerConnection(),this.webrtcDiv=document.getElementById(He.ScoreSheetDom.webrtc)},t.startScoreSheet=function(){var e=this;try{Ke.getInstance().isLoggedIn()&&navigator.mediaDevices.getUserMedia&&(qe("Starting scoresheet stream"),navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(t){qe("Scoresheet stream started - adding video element"),e.myVideoStream=t,e.addVideoStream(Ke.getInstance().getLoggedInUsername(),e.myVideoStream,!0)})))}catch(e){qe(e),qe("Non-secure context or no camera capability")}},t.reset=function(){var e=this;qe("Reset"),this.currentUserList&&this.currentUserList.length>0&&(qe("Removing previous users"),this.currentUserList.forEach((function(t){qe("Removing previous user ${user}"),e.removeUser(t)}))),this.webrtcDiv&&Te.removeAllChildren(this.webrtcDiv),this.currentUserList=[],this.peer&&(qe("Stopping video stream"),this.myVideoStream&&this.myVideoStream.getTracks().forEach((function(e){return e.stop()})),this.myVideo&&(this.myVideo.srcObject=null),this.myVideoStream=null)},t.addVideoStream=function(e,t,n){var a=this;if(void 0===n&&(n=!1),!(this.currentUserList.findIndex((function(t){return t===e}))>=0)){this.currentUserList.push(e);var i=document.createElement("div");i.setAttribute("id",e),Te.addRemoveClasses(i,"col-sm-12 col-md-4 col-lg-3");var s=document.createElement("div");Te.addRemoveClasses(s,"card");var r=document.createElement("div");Te.addRemoveClasses(r,"card-header"),r.innerHTML='<h5 class="card-title">'+e+"</h5>";var o=document.createElement("div");Te.addRemoveClasses(o,"card-body p-0 text-center");var c=document.createElement("video");if(Te.addRemoveClasses(c,"video "),s.appendChild(r),s.appendChild(o),o.appendChild(c),n){var d=document.createElement("div");Te.addRemoveClasses(d,"card-footer");var h=document.createElement("div");Te.addRemoveClasses(h,"d-flex w-100 justify-content-between mt-2");var u=document.createElement("button");u.setAttribute("type","button"),Te.addRemoveClasses(u,"btn btn-circle btn-warning"),u.innerHTML='<i class="fas fa-video-slash"></i>';var l=document.createElement("button");l.setAttribute("type","button"),Te.addRemoveClasses(l,"btn btn-circle btn-warning"),l.innerHTML='<i class="fa fa-microphone"></i>',h.appendChild(u),h.appendChild(l),d.appendChild(h),s.appendChild(d),u.addEventListener("click",(function(){if(c.paused){try{c.play()}catch(e){}Te.addRemoveClasses(u,"btn-success",!1),Te.addRemoveClasses(u,"btn-warning",!0)}else{try{c.pause()}catch(e){}Te.addRemoveClasses(u,"btn-success",!0),Te.addRemoveClasses(u,"btn-warning",!1)}})),l.addEventListener("click",(function(){c.muted?(c.muted=!1,Te.addRemoveClasses(l,"btn-success",!1),Te.addRemoveClasses(l,"btn-warning",!0)):(c.muted=!0,Te.addRemoveClasses(l,"btn-success",!0),Te.addRemoveClasses(l,"btn-warning",!1))})),this.myVideo=c}i.appendChild(s),c.srcObject=t,c.addEventListener("loadedmetadata",(function(){try{c.play()}catch(e){}a.webrtcDiv&&a.webrtcDiv.append(i)}))}},t.callUser=function(e){var t=this;if(qe("Asked to call user "+e),e!==Ke.getInstance().getLoggedInUsername()){var n=0;if(!(this.currentUserList.findIndex((function(t){return t===e}))>=0))var a=setInterval((function(){if(qe("Calling user "+e),t.myVideoStream){var i=t.peer.call(e,t.myVideoStream);i?(i.on("stream",(function(n){qe("User "+e+" answered, showing stream"),t.addVideoStream(e,n,!1)})),clearInterval(a)):++n>3&&clearInterval(a)}}),5e3)}},t.removeUser=function(e){qe("Asked to remove user "+e);var t=this.currentUserList.findIndex((function(t){return t===e}));t>=0&&this.currentUserList.splice(t,1);var n=document.getElementById(e);if(n){qe("Asked to remove user "+e+" - removing video element");var a=n.querySelector(".video");a&&(a.srcObject=null),Te.removeAllChildren(n);var i=n.parentNode;i&&i.removeChild(n)}},t.prepareToAnswerCallFrom=function(e){var t=this;try{Ke.getInstance().isLoggedIn()&&(qe("Preparing to answer call from "+e),navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(n){t.myVideoStream=n,t.addVideoStream(Ke.getInstance().getLoggedInUsername(),t.myVideoStream,!0),qe("Awaiting call from "+e),t.peer.on("call",(function(n){qe("Answering call from "+e),n.answer(t.myVideoStream),n.on("stream",(function(n){alert("Answered"),qe("Have answered, showing stream"),t.addVideoStream(e,n,!1)}))}))})))}catch(e){qe(e),qe("Insecure context or no video capability")}},e}(),Ye=o()("score-sheet-controller"),Qe=function(){function e(){this.applicationView=null,this.currentScoreRoom=null,this.currentlySelectedBoardGame=null,this.currentScoreSheet=null,this.currentUsername="",this.isRoomCreator=!1,this.currentUsersInScoreSheet=[],this.intervalTimer=-1,this.stateManager=new g,S.getInstance().addChatReceiver(this),this.receiveLogin=this.receiveLogin.bind(this),this.receiveLogout=this.receiveLogout.bind(this),this.receiveInvitation=this.receiveInvitation.bind(this),this.receiveMessage=this.receiveMessage.bind(this),this.receiveQueuedMessages=this.receiveQueuedMessages.bind(this),this.receiveQueuedInvites=this.receiveQueuedInvites.bind(this),this.receiveJoinedRoom=this.receiveJoinedRoom.bind(this),this.receivedLeftRoom=this.receivedLeftRoom.bind(this),this.userChangedValue=this.userChangedValue.bind(this),this.endScoreSheet=this.endScoreSheet.bind(this),this.pauseTimer=this.pauseTimer.bind(this),this.isSheetOwner=this.isSheetOwner.bind(this),this.inviteUser=this.inviteUser.bind(this),this.getCurrentRoom=this.getCurrentRoom.bind(this),this.getSelectedBoardGame=this.getSelectedBoardGame.bind(this),this.startTimer=this.startTimer.bind(this),this.stopTimerStoppedByAnotherUser=this.stopTimerStoppedByAnotherUser.bind(this),this.isTimerGoing=this.isTimerGoing.bind(this),this.reset=this.reset.bind(this),this.reset()}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.isTimerGoing=function(){var e=!1;return this.currentScoreSheet&&(e=this.currentScoreSheet.timerGoing),e},t.getStateManager=function(){return this.stateManager},t.getCurrentRoom=function(){return this.currentScoreRoom},t.receiveLogin=function(e){},t.receiveLogout=function(e){},t.setCurrentUser=function(e){Ye("Setting current user "+e),this.currentUsername=e},t.getCurrentUser=function(){return this.currentUsername},t.initialise=function(e){this.applicationView=e,Ve.getInstance().initialise()},t.receiveInvitation=function(e){if(this.isLoggedIn()&&e.type===v.ScoreSheet){if(!pe.getInstance().isUserInBlockedList(e.from))return this.currentScoreSheet&&(Ye("Received invite - already in score sheet - declining"),this.currentScoreSheet.room!==e.room)?(Ye("Received invite - already in score sheet - declining"),void S.getInstance().sendDeclineInvite(e.room,this.getCurrentUser(),v.ScoreSheet)):void(!e.requiresAcceptDecline||confirm("You have been invited by user "+e.from+" to joint a chat room for the board game "+e.subject+" score sheet")?(Ve.getInstance().prepareToAnswerCallFrom(e.from),re.getInstance().show("Score Sheet","Joining score sheet","info",7e3),S.getInstance().joinChat(this.getCurrentUser(),e.room,v.ScoreSheet),this.currentScoreRoom=e.room,this.currentlySelectedBoardGame=e.attachment.boardGame,this.currentScoreSheet=e.attachment.scoreSheet,Ke.getInstance().addBoardGameToDisplay(e.attachment.boardGame),this.isTimerGoing()&&(this.stopTimerStoppedByAnotherUser(),this.startTimer()),He.getInstance().stateChanged("","",this.currentScoreSheet),this.applicationView.handleShowScoreSheet(null)):S.getInstance().sendDeclineInvite(e.room,this.getCurrentUser(),v.ScoreSheet));Ye("Received invite from blocked user - ignoring")}},t.getSelectedBoardGame=function(){return this.currentlySelectedBoardGame},t.receiveQueuedMessages=function(e){var t=this;this.isLoggedIn()&&this.currentScoreRoom&&e.forEach((function(e){e.type===v.ScoreSheet&&t.currentScoreRoom===e.room&&t.receiveMessage(e)}))},t.receiveQueuedInvites=function(e){var t=this;this.isLoggedIn()&&e.forEach((function(e){e.type===v.ScoreSheet&&t.receiveInvitation(e)}))},t.receiveDecline=function(e,t,n){n===v.ScoreSheet&&(Ye("Receive decline for room "+e+" from "+t),this.currentScoreRoom&&this.currentScoreRoom===e&&re.getInstance().show("Score Sheet","User "+t+" declined the invitation.","warning"))},t.receiveJoinedRoom=function(e){e.type===v.ScoreSheet&&this.isLoggedIn()&&e.username!==this.getCurrentUser()&&this.currentScoreRoom===e.room&&(Ye("Handling user joined "+e.username),this.currentUsersInScoreSheet.findIndex((function(t){return t===e.username}))<0&&(this.currentUsersInScoreSheet.push(e.username),this.currentScoreSheet&&this.saveCurrentScoreSheet(this.currentScoreSheet)),this.isRoomCreator&&this.currentScoreSheet&&(Ye("Handling user joined "+e.username+" - sending"),this.addUserToScoreSheet(e.username),this.sendScoreSheetState(this.currentScoreSheet,!1)),re.getInstance().show(this.currentlySelectedBoardGame.name,"User "+e.username+" joined the scoresheet.","message",12e4))},t.receivedLeftRoom=function(e){if(e.type===v.ScoreSheet&&this.isLoggedIn()&&e.username!==this.getCurrentUser()&&this.currentScoreRoom===e.room){Ye("Handling user left "+e.username);var t=this.currentUsersInScoreSheet.findIndex((function(t){return t===e.username}));t>=0&&(this.currentUsersInScoreSheet.splice(t,1),this.removeUserFromScoreSheet(e.username),this.currentScoreSheet&&this.saveCurrentScoreSheet(this.currentScoreSheet)),this.isRoomCreator&&this.currentScoreSheet&&(Ye("Handling user left "+e.username+" - sending"),this.sendScoreSheetState(this.currentScoreSheet,!1)),re.getInstance().show(this.currentlySelectedBoardGame.name,"User "+e.username+" left the scoresheet.","warning",1e5)}},t.receiveUserList=function(e){},t.endScoreSheet=function(){Ye("Handling end of score sheet"),this.isRoomCreator&&this.currentScoreSheet&&this.saveScoreSheetToBoardGame(this.currentScoreSheet),this.isLoggedIn()&&(this.currentScoreRoom&&this.currentScoreSheet&&(Ye("Handling end of score sheet - sending"),this.sendScoreSheetState(this.currentScoreSheet,!0)),this.leave()),this.reset(),this.applicationView.switchBetweenCollectionAndScoreSheet(!0)},t.startScoreSheet=function(e){e&&(Ye("Starting score sheet for "+e.name),this.currentlySelectedBoardGame=e,this.isLoggedIn()&&(this.currentUsersInScoreSheet=[this.getCurrentUser()]),this.isRoomCreator=!0,this.currentScoreRoom=ge.getUniqueId(),this.currentScoreSheet={room:this.currentScoreRoom,boardGameName:e.name,sheetLayoutOptions:xe.getInstance().getScoreSheetTemplate(e),timer:0,timerGoing:!1,data:xe.getInstance().getScoreSheetStartingData(e),isFinished:!1},Ye(this.currentScoreSheet),Ve.getInstance().startScoreSheet(),this.stateManager.setStateByName(B,this.currentScoreSheet,!0),this.isLoggedIn()&&S.getInstance().joinChat(this.getCurrentUser(),this.currentScoreRoom,v.ScoreSheet))},t.hasActiveScoreSheet=function(){var e=!1;return this.currentScoreRoom&&null!==this.currentScoreRoom&&(Ye(this.currentScoreRoom),e=!0),e},t.inviteUser=function(e){this.isLoggedIn()&&this.currentScoreRoom&&this.currentlySelectedBoardGame&&(Ye("Inviting user "+e+" to score sheet"),this.isRoomCreator?(re.getInstance().show(this.currentlySelectedBoardGame.name,"You have invited user "+e+" to the scoresheet","message"),S.getInstance().sendInvite(this.getCurrentUser(),e,this.currentScoreRoom,v.ScoreSheet,!0,this.currentlySelectedBoardGame.name,{scoreSheet:this.currentScoreSheet,boardGame:this.currentlySelectedBoardGame})):alert("Only the score sheet creator can invite other users."))},t.receiveMessage=function(e){if(Ye("'Handling receive message"),Ye(e),this.isLoggedIn()&&e.type===v.ScoreSheet&&e.from!==this.getCurrentUser()&&this.currentScoreRoom&&this.currentScoreRoom===e.room){if(pe.getInstance().isUserInBlockedList(e.from))return void Ye("Received message from blocked user - ignoring");if(Ye("Received message for score sheet "+e.room),Ye(e),e.attachment){var t=e.attachment;if(Ye(t),this.currentScoreSheet){var n=this.currentScoreSheet.timerGoing;this.currentScoreSheet.room=e.room,this.currentScoreSheet.boardGameName=t.boardGameName,this.currentScoreSheet.data=t.data,this.currentScoreSheet.timer=t.timer>this.currentScoreSheet.timer?t.timer:this.currentScoreSheet.timer,this.currentScoreSheet.timerGoing=t.timerGoing,this.currentScoreSheet.sheetLayoutOptions=t.sheetLayoutOptions,this.currentScoreSheet.isFinished=t.isFinished,t.timerGoing?n||(this.stopTimerStoppedByAnotherUser(),this.startTimer()):n&&this.stopTimerStoppedByAnotherUser()}Ye("Updated score sheet"),Ye(this.currentScoreSheet),this.currentScoreSheet&&this.saveCurrentScoreSheet(this.currentScoreSheet,!0),t.isFinished&&(alert("Score sheet has been finished - closing"),this.reset(),this.leave(),He.getInstance().resetDisplay(),this.applicationView.switchBetweenCollectionAndScoreSheet(!0))}}},t.isSheetOwner=function(){return this.isRoomCreator},t.createScoreSheetFromTable=function(){var e=null,t=He.getInstance().getTableData();return this.currentScoreSheet&&this.currentScoreRoom&&(e={room:this.currentScoreRoom,data:t,boardGameName:this.currentlySelectedBoardGame.name,timer:this.currentScoreSheet.timer,sheetLayoutOptions:this.currentlySelectedBoardGame?xe.getInstance().getScoreSheetTemplate(this.currentlySelectedBoardGame):null,timerGoing:this.currentScoreSheet.timerGoing,isFinished:!1}),e},t.sendScoreSheetState=function(e,t){if(void 0===t&&(t=!1),this.currentScoreRoom&&this.isLoggedIn()){var n=parseInt(he()().format("YYYYMMDDHHmmss"));S.getInstance().sendMessage(this.getCurrentUser(),this.currentScoreRoom,"data",n,v.ScoreSheet,f.Normal,e)}},t.startTimer=function(){var e=this;Ye("Handling pause timer"),this.currentScoreSheet&&(this.currentScoreSheet.timerGoing=!0,this.intervalTimer=setInterval((function(){e.currentScoreSheet&&e.currentScoreSheet.timerGoing?(e.currentScoreSheet.timer++,He.getInstance().updateTimer(e.currentScoreSheet.timer,!e.currentScoreSheet.timerGoing)):e.currentScoreSheet&&(e.currentScoreSheet.timerGoing=!1,He.getInstance().updateTimer(e.currentScoreSheet.timer,!e.currentScoreSheet.timerGoing))}),1e3),this.currentScoreSheet&&this.saveCurrentScoreSheet(this.currentScoreSheet),this.isLoggedIn()&&this.currentScoreSheet&&(Ye("Handling pause timer - sending score sheet"),this.sendScoreSheetState(this.currentScoreSheet,!1)))},t.pauseTimer=function(){Ye("Handling pause timer"),this.intervalTimer>0&&(clearInterval(this.intervalTimer),this.intervalTimer=-1,this.currentScoreSheet&&(this.currentScoreSheet.timerGoing=!1,this.saveCurrentScoreSheet(this.currentScoreSheet),He.getInstance().updateTimer(this.currentScoreSheet.timer,!this.currentScoreSheet.timerGoing)),this.isLoggedIn()&&this.currentScoreSheet&&(Ye("Handling pause timer - updating all users"),this.sendScoreSheetState(this.currentScoreSheet,!1)))},t.userChangedValue=function(t,n){if(Ye("Handling user changed value "+n),n!==e.SOURCE_View&&"edit"===n){var a=this.createScoreSheetFromTable();if(Ye("Handling user changed Value"),Ye(t),Ye(a),a){Ye("Letting the template manager change any values");var i=xe.getInstance().transformDataAfterUserChange(this.currentlySelectedBoardGame,a);i&&Ye(a),this.saveCurrentScoreSheet(a,i),this.isLoggedIn()&&(Ye("Handling user change - updating all users"),this.sendScoreSheetState(a,!1))}}},t.leave=function(){Ye("Handling user leaving"),this.currentScoreSheet&&this.currentScoreRoom&&(this.isLoggedIn()&&S.getInstance().leaveChat(this.getCurrentUser(),this.currentScoreRoom,v.ScoreSheet),this.reset(),this.applicationView.switchBetweenCollectionAndScoreSheet(!0))},t.addUserToScoreSheet=function(e){Ke.getInstance().isLoggedIn()&&(Ye("Calling user "+e),Ve.getInstance().callUser(e))},t.removeUserFromScoreSheet=function(e){Ye("Removing user "+e),Ve.getInstance().removeUser(e)},t.reset=function(){this.currentScoreRoom=null,this.currentScoreSheet=null,this.currentlySelectedBoardGame=null,this.isRoomCreator=!1,this.currentUsersInScoreSheet=[],this.stopTimerStoppedByAnotherUser(),Ve.getInstance().reset()},t.isLoggedIn=function(){return this.getCurrentUser().trim().length>0},t.saveScoreSheetToBoardGame=function(e){if(Ye("Handling save"),this.currentlySelectedBoardGame){var t=xe.getInstance().getSaveData(this.currentlySelectedBoardGame,e);Ye(t),this.currentlySelectedBoardGame.scoresheets||(this.currentlySelectedBoardGame.scoresheets=[]),this.currentlySelectedBoardGame.scoresheets.push(t),Ke.getInstance().scoreSheetAddedToBoardGame(this.currentlySelectedBoardGame,t)}},t.saveCurrentScoreSheet=function(e,t){void 0===t&&(t=!0),this.currentScoreSheet=e,this.stateManager.setStateByName(B,this.currentScoreSheet,t)},t.stopTimerStoppedByAnotherUser=function(){Ye("Handling timer stopped by another user"),this.intervalTimer>0&&(clearInterval(this.intervalTimer),this.currentScoreSheet&&He.getInstance().updateTimer(this.currentScoreSheet.timer,!0)),this.intervalTimer=-1},e}();Qe.SOURCE_View="ssv";var Je=o()("controller-ts"),ze=o()("controller-ts-detail"),We=function(){function e(){}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.connectToApplication=function(e,t){this.applicationView=e,this.clientSideStorage=t;var n=new je;n.initialise([{stateName:N,apiURL:this.getServerAPIURL()+O,apis:{find:"",create:"",destroy:"",update:"",findAll:_},data:{find:"",create:"",destroy:"",update:"",findAll:P},isActive:!0}]);var a=U.getInstance(),i=g.getInstance(),s=new y(a,n);return a.addStateManager(i,[],!1),a.addStateManager(s,[F,D,j],!1),this.stateManager=a,this.stateChanged=this.stateChanged.bind(this),this.stateChangedItemAdded=this.stateChangedItemAdded.bind(this),this.stateChangedItemRemoved=this.stateChangedItemRemoved.bind(this),this.stateChangedItemUpdated=this.stateChangedItemUpdated.bind(this),this.callbackBoardGameDetails=this.callbackBoardGameDetails.bind(this),this.callbackAddToCollection=this.callbackAddToCollection.bind(this),this.callbackRemoveFromCollection=this.callbackRemoveFromCollection.bind(this),this.callbackGetCollection=this.callbackGetCollection.bind(this),this.addBoardGameToCollection=this.addBoardGameToCollection.bind(this),this.removeBoardGameFromCollection=this.removeBoardGameFromCollection.bind(this),this.removeBoardGameFromDisplay=this.removeBoardGameFromDisplay.bind(this),this.displayedBoardGamesStateManager=new me(!0),this},t.initialise=function(){Je("Initialising data state");var e=new ce;if(S.getInstance().setListener(e),Je("Setting up chat system for user "+this.getLoggedInUserId()+": "+this.getLoggedInUsername()),this.getLoggedInUserId()>0){var t=pe.getInstance();Ce.getInstance(),t.setCurrentUser(this.getLoggedInUsername()),Qe.getInstance().setCurrentUser(this.getLoggedInUsername()),t.setUnreadCountListener(this.applicationView),t.login(),this.getStateManager().getStateByName(N)}var n=this.displayedBoardGamesStateManager.getStateByName(D);n=this.cleanupBoardGameState(n),this.applicationView.setState({boardGames:n}),this.downloadAndSyncSavedBoardGameCollection()},t.getStateManager=function(){return this.stateManager},t.isLoggedIn=function(){var e=!1;try{loggedInUserId&&(e=!0)}catch(e){}return e},t.getLoggedInUserId=function(){var e=-1;try{loggedInUserId&&(e=loggedInUserId)}catch(e){}return ze("Logged in user id is "+e),e},t.getLoggedInUsername=function(){var e="";try{loggedInUsername&&(e=loggedInUsername)}catch(e){}return ze("Logged in user is "+e),e},t.handleMessage=function(e){Je(e)},t.getCurrentUser=function(){return this.getLoggedInUserId()},t.stateChangedItemAdded=function(e,t,n){},t.stateChangedItemRemoved=function(e,t,n){},t.stateChangedItemUpdated=function(e,t,n,a){},t.stateChanged=function(e,t,n){},t.addBoardGameToDisplay=function(e){Je("Handling addition of board game"),Je(e);var t=this.applicationView.state.boardGames;t.findIndex((function(t){return t.gameId===e.gameId}))>=0?Je("Board game in display already"):(e.decorator=w.Incomplete,t.push(e),Je("Adding received board game to application"),Je(e),this.displayedBoardGamesStateManager.setStateByName(D,t,!1),this.applicationView.setState({boardGames:t}),Ne.getInstance().addQLApiRequest(O,x,{gameId:e.gameId},this.callbackBoardGameDetails,D,!1))},t.callbackBoardGameDetails=function(e,t,n){if(Je("callback for bgg search for single board game "+n+" with status "+t),t>=200&&t<=299){Je(e);var a=e.data[G];Je(a);var i=/&#10;/g;a.description=a.description.replace(i,"\r\n"),i=/&ldquo;/g,a.description=a.description.replace(i,'"'),i=/&rdquo;/g,a.description=a.description.replace(i,'"'),i=/&quot;/g,a.description=a.description.replace(i,'"'),i=/&mdash;/g,a.description=a.description.replace(i,'"');var s=this.applicationView.state.boardGames,r=s.findIndex((function(e){return e.gameId===a.gameId}));r>=0?(Je("Updating application state"),s.splice(r,1,a),Je(s),a.decorator=w.PersistedLocally,this.displayedBoardGamesStateManager.setStateByName(D,s,!1),this.applicationView.setState({boardGames:s})):Je("Board game "+a.id+" not found in current state")}},t.callbackAddToCollection=function(e,t,n){var a=this;if(Je("callback for add single board game "+n+" to my collection with status "+t),t>=200&&t<=299){Je(e);var i=e.data[q];Je(i);var s=this.applicationView.state.boardGames,r=s.findIndex((function(e){return e.gameId===i.gameId}));if(r>=0){var o=s[r];if(Je("Updating board game "+o.gameId+" with database id "+i.id+" and new Persisted state"),o.decorator=w.Persisted,o.id=i.id,o.scoresheets){var c=function(e,t,n){};o.scoresheets.forEach((function(e){a.convertScoreSheetToApiCallFormat(e),Ne.getInstance().addQLApiRequest(O,z,{userId:a.getCurrentUser(),boardGameId:o.id,sheet:e},c,B,!1),a.convertScoreSheetToDatabaseFormat(e),e.decorator=w.Persisted}))}this.applicationView.setState({boardGames:s}),this.displayedBoardGamesStateManager.updateItemInState(D,o,k,!1)}}},t.callbackRemoveFromCollection=function(e,t,n){if(Je("callback for remove single board game "+n+" from my collection with status "+t),t>=200&&t<=299){Je(e);var a=e.data[Y];Je(a)}},t.callbackGetCollection=function(e,t,n){var a=this;if(Je("callback for getting my collection of board games "+n+" to my collection with status "+t),t>=200&&t<=299){Je(e);var i=e.data[J],s=this.applicationView.state.boardGames;ze("Starting with local state of "+s.length),i.forEach((function(e){e.decorator=w.Persisted,ze("Loading board game from collection "),ze(e),a.decorateScoreSheets(e);var t=s.findIndex((function(t){return t.gameId===e.gameId}));if(ze("have found the board game locally? "+(t>=0)),t>=0){var n=s[t];ze("in current state, replacing"),a.copyLocallySavedScoreSheetsToBoardGame(e,n),s.splice(t,1,e)}else ze("not in current state, adding"),s.push(e)})),s=this.cleanupBoardGameState(s),ze("Ending with local state of "+s.length),this.applicationView.setState({boardGames:s}),this.displayedBoardGamesStateManager.setStateByName(D,s,!1)}},t.scoreSheetAddedToBoardGame=function(e,t){this.isLoggedIn()&&e.decorator&&e.decorator===w.Persisted?(Ne.getInstance().addQLApiRequest(O,z,{userId:this.getCurrentUser(),boardGameId:e.id,sheet:t},(function(e,t,n){}),B,!1),t.decorator=w.Persisted):t.decorator=w.PersistedLocally,this.convertScoreSheetToDatabaseFormat(t);var n=this.applicationView.state.boardGames,a=n.findIndex((function(t){return t.gameId===e.gameId}));if(a>=0){var i=n[a];e.decorator=i.decorator,Je("Updating application state"),n.splice(a,1,e),Je(n),this.displayedBoardGamesStateManager.setStateByName(D,n,!1),this.applicationView.setState({boardGames:n})}else Je("Board game "+e.id+" not found in current state")},t.scoreSheetRemovedFromBoardGame=function(e,t){this.isLoggedIn()&&e.decorator&&e.decorator===w.Persisted&&Ne.getInstance().addQLApiRequest(O,W,{sheetId:t},(function(e,t,n){}),B,!1);var n=this.applicationView.state.boardGames,a=n.findIndex((function(t){return t.gameId===e.gameId}));if(a>=0){var i=n[a];e.decorator=i.decorator,Je("Updating application state"),n.splice(a,1,e),Je(n),this.displayedBoardGamesStateManager.setStateByName(D,n,!1),this.applicationView.setState({boardGames:n})}else Je("Board game "+e.id+" not found in current state")},t.addBoardGameToCollection=function(e){Je("Handling Add Board Game to collection");var t=this.findBoardGameInStateFromEvent(e);if(t&&t.decorator)switch(t.decorator){case w.Persisted:case w.Incomplete:break;case w.PersistedLocally:case w.Complete:if(this.displayedBoardGamesStateManager.addNewItemToState(D,t,!0),delete t.decorator,delete t.id,this.isLoggedIn()){var n=t.scoresheets;delete t.scoresheets,Ne.getInstance().addQLApiRequest(O,H,{userId:this.getCurrentUser(),boardGame:t},this.callbackAddToCollection,D,!0),t.decorator=w.Complete,t.scoresheets=n}else t.decorator=w.PersistedLocally}},t.removeBoardGameFromCollection=function(e){if(Je("Handling Remove Board Game from collection with id "+e.gameId),e&&e.decorator)switch(e.decorator){case w.PersistedLocally:case w.Persisted:this.removeBoardGameFromState(e),this.isLoggedIn()&&Ne.getInstance().addQLApiRequest(O,V,{userId:this.getCurrentUser(),boardGameId:e.gameId},this.callbackRemoveFromCollection,D,!1);break;case w.Incomplete:case w.Complete:}},t.removeBoardGameFromDisplay=function(e){if(Je("Handling Remove Board Game from display "+e.gameId),e&&e.decorator)switch(e.decorator){case w.Incomplete:break;case w.Persisted:case w.PersistedLocally:case w.Complete:this.removeBoardGameFromState(e)}},t.cleanupBoardGameState=function(e){var t=[];return e.forEach((function(e){var n=t.findIndex((function(t){return t.gameId===e.gameId}));if(n>=0){var a=t[n];a.decorator&&a.decorator===w.Persisted||e.decorator&&e.decorator===w.Persisted&&t.splice(n,1,e)}else t.push(e)})),t},t.downloadAndSyncSavedBoardGameCollection=function(){this.isLoggedIn()&&Ne.getInstance().addQLApiRequest(O,Q,{userId:this.getLoggedInUserId()},this.callbackGetCollection,D,!1)},t.getServerAPIURL=function(){var e="";return window.ENV&&window.ENV.serverURL&&(e=window.ENV.serverURL),e},t.removeBoardGameFromState=function(e){var t=this.applicationView.state.boardGames,n=t.findIndex((function(t){return t.gameId===e.gameId}));n>=0&&(t.splice(n,1),this.applicationView.setState({boardGames:t})),this.displayedBoardGamesStateManager.setStateByName(D,t,!1)},t.findBoardGameInStateFromEvent=function(t){var n=null;ze("Finding board game id in event");var a=t.target.getAttribute(e.eventDataKeyId);if(ze(a),a){a=parseInt(a);var i=this.applicationView.state.boardGames,s=i.findIndex((function(e){return e.gameId===a}));ze(s),s>=0&&(n=i[s])}return ze(n),n},t.decorateScoreSheets=function(e){e&&(e.scoresheets?e.scoresheets.forEach((function(e){e.decorator=w.Persisted})):e.scoresheets=[])},t.copyLocallySavedScoreSheetsToBoardGame=function(e,t){var n=this;if(t.scoresheets){var a=[];if(t.scoresheets.forEach((function(t){e.scoresheets.findIndex((function(e){return e.id===t.id}))<0&&(t.decorator=w.PersistedLocally,e.scoresheets.push(t),a.push(t))})),a.length>0){var i=function(e,t,n){};a.forEach((function(t){n.convertScoreSheetToApiCallFormat(t),Ne.getInstance().addQLApiRequest(O,z,{userId:n.getCurrentUser(),boardGameId:e.id,sheet:t},i,n.config.stateNames.scoreSheet,!1),n.convertScoreSheetToDatabaseFormat(t),t.decorator=w.Persisted}))}}},t.convertScoreSheetToDatabaseFormat=function(e){e.players&&(e.players.length>=1&&(e.player1=e.players[0],e.score1=e.scores[0]),e.players.length>=2&&(e.player2=e.players[1],e.score2=e.scores[1]),e.players.length>=3&&(e.player3=e.players[2],e.score3=e.scores[2]),e.players.length>=4&&(e.player4=e.players[3],e.score4=e.scores[3]),e.players.length>=5&&(e.player5=e.players[4],e.score5=e.scores[4]),e.players.length>=6&&(e.player6=e.players[5],e.score6=e.scores[5]),e.players.length>=7&&(e.player7=e.players[6],e.score7=e.scores[6]))},t.convertScoreSheetToApiCallFormat=function(e){delete e.decorator,delete e.player1,delete e.score1,delete e.player2,delete e.score2,delete e.player3,delete e.score3,delete e.player4,delete e.score4,delete e.player5,delete e.score5,delete e.player6,delete e.score6,delete e.player7,delete e.score7},t.handleShowChat=function(e){this.applicationView.handleShowChat(e)},e}();We.eventDataKeyId="board-game-id";const Ke=We,$e=function(){function e(){this.suppressEventEmits=!1,this.viewListeners=[]}var t=e.prototype;return t.addListener=function(e){this.viewListeners.push(e)},t.suppressEvents=function(){this.suppressEventEmits=!0},t.emitEvents=function(){this.suppressEventEmits=!1},t.itemDeleted=function(e,t){this.suppressEventEmits||this.viewListeners.forEach((function(n){return n.itemDeleted(e,t)}))},t.itemDragStarted=function(e,t){this.suppressEventEmits||this.viewListeners.forEach((function(n){return n.itemDragStarted(e,t)}))},t.itemSelected=function(e,t){this.suppressEventEmits||this.viewListeners.forEach((function(n){return n.itemSelected(e,t)}))},t.documentLoaded=function(e){this.suppressEventEmits||this.viewListeners.forEach((function(t){return t.documentLoaded(e)}))},t.itemAction=function(e,t,n){this.suppressEventEmits||this.viewListeners.forEach((function(a){return a.itemAction(e,t,n)}))},t.canDeleteItem=function(e,t){var n=!0;return this.suppressEventEmits||this.viewListeners.forEach((function(a){a.canDeleteItem(e,t)||(n=!1)})),n},t.hideRequested=function(e){this.suppressEventEmits||this.viewListeners.forEach((function(t){return t.hideRequested(e)}))},t.showRequested=function(e){this.suppressEventEmits||this.viewListeners.forEach((function(t){return t.showRequested(e)}))},t.itemDropped=function(e,t){this.suppressEventEmits||this.viewListeners.forEach((function(n){return n.itemDropped(e,t)}))},t.itemDeselected=function(e,t){this.suppressEventEmits||this.viewListeners.forEach((function(n){return n.itemDeselected(e,t)}))},e}();var Ze=o()("view-ts"),Xe=o()("view-ts-detail"),et=function(){function e(e,t,n){this.containerEl=null,this.uiConfig=e,this.stateManager=t,this.stateName=n,this.eventForwarder=new $e,this.stateChanged=this.stateChanged.bind(this),this.eventStartDrag=this.eventStartDrag.bind(this),this.eventClickItem=this.eventClickItem.bind(this),this.eventDeleteClickItem=this.eventDeleteClickItem.bind(this),this.eventActionClicked=this.eventActionClicked.bind(this),this.handleDrop=this.handleDrop.bind(this),this.stateManager.addChangeListenerForName(this.stateName,this)}var t=e.prototype;return t.addEventListener=function(e){this.eventForwarder.addListener(e)},t.onDocumentLoaded=function(){this.eventForwarder.documentLoaded(this)},t.stateChanged=function(e,t,n){this.updateView(t,n)},t.stateChangedItemAdded=function(e,t,n){this.stateManager&&this.stateName&&this.updateView(t,this.stateManager.getStateByName(t))},t.stateChangedItemRemoved=function(e,t,n){this.stateManager&&this.stateName&&this.updateView(t,this.stateManager.getStateByName(t))},t.stateChangedItemUpdated=function(e,t,n,a){this.stateManager&&this.stateName&&this.updateView(t,this.stateManager.getStateByName(t))},t.eventClickItem=function(t){t.preventDefault(),t.stopPropagation();var n=t.target.getAttribute(this.uiConfig.keyId),a=t.target.getAttribute(e.DATA_SOURCE);this.uiConfig.keyType===Ae.number&&(n=parseInt(n)),Xe("view "+this.getName()+": Item with id "+n+" clicked from "+a);var i={};i[this.uiConfig.keyId]=n,Xe(i);var s=this.stateManager.findItemInState(this.stateName,i,this.compareStateItemsForEquality);console.log(s),s&&this.eventForwarder.itemSelected(this,s)},t.eventDeleteClickItem=function(t){t.preventDefault(),t.stopPropagation();var n=t.target.getAttribute(this.uiConfig.keyId),a=t.target.getAttribute(e.DATA_SOURCE);this.uiConfig.keyType===Ae.number&&(n=parseInt(n)),Xe("view "+this.getName()+": Item with id "+n+" attempting delete from "+a);var i={};i[this.uiConfig.keyId]=n,Xe(i);var s=this.stateManager.findItemInState(this.stateName,i,this.compareStateItemsForEquality);if(s){var r=this.eventForwarder.canDeleteItem(this,s);Xe("view "+this.getName()+": Item with id "+n+" attempting delete from "+a+" - "+r),r&&(Xe(s),this.eventForwarder.itemDeleted(this,s))}},t.eventActionClicked=function(t){t.preventDefault(),t.stopPropagation();var n=t.target.getAttribute(this.uiConfig.keyId),a=t.target.getAttribute(e.DATA_SOURCE),i=t.target.getAttribute(_e);this.uiConfig.keyType===Ae.number&&(n=parseInt(n)),Xe("view "+this.getName()+": Item with id "+n+" attempting delete from "+a);var s={};s[this.uiConfig.keyId]=n,Xe(s);var r=this.stateManager.findItemInState(this.stateName,s,this.compareStateItemsForEquality);r&&this.eventForwarder.itemAction(this,i,r)},t.getDragData=function(t){var n=t.target.getAttribute(this.uiConfig.keyId),a=t.target.getAttribute(e.DATA_SOURCE);this.uiConfig.keyType===Ae.number&&(n=parseInt(n)),Xe("view "+this.getName()+": Item with id "+n+" getting drag data from "+a);var i={};i[this.uiConfig.keyId]=n;var s,r,o={};return(o=this.stateManager.findItemInState(this.stateName,i,this.compareStateItemsForEquality))&&(o.draggedType=null==(s=this.uiConfig.detail.drag)?void 0:s.type,o.draggedFrom=null==(r=this.uiConfig.detail.drag)?void 0:r.from),o},t.compareStateItemsForEquality=function(e,t){return R(e,t)},t.getModifierForStateItem=function(e,t){return Be.normal},t.getSecondaryModifierForStateItem=function(e,t){return Be.normal},t.getBadgeValue=function(e,t){return 0},t.getBackgroundImage=function(e,t){return""},t.updateView=function(e,t){this.createResultsForState(e,t)},t.eventStartDrag=function(e){Ze("view "+this.getName()+": drag start"),Xe(e.target);var t=JSON.stringify(this.getDragData(e));Xe(t),e.dataTransfer.setData(Ge,t)},t.createResultForItem=function(t,n){var a=this;Ze("view "+this.getName()+": creating Result"),Ze(n);var i=this.getIdForStateItem(t,n),s=document.createElement(this.uiConfig.resultsElementType);Te.addRemoveClasses(s,this.uiConfig.resultsClasses),Te.addAttributes(s,this.uiConfig.resultsElementAttributes),s.setAttribute(this.uiConfig.keyId,i),s.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId);var r=s;if(this.uiConfig.detail.containerClasses){var o=document.createElement("div");if(Te.addRemoveClasses(o,this.uiConfig.detail.containerClasses),o.setAttribute(this.uiConfig.keyId,i),o.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),r=document.createElement(this.uiConfig.detail.textElementType),Te.addRemoveClasses(r,this.uiConfig.detail.textElementClasses),r.setAttribute(this.uiConfig.keyId,i),r.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),o.appendChild(r),this.uiConfig.detail.background){var c=document.createElement(this.uiConfig.detail.background.elementType);Te.addRemoveClasses(c,this.uiConfig.detail.background.elementClasses),c.setAttribute("src",this.getBackgroundImage(t,n)),s.appendChild(c)}var d=document.createElement("div");if(o.appendChild(d),this.uiConfig.detail.badge){var h=this.getBadgeValue(t,n);if(h>0){var u=document.createElement(this.uiConfig.detail.badge.elementType);Te.addRemoveClasses(u,this.uiConfig.detail.badge.elementClasses),Te.addAttributes(u,this.uiConfig.detail.badge.elementAttributes),u.setAttribute(this.uiConfig.keyId,i),u.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),d.appendChild(u),u.innerHTML="&nbsp;&nbsp;&nbsp;"+h+"&nbsp;&nbsp;&nbsp;"}}if(this.uiConfig.extraActions&&this.uiConfig.extraActions.forEach((function(t){var n=document.createElement("button");if(n.setAttribute("type","button"),Te.addRemoveClasses(n,t.buttonClasses),t.buttonText&&(n.innerHTML=t.buttonText),t.iconClasses){var s=document.createElement("i");Te.addRemoveClasses(s,t.iconClasses),s.setAttribute(a.uiConfig.keyId,i),s.setAttribute(e.DATA_SOURCE,a.uiConfig.dataSourceId),s.setAttribute(_e,t.name),n.appendChild(s)}n.setAttribute(a.uiConfig.keyId,i),n.setAttribute(e.DATA_SOURCE,a.uiConfig.dataSourceId),n.setAttribute(_e,t.name),n.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),a.eventActionClicked(e)})),d.appendChild(n)})),this.uiConfig.detail.delete){var l=document.createElement("button");if(l.setAttribute("type","button"),Te.addRemoveClasses(l,this.uiConfig.detail.delete.buttonClasses),this.uiConfig.detail.delete.buttonText&&(l.innerHTML=this.uiConfig.detail.delete.buttonText),this.uiConfig.detail.delete.iconClasses){var m=document.createElement("i");Te.addRemoveClasses(m,this.uiConfig.detail.delete.iconClasses),m.setAttribute(this.uiConfig.keyId,i),m.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),l.appendChild(m)}l.setAttribute(this.uiConfig.keyId,i),l.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),l.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),a.eventDeleteClickItem(e)})),d.appendChild(l)}s.appendChild(o),this.uiConfig.detail.drag&&(s.setAttribute("draggable","true"),s.addEventListener("dragstart",this.eventStartDrag)),this.uiConfig.detail.select&&s.addEventListener("click",this.eventClickItem)}r.setAttribute(this.uiConfig.keyId,i),r.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId);var g=this.getDisplayValueForStateItem(t,n);if(r.innerHTML=g,this.uiConfig.modifiers){var f=this.getModifierForStateItem(t,n),v=this.getSecondaryModifierForStateItem(t,n);switch(f){case Be.normal:if(Ze("view "+this.getName()+": normal item"),Te.addRemoveClasses(s,this.uiConfig.modifiers.normal),this.uiConfig.icons&&this.uiConfig.icons.normal){var p=document.createElement("i");Te.addRemoveClasses(p,this.uiConfig.icons.normal),p.setAttribute(this.uiConfig.keyId,i),p.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),r.appendChild(p)}switch(v){case Be.warning:if(Te.addRemoveClasses(s,this.uiConfig.modifiers.normal,!1),Te.addRemoveClasses(s,this.uiConfig.modifiers.warning,!0),this.uiConfig.icons&&this.uiConfig.icons.warning){var S=document.createElement("i");Te.addRemoveClasses(S,this.uiConfig.icons.warning),S.setAttribute(this.uiConfig.keyId,i),S.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),r.appendChild(S)}break;case Be.active:if(this.uiConfig.icons&&this.uiConfig.icons.active){var I=document.createElement("i");Te.addRemoveClasses(I,this.uiConfig.icons.active),I.setAttribute(this.uiConfig.keyId,i),I.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),r.appendChild(I)}}break;case Be.active:if(Ze("view "+this.getName()+": active item"),Te.addRemoveClasses(s,this.uiConfig.modifiers.active),this.uiConfig.icons&&this.uiConfig.icons.active){var b=document.createElement("i");Te.addRemoveClasses(b,this.uiConfig.icons.active),b.setAttribute(this.uiConfig.keyId,i),b.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),r.appendChild(b)}switch(v){case Be.warning:if(Te.addRemoveClasses(s,this.uiConfig.modifiers.active,!1),Te.addRemoveClasses(s,this.uiConfig.modifiers.warning,!0),this.uiConfig.icons&&this.uiConfig.icons.warning){var C=document.createElement("i");Te.addRemoveClasses(C,this.uiConfig.icons.warning),C.setAttribute(this.uiConfig.keyId,i),C.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),r.appendChild(C)}}break;case Be.inactive:if(Ze("view "+this.getName()+": inactive item"),Te.addRemoveClasses(s,this.uiConfig.modifiers.inactive),this.uiConfig.icons&&this.uiConfig.icons.inactive){var y=document.createElement("i");Te.addRemoveClasses(y,this.uiConfig.icons.inactive),y.setAttribute(this.uiConfig.keyId,i),y.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),r.appendChild(y)}switch(v){case Be.warning:if(this.uiConfig.icons&&this.uiConfig.icons.warning){Te.addRemoveClasses(s,this.uiConfig.modifiers.inactive,!1),Te.addRemoveClasses(s,this.uiConfig.modifiers.warning,!0);var L=document.createElement("i");Te.addRemoveClasses(L,this.uiConfig.icons.warning),L.setAttribute(this.uiConfig.keyId,i),L.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),r.appendChild(L)}break;case Be.active:if(this.uiConfig.icons&&this.uiConfig.icons.active){var w=document.createElement("i");Te.addRemoveClasses(w,this.uiConfig.icons.active),w.setAttribute(this.uiConfig.keyId,i),w.setAttribute(e.DATA_SOURCE,this.uiConfig.dataSourceId),r.appendChild(w)}}}}return s},t.createResultsForState=function(e,t){var n=this;Ze("view "+this.getName()+": creating Results",10),Ze(t);var a=document.getElementById(this.uiConfig.resultsContainerId);a&&Te.removeAllChildren(a),t.map((function(t,i){var s=n.createResultForItem(e,t);Ze("view "+n.getName()+":  Adding child "+n.getIdForStateItem(e,t)),a&&a.appendChild(s)}))},t.setContainedBy=function(e){this.containerEl=e,this.uiConfig.detail.drop&&(Xe("view "+this.getName()+": Adding dragover events to "+this.uiConfig.dataSourceId),Xe(e),e.addEventListener("dragover",(function(e){e.preventDefault()})),e.addEventListener("drop",this.handleDrop))},t.handleDrop=function(e){Ze("view "+this.getName()+": drop event"),Xe(e.target);var t=e.dataTransfer.getData(Ge),n=JSON.parse(t);Xe(n);var a=n.draggedType,i=n.draggedFrom;if(Ze("view "+this.getName()+": drop event from "+i+" with type "+a),this.uiConfig.detail.drop){var s=this.uiConfig.detail.drop.acceptTypes.findIndex((function(e){return e===a}))>=0,r=!0;s&&(this.uiConfig.detail.drop.acceptFrom&&(r=this.uiConfig.detail.drop.acceptFrom.findIndex((function(e){return e===i}))>=0),Xe("view "+this.getName()+": accepted type? "+s+" and from? "+r),s&&r&&this.eventForwarder.itemDropped(this,n))}},t.getName=function(){return this.uiConfig.dataSourceId},t.hidden=function(){},e}();function tt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nt(e,t){return(nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}et.DATA_SOURCE="data-source";var at=o()("user-search"),it=o()("user-search-detail"),st=function(e){var t,n;function a(t){var n;return(n=e.call(this,a.DOMConfig,t,N)||this).loggedInUsers=[],n.updateView=n.updateView.bind(tt(n)),n.eventUserSelected=n.eventUserSelected.bind(tt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(tt(n)),n.handleFavouriteUserLoggedIn=n.handleFavouriteUserLoggedIn.bind(tt(n)),n.handleFavouriteUserLoggedOut=n.handleFavouriteUserLoggedOut.bind(tt(n)),n.handleFavouriteUsersChanged=n.handleFavouriteUsersChanged.bind(tt(n)),n.handleBlockedUsersChanged=n.handleBlockedUsersChanged.bind(tt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(tt(n)),n.itemDeleted=n.itemDeleted.bind(tt(n)),n.localisedSM=new me(!0),n.localisedSM.addChangeListenerForName(F,tt(n)),Ce.getInstance().addUserListener(tt(n)),at(n.localisedSM.getStateByName(F)),n}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,nt(t,n);var i=a.prototype;return i.handleLoggedInUsersUpdated=function(e){at("Received new list of users who are logged in "),at(e),this.loggedInUsers=e,this.updateView(F,{})},i.handleFavouriteUserLoggedIn=function(e){at("Handle Favourite User "+e+" logged in"),this.updateView(F,{})},i.handleFavouriteUserLoggedOut=function(e){at("Handle Favourite User "+e+" logged in"),this.updateView(F,{})},i.handleFavouriteUsersChanged=function(e){at("Handle Favourite Users changed to "+e),this.updateView(F,{})},i.handleBlockedUsersChanged=function(e){at("Handle Blocked Users changed to "+e),this.updateView(F,{})},i.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),$("#"+a.fastSearchInputId).on("autocompleteselect",this.eventUserSelected),this.addEventListener(this)},i.getIdForStateItem=function(e,t){return t.id},i.getDisplayValueForStateItem=function(e,t){return t.username},i.getModifierForStateItem=function(e,t){var n=Be.normal;return it("Checking for item modifiers"),it(t),pe.getInstance().isUserLoggedIn(t.username)||(n=Be.inactive),n},i.getSecondaryModifierForStateItem=function(e,t){var n=Be.normal;return it("Checking for item secondary modifiers "+t.username),Ce.getInstance().isFavouriteUser(t.username)&&(it("is favourite"),n=Be.active),Ce.getInstance().isBlockedUser(t.username)&&(it("is blocked"),n=Be.warning),n},i.eventUserSelected=function(e,t){if(e.preventDefault(),e.stopPropagation(),at("User "+t.item.label+" with id "+t.item.value+" selected"),e.target.innerText="",!this.localisedSM.isItemInState(F,{id:t.item.value},R)){var n=this.localisedSM.getStateByName(F);if(at("saved searches too long? recentUserSearches"),n.length>=a.dataLimit){at("saved searches too long - removing first");var i=n.shift();this.localisedSM.removeItemFromState(F,i,R,!0)}this.localisedSM.addNewItemToState(F,{id:t.item.value,username:t.item.label},!0)}},i.updateView=function(e,t){if(e===F&&(at("Updating for recent searches"),t=this.localisedSM.getStateByName(F),at(t),this.createResultsForState(e,t)),e===N){var n=Ke.getInstance().getLoggedInUsername(),i=$("#"+a.fastSearchInputId),s=[];t.forEach((function(e){var t={label:e.username,value:e.id};n!==e.username&&s.push(t)})),i.autocomplete({source:s}),i.autocomplete("option",{disabled:!1,minLength:1})}},i.itemAction=function(e,t,n){if(t===this.uiConfig.extraActions[0].name){if(pe.getInstance().isUserInFavouriteList(n.username))return void at(n.username+" already in fav list, ignoring");pe.getInstance().addUserToFavouriteList(n.username)}if(t===this.uiConfig.extraActions[1].name){if(pe.getInstance().isUserInBlockedList(n.username))return void at(n.username+" already in blocked list, ignoring");pe.getInstance().addUserToBlockedList(n.username)}},i.canDeleteItem=function(e,t){return!0},i.itemDeleted=function(e,t){it(t),at("Recent search user "+t.username+" with id "+t.id+" deleted - removing"),this.localisedSM.removeItemFromState(F,t,R,!0)},i.itemSelected=function(e,t){var n=Ce.getInstance().startChatWithUser(t.username);Ke.getInstance().handleShowChat(n)},i.documentLoaded=function(e){},i.hideRequested=function(e){},i.itemDragStarted=function(e,t){},i.itemDropped=function(e,t){},i.showRequested=function(e){},i.itemDeselected=function(e,t){},a}(et);st.fastSearchInputId="fastSearchUserNames",st.dataLimit=10,st.DOMConfig={resultsContainerId:"recentUserSearches",resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"id",keyType:Ae.number,dataSourceId:"userSearch",modifiers:{normal:"list-group-item-primary",inactive:"list-group-item-light",active:"list-group-item-info",warning:"list-group-item-danger"},icons:{normal:"fas fa-comment",inactive:"fas fa-comment",active:"fas fa-heart",warning:"fas fa-exclamation-circle"},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-sm",iconClasses:"fas fa-trash-alt"},drag:{type:ee,from:te}},extraActions:[{name:"favourite",buttonClasses:"btn bg-info text-white btn-circle btn-sm mr-1",iconClasses:"fas fa-user-plus"},{name:"block",buttonClasses:"btn bg-warning text-white btn-circle btn-sm mr-1",iconClasses:"fas fa-user-slash"}]};const rt=st;function ot(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ct(e,t){return(ct=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var dt=o()("chat-sidebar"),ht=function(e){var t,n;function a(){var t;return(t=e.call(this,a.DOMConfig,new g,A)||this).selectedChatLog=null,t.handleChatLogsUpdated=t.handleChatLogsUpdated.bind(ot(t)),t.handleChatLogUpdated=t.handleChatLogUpdated.bind(ot(t)),t.handleChatStarted=t.handleChatStarted.bind(ot(t)),Ce.getInstance().addListener(ot(t)),t}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,ct(t,n);var i=a.prototype;return i.compareStateItemsForEquality=function(e,t){return function(e,t){return e.roomName===t.roomName}(e,t)},i.updateStateManager=function(){dt("Updating state with chat manager");var e=pe.getInstance().getChatLogs();dt(e),this.stateManager.setStateByName(A,e,!0)},i.handleNewInviteReceived=function(e){return!0},i.handleChatLogUpdated=function(e){dt("Handling chat log updates"),this.updateStateManager()},i.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.addEventListener(this),this.updateStateManager()},i.getIdForStateItem=function(e,t){return t.roomName},i.getDisplayValueForStateItem=function(e,t){return t.users.join(",")},i.getModifierForStateItem=function(e,t){var n=Be.inactive;return this.selectedChatLog&&this.selectedChatLog.roomName===t.roomName&&(n=Be.active),n},i.getSecondaryModifierForStateItem=function(e,t){return this.getModifierForStateItem(e,t)},i.selectChatRoom=function(e){var t=pe.getInstance().getChatLog(e);this.selectedChatLog=t,this.eventForwarder.itemSelected(this,this.selectedChatLog),this.updateStateManager()},i.handleChatLogsUpdated=function(){this.selectedChatLog&&pe.getInstance().touchChatLog(this.selectedChatLog.roomName),this.updateStateManager()},i.handleChatStarted=function(e){this.selectedChatLog=e,this.eventForwarder.itemSelected(this,this.selectedChatLog),this.updateStateManager()},i.getBadgeValue=function(e,t){return t.numOfNewMessages},i.canDeleteItem=function(e,t){return!0},i.itemDeleted=function(e,t){dt("Deleting chat "+t.roomName),pe.getInstance().leaveChat(t.roomName),this.selectedChatLog&&this.selectedChatLog.roomName===t.roomName&&(this.eventForwarder.itemDeselected(this,this.selectedChatLog),this.selectedChatLog=null),this.updateStateManager()},i.hideRequested=function(e){this.selectedChatLog&&(this.eventForwarder.itemDeselected(this,this.selectedChatLog),this.selectedChatLog=null)},i.hidden=function(){this.hideRequested(this)},i.documentLoaded=function(e){},i.itemAction=function(e,t,n){},i.itemDragStarted=function(e,t){},i.itemDropped=function(e,t){},i.itemSelected=function(e,t){this.selectedChatLog=t,this.updateStateManager()},i.itemDeselected=function(e,t){this.selectedChatLog=null,this.updateStateManager()},i.showRequested=function(e){},i.handleOfflineMessagesReceived=function(e){},i.handleInvitationDeclined=function(e,t){},a}(et);ht.DOMConfig={resultsContainerId:"chatLogs",resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"roomName",keyType:Ae.string,dataSourceId:"chatLogs",modifiers:{normal:"",inactive:"list-group-item-dark",active:"list-group-item-primary",warning:""},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-sm",iconClasses:"text-black fas fa-sign-out-alt"},badge:{elementType:"span",elementClasses:"badge badge-pill badge-primary mr-1"}}};const ut=ht;var lt=o()("view-ts:boardgameview");function mt(e){var t=e.boardGame,n=e.showScoresHandler,a=e.addToCollectionHandler,s=e.removeFromCollectionHandler,r=e.startScoreSheetHandler;if(t){lt("Board Game "+t.gameId);var o=i.createElement("div",null,i.createElement("button",{type:"button",className:"btn-primary btn-sm rounded p-1 mt-1 w-100","board-game-id":t.gameId,onClick:a},"Add to ",Ke.getInstance().isLoggedIn()?"":"Browser"," Collection ",i.createElement("i",{className:"fas fa-star"}),""),i.createElement("button",{type:"button",className:"btn-primary btn-sm rounded p-1 mt-1 w-100","board-game-id":t.gameId,onClick:s},"Remove from Display",i.createElement("i",{className:"fas fa-trash-alt"}))),c=i.createElement("button",{type:"button",className:"btn-warning btn-sm rounded p-1 mt-1 w-100","board-game-id":t.gameId,onClick:s},"Remove from ",Ke.getInstance().isLoggedIn()?"":"Browser"," Collection ",i.createElement("i",{className:"far fa-star"}),""),d=i.createElement("button",{type:"button",className:"btn-secondary btn-sm rounded p-1 mr-2 mt-2 w-100","board-game-id":t.gameId,onClick:r},"Start Score Sheet ",i.createElement("i",{className:"fas fa-list-alt"}),""),h=0;t.scoresheets&&(h=t.scoresheets.length);var u=i.createElement("i",{className:"fas fa-star text-black"}),l=i.createElement("span",{"board-game-id":t.gameId,className:"badge badge-pill badge-info ml-1",onClick:n},"Scores: ",h);if(t.decorator&&t.decorator!==w.Incomplete){var m="https://boardgamegeek.com/boardgame/"+t.gameId;return i.createElement("div",{className:"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2"},i.createElement("div",{className:"card"},i.createElement("a",{href:m,target:"_blank"},i.createElement("img",{className:"card-img-top",src:t.image,alt:"Card image cap"})),i.createElement("div",{className:"card-body scroll"},i.createElement("h5",{className:"card-title"},t.name," (",t.year,") ",t.decorator===w.Persisted||t.decorator===w.PersistedLocally?u:""," ",t.decorator===w.Persisted||t.decorator===w.PersistedLocally?l:"",i.createElement("br",null)," ",Ke.getInstance().isLoggedIn()?t.decorator===w.Persisted?c:o:c),i.createElement("p",{className:"card-text"},t.description),i.createElement("p",{className:"card-text"},i.createElement("small",{className:"text-muted"},"Play Time: ",t.minPlayTime," - ",t.maxPlayTime," min",i.createElement("br",null),"Players: ",t.minPlayers," - ",t.maxPlayers," Min Age:",t.minAge,i.createElement("br",null),"Categories: ",t.categories))),i.createElement("div",{className:"card-footer text-right text-muted"},"Rank: ",t.rank," Score: ",t.averageScore," from ",t.numOfRaters," raters",i.createElement("br",null),d)))}return i.createElement("div",{className:"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2"},i.createElement("div",{className:"card"},i.createElement("img",{className:"card-img-top",src:"/img/spinner.gif",alt:"Card image cap"}),i.createElement("div",{className:"card-body"},i.createElement("h5",{className:"card-title"},t.name," (",t.year,") "),i.createElement("p",{className:"card-text"},"Loading..."),i.createElement("p",{className:"card-text"},i.createElement("small",{className:"text-muted"},"Loading..."))),i.createElement("div",{className:"card-footer text-right text-muted"},"Loading...")))}return i.createElement("div",{className:"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2"},i.createElement("div",{className:"card"}))}function gt(e,t){return(gt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ft=o()("score-sheet-sidebar"),vt=o()("score-sheet-sidebar:detail"),pt=function(e){var t,n;function a(){var t;return(t=e.call(this,a.SCORESHEETS_ViewConfig,new g,j)||this).selectedBoardGame=null,t}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,gt(t,n);var i=a.prototype;return i.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.addEventListener(this),this.stateManager.setStateByName(j,[],!0)},i.setSelectedBoardGame=function(e){ft("setting selected board game to"),vt(e),e&&(this.selectedBoardGame=e,this.stateManager.setStateByName(j,this.selectedBoardGame.scoresheets,!0))},i.getDisplayValueForStateItem=function(e,t){var n="";return n+='<h5 class="card-title">'+this.selectedBoardGame.name+" ("+this.selectedBoardGame.year+")</h5>",n+='<p class="card-text">Played On: '+he()(t.createdOn,"YYYYMMDDHHmmss").format("ddd, DD/MM/YYYY HH:mm")+"</p>",n+='<p class="card-text">Scores: ',t.player1&&t.score1>0&&(n+=t.player1+":"+t.score1+" "),t.player2&&t.score2>0&&(n+=t.player2+":"+t.score2+" "),t.player3&&t.score3>0&&(n+=t.player3+":"+t.score3+" "),t.player4&&t.score4>0&&(n+=t.player4+":"+t.score4+" "),t.player5&&t.score5>0&&(n+=t.player5+":"+t.score5+" "),t.player6&&t.score6>0&&(n+=t.player6+":"+t.score6+" "),t.player7&&t.score7>0&&(n+=t.player7+":"+t.score7+" "),n+"</p>"},i.getBackgroundImage=function(e,t){return"./img/scorecard-vertical.jpg"},i.getIdForStateItem=function(e,t){return t.id},i.documentLoaded=function(e){},i.hideRequested=function(e){},i.itemAction=function(e,t,n){},i.canDeleteItem=function(e,t){var n=!0;return this.selectedBoardGame&&(confirm("Are you sure you want to delete this Score Sheet?")||(n=!1)),n},i.itemDeleted=function(e,t){if(ft("Handling delete "+t),this.selectedBoardGame.scoresheets){var n=this.selectedBoardGame.scoresheets.findIndex((function(e){return e.id===t.id}));n>=0&&(this.selectedBoardGame.scoresheets.splice(n,1),this.stateManager.setStateByName(j,this.selectedBoardGame.scoresheets,!0),Ke.getInstance().scoreSheetRemovedFromBoardGame(this.selectedBoardGame,t.id))}},i.itemDragStarted=function(e,t){},i.itemDropped=function(e,t){},i.itemSelected=function(e,t){},i.itemDeselected=function(e,t){},i.showRequested=function(e){},a}(et);pt.SCORESHEETS_ViewConfig={resultsContainerId:"scoreSheets",resultsElementType:"div",resultsClasses:"text-white bg-info col-sm-6 col-md-3 col-lg-2 score-card",keyId:"id",keyType:Ae.string,dataSourceId:"scoreSheets",detail:{containerClasses:"card-img-overlay",textElementType:"div",textElementClasses:"ml-2",select:!0,delete:{buttonClasses:"btn btn-rounded btn-warning ml-6 mt-4",buttonText:"Delete&nbsp;",iconClasses:"fas fa-trash-alt"},background:{elementType:"img",elementClasses:"score-card-img"}}};const St=pt;var It=o()("sidebar-container");const bt=function(){function e(e){this.prefs=e,this.views=[],this.eventHide=this.eventHide.bind(this),this.eventShow=this.eventShow.bind(this)}var t=e.prototype;return t.addView=function(e,t){It("Adding view to container, with containing div of "+t.containerId);var n=document.getElementById(t.containerId);n&&(It("Adding view to container, with containing div of "+t.containerId+" - FOUND"),e.setContainedBy(n)),this.views.push(e),e.addEventListener(this)},t.onDocumentLoaded=function(){this.eventHide(null);var e=document.getElementById(this.prefs.id);if(null!==e){var t=e.querySelector(".close");t&&t.addEventListener("click",this.eventHide),this.views.forEach((function(e){e.onDocumentLoaded()}))}},t.eventHide=function(e){e&&e.preventDefault(),this.showHide("0%"),this.views.forEach((function(e){e.hidden()}))},t.eventShow=function(e){var t=this.prefs.expandedSize;window.innerWidth<769&&(t="50%"),window.innerWidth<415&&(t="100%"),this.showHide(t)},t.showHide=function(e){var t=document.getElementById(this.prefs.id);if(null!==t)switch(this.prefs.location){case Me.left:case Me.right:t.style.width=e;break;case Me.bottom:case Me.top:t.style.height=e}},t.documentLoaded=function(e){},t.itemAction=function(e,t,n){},t.canDeleteItem=function(e,t){return!0},t.itemDeleted=function(e,t){},t.itemDragStarted=function(e,t){},t.itemSelected=function(e,t){},t.itemDeselected=function(e,t){},t.itemDropped=function(e,t){},t.showRequested=function(e){this.eventShow(null)},t.hideRequested=function(e){this.eventHide(null)},e}();function Ct(e,t){return(Ct=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yt=function(e){var t,n;function a(){return e.call(this,a.SidebarPrefs)||this}return n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ct(t,n),a}(bt);yt.SidebarPrefs={id:"userSearchSideBar",expandedSize:"35%",location:Me.left},yt.SidebarContainers={recentSearches:"userSearchZone",favourites:"favouriteUsersDropZone",blocked:"blockedUsersDropZone"};const Lt=yt;function wt(e,t){return(wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Et=function(e){var t,n;function a(){return e.call(this,a.SidebarPrefs)||this}return n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,wt(t,n),a}(bt);Et.SidebarPrefs={id:"chatSideBar",expandedSize:"35%",location:Me.right},Et.SidebarContainers={chatLogs:"chatLogs",chatLog:"chatLogRoom"};const Ut=Et;function Rt(e,t){return(Rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var kt=function(e){var t,n;function a(){return e.call(this,a.SidebarPrefs)||this}return n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,Rt(t,n),a}(bt);kt.SidebarPrefs={id:"scoreSheetSidebar",expandedSize:"40%",location:Me.bottom},kt.scoreSheets="scoreSheets";const Nt=kt;var Dt=o()("chat-sidebar:detail"),jt=function(){function e(e){this.stateManager=e,this.selectedChatLog=null,this.handleAddMessage=this.handleAddMessage.bind(this),this.handleChatLogsUpdated=this.handleChatLogsUpdated.bind(this),this.handleChatLogUpdated=this.handleChatLogUpdated.bind(this),this.handleChatStarted=this.handleChatStarted.bind(this),this.handleUserDrop=this.handleUserDrop.bind(this),this.leaveChat=this.leaveChat.bind(this),this.eventUserSelected=this.eventUserSelected.bind(this),Ce.getInstance().addListener(this),e.addChangeListenerForName(N,this)}var t=e.prototype;return t.setContainedBy=function(e){},t.addEventListener=function(e){},t.getIdForStateItem=function(e,t){throw new Error("Method not implemented.")},t.getDisplayValueForStateItem=function(e,t){throw new Error("Method not implemented.")},t.compareStateItemsForEquality=function(e,t){throw new Error("Method not implemented.")},t.getModifierForStateItem=function(e,t){throw new Error("Method not implemented.")},t.getSecondaryModifierForStateItem=function(e,t){throw new Error("Method not implemented.")},t.getBadgeValue=function(e,t){throw new Error("Method not implemented.")},t.getBackgroundImage=function(e,t){throw new Error("Method not implemented.")},t.updateView=function(e,t){throw new Error("Method not implemented.")},t.itemDeselected=function(e,t){Dt("Chat Log with id "+t.roomName+" deselected"),this.selectedChatLog&&t.roomName===this.selectedChatLog.roomName&&(this.selectedChatLog=null,this.checkCanComment(),this.clearChatLog())},t.itemSelected=function(e,t){this.selectedChatLog=t,this.selectedChatLog&&(Dt("Chat Log with id "+t.roomName+" selected"),this.checkCanComment(),this.renderChatLog(this.selectedChatLog))},t.canDeleteItem=function(e,t){return!0},t.itemDeleted=function(e,t){Dt("Chat Log with "+t.roomName+" deleting"),this.selectedChatLog&&this.selectedChatLog.roomName===t.roomName&&(this.checkCanComment(),this.renderChatLog(this.selectedChatLog))},t.hideRequested=function(e){this.selectedChatLog=null,this.checkCanComment(),this.clearChatLog()},t.handleUserDrop=function(e){if(Dt("drop event on current chat room"),this.selectedChatLog){var t=e.dataTransfer.getData(Ge),n=JSON.parse(t);Dt(n),n.draggedType===ee&&(pe.getInstance().sendInvite(n.username,this.selectedChatLog.roomName),re.getInstance().show("Chat","Invited "+n.username+" to the chat."))}},t.handleChatLogUpdated=function(e){Dt("Handling chat log updates"),this.checkCanComment(),this.renderChatLog(e)},t.handleAddMessage=function(e){if(e.preventDefault(),e.stopPropagation(),Dt("Handling message event"),this.selectedChatLog){if(this.commentEl&&0===this.commentEl.value.trim().length)return;var t=this.commentEl.value.trim();this.commentEl.value="";var n=pe.getInstance().sendMessage(this.selectedChatLog.roomName,t,f.Normal,{});if(n){var a=this.addChatMessage(n);Te.scrollSmoothTo(a)}}},t.onDocumentLoaded=function(){var t=this;this.chatLogDiv=document.getElementById(e.chatLogId),this.commentEl=document.getElementById(e.commentId),this.chatForm=document.getElementById(e.newFormId),this.sendMessageButton=document.getElementById(e.submitCommentId),this.leaveChatButton=document.getElementById(e.leaveChatId),this.chatRoomDiv=document.getElementById(e.chatLogRoomId),this.fastUserSearch=document.getElementById(e.chatFastSearchUserNames),this.chatRoomDiv.addEventListener("dragover",(function(e){Dt("Dragged over"),t.selectedChatLog&&e.preventDefault()})),this.chatRoomDiv.addEventListener("drop",this.handleUserDrop),this.chatForm.addEventListener("submit",this.handleAddMessage),this.leaveChatButton.addEventListener("click",this.leaveChat),this.checkCanComment(),$("#"+e.chatFastSearchUserNames).on("autocompleteselect",this.eventUserSelected)},t.eventUserSelected=function(e,t){e.preventDefault(),e.stopPropagation(),Dt("User "+t.item.label+" with id "+t.item.value+" selected"),e.target.innerText="",this.selectedChatLog&&pe.getInstance().sendInvite(t.item.label,this.selectedChatLog.roomName),re.getInstance().show("Chat","Invited "+t.item.label+" to the chat.")},t.addChatMessage=function(e){var t=document.createElement("div");if(Te.addRemoveClasses(t,"message"),0===e.from.trim().length){var n=document.createElement("div");Te.addRemoveClasses(n,"message-sender"),n.innerText=e.message,t.appendChild(n)}else{if(e.from===pe.getInstance().getCurrentUser())Te.addRemoveClasses(t,"my-message");else{var a=document.createElement("div");Te.addRemoveClasses(a,"message-sender"),a.innerText=e.from+"   "+he()(e.created,"YYYYMMDDHHmmss").format("DD/MM/YYYY "),t.appendChild(a)}var i=document.createElement("div");e.from===pe.getInstance().getCurrentUser()?Te.addRemoveClasses(i,"my-message-content"):Te.addRemoveClasses(i,"message-content"),i.innerText=e.message,t.appendChild(i)}return this.chatLogDiv.appendChild(t),t},t.reRenderChatMessages=function(e){var t=this;Te.removeAllChildren(this.chatLogDiv);var n=null;e.messages.forEach((function(e){n=t.addChatMessage(e)})),n&&Te.scrollTo(n)},t.renderChatLog=function(e){Dt("Chat Log "+e.roomName+" rendering"),this.selectedChatLog&&this.selectedChatLog.roomName===e.roomName&&(this.selectedChatLog=e,pe.getInstance().touchChatLog(e.roomName),this.reRenderChatMessages(e))},t.handleChatLogsUpdated=function(){this.selectedChatLog&&(pe.getInstance().touchChatLog(this.selectedChatLog.roomName),this.reRenderChatMessages(this.selectedChatLog)),this.checkCanComment()},t.handleChatStarted=function(e){this.selectedChatLog=e,this.renderChatLog(e)},t.leaveChat=function(e){e.preventDefault(),e.stopPropagation(),this.selectedChatLog&&(pe.getInstance().leaveChat(this.selectedChatLog.roomName),this.selectedChatLog=null,this.clearChatLog(),this.checkCanComment())},t.checkCanComment=function(){this.selectedChatLog?(this.commentEl&&this.commentEl.removeAttribute("readonly"),this.commentEl&&this.commentEl.removeAttribute("disabled"),this.sendMessageButton&&this.sendMessageButton.removeAttribute("disabled"),this.leaveChatButton&&this.leaveChatButton.removeAttribute("disabled"),this.fastUserSearch&&this.fastUserSearch.removeAttribute("disabled")):(this.commentEl&&this.commentEl.setAttribute("readonly","true"),this.commentEl&&this.commentEl.setAttribute("disabled","true"),this.sendMessageButton&&this.sendMessageButton.setAttribute("disabled","true"),this.leaveChatButton&&this.leaveChatButton.setAttribute("disabled","true"),this.fastUserSearch&&this.fastUserSearch.setAttribute("disabled","true"))},t.clearChatLog=function(){Te.removeAllChildren(this.chatLogDiv)},t.stateChanged=function(t,n,a){if(n===N){var i=$("#"+e.ssFastSearchUserNames),s=Ke.getInstance().getLoggedInUsername(),r=[];a.forEach((function(e){var t={label:e.username,value:e.id};s!==e.username&&r.push(t)})),i.autocomplete({source:r}),i.autocomplete("option",{disabled:!1,minLength:1})}},t.stateChangedItemAdded=function(e,t,n){this.stateChanged(e,t,this.stateManager.getStateByName(t))},t.stateChangedItemRemoved=function(e,t,n){},t.stateChangedItemUpdated=function(e,t,n,a){},t.handleOfflineMessagesReceived=function(e){},t.handleInvitationDeclined=function(e,t){},t.handleNewInviteReceived=function(e){return!0},t.itemDragStarted=function(e,t){},t.itemAction=function(e,t,n){},t.documentLoaded=function(e){},t.showRequested=function(e){},t.itemDropped=function(e,t){},t.getName=function(){return"chatLog"},t.hidden=function(){this.hideRequested(this)},e}();jt.newFormId="newMessage",jt.commentId="message",jt.submitCommentId="submitMessage",jt.chatLogId="chatLog",jt.chatLogRoomId="chatLogRoom",jt.leaveChatId="leaveChat",jt.chatFastSearchUserNames="chatFastSearchUserNames";const Ft=jt;function Tt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bt(e,t){return(Bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var At=o()("user-search-sidebar"),Mt=o()("user-search-sidebar:detail"),Ot=function(e){var t,n;function a(t){var n;return(n=e.call(this,a.DOMConfig,t,N)||this).updateView=n.updateView.bind(Tt(n)),n.eventClickItem=n.eventClickItem.bind(Tt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(Tt(n)),n.handleFavouriteUserLoggedIn=n.handleFavouriteUserLoggedIn.bind(Tt(n)),n.handleFavouriteUserLoggedOut=n.handleFavouriteUserLoggedOut.bind(Tt(n)),n.handleFavouriteUsersChanged=n.handleFavouriteUsersChanged.bind(Tt(n)),n.handleBlockedUsersChanged=n.handleBlockedUsersChanged.bind(Tt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(Tt(n)),Ce.getInstance().addUserListener(Tt(n)),n}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,Bt(t,n);var i=a.prototype;return i.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.addEventListener(this)},i.handleLoggedInUsersUpdated=function(e){At("Received new list of users who are logged in "),this.updateView("",{})},i.handleFavouriteUserLoggedIn=function(e){At("Handle Favourite User "+e+" logged in"),this.updateView("",{})},i.handleFavouriteUserLoggedOut=function(e){At("Handle Favourite User "+e+" logged in"),this.updateView("",{})},i.handleFavouriteUsersChanged=function(e){At("Handle Favourite Users changed to "+e),this.updateView("",{})},i.getIdForStateItem=function(e,t){return t.id},i.getDisplayValueForStateItem=function(e,t){return t.username},i.getModifierForStateItem=function(e,t){var n=Be.normal;return pe.getInstance().isUserLoggedIn(t.username)||(n=Be.inactive),n},i.getSecondaryModifierForStateItem=function(e,t){var n=Be.normal;return Mt("Checking for item secondary modifiers "+t.username),Ce.getInstance().isFavouriteUser(t.username)&&(Mt("is favourite"),n=Be.active),Ce.getInstance().isBlockedUser(t.username)&&(Mt("is blocked"),n=Be.warning),n},i.updateView=function(t,n){var a,i=[],s=null==(a=this.stateManager)?void 0:a.getStateByName(N);s&&s.forEach((function(e){pe.getInstance().isUserInFavouriteList(e.username)&&i.push(e)})),e.prototype.updateView.call(this,t,i)},i.documentLoaded=function(e){},i.handleBlockedUsersChanged=function(e){this.updateView("",{})},i.hideRequested=function(e){},i.itemAction=function(e,t,n){if(t===this.uiConfig.extraActions[0].name){if(pe.getInstance().isUserInBlockedList(n.username))return void At(n.username+" already in fav list, ignoring");pe.getInstance().addUserToBlockedList(n.username)}},i.canDeleteItem=function(e,t){return!0},i.itemDeleted=function(e,t){At("Favourite user "+t.username+" with id "+t.id+" deleted - removing"),pe.getInstance().removeUserFromFavouriteList(t.username)},i.itemDragStarted=function(e,t){},i.itemDeselected=function(e,t){},i.itemDropped=function(e,t){At("Handling item dropped "+t.username),pe.getInstance().isUserInFavouriteList(t.username)?At(t.username+" already in fav list, ignoring"):pe.getInstance().addUserToFavouriteList(t.username)},i.itemSelected=function(e,t){var n=Ce.getInstance().startChatWithUser(t.username);Ke.getInstance().handleShowChat(n)},i.showRequested=function(e){},a}(et);Ot.DOMConfig={resultsContainerId:"favouriteUsers",resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"id",keyType:Ae.number,dataSourceId:"favouriteUsers",modifiers:{normal:"list-group-item-primary",inactive:"list-group-item-light",active:"list-group-item-info",warning:"list-group-item-danger"},icons:{normal:"fas fa-comment",inactive:"fas fa-comment",active:"fas fa-heart",warning:"fas fa-exclamation-circle"},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-sm",iconClasses:"fas fa-trash-alt"},drop:{acceptFrom:[te],acceptTypes:[ee]},drag:{type:ee,from:ne}},extraActions:[{name:"block",buttonClasses:"btn bg-warning text-white btn-circle btn-sm mr-1",iconClasses:"fas fa-user-slash"}]};const xt=Ot;function Gt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _t(e,t){return(_t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pt=o()("user-search-sidebar"),Ht=function(e){var t,n;function a(t){var n;return(n=e.call(this,a.DOMConfig,t,N)||this).updateView=n.updateView.bind(Gt(n)),n.eventClickItem=n.eventClickItem.bind(Gt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(Gt(n)),n.handleFavouriteUserLoggedIn=n.handleFavouriteUserLoggedIn.bind(Gt(n)),n.handleFavouriteUserLoggedOut=n.handleFavouriteUserLoggedOut.bind(Gt(n)),n.handleFavouriteUsersChanged=n.handleFavouriteUsersChanged.bind(Gt(n)),n.handleBlockedUsersChanged=n.handleBlockedUsersChanged.bind(Gt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(Gt(n)),Ce.getInstance().addUserListener(Gt(n)),n}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,_t(t,n);var i=a.prototype;return i.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.addEventListener(this)},i.canDeleteItem=function(e,t){return!0},i.documentLoaded=function(e){},i.itemDeleted=function(e,t){Pt("Blocked user "+t.username+" with id "+t.id+" deleted - removing"),pe.getInstance().removeUserFromBlockedList(t.username)},i.itemSelected=function(e,t){throw new Error("Method not implemented.")},i.itemDragStarted=function(e,t){throw new Error("Method not implemented.")},i.itemAction=function(e,t,n){throw new Error("Method not implemented.")},i.hideRequested=function(e){throw new Error("Method not implemented.")},i.showRequested=function(e){throw new Error("Method not implemented.")},i.handleLoggedInUsersUpdated=function(e){},i.handleFavouriteUserLoggedIn=function(e){},i.handleFavouriteUserLoggedOut=function(e){},i.handleFavouriteUsersChanged=function(e){},i.handleBlockedUsersChanged=function(e){Pt("Handle Blocked Users changed to "+e),this.updateView("",{})},i.getDisplayValueForStateItem=function(e,t){return t.username},i.getSecondaryModifierForStateItem=function(e,t){return Be.warning},i.getIdForStateItem=function(e,t){return t.id},i.updateView=function(t,n){var a,i=[],s=null==(a=this.stateManager)?void 0:a.getStateByName(N);s&&s.forEach((function(e){pe.getInstance().isUserInBlockedList(e.username)&&i.push(e)})),e.prototype.updateView.call(this,t,i)},i.itemDropped=function(e,t){pe.getInstance().isUserInBlockedList(t.username)?Pt(t.username+" already in blocked list, ignoring"):pe.getInstance().addUserToBlockedList(t.username)},i.itemDeselected=function(e,t){},a}(et);Ht.DOMConfig={resultsContainerId:"blockedUsers",resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"id",keyType:Ae.number,dataSourceId:"blockedUsers",modifiers:{normal:"list-group-item-primary",inactive:"list-group-item-light",active:"list-group-item-info",warning:"list-group-item-danger"},icons:{normal:"fas fa-comment",inactive:"fas fa-comment",active:"fas fa-heart",warning:"fas fa-exclamation-circle"},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-sm",iconClasses:"fas fa-trash-alt"},drop:{acceptFrom:[te,ne],acceptTypes:[ee]}}};const qt=Ht;function Vt(e,t){return(Vt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Yt=function(e){var t,n;function a(){return e.call(this,a.BGGSEARCH_SidebarPrefs)||this}return n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,Vt(t,n),a}(bt);Yt.BGGSEARCH_SidebarPrefs={id:"boardGameSearchSidebar",expandedSize:"35%",location:Me.left},Yt.bggSearchResults="bggSearchResults";const Qt=Yt;function Jt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zt(e,t){return(zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Wt=o()("board-game-search-sidebar"),Kt=o()("board-game-search-sidebar:detail"),$t=function(e){var t,n;function a(){var t;return(t=e.call(this,a.BGGSEARCH_ViewConfig,new g,T)||this).handleSearch=t.handleSearch.bind(Jt(t)),t.handleSearchResultsCB=t.handleSearchResultsCB.bind(Jt(t)),t}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,zt(t,n);var i=a.prototype;return i.handleSearchResultsCB=function(e,t,n){this.changeSearchButton(!0),Wt("callback for bgg search "+n+" with status "+t+" - "),t>=200&&t<=299&&(Kt(e),Kt(e.data.findBoardGames),this.stateManager&&this.stateName&&this.stateManager.setStateByName(this.stateName,e.data.findBoardGames,!0))},i.onDocumentLoaded=function(){this.formEl=document.getElementById(a.BGGSEARCH_Form),this.buttonEl=document.getElementById(a.BGGSEARCH_Search),this.queryEl=document.getElementById(a.BGGSEARCH_Query),this.formEl.addEventListener("submit",this.handleSearch),this.addEventListener(this),e.prototype.onDocumentLoaded.call(this)},i.getIdForStateItem=function(e,t){return t.gameId},i.getDisplayValueForStateItem=function(e,t){return t.name+" ("+t.year+")     "},i.compareStateItemsForEquality=function(e,t){var n=!1;if(e.gameId&&t.gameId){var a=parseInt(e.gameId),i=parseInt(t.gameId);isNaN(a)||isNaN(i)||(e.gameId=a,t.gameId=i,n=e.gameId===t.gameId)}return n},i.eventClickItem=function(t){e.prototype.eventClickItem.call(this,t),this.eventForwarder.hideRequested(this)},i.changeSearchButton=function(e){void 0===e&&(e=!1),Te.removeAllChildren(this.buttonEl),e?(this.buttonEl&&this.buttonEl.removeAttribute("disabled"),this.buttonEl&&(this.buttonEl.innerHTML="Search")):(this.buttonEl&&this.buttonEl.setAttribute("disabled","true"),this.buttonEl&&(this.buttonEl.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>  Loading...'))},i.handleSearch=function(e){Wt("Handling search"),e.preventDefault(),e.stopPropagation();var t=this.queryEl.value.trim();if(0!=t.length){this.changeSearchButton(!1);Ne.getInstance().addQLApiRequest(O,"query search($queryString: String!) {findBoardGames(query: $queryString) {gameId, name, year}}",{queryString:t},this.handleSearchResultsCB,T)}},i.documentLoaded=function(e){},i.hideRequested=function(e){},i.itemAction=function(e,t,n){},i.canDeleteItem=function(e,t){return!0},i.itemDeleted=function(e,t){var n;Kt("Handling delete of board game search result for game "+t.gameId),null==(n=this.stateManager)||n.removeItemFromState(T,t,this.compareStateItemsForEquality,!0)},i.itemDragStarted=function(e,t){},i.itemSelected=function(e,t){},i.showRequested=function(e){},i.itemDropped=function(e,t){},i.itemDeselected=function(e,t){},a}(et);$t.BGGSEARCH_ViewConfig={resultsContainerId:"bggSearchResults",resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"gameId",keyType:Ae.number,dataSourceId:"bggSearch",modifiers:{normal:"list-group-item-primary",inactive:"list-group-item-light",active:"list-group-item-info",warning:"list-group-item-danger"},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,drag:{type:X,from:"boardGameSearch"}}},$t.BGGSEARCH_Form="bggSearch",$t.BGGSEARCH_Query="queryText",$t.BGGSEARCH_Search="bggSearchButton";const Zt=$t;function Xt(e,t,n,a,i,s,r){try{var o=e[s](r),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(a,i)}function en(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tn(e,t){return(tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nn=o()("app"),an=function(e){var t,n;function a(){var t;return(t=e.call(this)||this).state={boardGames:[]},t.cancelDelete=t.cancelDelete.bind(en(t)),t.confirmDelete=t.confirmDelete.bind(en(t)),t.handleDeleteBoardGame=t.handleDeleteBoardGame.bind(en(t)),t.handleShowUserSearch=t.handleShowUserSearch.bind(en(t)),t.handleShowChat=t.handleShowChat.bind(en(t)),t.handleShowBGGSearch=t.handleShowBGGSearch.bind(en(t)),t.handleDrop=t.handleDrop.bind(en(t)),t.handleShowCollection=t.handleShowCollection.bind(en(t)),t.handleShowScoreSheet=t.handleShowScoreSheet.bind(en(t)),t.handleStartScoreSheet=t.handleStartScoreSheet.bind(en(t)),t.handleShowScores=t.handleShowScores.bind(en(t)),Ke.getInstance().connectToApplication(en(t),window.localStorage),t}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,tn(t,n);var s=a.prototype;return s.addBoardGameToDisplay=function(e){Ke.getInstance().addBoardGameToDisplay(e)},s.getCurrentUser=function(){return Ke.getInstance().getLoggedInUserId()},s.alert=function(e,t){this.titleEl.textContent=e,this.contentEl.textContent=t,this.modalEl.classList.remove(K),this.modalEl.classList.add(Z)},s.render=function(){var e=this;nn("Rendering App");var t=this.state.boardGames;nn(t);var n=t.map((function(t,n){return i.createElement(mt,{key:n,boardGame:t,showScoresHandler:e.handleShowScores,addToCollectionHandler:Ke.getInstance().addBoardGameToCollection,removeFromCollectionHandler:e.handleDeleteBoardGame,startScoreSheetHandler:e.handleStartScoreSheet})}));return i.createElement("div",{className:"root container-fluid"},i.createElement("div",{className:"card-group"},n))},s.cancelDelete=function(e){this.modalEl.classList.remove(Z),this.modalEl.classList.add(K),e.preventDefault()},s.confirmDelete=function(e){this.modalEl.classList.remove(Z),this.modalEl.classList.add(K),e.preventDefault();var t=this.modalEl.getAttribute(Ke.eventDataKeyId);t=parseInt(t),nn("Handling Delete with id "+t);var n=this.state.boardGames,a=n.findIndex((function(e){return e.gameId===t}));if(a>=0){var i=n[a];Ke.getInstance().removeBoardGameFromCollection(i)}},s.handleStartScoreSheet=function(e){if(e.preventDefault(),Qe.getInstance().hasActiveScoreSheet()){if(!confirm("You already have an active score sheet, do you want to finish that one and start a new one?"))return;Qe.getInstance().endScoreSheet()}this.hideAllSideBars();var t=e.target.getAttribute(Ke.eventDataKeyId);if(nn("Handling starting score sheet for "+t),t){t=parseInt(t);var n=this.state.boardGames,a=n.findIndex((function(e){return e.gameId===t}));if(a>=0){var i=n[a];nn(i),Qe.getInstance().startScoreSheet(i),this.switchBetweenCollectionAndScoreSheet(!1)}}},s.handleDeleteBoardGame=function(e){e.preventDefault();var t=e.target.getAttribute(Ke.eventDataKeyId);if(nn("Handling Delete Board Game "+t),t){t=parseInt(t);var n=this.state.boardGames,a=n.findIndex((function(e){return e.gameId===t}));if(a>=0){var i=n[a];i.decorator&&i.decorator===w.Persisted?(nn("Handling Delete Board Game "+t+" - persisted, confirming with user, but only if logged in"),Ke.getInstance().isLoggedIn()?(this.modalEl.setAttribute(Ke.eventDataKeyId,t),this.alert(i.name+" ("+i.year+")","Are you sure you want to delete this board game from your collection?")):(nn("Handling Delete Board Game "+t+" - IS persisted but not logged in, just deleting from local storage  asking controller to remove"),Ke.getInstance().removeBoardGameFromDisplay(i))):(nn("Handling Delete Board Game "+t+" - NOT persisted, asking controller to remove"),Ke.getInstance().removeBoardGameFromDisplay(i))}}},s.componentDidMount=function(){var e,t=(e=regeneratorRuntime.mark((function e(){var t,n,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:nn("component Did Mount"),this.chatSidebar=new Ut,this.chatView=new ut,this.chatSidebar.addView(this.chatView,{containerId:Ut.SidebarContainers.chatLogs}),t=new Ft(Ke.getInstance().getStateManager()),this.chatSidebar.addView(t,{containerId:Ut.SidebarContainers.chatLog}),this.chatView.addEventListener(t),this.chatSidebar.onDocumentLoaded(),this.userSearchSidebar=new Lt,n=new rt(Ke.getInstance().getStateManager()),this.userSearchSidebar.addView(n,{containerId:Lt.SidebarContainers.recentSearches}),a=new xt(Ke.getInstance().getStateManager()),this.userSearchSidebar.addView(a,{containerId:Lt.SidebarContainers.favourites}),i=new qt(Ke.getInstance().getStateManager()),this.userSearchSidebar.addView(i,{containerId:Lt.SidebarContainers.blocked}),this.userSearchSidebar.onDocumentLoaded(),this.bggSearchSidebar=new Qt,s=new Zt,this.bggSearchSidebar.addView(s,{containerId:Qt.bggSearchResults}),this.bggSearchSidebar.onDocumentLoaded(),s.addEventListener(this),this.scoreSheetSidebar=new Nt,this.scoresView=new St,this.scoreSheetSidebar.addView(this.scoresView,{containerId:Nt.scoreSheets}),this.scoreSheetSidebar.onDocumentLoaded(),He.getInstance().onDocumentLoaded(),document&&(document.getElementById("navigationItemBoardGameSearch").addEventListener("click",this.handleShowBGGSearch),document.getElementById("navigationItemUserSearch").addEventListener("click",this.handleShowUserSearch),this.chatNavigationItem=document.getElementById("navigationItemChat"),this.chatNavigationItem.addEventListener("click",this.handleShowChat),document.getElementById("navigationItemMyCollection").addEventListener("click",this.handleShowCollection),document.getElementById("navigationItemScoreSheet").addEventListener("click",this.handleShowScoreSheet)),this.modalEl=document.getElementById("alert"),this.titleEl=document.getElementById("alert-title"),this.contentEl=document.getElementById("alert-content"),this.cancelBtnEl=document.getElementById("alert-cancel"),this.confirmBtnEl=document.getElementById("alert-confirm"),this.closeBtnEl=document.getElementById("alert-close"),this.cancelBtnEl&&this.cancelBtnEl.addEventListener("click",this.cancelDelete),this.confirmBtnEl&&this.confirmBtnEl.addEventListener("click",this.confirmDelete),this.closeBtnEl&&this.closeBtnEl.addEventListener("click",this.cancelDelete),this.thisEl=document.getElementById("root"),this.scoreSheetEl=document.getElementById("scoreSheetZone"),this.thisEl&&(this.thisEl.addEventListener("dragover",(function(e){e.preventDefault()})),this.thisEl.addEventListener("drop",this.handleDrop)),Qe.getInstance().initialise(this),Ke.getInstance().initialise();case 41:case"end":return e.stop()}}),e,this)})),function(){var t=this,n=arguments;return new Promise((function(a,i){var s=e.apply(t,n);function r(e){Xt(s,a,i,r,o,"next",e)}function o(e){Xt(s,a,i,r,o,"throw",e)}r(void 0)}))});return function(){return t.apply(this,arguments)}}(),s.hideAllSideBars=function(){this.chatSidebar.eventHide(null),this.userSearchSidebar.eventHide(null),this.bggSearchSidebar.eventHide(null)},s.handleShowCollection=function(e){this.switchBetweenCollectionAndScoreSheet(!0)},s.handleShowScoreSheet=function(e){this.switchBetweenCollectionAndScoreSheet(!1)},s.handleShowUserSearch=function(e){nn("Handling Show User Search"),e.preventDefault(),Ke.getInstance().isLoggedIn()?this.userSearchSidebar.eventShow(e):window.location.href=M},s.handleShowScores=function(e){nn("Handling show board game scores"),e.preventDefault();var t=e.target.getAttribute(Ke.eventDataKeyId);if(nn("Handling Show board game scores "+t),t){t=parseInt(t);var n=this.state.boardGames,a=n.findIndex((function(e){return e.gameId===t}));if(a>=0){var i=n[a];this.scoresView.setSelectedBoardGame(i),this.scoreSheetSidebar.eventShow(null)}}},s.handleShowChat=function(e){nn("Handling Show Chat"),Ke.getInstance().isLoggedIn()?(this.chatSidebar.eventShow(null),e&&this.chatView.selectChatRoom(e)):window.location.href=M},s.handleShowBGGSearch=function(e){nn("Handling Show BGG Search View"),e.preventDefault(),Ke.getInstance().isLoggedIn()||this.hideAllSideBars(),this.bggSearchSidebar.eventShow(e)},s.countChanged=function(e){var t='Chat <i class="fas fa-inbox"></i>';e>0&&(t+=' <span class="badge badge-pill badge-primary">&nbsp;'+e+"&nbsp;</span>"),this.chatNavigationItem&&(this.chatNavigationItem.innerHTML=""+t)},s.handleDrop=function(e){var t=e.dataTransfer.getData(Ge);nn(t);var n=JSON.parse(t);nn(n),n.draggedType===X&&(n.gameId=parseInt(n.gameId),this.addBoardGameToDisplay(n))},s.switchBetweenCollectionAndScoreSheet=function(e){e?(this.thisEl&&Te.addRemoveClasses(this.thisEl,"d-none",!1),this.thisEl&&Te.addRemoveClasses(this.thisEl,"d-block",!0),this.scoreSheetEl&&Te.addRemoveClasses(this.scoreSheetEl,"d-none",!0),this.scoreSheetEl&&Te.addRemoveClasses(this.scoreSheetEl,"d-block",!1)):Qe.getInstance().hasActiveScoreSheet()&&(this.thisEl&&Te.addRemoveClasses(this.thisEl,"d-none",!0),this.thisEl&&Te.addRemoveClasses(this.thisEl,"d-block",!1),this.scoreSheetEl&&Te.addRemoveClasses(this.scoreSheetEl,"d-none",!1),this.scoreSheetEl&&Te.addRemoveClasses(this.scoreSheetEl,"d-block",!0))},s.documentLoaded=function(e){},s.hideRequested=function(e){},s.showRequested=function(e){},s.itemAction=function(e,t,n){},s.canDeleteItem=function(e,t){return!0},s.itemDeleted=function(e,t){},s.itemDeselected=function(e,t){},s.itemDragStarted=function(e,t){},s.itemDropped=function(e,t){},s.itemSelected=function(e,t){t.gameId=parseInt(t.gameId),this.addBoardGameToDisplay(t)},a}(i.Component);localStorage.debug="score-sheet-view",o().log=console.info.bind(console);var sn=i.createElement(an,{className:"container-fluid justify-content-around"});s.render(sn,document.getElementById("root"))},4125:(e,t,n)=>{var a={"./af":2525,"./af.js":2525,"./ar":9102,"./ar-dz":3778,"./ar-dz.js":3778,"./ar-kw":960,"./ar-kw.js":960,"./ar-ly":1490,"./ar-ly.js":1490,"./ar-ma":5507,"./ar-ma.js":5507,"./ar-sa":4042,"./ar-sa.js":4042,"./ar-tn":1523,"./ar-tn.js":1523,"./ar.js":9102,"./az":8365,"./az.js":8365,"./be":4860,"./be.js":4860,"./bg":9904,"./bg.js":9904,"./bm":952,"./bm.js":952,"./bn":8609,"./bn.js":8609,"./bo":8437,"./bo.js":8437,"./br":4557,"./br.js":4557,"./bs":9332,"./bs.js":9332,"./ca":3667,"./ca.js":3667,"./cs":6860,"./cs.js":6860,"./cv":5427,"./cv.js":5427,"./cy":8863,"./cy.js":8863,"./da":3520,"./da.js":3520,"./de":2111,"./de-at":464,"./de-at.js":464,"./de-ch":701,"./de-ch.js":701,"./de.js":2111,"./dv":4438,"./dv.js":4438,"./el":3121,"./el.js":3121,"./en-SG":2406,"./en-SG.js":2406,"./en-au":9197,"./en-au.js":9197,"./en-ca":3885,"./en-ca.js":3885,"./en-gb":1914,"./en-gb.js":1914,"./en-ie":938,"./en-ie.js":938,"./en-il":5438,"./en-il.js":5438,"./en-nz":9722,"./en-nz.js":9722,"./eo":2783,"./eo.js":2783,"./es":6820,"./es-do":9651,"./es-do.js":9651,"./es-us":6018,"./es-us.js":6018,"./es.js":6820,"./et":8686,"./et.js":8686,"./eu":1323,"./eu.js":1323,"./fa":1885,"./fa.js":1885,"./fi":3741,"./fi.js":3741,"./fo":9961,"./fo.js":9961,"./fr":2800,"./fr-ca":8121,"./fr-ca.js":8121,"./fr-ch":7979,"./fr-ch.js":7979,"./fr.js":2800,"./fy":8930,"./fy.js":8930,"./ga":2591,"./ga.js":2591,"./gd":5513,"./gd.js":5513,"./gl":4485,"./gl.js":4485,"./gom-latn":3878,"./gom-latn.js":3878,"./gu":5435,"./gu.js":5435,"./he":2825,"./he.js":2825,"./hi":7282,"./hi.js":7282,"./hr":2438,"./hr.js":2438,"./hu":1310,"./hu.js":1310,"./hy-am":4794,"./hy-am.js":4794,"./id":8761,"./id.js":8761,"./is":6593,"./is.js":6593,"./it":2196,"./it-ch":8111,"./it-ch.js":8111,"./it.js":2196,"./ja":2645,"./ja.js":2645,"./jv":1869,"./jv.js":1869,"./ka":4093,"./ka.js":4093,"./kk":9794,"./kk.js":9794,"./km":2637,"./km.js":2637,"./kn":8684,"./kn.js":8684,"./ko":4565,"./ko.js":4565,"./ku":2773,"./ku.js":2773,"./ky":5606,"./ky.js":5606,"./lb":2027,"./lb.js":2027,"./lo":366,"./lo.js":366,"./lt":7311,"./lt.js":7311,"./lv":1851,"./lv.js":1851,"./me":2700,"./me.js":2700,"./mi":3575,"./mi.js":3575,"./mk":5509,"./mk.js":5509,"./ml":9866,"./ml.js":9866,"./mn":9072,"./mn.js":9072,"./mr":3798,"./mr.js":3798,"./ms":6848,"./ms-my":1212,"./ms-my.js":1212,"./ms.js":6848,"./mt":3181,"./mt.js":3181,"./my":3977,"./my.js":3977,"./nb":7248,"./nb.js":7248,"./ne":1859,"./ne.js":1859,"./nl":7058,"./nl-be":6901,"./nl-be.js":6901,"./nl.js":7058,"./nn":1748,"./nn.js":1748,"./pa-in":4266,"./pa-in.js":4266,"./pl":9581,"./pl.js":9581,"./pt":7410,"./pt-br":6114,"./pt-br.js":6114,"./pt.js":7410,"./ro":8295,"./ro.js":8295,"./ru":9862,"./ru.js":9862,"./sd":9548,"./sd.js":9548,"./se":3236,"./se.js":3236,"./si":289,"./si.js":289,"./sk":8339,"./sk.js":8339,"./sl":4170,"./sl.js":4170,"./sq":5316,"./sq.js":5316,"./sr":8791,"./sr-cyrl":7630,"./sr-cyrl.js":7630,"./sr.js":8791,"./ss":5773,"./ss.js":5773,"./sv":1159,"./sv.js":1159,"./sw":2329,"./sw.js":2329,"./ta":7054,"./ta.js":7054,"./te":1280,"./te.js":1280,"./tet":4120,"./tet.js":4120,"./tg":7678,"./tg.js":7678,"./th":4679,"./th.js":4679,"./tl-ph":3270,"./tl-ph.js":3270,"./tlh":5386,"./tlh.js":5386,"./tr":4669,"./tr.js":4669,"./tzl":1434,"./tzl.js":1434,"./tzm":7217,"./tzm-latn":7665,"./tzm-latn.js":7665,"./tzm.js":7217,"./ug-cn":4956,"./ug-cn.js":4956,"./uk":9596,"./uk.js":9596,"./ur":5133,"./ur.js":5133,"./uz":9456,"./uz-latn":8737,"./uz-latn.js":8737,"./uz.js":9456,"./vi":5577,"./vi.js":5577,"./x-pseudo":4564,"./x-pseudo.js":4564,"./yo":8854,"./yo.js":8854,"./zh-cn":5817,"./zh-cn.js":5817,"./zh-hk":6634,"./zh-hk.js":6634,"./zh-tw":9292,"./zh-tw.js":9292};function i(e){var t=s(e);return n(t)}function s(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}i.keys=function(){return Object.keys(a)},i.resolve=s,e.exports=i,i.id=4125},6700:(e,t,n)=>{var a={"./af":2786,"./af.js":2786,"./ar":867,"./ar-dz":4130,"./ar-dz.js":4130,"./ar-kw":6135,"./ar-kw.js":6135,"./ar-ly":6440,"./ar-ly.js":6440,"./ar-ma":7702,"./ar-ma.js":7702,"./ar-sa":6040,"./ar-sa.js":6040,"./ar-tn":7100,"./ar-tn.js":7100,"./ar.js":867,"./az":1083,"./az.js":1083,"./be":9808,"./be.js":9808,"./bg":8338,"./bg.js":8338,"./bm":7438,"./bm.js":7438,"./bn":8905,"./bn-bd":6225,"./bn-bd.js":6225,"./bn.js":8905,"./bo":1560,"./bo.js":1560,"./br":1278,"./br.js":1278,"./bs":622,"./bs.js":622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":877,"./cv.js":877,"./cy":7373,"./cy.js":7373,"./da":4780,"./da.js":4780,"./de":9740,"./de-at":217,"./de-at.js":217,"./de-ch":894,"./de-ch.js":894,"./de.js":9740,"./dv":5300,"./dv.js":5300,"./el":837,"./el.js":837,"./en-au":8348,"./en-au.js":8348,"./en-ca":7925,"./en-ca.js":7925,"./en-gb":2243,"./en-gb.js":2243,"./en-ie":6436,"./en-ie.js":6436,"./en-il":7207,"./en-il.js":7207,"./en-in":4175,"./en-in.js":4175,"./en-nz":6319,"./en-nz.js":6319,"./en-sg":1662,"./en-sg.js":1662,"./eo":2915,"./eo.js":2915,"./es":5655,"./es-do":5251,"./es-do.js":5251,"./es-mx":6112,"./es-mx.js":6112,"./es-us":1146,"./es-us.js":1146,"./es.js":5655,"./et":5603,"./et.js":5603,"./eu":7763,"./eu.js":7763,"./fa":6959,"./fa.js":6959,"./fi":1897,"./fi.js":1897,"./fil":2549,"./fil.js":2549,"./fo":4694,"./fo.js":4694,"./fr":4470,"./fr-ca":3049,"./fr-ca.js":3049,"./fr-ch":2330,"./fr-ch.js":2330,"./fr.js":4470,"./fy":5044,"./fy.js":5044,"./ga":9295,"./ga.js":9295,"./gd":2101,"./gd.js":2101,"./gl":8794,"./gl.js":8794,"./gom-deva":7884,"./gom-deva.js":7884,"./gom-latn":3168,"./gom-latn.js":3168,"./gu":5349,"./gu.js":5349,"./he":4206,"./he.js":4206,"./hi":94,"./hi.js":94,"./hr":316,"./hr.js":316,"./hu":2138,"./hu.js":2138,"./hy-am":1423,"./hy-am.js":1423,"./id":9218,"./id.js":9218,"./is":135,"./is.js":135,"./it":626,"./it-ch":150,"./it-ch.js":150,"./it.js":626,"./ja":9183,"./ja.js":9183,"./jv":4286,"./jv.js":4286,"./ka":2105,"./ka.js":2105,"./kk":7772,"./kk.js":7772,"./km":8758,"./km.js":8758,"./kn":9282,"./kn.js":9282,"./ko":3730,"./ko.js":3730,"./ku":1408,"./ku.js":1408,"./ky":3291,"./ky.js":3291,"./lb":6841,"./lb.js":6841,"./lo":5466,"./lo.js":5466,"./lt":7010,"./lt.js":7010,"./lv":7595,"./lv.js":7595,"./me":9861,"./me.js":9861,"./mi":5493,"./mi.js":5493,"./mk":5966,"./mk.js":5966,"./ml":7341,"./ml.js":7341,"./mn":5115,"./mn.js":5115,"./mr":370,"./mr.js":370,"./ms":9847,"./ms-my":1237,"./ms-my.js":1237,"./ms.js":9847,"./mt":2126,"./mt.js":2126,"./my":6165,"./my.js":6165,"./nb":4924,"./nb.js":4924,"./ne":6744,"./ne.js":6744,"./nl":3901,"./nl-be":9814,"./nl-be.js":9814,"./nl.js":3901,"./nn":3877,"./nn.js":3877,"./oc-lnc":2135,"./oc-lnc.js":2135,"./pa-in":5858,"./pa-in.js":5858,"./pl":4495,"./pl.js":4495,"./pt":9520,"./pt-br":7971,"./pt-br.js":7971,"./pt.js":9520,"./ro":6459,"./ro.js":6459,"./ru":1793,"./ru.js":1793,"./sd":950,"./sd.js":950,"./se":490,"./se.js":490,"./si":124,"./si.js":124,"./sk":4249,"./sk.js":4249,"./sl":4985,"./sl.js":4985,"./sq":1104,"./sq.js":1104,"./sr":9131,"./sr-cyrl":9915,"./sr-cyrl.js":9915,"./sr.js":9131,"./ss":5893,"./ss.js":5893,"./sv":8760,"./sv.js":8760,"./sw":1172,"./sw.js":1172,"./ta":7333,"./ta.js":7333,"./te":3110,"./te.js":3110,"./tet":2095,"./tet.js":2095,"./tg":7321,"./tg.js":7321,"./th":9041,"./th.js":9041,"./tk":9005,"./tk.js":9005,"./tl-ph":5768,"./tl-ph.js":5768,"./tlh":9444,"./tlh.js":9444,"./tr":2397,"./tr.js":2397,"./tzl":8254,"./tzl.js":8254,"./tzm":1106,"./tzm-latn":699,"./tzm-latn.js":699,"./tzm.js":1106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":7691,"./uk.js":7691,"./ur":3795,"./ur.js":3795,"./uz":6791,"./uz-latn":588,"./uz-latn.js":588,"./uz.js":6791,"./vi":5666,"./vi.js":5666,"./x-pseudo":4378,"./x-pseudo.js":4378,"./yo":5805,"./yo.js":5805,"./zh-cn":3839,"./zh-cn.js":3839,"./zh-hk":5726,"./zh-hk.js":5726,"./zh-mo":9807,"./zh-mo.js":9807,"./zh-tw":4152,"./zh-tw.js":4152};function i(e){var t=s(e);return n(t)}function s(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}i.keys=function(){return Object.keys(a)},i.resolve=s,e.exports=i,i.id=6700}},n={};function a(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(s.exports,s,s.exports,a),s.loaded=!0,s.exports}a.m=t,e=[],a.O=(t,n,i,s)=>{if(!n){var r=1/0;for(h=0;h<e.length;h++){for(var[n,i,s]=e[h],o=!0,c=0;c<n.length;c++)(!1&s||r>=s)&&Object.keys(a.O).every((e=>a.O[e](n[c])))?n.splice(c--,1):(o=!1,s<r&&(r=s));if(o){e.splice(h--,1);var d=i();void 0!==d&&(t=d)}}return t}s=s||0;for(var h=e.length;h>0&&e[h-1][2]>s;h--)e[h]=e[h-1];e[h]=[n,i,s]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={143:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var i,s,[r,o,c]=n,d=0;if(r.some((t=>0!==e[t]))){for(i in o)a.o(o,i)&&(a.m[i]=o[i]);if(c)var h=c(a)}for(t&&t(n);d<r.length;d++)s=r[d],a.o(e,s)&&e[s]&&e[s][0](),e[r[d]]=0;return a.O(h)},n=self.webpackChunktemplate_feo_react_babel=self.webpackChunktemplate_feo_react_babel||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=a.O(void 0,[736],(()=>a(3610)));i=a.O(i)})();
//# sourceMappingURL=app.bundle.js.map