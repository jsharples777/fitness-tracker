(()=>{var e,t={8362:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Bi});var i,a,r,s,o="text/plain",d="view-extra-action";!function(e){e[e.normal=0]="normal",e[e.active=1]="active",e[e.inactive=2]="inactive",e[e.warning=3]="warning"}(i||(i={})),function(e){e[e.number=0]="number",e[e.string=1]="string",e[e.boolean=2]="boolean",e[e.collection=3]="collection"}(a||(a={})),function(e){e[e.top=0]="top",e[e.right=1]="right",e[e.left=2]="left",e[e.bottom=3]="bottom"}(r||(r={})),function(e){e[e.first=0]="first",e[e.last=1]="last"}(s||(s={}));var c=992,l=769,u=415;const h=new(function(){function e(){}var t=e.prototype;return t.scrollSmoothToId=function(e){var t=document.getElementById(e);null!==t&&t.scrollIntoView({block:"start",behavior:"smooth"})},t.scrollToBottomNow=function(e){e&&(e.scrollTop=e.scrollHeight-e.clientHeight+100)},t.scrollToBottomSmooth=function(e){e&&(e.scrollIntoView({behavior:"smooth"}),e.scrollTop=e.scrollHeight-e.clientHeight+100)},t.scrollSmoothTo=function(e){e.scrollIntoView({block:"start",behavior:"smooth"})},t.scrollTo=function(e){e.scrollIntoView({block:"start"})},t.removeAllChildren=function(e){if(e&&e.firstChild)for(;e.firstChild;){var t=e.lastChild;t&&e.removeChild(t)}},t.addRemoveClasses=function(e,t,n){void 0===n&&(n=!0),t.split(" ").forEach((function(t){t.trim().length>0&&(n?e.classList.add(t):e.classList.remove(t))}))},t.addAttributes=function(e,t){t&&t.forEach((function(t){e.setAttribute(t.name,t.value)}))},t.removeAttributes=function(e,t){t.forEach((function(t){e.removeAttribute(t)}))},t.allElementsFromPoint=function(e,t){for(var n,i=[],a=[];(n=document.elementFromPoint(e,t))&&n!==document.documentElement;)i.push(n),a.push(n.style.visibility),n.style.visibility="hidden";for(var r=0;r<i.length;r++)i[r].style.visibility=a[r];return i.reverse(),i},e}());var m,f=n(1227),g=n.n(f),v=g()("context-helper");!function(e){e[e.top=0]="top",e[e.bottom=1]="bottom",e[e.right=2]="right",e[e.left=3]="left"}(m||(m={}));var p,C=function(e,t){return""},I=function(){function e(){this.registry=[],this.menuDivEl=null,this.menuContentEl=null,this.handleContextMenu=this.handleContextMenu.bind(this),this.hideContextMenu=this.hideContextMenu.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.onDocumentLoaded=function(){document.addEventListener("click",this.hideContextMenu),this.menuDivEl=document.getElementById("contextmenu"),this.menuContentEl=document.getElementById("contextMenuItems")},t.ensureInRegistry=function(e){var t,n=this.registry.findIndex((function(t){return t.source===e}));return n<0?(t={source:e,defaultType:{internalType:"",displayName:"",identifier:C,description:C,actions:[]}},this.registry.push(t)):t=this.registry[n],t},t.addContextFromView=function(e,t,n){var i=this.ensureInRegistry(e.getName());return i.view=e,i.defaultType.internalType=t,i.defaultType.displayName=n,i.defaultType.identifier=e.getItemId,i.defaultType.description=e.getItemDescription,i},t.addContextToElement=function(t,n,i,a,r,s){void 0===r&&(r=!1),void 0===s&&(s=m.bottom);var o=this.ensureInRegistry(t);if(a.setAttribute(e.SOURCE,o.source),a.setAttribute(e.TYPE,o.defaultType.internalType),a.setAttribute(e.DISPLAYNAME,o.defaultType.displayName),a.setAttribute(e.IDENTIFIER,o.defaultType.identifier(n,i)),a.setAttribute(e.DESCRIPTION,o.defaultType.description(n,i)),r){switch(a.setAttribute(e.BOOTSTRAP_TOGGLE,e.BOOTSTRAP_TOOLTIP_VALUE),a.setAttribute(e.BOOTSTRAP_TOGGLE_HTML,e.BOOTSTRAP_TOGGLE_HTML_VALUE),s){case m.bottom:a.setAttribute(e.BOOTSTRAP_PLACEMENT,e.BOOTSTRAP_PLACEMENT_BOTTOM);break;case m.top:a.setAttribute(e.BOOTSTRAP_PLACEMENT,e.BOOTSTRAP_PLACEMENT_TOP);break;case m.left:a.setAttribute(e.BOOTSTRAP_PLACEMENT,e.BOOTSTRAP_PLACEMENT_LEFT);break;case m.right:a.setAttribute(e.BOOTSTRAP_PLACEMENT,e.BOOTSTRAP_PLACEMENT_RIGHT)}$('[data-toggle="tooltip"]').tooltip({html:!0})}},t.findContextFromElement=function(t){var n=null,i=t.getAttribute(e.SOURCE);if(i)n={source:i,internalType:t.getAttribute(e.TYPE),displayName:t.getAttribute(e.DISPLAYNAME),identifier:t.getAttribute(e.IDENTIFIER),description:t.getAttribute(e.DESCRIPTION)};else{var a=t.parentElement;a&&(n=this.findContextFromElement(a))}return n},t.findAllContextsFromElement=function(t,n){var i=t.getAttribute(e.SOURCE);if(i){var a={source:i,internalType:t.getAttribute(e.TYPE),displayName:t.getAttribute(e.DISPLAYNAME),identifier:t.getAttribute(e.IDENTIFIER),description:t.getAttribute(e.DESCRIPTION)};n.push(a)}var r=t.parentElement;r&&this.findAllContextsFromElement(r,n)},t.findContextFromEvent=function(e){var t=null;return e.target&&(e.target,t=this.findContextFromElement(e.target)),t},t.addContextActionToContext=function(e,t){v("Adding action to context "+e.source),v(t),e.defaultType.actions.push(t)},t.addActionToContext=function(e,t,n,i,a){var r={actionName:t,displayName:n,handler:i,elementDefinition:{elementType:"a",elementAttributes:[{name:"href",value:"#"}],elementClasses:"list-group-item list-group-item-action bg-dark text-white"},iconClasses:a};this.addContextActionToContext(e,r)},t.buildContextMenu=function(t){var n=this;v("building context menu");var i=!1,a=this.ensureInRegistry(t.source);return a.defaultType.actions.length>0?this.menuContentEl&&this.menuContentEl&&(h.removeAllChildren(this.menuContentEl),a.defaultType.actions.forEach((function(a){v("Adding action"),v(a);var r=document.createElement(a.elementDefinition.elementType);r&&n.menuContentEl&&(h.addAttributes(r,a.elementDefinition.elementAttributes),h.addRemoveClasses(r,a.elementDefinition.elementClasses),r.setAttribute(e.SOURCE,t.source),r.setAttribute(e.TYPE,t.internalType),r.setAttribute(e.DISPLAYNAME,t.displayName),r.setAttribute(e.IDENTIFIER,t.identifier),r.setAttribute(e.DESCRIPTION,t.description),r.setAttribute(d,a.actionName),r.addEventListener("click",(function(e){n.hideContextMenu(e),a.handler(e)})),r.innerHTML=""+a.displayName,a.iconClasses&&(r.innerHTML+='&nbsp;&nbsp;<i class="'+a.iconClasses+'"></i>'),n.menuContentEl.appendChild(r),v("new menu element is "),v(n.menuContentEl),i=!0)}))):v("building context menu - no actions for "+t.source),i},t.handleContextMenu=function(e){v("Right click"),v(e.target);var t=this.findContextFromElement(e.target);return v(t),!t||!this.buildContextMenu(t)||(e.preventDefault(),e.stopPropagation(),this.showContextMenu(e),!1)},t.hideContextMenu=function(e){this.menuDivEl&&h.addRemoveClasses(this.menuDivEl,"d-none")},t.showContextMenu=function(e){this.menuDivEl&&(v("Showing context menu at "+e.pageX+","+e.pageY),h.addRemoveClasses(this.menuDivEl,"d-none",!1),this.menuDivEl.style.left=e.pageX+"px",this.menuDivEl.style.top=e.pageY+"px")},e}();I.SOURCE="context-source",I.TYPE="context-type",I.DISPLAYNAME="context-display-name",I.IDENTIFIER="context-id",I.DESCRIPTION="title",I.BOOTSTRAP_TOGGLE="data-toggle",I.BOOTSTRAP_PLACEMENT="data-placement",I.BOOTSTRAP_TOOLTIP_VALUE="tooltip",I.BOOTSTRAP_POPOVER_VALUE="popover",I.BOOTSTRAP_TOGGLE_HTML="data-html",I.BOOTSTRAP_TOGGLE_HTML_VALUE="true",I.BOOTSTRAP_PLACEMENT_TOP="top",I.BOOTSTRAP_PLACEMENT_BOTTOM="bottom",I.BOOTSTRAP_PLACEMENT_RIGHT="right",I.BOOTSTRAP_PLACEMENT_LEFT="left",function(e){e[e.ItemAdded=0]="ItemAdded",e[e.ItemUpdated=1]="ItemUpdated",e[e.ItemDeleted=2]="ItemDeleted",e[e.StateChanged=3]="StateChanged"}(p||(p={}));var b=g()("state-manager-delegate");const y=function(){function e(e){this.suppressEventEmits=!1,this.managerName=e,this.stateChangeListeners=[]}var t=e.prototype;return t.suppressEvents=function(){this.suppressEventEmits=!0},t.emitEvents=function(){this.suppressEventEmits=!1},t.informChangeListenersForStateWithName=function(e,t,n,i){var a=this;if(void 0===n&&(n=p.StateChanged),void 0===i&&(i=null),b("State Manager: Informing state listeners of "+e),this.suppressEventEmits)b("State Manager: Events suppressed");else{var r=this.stateChangeListeners.findIndex((function(t){return t.name===e}));r>=0&&(b("State Manager: Found state listeners of "+e+" with event type "+n),this.stateChangeListeners[r].listeners.forEach((function(r){b("State Manager: Found state listener of "+e+" with name "+r.getListenerName()+" - informing");try{switch(n){case p.StateChanged:r.stateChanged(a.managerName,e,t);break;case p.ItemAdded:r.stateChangedItemAdded(a.managerName,e,t);break;case p.ItemUpdated:r.stateChangedItemUpdated(a.managerName,e,i,t);break;case p.ItemDeleted:r.stateChangedItemRemoved(a.managerName,e,t)}}catch(e){console.log(e)}})))}},t.addChangeListenerForName=function(e,t){this.ensureListenerSetupForName(e),b("State Manager: Adding state listener for "+e+" with name "+t.getListenerName());var n=this.stateChangeListeners.findIndex((function(t){return t.name===e}));n>=0&&(b("State Manager: Adding state listener for "+e+" with name "+t.getListenerName()+" with index "+n),this.stateChangeListeners[n].listeners.push(t))},t.ensureListenerSetupForName=function(e){if(this.stateChangeListeners.findIndex((function(t){return t.name===e}))<0){var t={name:e,listeners:[]};this.stateChangeListeners.push(t)}},e}();var w=g()("state-manager-ts"),E=function(){function e(e){this.forceSaves=!0,this.managerName="",this.delegate=new y(e),this.managerName=e,this.emitEvents(),this.forceSaves=!0}var t=e.prototype;return t.suppressEvents=function(){this.delegate.suppressEvents()},t.emitEvents=function(){this.delegate.emitEvents()},t.dontForceSavesOnAddRemoveUpdate=function(){this.forceSaves=!1},t.forceSavesOnAddRemoveUpdate=function(){this.forceSaves=!0},t.informChangeListenersForStateWithName=function(e,t,n,i){void 0===n&&(n=p.StateChanged),void 0===i&&(i=null),this.delegate.informChangeListenersForStateWithName(e,t,n,i)},t.addChangeListenerForName=function(e,t){this.delegate.addChangeListenerForName(e,t)},t.addStateByName=function(e,t){this._ensureStatePresent(e);var n={name:e,value:t};return this._replaceNamedStateInStorage(n),this.informChangeListenersForStateWithName(e,t,p.StateChanged),t},t.getStateByName=function(e){var t;return this._ensureStatePresent(e),w("State Manager: Getting state for "+e),t=this._getState(e).value,w("State Manager: Found previous state for "+e),w(t),t},t.setStateByName=function(e,t,n){return void 0===n&&(n=!0),this._ensureStatePresent(e),w("State Manager: Setting state for "+e),w(t),this._getState(e).value=t,this.forceSaves&&this._saveState(e,t),n&&this.informChangeListenersForStateWithName(e,t),t},t.addNewItemToState=function(e,t,n){void 0===n&&(n=!1),this._ensureStatePresent(e),w("State Manager: Adding item to state "+e),this._addItemToState(e,t,n),this.informChangeListenersForStateWithName(e,t,p.ItemAdded)},t.findItemInState=function(e,t,n){this._ensureStatePresent(e);var i={},a=this.getStateByName(e),r=a.findIndex((function(e){return n(e,t)}));return w("Finding item in state "+e+" - found index "+r),w(t),r>=0&&(i=a[r]),i},t.isItemInState=function(e,t,n){this._ensureStatePresent(e);var i=!1;return this.getStateByName(e).findIndex((function(e){return n(e,t)}))>=0&&(i=!0),i},t.removeItemFromState=function(e,t,n,i){this._ensureStatePresent(e);var a=this.findItemInState(e,t,n);return w("State Manager: Found item - removing, is persisted "+i),this._removeItemFromState(e,t,n,i),this.informChangeListenersForStateWithName(e,a,p.ItemDeleted),!0},t.updateItemInState=function(e,t,n,i){this._ensureStatePresent(e);var a=this.findItemInState(e,t,n);return w("State Manager: Found item - replacing "),this._updateItemInState(e,t,n,i),this.informChangeListenersForStateWithName(e,t,p.ItemUpdated,a),!0},e}();function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S=g()("state-manager-ms");const F=function(e){var t,n;function i(){var t;return(t=e.call(this,"memory")||this).applicationState=[],t.forceSaves=!0,t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,L(t,n),i.getInstance=function(){return i._instance||(i._instance=new i),i._instance};var a=i.prototype;return a._ensureStatePresent=function(e){if(this.applicationState.findIndex((function(t){return t.name===e}))<0){var t={name:e,value:[]};this.applicationState.push(t)}},a._addNewNamedStateToStorage=function(e){S("Adding new complete state "+name),S(e.value),this.applicationState.push(e)},a._replaceNamedStateInStorage=function(e){var t=this.applicationState.findIndex((function(t){return t.name===e.name}));t>=0&&(S("replacing complete state "+name),S(e.value),this.applicationState.splice(t,1,e))},a._getState=function(e){var t=this.applicationState.find((function(t){return t.name===e}));return S("getting complete state "+e),S(t.value),t},a._saveState=function(e,t){var n=this.applicationState.findIndex((function(t){return t.name===e}));if(n>=0){var i=this.applicationState[n];S("SAVING complete state "+e),S(i.value),i.value=t}},a._addItemToState=function(e,t,n){if(void 0===n&&(n=!1),n){var i=this.applicationState.findIndex((function(t){return t.name===e}));if(i>=0){var a=this.applicationState[i];S("adding item to state "+e),S(t),a.value.push(t)}}},a._removeItemFromState=function(e,t,n,i){var a=this.applicationState.findIndex((function(t){return t.name===e}));if(a>=0){var r=this.applicationState[a],s=r.value.findIndex((function(e){return n(e,t)}));s>=0&&(S("removing item from state "+e),S(t),r.value.splice(s,1))}},a._updateItemInState=function(e,t,n,i){var a=this.applicationState.findIndex((function(t){return t.name===e}));if(a>=0){var r=this.applicationState[a],s=r.value.findIndex((function(e){return n(e,t)}));s>=0&&(r.value.splice(s,1,t),S("updating item in state "+e),S(t))}else this._addItemToState(e,t,!0)},i}(E);var N,D;!function(e){e[e.Normal=0]="Normal",e[e.High=1]="High",e[e.Urgent=2]="Urgent"}(N||(N={})),function(e){e[e.ChatRoom=0]="ChatRoom",e[e.ScoreSheet=1]="ScoreSheet"}(D||(D={}));var k=g()("socket-ts");const T=function(){function e(){this.chatReceivers=[],this.callbackForMessage=this.callbackForMessage.bind(this),this.callbackForData=this.callbackForData.bind(this),this.listener=null,this.socket=null,this.chatReceivers=[],this.callbackForMessage=this.callbackForMessage.bind(this),this.callbackForLogin=this.callbackForLogin.bind(this),this.callbackForLogout=this.callbackForLogout.bind(this),this.callbackForJoinRoom=this.callbackForJoinRoom.bind(this),this.callbackForExitRoom=this.callbackForExitRoom.bind(this),this.callbackForInvite=this.callbackForInvite.bind(this),this.callbackForChat=this.callbackForChat.bind(this),this.callbackForQueue=this.callbackForQueue.bind(this),this.callbackForUserList=this.callbackForUserList.bind(this),this.callbackForDeclineInvite=this.callbackForDeclineInvite.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.addChatReceiver=function(e){this.chatReceivers.push(e)},t.setListener=function(e){k("Setting listener"),this.listener=e,k("Creating socket connection"),this.socket=io(),k("Waiting for messages"),this.socket.on("message",this.callbackForMessage),this.socket.on("data",this.callbackForData),this.socket.on("login",this.callbackForLogin),this.socket.on("logout",this.callbackForLogout),this.socket.on("joinroom",this.callbackForJoinRoom),this.socket.on("exitroom",this.callbackForExitRoom),this.socket.on("invite",this.callbackForInvite),this.socket.on("declineinvite",this.callbackForDeclineInvite),this.socket.on("chat",this.callbackForChat),this.socket.on("queue",this.callbackForQueue),this.socket.on("userlist",this.callbackForUserList)},t.login=function(e){this.socket.emit("login",{username:e})},t.logout=function(e){this.socket.emit("logout",{username:e})},t.joinChat=function(e,t,n){this.socket.emit("joinroom",{username:e,room:t,type:n})},t.leaveChat=function(e,t,n){this.socket.emit("exitroom",{username:e,room:t,type:n})},t.sendInvite=function(e,t,n,i,a,r,s){void 0===i&&(i=D.ChatRoom),void 0===a&&(a=!1),void 0===r&&(r=""),void 0===s&&(s={});var o={from:e,to:t,room:n,type:i,requiresAcceptDecline:a,subject:r,attachment:s};k("Sending invite"),k(o),this.socket.emit("invite",o)},t.sendMessage=function(e,t,n,i,a,r,s){void 0===r&&(r=N.Normal),void 0===s&&(s={});var o={from:e,room:t,message:n,created:i,priority:r,type:a,attachment:s};this.socket.emit("chat",o)},t.getUserList=function(){this.socket.emit("userlist")},t.sendDeclineInvite=function(e,t,n){this.socket.emit("declineinvite",{room:e,from:t,type:n})},t.callbackForMessage=function(e){k("Received message : "+e);try{k(e);var t=JSON.parse(e);this.chatReceivers.forEach((function(e){return e.receiveMessage(t)}))}catch(e){k(e),k("Not JSON data")}},t.callbackForLogin=function(e){k("Received login : "+e),this.chatReceivers.forEach((function(t){return t.receiveLogin(e)}))},t.callbackForUserList=function(e){k("Received user list : "+e),this.chatReceivers.forEach((function(t){return t.receiveUserList(e)}))},t.callbackForLogout=function(e){k("Received logout : "+e),this.chatReceivers.forEach((function(t){return t.receiveLogout(e)}))},t.callbackForJoinRoom=function(e){k("Received joined room : "+e);try{var t=JSON.parse(e);k(t),this.chatReceivers.forEach((function(e){return e.receiveJoinedRoom(t)}))}catch(e){k("Not JSON data")}},t.callbackForExitRoom=function(e){k("Received left room : "+e);try{var t=JSON.parse(e);k(t),this.chatReceivers.forEach((function(e){return e.receivedLeftRoom(t)}))}catch(e){k("Not JSON data")}},t.callbackForInvite=function(e){k("Received invite : "+e);try{var t=JSON.parse(e);k(t),this.chatReceivers.forEach((function(e){return e.receiveInvitation(t)}))}catch(e){k("Not JSON data")}},t.callbackForDeclineInvite=function(e){k("Received declined invite : "+e);try{var t=JSON.parse(e);k(t),this.chatReceivers.forEach((function(e){return e.receiveDecline(t.room,t.username,t.type)}))}catch(e){k(e),k("Not JSON data")}},t.callbackForChat=function(e){k("Received chat : "+e);try{var t=JSON.parse(e);k(t),this.chatReceivers.forEach((function(e){return e.receiveMessage(t)}))}catch(e){k("Not JSON data")}},t.callbackForQueue=function(e){k("Received queued items : "+e);try{var t=JSON.parse(e);k(t),t.invites&&t.invites.length>0&&this.chatReceivers.forEach((function(e){return e.receiveQueuedInvites(t.invites)})),t.messages&&t.messages.length>0&&this.chatReceivers.forEach((function(e){return e.receiveQueuedMessages(t.messages)}))}catch(e){k("Not JSON data")}},t.callbackForData=function(e){k("Received data");try{var t=JSON.parse(e);if(k(t),null===this.listener)return;t.user===this.listener.getCurrentUser()?k("change made by this user, ignoring"):(k("change made by another user, passing off to the application"),this.listener.handleDataChangedByAnotherUser(t))}catch(e){k("Not JSON data")}},e}();function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var O=g()("state-manager-async"),U=function(e){var t,n;function i(t,n){var i;(i=e.call(this,"async")||this).topLevelSM=t,i.wrappedSM=n,i.forceSaves=!1,i.wrappedSM.emitEvents();var a=i.wrappedSM.getConfiguredStateNames();return i.stateChanged=i.stateChanged.bind(R(i)),i.stateChangedItemAdded=i.stateChangedItemAdded.bind(R(i)),i.stateChangedItemRemoved=i.stateChangedItemRemoved.bind(R(i)),i.stateChangedItemUpdated=i.stateChangedItemUpdated.bind(R(i)),a.forEach((function(e){i.wrappedSM.addChangeListenerForName(e,R(i))})),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,A(t,n);var a=i.prototype;return a._addItemToState=function(e,t,n){void 0===n&&(n=!1),O("adding item to state "+e+" - is persisted "+n),this.wrappedSM.addNewItemToState(e,t,n)},a._getState=function(e){return O("getting state "+e),this.wrappedSM.getStateByName(e),{name:e,value:[]}},a._removeItemFromState=function(e,t,n,i){O("removing item from state "+e+" is persisted "+i),this.wrappedSM.removeItemFromState(e,t,n,i)},a._updateItemInState=function(e,t,n,i){O("updating item in state "+e),this.wrappedSM.updateItemInState(e,t,n,i)},a._ensureStatePresent=function(e){},a._addNewNamedStateToStorage=function(e){},a._replaceNamedStateInStorage=function(e){},a._saveState=function(e,t){},a.stateChangedItemRemoved=function(e,t,n){},a.stateChangedItemUpdated=function(e,t,n,i){},a.stateChanged=function(e,t,n){O("Wrapped SM has supplied new state "+t+" passing to top level SM"),O(n),this.topLevelSM.setStateByName(t,n)},a.stateChangedItemAdded=function(e,t,n){O("Wrapped SM has supplied new completed item for state "+t+" passing to top level SM"),this.topLevelSM.addNewItemToState(t,n,!0)},a.getListenerName=function(){return"Async Manager"},i}(E);function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var M,_=g()("state-manager-aggregate"),j=function(e){var t,n;function i(){var t;return(t=e.call(this,"aggregate")||this).stateManagers=[],t.emitEvents(),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,x(t,n),i.getInstance=function(){return i._instance||(i._instance=new i),i._instance};var a=i.prototype;return a.addStateManager=function(e,t,n){void 0===t&&(t=[]);var i={manager:e,filters:t};this.stateManagers.push(i),n||e.suppressEvents(),_("adding state manager with/without filters")},a._addNewNamedStateToStorage=function(e){var t=this;this.stateManagers.forEach((function(n){t.stateNameInFilters(e.name,n.filters)||n.manager._addNewNamedStateToStorage(e)}))},a._getState=function(e){var t=this,n={name:e,value:[]};return this.stateManagers.forEach((function(i){t.stateNameInFilters(n.name,i.filters)||(_("get state from state manager for state "+e),_(i.manager),i.manager._getState(e))})),this.stateManagers.length>0&&(n=this.stateManagers[0].manager._getState(e)),n},a._ensureStatePresent=function(e){var t=this;this.stateManagers.forEach((function(n){t.stateNameInFilters(e,n.filters)||n.manager._ensureStatePresent(e)}))},a._replaceNamedStateInStorage=function(e){var t=this;this.stateManagers.forEach((function(n){t.stateNameInFilters(e.name,n.filters)||n.manager._replaceNamedStateInStorage(e)}))},a._saveState=function(e,t){var n=this;this.stateManagers.forEach((function(i){n.stateNameInFilters(e,i.filters)||(_("saving state in state manager for state "+e),_(i.manager),_(t),i.manager._saveState(e,t))}))},a._addItemToState=function(e,t,n){var i=this;void 0===n&&(n=!1),this.stateManagers.forEach((function(a){i.stateNameInFilters(e,a.filters)||(_("adding item to state in  state manager for state "+e+", is persisted = "+n),_(a.manager),_(t),a.manager._addItemToState(e,t,n))}))},a._removeItemFromState=function(e,t,n,i){var a=this;this.stateManagers.forEach((function(r){a.stateNameInFilters(e,r.filters)||(_("removing item from state in state manager for state "+e+", is persisted = "+i),_(r.manager),_(t),r.manager._removeItemFromState(e,t,n,i))}))},a._updateItemInState=function(e,t,n,i){var a=this;this.stateManagers.forEach((function(r){a.stateNameInFilters(e,r.filters)||(_("updating item in state in  state manager for state "+e),_(r.manager),_(t),r.manager._updateItemInState(e,t,n,i))}))},a.stateNameInFilters=function(e,t){return t.findIndex((function(t){return t===e}))>=0},i}(E);function B(e,t){return e.id===t.id}function V(e,t){return e._id===t._id}!function(e){e[e.Incomplete=0]="Incomplete",e[e.Complete=1]="Complete",e[e.Persisted=2]="Persisted",e[e.PersistedLocally=3]="PersistedLocally"}(M||(M={}));var P="user",H="chatLog",W="exerciseType",q="workout",Y="recentUserSearch",G="/login",J="user",Q="exerciseType",z="userSearch",K="favourites",Z="exerciseTypes",X="exerciseTypes",ee="exercises",te="exerciseTypeDetail",ne="workoutDetail";function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ae=function(e){var t,n;function i(t){return e.call(this,t)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ie(t,n),i.prototype.show=function(e,t,n,i,a){var r=this;void 0===n&&(n=0),void 0===i&&(i="info"),void 0===a&&(a=3e3);var s=this.notificationManager.getContainerId(),o="";switch(i){case"info":o="bg-info";break;case"warning":o="bg-warning";break;case"message":o="bg-primary";break;case"priority":o="bg-danger";break;default:o="bg-info"}var d=document.createElement("div");d.className="notification toast",d.style.top=n+"px",d.setAttribute("role","alert"),d.setAttribute("data-autohide","false");var c=document.createElement("div");c.className="toast-header text-white "+o;var l=document.createElement("strong");l.className="mr-auto",l.textContent=e;var u=document.createElement("button");u.className="ml-2 mb-1 close",u.textContent="x",u.addEventListener("click",(function(){r.notificationManager.remove(d)}));var h=document.createElement("div");h.className="toast-body",h.textContent=t,c.appendChild(l),c.appendChild(u),d.appendChild(c),d.appendChild(h),d.classList.add("is-"+i);var m=document.getElementById(s);return m&&m.appendChild(d),$(".notification").toast("show"),a<=0&&(a=2e3),setTimeout((function(){r.notificationManager.remove(d)}),a),d},i}((function(e){this.show=this.show.bind(this),this.notificationManager=e,this.containerId=this.notificationManager.getContainerId()}));const re=new(function(){function e(){}return e.prototype.createNotification=function(e){return new ae(e)},e}()),se=function(){function e(){this.notifications=[],this.currentCount=0,this.offsetPerNotification=120,this.containerId="notifications",this.show=this.show.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getContainerId=function(){return this.containerId},t.show=function(e,t,n,i){void 0===n&&(n="info"),void 0===i&&(i=5e3);var a=re.createNotification(this).show(e,t,this.currentCount*this.offsetPerNotification,n,i);this.currentCount++,this.notifications.push(a)},t.remove=function(e){var t=this,n=this.notifications.findIndex((function(t){return t===e}));n>=0&&(this.notifications.splice(n,1),this.notifications.map((function(e,n){e.style.top=t.offsetPerNotification*n+"px"})));var i=e.parentElement;null!==i&&i.removeChild(e),this.currentCount--,this.currentCount<0&&(this.currentCount=0)},e}();var oe=g()("socket-listener"),de=function(){function e(){}var t=e.prototype;return t.handleDataChangedByAnotherUser=function(e){oe("Handling data change "+e.type+" on object type "+e.stateName+" made by user "+e.user);var t=Ke.getInstance().getStateManager().findItemInState(P,{_id:e.user},V),n="unknown";t&&(n=t.username),oe("Handling data change "+e.type+" on object type "+e.stateName+" made by user "+n);var i=e.data;oe(i);try{switch(e.type){case"create":switch(e.stateName){case P:Ke.getInstance().getStateManager().addNewItemToState(P,i,!0),se.getInstance().show(i.username,i.username+" has just registered.","message");break;case W:Ke.getInstance().getStateManager().addNewItemToState(W,i,!0)}break;case"update":switch(e.stateName){case W:Ke.getInstance().getStateManager().updateItemInState(W,i,V,!0)}break;case"delete":switch(e.stateName){case W:Ke.getInstance().getStateManager().removeItemFromState(W,i,V,!0)}}}catch(e){oe(e)}},t.handleMessage=function(e){oe("Received message: "+e)},t.getCurrentUser=function(){return Ke.getInstance().getLoggedInUserId()},e}(),ce=n(381),le=n.n(ce);function ue(e,t){return(ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var he,me=g()("local-storage"),fe=function(e){var t,n;function i(t){var n;return void 0===t&&(t=!1),(n=e.call(this,"browser")||this).configuration=[],n.storage=window.sessionStorage,t&&(n.storage=window.localStorage),n.forceSaves=!0,n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ue(t,n),i.getInstance=function(e){return void 0===e&&(e=!1),i._instance||(i._instance=new i(e)),i._instance};var a=i.prototype;return a._ensureStatePresent=function(e){null===this.storage.getItem(e)&&this._addNewNamedStateToStorage({name:e,value:[]})},a._addNewNamedStateToStorage=function(e){me("Local Storage: Saving with key "+e.name),me(e);var t=JSON.stringify(e.value);me(t),this.storage.setItem(e.name,t)},a._replaceNamedStateInStorage=function(e){this._addNewNamedStateToStorage(e)},a._getState=function(e){var t=[];me("Local Storage: Loading with key "+e);var n=this.storage.getItem(e);return me(n),null!==n&&(t=JSON.parse(n)),{name:e,value:t}},a._saveState=function(e,t){this._addNewNamedStateToStorage({name:e,value:t})},a._addItemToState=function(e,t,n){if(void 0===n&&(n=!1),n){var i=this._getState(e);me("adding item to state "+e),me(t),i.value.push(t),this._replaceNamedStateInStorage(i)}},a._removeItemFromState=function(e,t,n,i){var a=this._getState(e),r=a.value.findIndex((function(e){return n(e,t)}));r>=0&&(me("removing item from state "+e),me(t),a.value.splice(r,1)),this._replaceNamedStateInStorage(a)},a._updateItemInState=function(e,t,n,i){var a=this._getState(e),r=a.value.findIndex((function(e){return n(e,t)}));r>=0&&(a.value.splice(r,1,t),me("updating item in state "+e),me(t)),this._replaceNamedStateInStorage(a)},a.forceResetForGet=function(e){},a.getConfiguredStateNames=function(){return this.configuration},a.hasCompletedRun=function(e){return!1},a.initialise=function(e){this.configuration=e},i}(E),ge=n(4586);!function(e){e[e.LoggedOut=0]="LoggedOut",e[e.LoggedIn=1]="LoggedIn"}(he||(he={}));var ve=g()("chat-manager"),pe=function(){function e(){this.blockedList=[],this.favouriteList=[],this.loggedInUsers=[],this.currentUsername="",this.unreadListener=null,ve("Setting up chat logs, blocked list, and favourites"),this.chatLogs=[],this.chatListeners=[],this.chatUserListeners=[],this.localStorage=new fe(!0),T.getInstance().addChatReceiver(this),this.receiveLogin=this.receiveLogin.bind(this),this.receiveLogout=this.receiveLogout.bind(this),this.receiveInvitation=this.receiveInvitation.bind(this),this.receiveMessage=this.receiveMessage.bind(this),this.receiveQueuedMessages=this.receiveQueuedMessages.bind(this),this.receiveQueuedInvites=this.receiveQueuedInvites.bind(this),this.receiveJoinedRoom=this.receiveJoinedRoom.bind(this),this.receivedLeftRoom=this.receivedLeftRoom.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.addChatEventHandler=function(e){this.chatListeners.push(e)},t.addChatUserEventHandler=function(e){this.chatUserListeners.push(e)},t.isUserLoggedIn=function(e){return this.loggedInUsers.findIndex((function(t){return t===e}))>=0},t.receiveUserList=function(e){this.loggedInUsers=e,this.chatUserListeners.forEach((function(t){return t.handleLoggedInUsersUpdated(e)}))},t.addUserToBlockedList=function(e){var t=this;this.blockedList.findIndex((function(t){return t===e}))<0&&(this.blockedList.push(e),this.saveBlockedList(),this.chatUserListeners.forEach((function(e){return e.handleBlockedUsersChanged(t.favouriteList)})))},t.removeUserFromBlockedList=function(e){var t=this,n=this.blockedList.findIndex((function(t){return t===e}));n>=0&&(this.blockedList.splice(n,1),this.saveBlockedList(),this.chatUserListeners.forEach((function(e){return e.handleBlockedUsersChanged(t.favouriteList)})))},t.isUserInBlockedList=function(e){return this.blockedList.findIndex((function(t){return t===e}))>=0},t.addUserToFavouriteList=function(e){var t=this;this.favouriteList.findIndex((function(t){return t===e}))<0&&(this.favouriteList.push(e),this.saveFavouriteList(),this.chatUserListeners.forEach((function(e){return e.handleFavouriteUsersChanged(t.favouriteList)})))},t.removeUserFromFavouriteList=function(e){var t=this,n=this.favouriteList.findIndex((function(t){return t===e}));n>=0&&(this.favouriteList.splice(n,1),this.saveFavouriteList(),this.chatUserListeners.forEach((function(e){return e.handleFavouriteUsersChanged(t.favouriteList)})))},t.isUserInFavouriteList=function(e){return this.favouriteList.findIndex((function(t){return t===e}))>=0},t.getFavouriteUserList=function(){return[].concat(this.favouriteList)},t.getBlockedUserList=function(){return[].concat(this.blockedList)},t.setCurrentUser=function(t){ve("Setting current user "+t),this.currentUsername=t;var n=this.localStorage.getStateByName(e.chatLogKey+this.currentUsername);ve(n),n&&(this.chatLogs=n);var i=this.localStorage.getStateByName(e.blockedListKey+this.currentUsername);ve(i),i&&(this.blockedList=i);var a=this.localStorage.getStateByName(e.favouriteListKey+this.currentUsername);ve(a),a&&(this.favouriteList=a),this.chatListeners.forEach((function(e){return e.handleChatLogsUpdated()}))},t.getCurrentUser=function(){return this.currentUsername},t.receiveJoinedRoom=function(e){if(e.type===D.ChatRoom){var t=this.ensureChatLogExists(e.room);ve("User list for room "+e.room+" - "+e.userList.join(",")),t.users=e.userList;var n=parseInt(le()().format("YYYYMMDDHHmmss")),i=le()().format("DD/MM/YYYY HH:mm"),a={from:"",created:n,room:e.room,priority:0,type:D.ChatRoom,message:e.username+" joined the chat on "+i};t.messages.push(a),this.saveLogs(),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(t,!1)}))}},t.receivedLeftRoom=function(e){if(e.type===D.ChatRoom&&e.username!==this.currentUsername){var t=this.ensureChatLogExists(e.room);ve("User list for room "+e.room+" - "+e.userList.join(",")),t.users=e.userList;var n=parseInt(le()().format("YYYYMMDDHHmmss")),i=le()().format("DD/MM/YYYY HH:mm"),a={from:"",created:n,room:e.room,priority:0,type:D.ChatRoom,message:e.username+" left the chat on "+i};t.messages.push(a),this.saveLogs(),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(t,!1)}))}},t.receiveInvitation=function(e){if(e.type===D.ChatRoom)if(this.isUserInBlockedList(e.from))ve("User "+e.from+" blocked");else{ve("Invited to chat "+e.room);var t=this.doesChatRoomExist(e.room);ve(e),ve("Letting the listeners know, if they are all happy to accept then we will join the room");var n=!0;if(t||this.chatListeners.forEach((function(t){t.handleNewInviteReceived(e)||(n=!1)})),n){var i=this.ensureChatLogExists(e.room);i.type=e.type,e.userList&&e.userList.forEach((function(t){i.users.findIndex((function(e){return e===t}))<0&&i.users.push(e.from)})),i.users.findIndex((function(t){return t===e.from}))<0&&i.users.push(e.from),this.saveLogs(),ve("Joining chat "+e.room),T.getInstance().joinChat(this.getCurrentUser(),e.room,D.ChatRoom),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(i,!1)}))}}},t.receiveLogin=function(e){var t=this;ve("Handle login received for "+e),this.loggedInUsers.findIndex((function(t){return t===e}))<0&&this.loggedInUsers.push(e),ve(this.loggedInUsers),this.chatUserListeners.forEach((function(e){return e.handleLoggedInUsersUpdated(t.loggedInUsers)})),!this.isUserInBlockedList(e)&&this.isUserInFavouriteList(e)&&(ve("User "+e+" logging in"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedIn(e)})))},t.receiveLogout=function(e){var t=this,n=this.loggedInUsers.findIndex((function(t){return t===e}));n>=0&&this.loggedInUsers.splice(n,1),this.chatUserListeners.forEach((function(e){return e.handleLoggedInUsersUpdated(t.loggedInUsers)})),!this.isUserInBlockedList(e)&&this.isUserInFavouriteList(e)&&(ve("User "+e+" logging out"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedOut(e)})))},t.receiveDecline=function(e,t,n){n===D.ChatRoom&&t!==this.currentUsername&&(this.isUserInBlockedList(t)||(ve("User "+t+" declined invitation to room"),this.chatListeners.forEach((function(n){return n.handleInvitationDeclined(e,t)}))))},t.setUnreadCountListener=function(e){this.unreadListener=e},t.touchChatLog=function(e){var t=this.ensureChatLogExists(e);t.numOfNewMessages=0,t.lastViewed=parseInt(le()().format("YYYYMMDDHHmmss")),this.emitUnreadMessageCountChanged(),this.saveLogs()},t.getChatLog=function(e){var t=null,n=this.chatLogs.findIndex((function(t){return t.roomName===e}));return n>=0&&(t=this.chatLogs[n]),t},t.receiveMessage=function(e,t){if(void 0===t&&(t=!1),e.type===D.ChatRoom&&e.from!==this.getCurrentUser())if(this.isUserInBlockedList(e.from))ve("Message received from user "+e.from+" - is in blocked list, not passed on.");else{var n=this.ensureChatLogExists(e.room);this.addSenderToRoomIfNotAlreadyPresent(n,e.from),this.addMessageToChatLog(n,e),ve("Message received"),ve(e),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(n,t)}))}},t.receiveQueuedInvites=function(e){var t=this;e.forEach((function(e){t.receiveInvitation(e)}))},t.receiveQueuedMessages=function(e){var t=this;e.forEach((function(e){t.receiveMessage(e,!0)})),this.chatListeners.forEach((function(t){return t.handleOfflineMessagesReceived(e)}))},t.joinChat=function(e){0!==this.getCurrentUser().trim().length&&(this.ensureChatLogExists(e),T.getInstance().joinChat(this.getCurrentUser(),e,D.ChatRoom))},t.leaveChat=function(e){0!==this.getCurrentUser().trim().length&&(this.removeChatLog(e),T.getInstance().leaveChat(this.getCurrentUser(),e,D.ChatRoom),this.emitUnreadMessageCountChanged())},t.login=function(){var e=this;0!==this.getCurrentUser().trim().length&&(T.getInstance().login(this.getCurrentUser()),T.getInstance().getUserList(),this.chatLogs.forEach((function(t){t.type===D.ChatRoom&&T.getInstance().joinChat(e.currentUsername,t.roomName,D.ChatRoom)})))},t.logout=function(){0!==this.getCurrentUser().trim().length&&T.getInstance().logout(this.getCurrentUser())},t.declineInvite=function(e){0!==this.getCurrentUser().trim().length&&T.getInstance().sendDeclineInvite(e,this.getCurrentUser(),D.ChatRoom)},t.sendInvite=function(e,t,n,i,a){void 0===n&&(n=D.ChatRoom),void 0===i&&(i=!1),void 0===a&&(a=""),0!==this.getCurrentUser().trim().length&&(this.isUserInBlockedList(e)||this.ensureChatLogExists(t).users.findIndex((function(t){return t===e}))<0&&T.getInstance().sendInvite(this.getCurrentUser(),e,t,n,i,a))},t.sendMessage=function(e,t,n,i){if(void 0===n&&(n=N.Normal),0===this.getCurrentUser().trim().length)return null;var a=this.ensureChatLogExists(e),r=parseInt(le()().format("YYYYMMDDHHmmss"));T.getInstance().sendMessage(this.getCurrentUser(),e,t,r,D.ChatRoom,N.Normal,{}),i||(i={});var s={from:this.getCurrentUser(),room:e,message:t,created:r,priority:n,type:D.ChatRoom,attachment:i};return this.addMessageToChatLog(a,s),s},t.getChatLogs=function(){return[].concat(this.chatLogs)},t.startChatWithUser=function(e){var t=null;if(e){ve("Starting chat with "+e);var n=this.ensureChatLogExistsWithUser(e);this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(n,!1)})),T.getInstance().sendInvite(this.getCurrentUser(),e,n.roomName,D.ChatRoom,!1,""),T.getInstance().joinChat(this.getCurrentUser(),n.roomName,D.ChatRoom),t=n.roomName}return t},t.saveLogs=function(){this.localStorage.setStateByName(e.chatLogKey+this.currentUsername,this.chatLogs,!1)},t.saveBlockedList=function(){this.localStorage.setStateByName(e.blockedListKey+this.currentUsername,this.blockedList,!1)},t.saveFavouriteList=function(){this.localStorage.setStateByName(e.favouriteListKey+this.currentUsername,this.favouriteList,!1)},t.ensureChatLogExists=function(e){var t,n=this.chatLogs.findIndex((function(t){return t.roomName===e}));return n<0?(t={roomName:e,users:[this.getCurrentUser()],messages:[],lastViewed:parseInt(le()().format("YYYYMMDDHHmmss")),numOfNewMessages:0,type:D.ChatRoom},this.chatLogs.push(t),this.saveLogs()):t=this.chatLogs[n],t},t.ensureChatLogExistsWithUser=function(e){for(var t=null,n=0;n<this.chatLogs.length;){var i=this.chatLogs[n];2===i.users.length&&i.users.findIndex((function(t){return t===e}))>=0&&(t=i,n=this.chatLogs.length),n++}return t||(t={roomName:(0,ge.Z)(),users:[this.getCurrentUser(),e],messages:[],lastViewed:parseInt(le()().format("YYYYMMDDHHmmss")),numOfNewMessages:0,type:D.ChatRoom},this.chatLogs.push(t),this.saveLogs()),t},t.doesChatRoomExist=function(e){return this.chatLogs.findIndex((function(t){return t.roomName===e}))>=0},t.emitUnreadMessageCountChanged=function(){var e,t=0;this.chatLogs.forEach((function(e){t+=e.numOfNewMessages})),null==(e=this.unreadListener)||e.countChanged(t)},t.addMessageToChatLog=function(e,t){e.numOfNewMessages++,e.messages.push(t),this.emitUnreadMessageCountChanged(),t.from===this.getCurrentUser()?this.touchChatLog(e.roomName):this.saveLogs()},t.addSenderToRoomIfNotAlreadyPresent=function(e,t){e.users.findIndex((function(e){return e===t}))<0&&e.users.push(t)},t.removeChatLog=function(e){var t=this.chatLogs.findIndex((function(t){return t.roomName===e}));if(t>=0){ve("Removing Chat log for room "+e);var n=this.chatLogs.splice(t,1);ve(n.length),this.saveLogs()}},e}();pe.chatLogKey="im-board-chat-logs",pe.blockedListKey="im-board-blocked-list",pe.favouriteListKey="im-board-favourite-list";var Ce,Ie,be=g()("notification-controller"),ye=function(){function e(){this.doNotDisturb=!1,this.chatManager=pe.getInstance(),this.doNotDisturb=!1,this.chatListeners=[],this.chatUserListeners=[],this.handleChatLogUpdated=this.handleChatLogUpdated.bind(this),this.handleLoggedInUsersUpdated=this.handleLoggedInUsersUpdated.bind(this),this.handleFavouriteUserLoggedIn=this.handleFavouriteUserLoggedIn.bind(this),this.handleFavouriteUserLoggedOut=this.handleFavouriteUserLoggedOut.bind(this),this.chatManager.addChatEventHandler(this),this.chatManager.addChatUserEventHandler(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.handleInvitationDeclined=function(e,t){this.doNotDisturb||se.getInstance().show("Room","User "+t+" has declined the invitation to join you.","info",7e3)},t.handleNewInviteReceived=function(e){return e.type===D.ScoreSheet||(this.doNotDisturb&&!e.requiresAcceptDecline||e.requiresAcceptDecline||se.getInstance().show("Chat Room","User "+e.from+" has invited you.","info",7e3),!0)},t.addListener=function(e){this.chatListeners.push(e)},t.addUserListener=function(e){this.chatUserListeners.push(e)},t.setDoNotDisturb=function(e){void 0===e&&(e=!0),this.doNotDisturb=e},t.blackListUser=function(e,t){void 0===t&&(t=!0),t?this.chatManager.addUserToBlockedList(e):this.chatManager.removeUserFromBlockedList(e)},t.favouriteUser=function(e,t){void 0===t&&(t=!0),t?this.chatManager.addUserToFavouriteList(e):this.chatManager.removeUserFromFavouriteList(e)},t.isFavouriteUser=function(e){return this.chatManager.isUserInFavouriteList(e)},t.isBlockedUser=function(e){return this.chatManager.isUserInBlockedList(e)},t.handleChatLogsUpdated=function(){this.chatListeners.forEach((function(e){return e.handleChatLogsUpdated()}))},t.handleChatLogUpdated=function(e,t){if(void 0===t&&(t=!1),be("Handle chat log updated"),be(e),this.chatListeners.forEach((function(n){return n.handleChatLogUpdated(e,t)})),!this.doNotDisturb&&!t&&e.messages.length>0){var n=e.messages[e.messages.length-1];se.getInstance().show(n.from,n.message,"message",3e3)}},t.handleLoggedInUsersUpdated=function(e){be("Handle logged in users updated"),be(e),this.chatUserListeners.forEach((function(t){return t.handleLoggedInUsersUpdated(e)}))},t.handleFavouriteUserLoggedIn=function(e){be("Handle favourite user "+e+" logged in"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedIn(e)})),this.doNotDisturb||se.getInstance().show(e,"User "+e+" has logged in.","warning",5e3)},t.handleFavouriteUserLoggedOut=function(e){be("Handle favourite user "+e+" logged out"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedOut(e)})),this.doNotDisturb||se.getInstance().show(e,"User "+e+" has logged out.","priority",4e3)},t.handleBlockedUsersChanged=function(e){be("Handle blocked users changed to "+e),this.chatUserListeners.forEach((function(t){return t.handleBlockedUsersChanged(e)}))},t.handleFavouriteUsersChanged=function(e){be("Handle favourite users changed to "+e),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUsersChanged(e)}))},t.startChatWithUser=function(e){return pe.getInstance().startChatWithUser(e)},t.handleChatStarted=function(e){this.chatListeners.forEach((function(t){return t.handleChatStarted(e)}))},t.handleOfflineMessagesReceived=function(e){this.doNotDisturb||0!==e.length&&se.getInstance().show("Offline messages received","You have received "+e.length+" messages since you last logged out.")},e}();function we(){return(we=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function Ee(e,t,n,i,a,r,s){try{var o=e[r](s),d=o.value}catch(e){return void n(e)}o.done?t(d):Promise.resolve(d).then(i,a)}!function(e){e[e.POST=0]="POST",e[e.GET=1]="GET",e[e.PUT=2]="PUT",e[e.DELETE=3]="DELETE"}(Ce||(Ce={})),function(e){e[e.PRIORITY=0]="PRIORITY",e[e.BACKGROUND=1]="BACKGROUND"}(Ie||(Ie={}));var Le=g()("api-ts");const Se=new(function(){function e(){}var t=e.prototype;return t.postFetchJSON=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n})},e.next=3,fetch(t,i);case 3:return a=e.sent,e.abrupt("return",a.json());case 5:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function s(e){Ee(r,i,a,s,o,"next",e)}function o(e){Ee(r,i,a,s,o,"throw",e)}s(void 0)}))});return function(e,n){return t.apply(this,arguments)}}(),t.apiFetchJSONWithPost=function(e){Le("Executing fetch with URL "+e.originalRequest.url+" with body "+e.originalRequest.params);try{JSON.stringify(e.originalRequest.params)}catch(t){Le("Unable to convert parameters to JSON"),Le(e.originalRequest.params,100),e.callback(null,404,e.queueType,e.requestId)}var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(we({},e.originalRequest.params))};this.fetchJSON(e.originalRequest.url,t,e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithGet=function(e){Le("Executing GET fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id),e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,{method:"GET",headers:{"Content-Type":"application/json"}},e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithDelete=function(e){Le("Executing DELETE fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id),e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,{method:"DELETE",headers:{"Content-Type":"application/json"}},e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithPut=function(e){Le("Executing PUT fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id);var t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(we({},e.originalRequest.params))};e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,t,e.callback,e.queueType,e.requestId)},t.fetchJSON=function(e,t,n,i,a){fetch(e,t).then((function(e){if(Le("Response code was "+e.status),e.status>=200&&e.status<=299)return e.json();400===e.status&&Le(e.json())})).then((function(e){Le(e),n(e,200,i,a)})).catch((function(e){Le(e),n(null,500,i,a)}))},e}());function Fe(e,t,n,i,a,r,s){try{var o=e[r](s),d=o.value}catch(e){return void n(e)}o.done?t(d):Promise.resolve(d).then(i,a)}function Ne(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function s(e){Fe(r,i,a,s,o,"next",e)}function o(e){Fe(r,i,a,s,o,"throw",e)}s(void 0)}))}}var De=g()("api-ts");const ke=function(){function e(){this.backgroundQueue=[],this.priorityQueue=[],this.inProgress=[],this.backgroundChangeListener=null,this.priorityChangeListener=null,this.callbackForQueueRequest=this.callbackForQueueRequest.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.setBackgroundChangeListener=function(e){this.backgroundChangeListener=e},t.setPriorityChangeListener=function(e){this.priorityChangeListener=e},t.getPriorityQueueCount=function(){return this.priorityQueue.length},t.getBackgroundQueueCount=function(){return this.backgroundQueue.length},t.addQLApiRequest=function(e,t,n,i,a,r){void 0===r&&(r=!1);var s={url:e,type:Ce.POST,params:{query:t,variables:n},callback:i,associatedStateName:a};this.addApiRequest(s,r)},t.addQLMutationRequest=function(e,t,n,i,a,r){void 0===r&&(r=!1);var s={url:e,type:Ce.POST,params:{mutation:t,variables:n},callback:i,associatedStateName:a};this.addApiRequest(s,r)},t.addApiRequest=function(e,t){void 0===t&&(t=!1);var n=(0,ge.Z)();if(De("Download Manger: Adding Queue Request "+n),De(e,200),t){var i={originalRequest:e,requestId:n,queueType:Ie.PRIORITY,callback:this.callbackForQueueRequest};this.priorityQueue.push(i),this.priorityChangeListener&&this.priorityChangeListener.handleEventAddToQueue()}else{var a={originalRequest:e,requestId:n,queueType:Ie.BACKGROUND,callback:this.callbackForQueueRequest};this.backgroundQueue.push(a),this.backgroundChangeListener&&this.backgroundChangeListener.handleEventAddToQueue()}this.processQueues()},t.processPriorityQueue=function(){var e=Ne(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==(t=this.priorityQueue.shift())&&this.inProgress.push(t),void 0!==t&&this.initiateFetchForQueueItem(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processBackgroundQueue=function(){var e=Ne(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==(t=this.backgroundQueue.shift())&&this.inProgress.push(t),void 0!==t&&this.initiateFetchForQueueItem(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processQueues=function(){var e=Ne(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.priorityQueue.length+this.backgroundQueue.length;case 1:if(!(t>0)){e.next=14;break}if(De("Download Manager: processing queue, items remaining "+t),!(this.priorityQueue.length>0)){e.next=8;break}return e.next=6,this.processPriorityQueue();case 6:e.next=11;break;case 8:if(!(this.backgroundQueue.length>0)){e.next=11;break}return e.next=11,this.processBackgroundQueue();case 11:t=this.priorityQueue.length+this.backgroundQueue.length,e.next=1;break;case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.callbackForQueueRequest=function(e,t,n,i){n===Ie.PRIORITY?this.priorityChangeListener&&this.priorityChangeListener.handleEventRemoveFromQueue():this.backgroundChangeListener&&this.backgroundChangeListener.handleEventRemoveFromQueue(),De("Download Manager: received callback for queue "+n+" request "+i+" with status "+t);var a=this.inProgress.findIndex((function(e){return e.requestId===i}));if(a>=0){var r=this.inProgress[a];this.inProgress.splice(a,1),De(r),De("Download Manager: finished for queue item "+r.requestId),r.originalRequest.callback(e,t,r.originalRequest.associatedStateName)}},t.initiateFetchForQueueItem=function(e){if(De("Download Manager: initiating fetch for queue item "+e.requestId),De(e),null!==e.originalRequest.url&&null!=e.originalRequest.params&&null!=e.originalRequest.callback)switch(e.originalRequest.type){case Ce.POST:Se.apiFetchJSONWithPost(e);break;case Ce.GET:Se.apiFetchJSONWithGet(e);break;case Ce.DELETE:Se.apiFetchJSONWithDelete(e);break;case Ce.PUT:Se.apiFetchJSONWithPut(e)}},e}();var Te,Re=g()("state-manager-api"),Ae=function(){function e(){this.configuration=[],this.delegate=new y("restapi"),this.emitEvents(),this.bHasCompletedRun=[],this.callbackForAddItem=this.callbackForAddItem.bind(this),this.callbackForRemoveItem=this.callbackForRemoveItem.bind(this),this.callbackForUpdateItem=this.callbackForUpdateItem.bind(this),this.callbackForGetItems=this.callbackForGetItems.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getConfiguredStateNames=function(){var e=[];return this.configuration.forEach((function(t){e.push(t.stateName)})),e},t.hasCompletedRun=function(e){var t=!1,n=this.configuration.findIndex((function(t){return t.stateName===e}));return n>=0&&(t=this.bHasCompletedRun[n]),t},t.setCompletedRun=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!0)},t.forceResetForGet=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!1)},t.initialise=function(e){this.configuration=e;var t=[];this.configuration.forEach((function(e){t.push(!1)})),this.bHasCompletedRun=t},t._addNewNamedStateToStorage=function(e){},t._getState=function(e){if(Re("Getting All "+e),this.hasCompletedRun(e))Re("Getting All "+e+" - not done - previously retrieved");else{var t=this.getConfigurationForStateName(e);if(t.isActive){var n={url:t.serverURL+t.api,type:Ce.GET,params:{},callback:this.callbackForGetItems,associatedStateName:e};ke.getInstance().addApiRequest(n,!0)}else Re("No configuration for state "+e)}return{name:e,value:[]}},t._ensureStatePresent=function(e){},t._replaceNamedStateInStorage=function(e){},t._saveState=function(e,t){},t._addItemToState=function(e,t,n){if(void 0===n&&(n=!1),!n){Re("Adding item to "+e),Re(t);var i=this.getConfigurationForStateName(e);if(i.isActive){var a={url:i.serverURL+i.api,type:Ce.POST,params:t,callback:this.callbackForAddItem,associatedStateName:e};ke.getInstance().addApiRequest(a,!0)}else Re("No configuration for state "+e)}},t._removeItemFromState=function(e,t,n,i){if(!i){Re("Removing item from "+e),Re(t);var a=this.getConfigurationForStateName(e),r=t.id;if(a.idField&&(r=t[a.idField]),a.isActive){var s={url:a.serverURL+a.api,type:Ce.DELETE,params:{id:r},callback:this.callbackForRemoveItem,associatedStateName:e};ke.getInstance().addApiRequest(s,!0)}else Re("No configuration for state "+e)}},t._updateItemInState=function(e,t,n,i){if(!i){Re("Updating item in "+e),Re(t);var a=this.getConfigurationForStateName(e);if(a.isActive){var r={url:a.serverURL+a.api,type:Ce.PUT,params:t,callback:this.callbackForUpdateItem,associatedStateName:e};ke.getInstance().addApiRequest(r,!0)}else Re("No configuration for state "+e)}},t.addChangeListenerForName=function(e,t){this.delegate.addChangeListenerForName(e,t)},t.addNewItemToState=function(e,t,n){this._addItemToState(e,t,n)},t.emitEvents=function(){this.delegate.emitEvents()},t.findItemInState=function(e,t,n){throw Error("not implemented")},t.getStateByName=function(e){this._getState(e)},t.informChangeListenersForStateWithName=function(e,t,n,i){this.delegate.informChangeListenersForStateWithName(e,t,n,i)},t.isItemInState=function(e,t,n){return!0},t.removeItemFromState=function(e,t,n,i){return Re("Removing item from state "+e+" is persisted "+i),Re(t),this._removeItemFromState(e,t,n,i),!0},t.setStateByName=function(e,t,n){},t.suppressEvents=function(){this.delegate.suppressEvents()},t.updateItemInState=function(e,t,n,i){return this._updateItemInState(e,t,n,i),!0},t.getConfigurationForStateName=function(e){var t={stateName:e,serverURL:"",api:"",isActive:!1},n=this.configuration.findIndex((function(t){return t.stateName===e}));return n>=0&&(t=this.configuration[n]),t},t.callbackForRemoveItem=function(e,t,n){Re("callback for remove item for state "+n+" with status "+t+" - not forwarded"),t>=200&&t<=299&&Re(e)},t.callbackForUpdateItem=function(e,t,n){Re("callback for update item for state "+n+" with status "+t+" - not forwarded"),t>=200&&t<=299&&Re(e)},t.callbackForGetItems=function(e,t,n){Re("callback for get items for state "+n+" with status "+t+" - FORWARDING"),t>=200&&t<=299&&(Re(e),this.setCompletedRun(n),this.delegate.informChangeListenersForStateWithName(n,e,p.StateChanged,null))},t.callbackForAddItem=function(e,t,n){Re("callback for add item for state "+n+" with status "+t+" - FORWARDING"),t>=200&&t<=299&&(Re(e),this.delegate.informChangeListenersForStateWithName(n,e,p.ItemAdded,null))},e}();!function(e){e.id="Id",e.uuid="UUID",e.text="Text",e.integer="Integer",e.float="Number",e.date="Date",e.time="Time",e.shortTime="Short Time",e.datetime="Datetime",e.email="Email",e.password="Password",e.boolean="True/False",e.userId="User",e.choice="Choice",e.limitedChoice="Limited Choice",e.largeText="TextArea",e.collection="Collection",e.duration="Duration"}(Te||(Te={}));var Oe=g()("basic-field-operations-formatter"),Ue=g()("basic-field-operations-validator"),xe=g()("basic-field-operations-generator"),Me=g()("basic-field-operations-renderer"),_e=function(){function e(){this.previousFieldValues=[]}var t=e.prototype;return t.setSubElements=function(e){},t.formatValue=function(e,t){Oe("Handling format value for field "+e.displayName+" with value "+t);var n=t;switch(e.type){case Te.date:n=le()(t,"DD/MM/YYYY").format("YYYYMMDD");break;case Te.datetime:n=le()(t,"DD/MM/YYYY HH:mm:ss").format("YYYYMMDDHHmmss");break;case Te.boolean:n="true"===t.toLowerCase();break;case Te.id:e.idType===a.number&&(n=parseInt(t));break;case Te.float:var i=parseFloat(t);isNaN(i)||(n=i);break;case Te.integer:var r=parseFloat(t);isNaN(r)||(n=r)}return Oe("Handling format value for field "+e.displayName+" with value "+t+" - result is "+n),n},t.isValidValue=function(t,n){Ue("Handling is valid value for field "+t.displayName+" with value "+n);var i={isValid:!0,resetOnFailure:!1};if(t.mandatory){if(!n||0===n.trim().length)return i.isValid=!1,i.message=t.displayName+" is required. Please enter a valid value.",Ue("Handling is valid value for field "+t.displayName+" with value "+n+" - is valid is "+i.isValid+" with message "+i.message),i;if(t.type===Te.boolean&&"true"!==n.trim().toLowerCase())return i.isValid=!1,i.message=t.displayName+" is required and must be selected.",Ue("Handling is valid value for field "+t.displayName+" with value "+n+" - is valid is "+i.isValid+" with message "+i.message),i}if(n)switch(t.type){case Te.datetime:i.isValid=e.dateTimeRegex.test(n),i.isValid||(i.message=t.displayName+" must be DD/MM/YYYY hh:mm");break;case Te.date:i.isValid=e.dateRegex.test(n),i.isValid||(i.message=t.displayName+" must be DD/MM/YYYY");break;case Te.float:i.isValid=e.floatRegexp.test(n),i.isValid||(i.message=t.displayName+" must be 00.00");break;case Te.id:i.isValid=e.integerRegex.test(n),i.isValid||(i.message=t.displayName+" must be an integer");break;case Te.email:i.isValid=e.emailRegex.test(n),i.isValid||(i.message=t.displayName+" must be an email address");break;case Te.integer:i.isValid=e.integerRegex.test(n),i.isValid||(i.message=t.displayName+" must be an integer");break;case Te.text:break;case Te.password:i.isValid=e.basicPasswordRegex.test(n),i.isValid||(i.message=t.displayName+" must be 8 to 15 letters and digits only");break;case Te.time:i.isValid=e.timeRegex.test(n),i.isValid||(i.message=t.displayName+" must be 24 hour time format HH:MM:SS");break;case Te.shortTime:i.isValid=e.shortTimeRegex.test(n),i.isValid||(i.message=t.displayName+" must be 24 hour time format HH:MM");break;case Te.duration:i.isValid=e.durationRegexp.test(n),i.isValid||(i.message=t.displayName+" must be in the format MM:SS or 999:MM:SS");break;case Te.boolean:i.isValid=e.booleanRegexp.test(n),i.isValid||(i.message=t.displayName+" must be true or false")}return Ue("Handling is valid value for field "+t.displayName+" with value "+n+" - is valid is "+i.isValid+" with message "+i.message),i},t.setPreviousValue=function(e,t){var n;Me("Storing previous value for field "+e.displayName+" with  new value "+t);var i=this.previousFieldValues.findIndex((function(t){return t.id===e.id}));i>=0?(n=this.previousFieldValues[i],Me("Storing previous value for field "+e.displayName+" with new value "+t+" - old value was "+n),n.value=t):(n={id:e.id,value:t},Me("Storing previous value for field "+e.displayName+" with new value "+t+" - NO previous"),this.previousFieldValues.push(n))},t.renderValue=function(e,t){if(Me("Rendering value for field "+e.displayName+" with new value "+t),t){var n=t;switch(e.type){case Te.date:n=le()(t,"YYYYMMDD").format("DD/MM/YYYY");break;case Te.datetime:n=le()(t,"YYYYMMDDHHmmss").format("DD/MM/YYYY HH:mm:ss")}return this.setPreviousValue(e,n),Me("Rendering value for field "+e.displayName+" with new value "+t+" - rendered to "+n),n}return Me("Rendering value for field "+e.displayName+" with new value is empty - no rendering required"),null},t.generateValue=function(e){var t="";switch(e.type){case Te.datetime:t=le()().format("YYYYMMDDHHmmss");break;case Te.date:t=le()().format("YYYYMMDD");break;case Te.float:t="0.0";break;case Te.id:t="-1";break;case Te.email:t="me@me.com";break;case Te.integer:t="0";break;case Te.text:case Te.password:t="";break;case Te.time:t="00:00:00";break;case Te.shortTime:case Te.duration:t="00:00";break;case Te.boolean:t="false";break;case Te.uuid:t=(0,ge.Z)();break;case Te.userId:t=""+Ke.getInstance().getLoggedInUsername()}return t},t.generate=function(e,t){var n="";return e.generator&&(e.generator.onCreation&&t&&(n=this.generateValue(e),xe("Generating value for field "+e.displayName+" with on creation "+n)),e.generator.onModify&&!t&&(n=this.generateValue(e),xe("Generating value for field "+e.displayName+" with on modify "+n))),n},e}();_e.dateRegex=/^(0[1-9]|1\d|2\d|3[01])\/(0[1-9]|1[0-2])\/(19|20)\d{2}$/,_e.emailRegex=/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()\.,;\s@\"]+\.{0,1})+([^<>()\.,;:\s@\"]{2,}|[\d\.]+))$/,_e.shortTimeRegex=/^([01]\d|2[0-3]):?([0-5]\d)$/,_e.timeRegex=/^([01]\d|2[0-3]):?([0-5]\d):?([0-5]\d)$/,_e.dateTimeRegex=/^(0[1-9]|1\d|2\d|3[01])\/(0[1-9]|1[0-2])\/(19|20)\d{2}\s([01]\d|2[0-3]):?([0-5]\d):?([0-5]\d)$/,_e.basicPasswordRegex=/^[a-zA-Z0-9]{8,15}$/,_e.integerRegex=/^[+-]?\d+$/,_e.floatRegexp=/^[+-]?\d+(\.\d+)?$/,_e.booleanRegexp=/^true|false$/,_e.durationRegexp=/^(\d+:)?[0-5]?\d:[0-5]\d$/;var je="createdOn",Be="modifiedOn",Ve="Created By",Pe="Last Modified By",He="Created On",We="Last Modified On",qe=function(){function e(){}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.generateStartingDisplayOrder=function(e){var t=[];return e.fields.forEach((function(e,n){var i={fieldId:e.id,displayOrder:n};e.id===je&&(i.displayOrder+=100),e.id===Be&&(i.displayOrder+=101),e.type===Te.userId&&(i.displayOrder+=100),t.push(i)})),t},t.createBasicObjectDefinition=function(e,t,n,i,r,s){void 0===r&&(r=!0),void 0===s&&(s="id");var o={id:e,displayName:t,fields:[]},d=new _e;if(n){var c=Te.id;i&&(c=Te.uuid);var l={id:s,isKey:!0,idType:a.number,type:c,displayName:"Id",mandatory:!0,generator:{generator:d,onModify:!1,onCreation:!0}};o.fields.push(l)}return r&&(this.addCreatedDateToArray(o.fields),this.addCreatedByToArray(o.fields),this.addModifiedByToArray(o.fields),this.addModifiedDateToArray(o.fields)),o},t.addCreatedDateToArray=function(e){var t=this.addStringFieldToArray(e,je,He,Te.datetime,!0,He);t.generator={generator:new _e,onCreation:!0,onModify:!1},t.displayOnly=!0},t.addModifiedDateToArray=function(e){var t=this.addStringFieldToArray(e,Be,We,Te.datetime,!0,We);t.generator={generator:new _e,onCreation:!0,onModify:!0},t.displayOnly=!0},t.addCreatedByToArray=function(e){var t=this.addNumericFieldToArray(e,"createdBy",Ve,Te.userId,!0,Ve);t.generator={generator:new _e,onCreation:!0,onModify:!1},t.displayOnly=!0},t.addModifiedByToArray=function(e){var t=this.addStringFieldToArray(e,"modifiedBy",Pe,Te.userId,!0,Pe);t.generator={generator:new _e,onCreation:!0,onModify:!0},t.displayOnly=!0},t.addFieldToArray=function(e,t,n,i,a,r,s,o){void 0===r&&(r=!1),void 0===s&&(s=null),void 0===o&&(o=null);var d={id:n,isKey:!1,idType:t,type:a,displayName:i,mandatory:r,displayOnly:!1};return r&&(d.generator={generator:new _e,onCreation:!0,onModify:!1}),s&&(d.description=s),o&&(d.dataSource=o),e.push(d),d},t.addStringFieldToArray=function(e,t,n,i,r,s,o){return void 0===r&&(r=!1),void 0===s&&(s=null),void 0===o&&(o=null),this.addFieldToArray(e,a.string,t,n,i,r,s,o)},t.addNumericFieldToArray=function(e,t,n,i,r,s,o){return void 0===r&&(r=!1),void 0===s&&(s=null),void 0===o&&(o=null),this.addFieldToArray(e,a.string,t,n,i,r,s,o)},t.addStringFieldToObjDefinition=function(e,t,n,i,a,r,s){return void 0===a&&(a=!1),void 0===r&&(r=null),void 0===s&&(s=null),this.addStringFieldToArray(e.fields,t,n,i,a,r,s)},t.addNumericFieldToObjDefinition=function(e,t,n,i,a,r,s){return void 0===a&&(a=!1),void 0===r&&(r=null),void 0===s&&(s=null),this.addNumericFieldToArray(e.fields,t,n,i,a,r,s)},e}(),Ye=g()("object-definition-registry"),Ge=function(){function e(){this.definitions=[]}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.findDefinition=function(e){var t=null,n=this.definitions.findIndex((function(t){return t.id===e}));return n>=0&&(t=this.definitions[n]),t},t.addDefinition=function(e,t,n,i,a,r){void 0===a&&(a=!0),void 0===r&&(r="id"),Ye("Adding definition for "+e+" with name "+t);var s=this.findDefinition(e);if(s)return s;var o=qe.getInstance().createBasicObjectDefinition(e,t,n,i,a,r);return this.definitions.push(o),o},t.createInstanceFromDef=function(e){Ye("Creating instance for definition "+e.displayName);var t={},n=new _e;return e.fields.forEach((function(e){if(e.generator&&e.generator.onCreation){var i=e.generator.generator.generate(e,!0);switch(e.type){case Te.date:case Te.datetime:break;default:i=n.formatValue(e,i)}Ye("Setting default values for "+e.displayName+" to "+i),t[e.id]=i}e.type===Te.collection&&(t[e.id]=[])})),t},t.createInstance=function(e){Ye("Creating instance for definition "+e);var t={},n=this.findDefinition(e);return n&&(t=this.createInstanceFromDef(n)),t},e}(),Je=function(){function e(e){this.options=e,this.listeners=[]}var t=e.prototype;return t.addValueOption=function(e,t){var n=this;this.options.push({name:e,value:t}),this.listeners.forEach((function(e){return e.optionsChanged(n.options)}))},t.addListener=function(e){this.listeners.push(e)},t.getOptions=function(){return this.options},e}();function Qe(){return(Qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var ze=g()("controller-ts"),$e=g()("controller-ts-detail"),Ke=function(){function e(){}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.connectToApplication=function(e,t){this.applicationView=e,this.clientSideStorage=t;var n=Ae.getInstance();n.initialise([{stateName:P,serverURL:"",api:"/api/users",isActive:!0},{stateName:W,serverURL:"",api:"/api/exercise-types",isActive:!0,idField:"_id"},{stateName:q,serverURL:"",api:"/api/workouts",isActive:!0,idField:"_id"}]);var i=j.getInstance(),a=F.getInstance(),r=new U(i,n);return i.addStateManager(a,[],!1),i.addStateManager(r,[],!1),this.stateManager=i,this.stateChanged=this.stateChanged.bind(this),this.stateChangedItemAdded=this.stateChangedItemAdded.bind(this),this.stateChangedItemRemoved=this.stateChangedItemRemoved.bind(this),this.stateChangedItemUpdated=this.stateChangedItemUpdated.bind(this),this.setupDataObjectDefinitions(),this},t.setupDataObjectDefinitions=function(){var e=Ge.getInstance().addDefinition(W,"Exercise",!0,!0,!0,"_id");qe.getInstance().addStringFieldToObjDefinition(e,"name","Name",Te.text,!0,"Exercise name"),qe.getInstance().addStringFieldToObjDefinition(e,"type","Type",Te.limitedChoice,!0,"Choose cardio or strength",new Je([{name:"Cardio",value:"cardio"},{name:"Strength",value:"strength"}])),qe.getInstance().addStringFieldToObjDefinition(e,"duration","Duration",Te.duration,!0,"Exercise time"),qe.getInstance().addStringFieldToObjDefinition(e,"sets","Sets",Te.integer,!1,"Number of sets"),qe.getInstance().addStringFieldToObjDefinition(e,"reps","Repetitions",Te.integer,!1,"Number of reps"),qe.getInstance().addStringFieldToObjDefinition(e,"weight","Weight",Te.float,!1,"Weight used"),qe.getInstance().addStringFieldToObjDefinition(e,"distance","Distance",Te.float,!1,"Distance travelled"),ze("Exercise type data object definition"),ze(e),$e(Ge.getInstance().findDefinition("exerciseType"));var t=Ge.getInstance().addDefinition(q,"Workout",!0,!0,!0,"_id");qe.getInstance().addStringFieldToObjDefinition(t,"name","Name",Te.text,!1,"Give the workout a name"),qe.getInstance().addStringFieldToObjDefinition(t,"completed","Completed",Te.boolean,!0,"Have completed the workout");var n=qe.getInstance().addStringFieldToObjDefinition(t,"exercises","Exercises",Te.collection,!0,"Exercises in this workout");n.idType=a.collection,n.collectionOfDataObjectId=e.id,ze("Workout data object definition"),ze(t),$e(Ge.getInstance().findDefinition("workout"))},t.onDocumentLoaded=function(){ze("Initialising data state");var e=new de;if(T.getInstance().setListener(e),ze("Setting up chat system for user "+this.getLoggedInUserId()+": "+this.getLoggedInUsername()),this.getLoggedInUserId().trim().length>0){var t=pe.getInstance();ye.getInstance(),t.setCurrentUser(this.getLoggedInUsername()),t.setUnreadCountListener(this.applicationView),t.login(),this.getStateManager().getStateByName(P),this.getStateManager().getStateByName(W),this.getStateManager().getStateByName(q)}},t.getStateManager=function(){return this.stateManager},t.getListenerName=function(){return"Controller"},t.isLoggedIn=function(){var e=!1;try{loggedInUser&&(e=!0)}catch(e){}return e},t.getLoggedInUserId=function(){var e="";try{loggedInUser&&(e=loggedInUser._id)}catch(e){}return $e("Logged in user id is "+e),e},t.getLoggedInUsername=function(){var e="";try{loggedInUser&&(e=loggedInUser.username)}catch(e){}return $e("Logged in user is "+e),e},t.handleMessage=function(e){ze(e)},t.getCurrentUser=function(){return this.getLoggedInUserId()},t.stateChangedItemAdded=function(e,t,n){},t.stateChangedItemRemoved=function(e,t,n){},t.stateChangedItemUpdated=function(e,t,n,i){},t.stateChanged=function(e,t,n){},t.getServerAPIURL=function(){var e="";return window.ENV&&window.ENV.serverURL&&(e=window.ENV.serverURL),e},t.handleShowChat=function(e){this.applicationView.handleShowChat(e)},t.create=function(e,t,n){switch(t){case W:ze("Handling create new exercise type"),$e(n),this.stateManager.addNewItemToState(t,n,!1)}},t.delete=function(e,t,n){switch(t){case W:ze("Handling delete exercise type - already managed by stateful collection view"),$e(n)}},t.update=function(e,t,n){switch(t){case W:ze("Handling update exercise type"),$e(n),this.stateManager.updateItemInState(t,n,V,!1)}},t.addExerciseToCurrentWorkout=function(e){var t=Qe({},e);t._id=(0,ge.Z)(),this.applicationView.addingExerciseToCurrentWorkout(t)},t.addWorkoutExercisesToCurrentWorkout=function(e){var t=this;e.exercises&&e.exercises.forEach((function(e){t.addExerciseToCurrentWorkout(e)}))},e}(),Ze=function(){function e(){this.suppressEventEmits=!1,this.viewListeners=[]}var t=e.prototype;return t.addListener=function(e){this.viewListeners.push(e)},t.suppressEvents=function(){this.suppressEventEmits=!0},t.emitEvents=function(){this.suppressEventEmits=!1},t.itemDeleted=function(e,t){this.suppressEventEmits||this.viewListeners.forEach((function(n){return n.itemDeleted(e,t)}))},t.documentLoaded=function(e){this.suppressEventEmits||this.viewListeners.forEach((function(t){return t.documentLoaded(e)}))},t.itemAction=function(e,t,n){this.suppressEventEmits||this.viewListeners.forEach((function(i){return i.itemAction(e,t,n)}))},t.canDeleteItem=function(e,t){var n=!0;return this.suppressEventEmits||this.viewListeners.forEach((function(i){i.canDeleteItem(e,t)||(n=!1)})),n},t.hideRequested=function(e){this.suppressEventEmits||this.viewListeners.forEach((function(t){return t.hideRequested(e)}))},t.showRequested=function(e){this.suppressEventEmits||this.viewListeners.forEach((function(t){return t.showRequested(e)}))},t.itemDropped=function(e,t){this.suppressEventEmits||this.viewListeners.forEach((function(n){return n.itemDropped(e,t)}))},e}(),Xe=g()("abstract-view-ts"),et=g()("abstract-view-ts-detail"),tt=function(){function e(e){this.containerEl=null,this.uiConfig=e,this.viewEl=null,this.eventForwarder=new Ze,this.handleDrop=this.handleDrop.bind(this)}var t=e.prototype;return t.getItemId=function(e,t){throw new Error("Method not implemented.")},t.getItemDescription=function(e,t){throw new Error("Method not implemented.")},t.getUIConfig=function(){return this.uiConfig},t.addEventListener=function(e){this.eventForwarder.addListener(e)},t.onDocumentLoaded=function(){this.viewEl=document.getElementById(this.uiConfig.resultsContainerId),this.eventForwarder.documentLoaded(this)},t.setContainedBy=function(e){this.containerEl=e},t.getName=function(){return this.uiConfig.dataSourceId},t.hasChanged=function(){return!1},t.getDataSourceKeyId=function(){return e.DATA_SOURCE},t.handleDrop=function(e){Xe("view "+this.getName()+": drop event"),et(e.target);var t=e.dataTransfer.getData(o),n=JSON.parse(t);et(n);var i=n.draggedType,a=n.draggedFrom;if(Xe("view "+this.getName()+": drop event from "+a+" with type "+i),this.uiConfig.drop){var r=this.uiConfig.drop.acceptTypes.findIndex((function(e){return e===i}))>=0,s=!0;r&&(this.uiConfig.drop.acceptFrom&&(s=this.uiConfig.drop.acceptFrom.findIndex((function(e){return e===a}))>=0),et("view "+this.getName()+": accepted type? "+r+" and from? "+s),r&&s&&this.eventForwarder.itemDropped(this,n))}},e}();function nt(e,t){return(nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}tt.DATA_SOURCE="data-source";var it,at,rt=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).collectionViewListeners=[],t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,nt(t,n);var a=i.prototype;return a.addListener=function(t){e.prototype.addListener.call(this,t),this.collectionViewListeners.push(t)},a.itemDragStarted=function(e,t){this.suppressEventEmits||this.collectionViewListeners.forEach((function(n){return n.itemDragStarted(e,t)}))},a.itemSelected=function(e,t){this.suppressEventEmits||this.collectionViewListeners.forEach((function(n){return n.itemSelected(e,t)}))},a.itemDeselected=function(e,t){this.suppressEventEmits||this.collectionViewListeners.forEach((function(n){return n.itemDeselected(e,t)}))},a.canSelectItem=function(e,t){var n=!0;return this.suppressEventEmits||this.collectionViewListeners.forEach((function(i){i.canSelectItem(e,t)||(n=!1)})),n},i}(Ze);(at=it||(it={}))[at.cancelled=0]="cancelled",at[at.confirmed=1]="confirmed";var st="d-none",ot="d-block",dt=g()("alert"),ct=function(){function e(){this.alertDiv=document.getElementById("alert"),this.alertTitle=document.getElementById("alert-title"),this.alertContent=document.getElementById("alert-content"),this.cancelButton=document.getElementById("alert-cancel"),this.confirmButton=document.getElementById("alert-confirm")}return e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.startAlert=function(e,t,n,i){var a=this;this.alertTitle.innerHTML=t,this.alertContent.innerHTML=n,this.alertDiv.classList.remove(st),this.alertDiv.classList.add(ot),this.confirmButton.addEventListener("click",(function t(n){dt("Handling confirm event from alert"),e.completed({outcome:it.confirmed,context:i}),a.alertDiv.classList.add(st),a.alertDiv.classList.remove(ot),n.target.removeEventListener("click",t)})),this.cancelButton.addEventListener("click",(function t(n){dt("Handling cancel event from alert"),e.completed({outcome:it.cancelled,context:i}),a.alertDiv.classList.add(st),a.alertDiv.classList.remove(ot),n.target.removeEventListener("click",t)}))},e}(),lt=g()("collection-view-event-handler-delegate"),ut=function(){function e(e,t){this.selectedItem=null,this.view=e,this.eventForwarder=t,this.eventStartDrag=this.eventStartDrag.bind(this),this.eventActionClicked=this.eventActionClicked.bind(this),this.eventClickItem=this.eventClickItem.bind(this),this.eventDeleteClickItem=this.eventDeleteClickItem.bind(this)}var t=e.prototype;return t.getItemContext=function(e){return{itemId:e.target.getAttribute(this.view.getCollectionUIConfig().keyId),dataSource:e.target.getAttribute(tt.DATA_SOURCE)}},t.getDragData=function(e){var t=this.getItemContext(e),n=t.itemId,i=t.dataSource;this.view.getCollectionUIConfig().keyType===a.number&&(n=parseInt(n)),lt("view "+this.view.getName()+": Item with id "+n+" getting drag data from "+i);var r={};r[this.view.getCollectionUIConfig().keyId]=n;var s,o,d={};return(d=this.view.getItemInNamedCollection(this.view.getCollectionName(),r))&&(d.draggedType=null==(s=this.view.getCollectionUIConfig().detail.drag)?void 0:s.type,d.draggedFrom=null==(o=this.view.getCollectionUIConfig().detail.drag)?void 0:o.from),d},t.eventStartDrag=function(e){lt("view "+this.view.getName()+": drag start"),lt(e.target);var t=JSON.stringify(this.getDragData(e));lt(t),e.dataTransfer.setData(o,t),this.eventForwarder.itemDragStarted(this.view,t)},t.eventClickItem=function(e){e.preventDefault(),e.stopPropagation();var t=this.getItemContext(e),n=t.itemId,i=t.dataSource;this.view.getCollectionUIConfig().keyType===a.number&&(n=parseInt(n)),lt("view "+this.view.getName()+": Item with id "+n+" clicked from "+i);var r={};r[this.view.getCollectionUIConfig().keyId]=n,lt(r);var s=this.view.getItemInNamedCollection(this.view.getCollectionName(),r);if(lt(s),s){var o=this.eventForwarder.canSelectItem(this.view,s);lt("view "+this.view.getName()+": Item with id "+n+" attempting selected from "+i+" - "+o),o&&(this.selectedItem=s,lt(s),this.eventForwarder.itemSelected(this.view,s))}},t.eventDeleteClickItem=function(e){e.preventDefault(),e.stopPropagation();var t=this.getItemContext(e),n=t.itemId,i=t.dataSource;this.view.getCollectionUIConfig().keyType===a.number&&(n=parseInt(n)),lt("view "+this.view.getName()+": Item with id "+n+" attempting delete from "+i);var r={};r[this.view.getCollectionUIConfig().keyId]=n,lt(r);var s=this.view.getItemInNamedCollection(this.view.getCollectionName(),r);if(s){var o=this.eventForwarder.canDeleteItem(this.view,s);lt("view "+this.view.getName()+": Item with id "+n+" attempting delete from "+i+" - "+o),o&&(this.view.getCollectionUIConfig().detail.quickDelete?(this.selectedItem=null,this.eventForwarder.itemDeleted(this.view,s)):ct.getInstance().startAlert(this,this.view.getName(),"Are you sure you want to delete this information?",s))}},t.eventActionClicked=function(e){e.preventDefault(),e.stopPropagation();var t=this.getItemContext(e),n=t.itemId,i=t.dataSource,r=e.target.getAttribute(d);this.view.getCollectionUIConfig().keyType===a.number&&(n=parseInt(n)),lt("view "+this.view.getName()+": Item with id "+n+" attempting delete from "+i);var s={};s[this.view.getCollectionUIConfig().keyId]=n,lt(s);var o=this.view.getItemInNamedCollection(this.view.getCollectionName(),s);if(o){var c=this.eventForwarder.canSelectItem(this.view,o);lt("view "+this.view.getName()+": Item with id "+n+" attempting action "+r+" from "+i+" - "+c),c&&(this.selectedItem=o,lt(o),this.eventForwarder.itemAction(this.view,r,o))}},t.completed=function(e){lt(e.context),e.outcome===it.confirmed&&(this.selectedItem=null,this.eventForwarder.itemDeleted(this.view,e.context))},e}();function ht(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}g()("collection-view-ts");var ft=g()("collection-view-ts-detail"),gt=function(e){var t,n;function a(t,n){var i;(i=e.call(this,t.viewConfig)||this).collectionUIConfig=t,i.collectionName=n,i.renderer=null;var a=new rt;return i.eventForwarder=a,i.eventHandlerDelegate=new ut(ht(i),a),i.updateViewForNamedCollection=i.updateViewForNamedCollection.bind(ht(i)),i.eventStartDrag=i.eventStartDrag.bind(ht(i)),i.eventActionClicked=i.eventActionClicked.bind(ht(i)),i.eventClickItem=i.eventClickItem.bind(ht(i)),i.eventDeleteClickItem=i.eventDeleteClickItem.bind(ht(i)),i}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,mt(t,n);var r=a.prototype;return r.eventStartDrag=function(e){this.eventHandlerDelegate.eventStartDrag(e)},r.eventClickItem=function(e){this.eventHandlerDelegate.eventClickItem(e)},r.eventDeleteClickItem=function(e){this.eventHandlerDelegate.eventDeleteClickItem(e)},r.eventActionClicked=function(e){this.eventHandlerDelegate.eventActionClicked(e)},r.getCollectionName=function(){return this.collectionName},r.getItemId=function(e,t){return this.getIdForItemInNamedCollection(e,t)},r.getCollectionUIConfig=function(){return this.collectionUIConfig},r.addEventCollectionListener=function(e){this.eventForwarder.addListener(e)},r.setContainedBy=function(t){e.prototype.setContainedBy.call(this,t),this.uiConfig.drop&&(ft("view "+this.getName()+": Adding dragover events to "+this.uiConfig.dataSourceId),ft(t),t.addEventListener("dragover",(function(e){e.preventDefault()})),t.addEventListener("drop",this.handleDrop))},r.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.renderer&&this.renderer.onDocumentLoaded()},r.renderBackgroundForItemInNamedCollection=function(e,t,n){},r.compareItemsForEquality=function(e,t){return B(e,t)},r.getModifierForItemInNamedCollection=function(e,t){return i.normal},r.getSecondaryModifierForItemInNamedCollection=function(e,t){return i.normal},r.getBadgeValueForItemInNamedCollection=function(e,t){return 0},r.getBackgroundImageForItemInNamedCollection=function(e,t){return""},r.updateViewForNamedCollection=function(e,t){this.viewEl&&this.renderer&&this.renderer.setDisplayElementsForCollectionInContainer(this.viewEl,e,t)},r.hasPermissionToDeleteItemInNamedCollection=function(e,t){return!0},r.hasPermissionToUpdateItemInNamedCollection=function(e,t){return!0},r.hasPermissionToActionItemInNamedCollection=function(e,t,n){return!0},r.setRenderer=function(e){this.renderer=e},a}(tt);function vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pt(e,t){return(pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ct=g()("ab-stateful-collection-view"),It=function(e){var t,n;function i(t,n,i){var a;return(a=e.call(this,t,i)||this).stateManager=n,a.stateChanged=a.stateChanged.bind(vt(a)),a.stateManager.addChangeListenerForName(a.collectionName,vt(a)),a}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,pt(t,n);var a=i.prototype;return a.getItemDescription=function(e,t){return""},a.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.addEventCollectionListener(this)},a.getItemInNamedCollection=function(e,t){return this.stateManager.findItemInState(e,t,this.compareItemsForEquality)},a.stateChanged=function(e,t,n){Ct("handling state "+t+" changed"),Ct(n),this.updateViewForNamedCollection(t,n)},a.stateChangedItemAdded=function(e,t,n){Ct("handling state "+t+" new item added"),Ct(n),this.stateManager&&this.collectionName&&this.updateViewForNamedCollection(t,this.stateManager.getStateByName(t))},a.stateChangedItemRemoved=function(e,t,n){Ct("handling state "+t+" new item removed"),Ct(n),this.stateManager&&this.collectionName&&this.updateViewForNamedCollection(t,this.stateManager.getStateByName(t))},a.stateChangedItemUpdated=function(e,t,n,i){Ct("handling state "+t+" new item updated"),Ct(i),this.stateManager&&this.collectionName&&this.updateViewForNamedCollection(t,this.stateManager.getStateByName(t))},a.render=function(){this.updateViewForNamedCollection(this.collectionName,this.stateManager.getStateByName(this.collectionName))},a.show=function(){},a.hidden=function(){},a.documentLoaded=function(e){},a.hideRequested=function(e){},a.itemDragStarted=function(e,t){},a.itemDropped=function(e,t){},a.showRequested=function(e){},a.itemDeselected=function(e,t){},a.itemSelected=function(e,t){},a.itemAction=function(e,t,n){},a.itemDeleted=function(e,t){this.stateManager.removeItemFromState(this.collectionName,t,this.compareItemsForEquality,!1)},a.canSelectItem=function(e,t){return!0},a.canDeleteItem=function(e,t){return!0},a.getListenerName=function(){return this.getName()},i}(gt),bt=g()("list-view-renderer"),yt=function(){function e(e,t){this.view=e,this.eventHandler=t}var t=e.prototype;return t.createDisplayElementForCollectionItem=function(e,t){var n=this,a=this.view.hasPermissionToDeleteItemInNamedCollection(e,t),r=this.view.getCollectionUIConfig(),s=this.view.getDataSourceKeyId();bt("view "+this.view.getName()+": creating List item"),bt(t);var o=this.view.getIdForItemInNamedCollection(e,t),c=document.createElement(r.resultsElementType);h.addRemoveClasses(c,r.resultsClasses),h.addAttributes(c,r.resultsElementAttributes),c.setAttribute(r.keyId,o),c.setAttribute(s,r.viewConfig.dataSourceId);var l=c;if(r.detail.containerClasses){var u=document.createElement("div");if(h.addRemoveClasses(u,r.detail.containerClasses),u.setAttribute(r.keyId,o),u.setAttribute(s,r.viewConfig.dataSourceId),l=document.createElement(r.detail.textElementType),h.addRemoveClasses(l,r.detail.textElementClasses),l.setAttribute(r.keyId,o),l.setAttribute(s,r.viewConfig.dataSourceId),u.appendChild(l),r.detail.background){var m=document.createElement(r.detail.background.elementType);h.addRemoveClasses(m,r.detail.background.elementClasses),m.setAttribute("src",this.view.getBackgroundImageForItemInNamedCollection(e,t)),c.appendChild(m)}var f=document.createElement("div");if(u.appendChild(f),r.detail.badge){var g=this.view.getBadgeValueForItemInNamedCollection(e,t);if(g>0){var v=document.createElement(r.detail.badge.elementType);h.addRemoveClasses(v,r.detail.badge.elementClasses),h.addAttributes(v,r.detail.badge.elementAttributes),v.setAttribute(r.keyId,o),v.setAttribute(s,r.viewConfig.dataSourceId),f.appendChild(v),v.innerHTML="&nbsp;&nbsp;&nbsp;"+g+"&nbsp;&nbsp;&nbsp;"}}if(r.extraActions&&r.extraActions.forEach((function(i){if(n.view.hasPermissionToActionItemInNamedCollection(i.name,e,t)){var a=document.createElement("button");if(a.setAttribute("type","button"),h.addRemoveClasses(a,i.buttonClasses),h.addAttributes(a,i.attributes),i.buttonText&&(a.innerHTML=i.buttonText),i.iconClasses){var c=document.createElement("i");h.addRemoveClasses(c,i.iconClasses),c.setAttribute(r.keyId,o),c.setAttribute(s,r.viewConfig.dataSourceId),c.setAttribute(d,i.name),a.appendChild(c)}a.setAttribute(r.keyId,o),a.setAttribute(s,r.viewConfig.dataSourceId),a.setAttribute(d,i.name),a.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),n.eventHandler.eventActionClicked(e)})),f.appendChild(a)}})),r.detail.delete&&a){var p=document.createElement("button");if(p.setAttribute("type","button"),h.addRemoveClasses(p,r.detail.delete.buttonClasses),h.addAttributes(p,r.detail.delete.attributes),r.detail.delete.buttonText&&(p.innerHTML=r.detail.delete.buttonText),r.detail.delete.iconClasses){var C=document.createElement("i");h.addRemoveClasses(C,r.detail.delete.iconClasses),C.setAttribute(r.keyId,o),C.setAttribute(s,r.viewConfig.dataSourceId),p.appendChild(C)}p.setAttribute(r.keyId,o),p.setAttribute(s,r.viewConfig.dataSourceId),p.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),n.eventHandler.eventDeleteClickItem(e)})),f.appendChild(p)}c.appendChild(u),r.detail.drag&&(c.setAttribute("draggable","true"),c.addEventListener("dragstart",this.eventHandler.eventStartDrag)),r.detail.select&&c.addEventListener("click",this.eventHandler.eventClickItem)}if(l.setAttribute(r.keyId,o),l.setAttribute(s,r.viewConfig.dataSourceId),this.view.renderDisplayForItemInNamedCollection(l,e,t),r.detail.icons&&r.detail.icons(e,t).forEach((function(e){var t=document.createElement("i");h.addRemoveClasses(t,e),t.setAttribute(r.keyId,o),t.setAttribute(s,r.viewConfig.dataSourceId),l.appendChild(t)})),r.modifiers){var I=this.view.getModifierForItemInNamedCollection(e,t),b=this.view.getSecondaryModifierForItemInNamedCollection(e,t);switch(I){case i.normal:if(bt("view "+this.view.getName()+": normal item"),h.addRemoveClasses(c,r.modifiers.normal),r.icons&&r.icons.normal){var y=document.createElement("i");h.addRemoveClasses(y,r.icons.normal),y.setAttribute(r.keyId,o),y.setAttribute(s,r.viewConfig.dataSourceId),l.appendChild(y)}switch(b){case i.warning:if(h.addRemoveClasses(c,r.modifiers.normal,!1),h.addRemoveClasses(c,r.modifiers.warning,!0),r.icons&&r.icons.warning){var w=document.createElement("i");h.addRemoveClasses(w,r.icons.warning),w.setAttribute(r.keyId,o),w.setAttribute(s,r.viewConfig.dataSourceId),l.appendChild(w)}break;case i.active:if(r.icons&&r.icons.active){var E=document.createElement("i");h.addRemoveClasses(E,r.icons.active),E.setAttribute(r.keyId,o),E.setAttribute(s,r.viewConfig.dataSourceId),l.appendChild(E)}}break;case i.active:if(bt("view "+this.view.getName()+": active item"),h.addRemoveClasses(c,r.modifiers.active),r.icons&&r.icons.active){var L=document.createElement("i");h.addRemoveClasses(L,r.icons.active),L.setAttribute(r.keyId,o),L.setAttribute(s,r.viewConfig.dataSourceId),l.appendChild(L)}switch(b){case i.warning:if(h.addRemoveClasses(c,r.modifiers.active,!1),h.addRemoveClasses(c,r.modifiers.warning,!0),r.icons&&r.icons.warning){var S=document.createElement("i");h.addRemoveClasses(S,r.icons.warning),S.setAttribute(r.keyId,o),S.setAttribute(s,r.viewConfig.dataSourceId),l.appendChild(S)}}break;case i.inactive:if(bt("view "+this.view.getName()+": inactive item"),h.addRemoveClasses(c,r.modifiers.inactive),r.icons&&r.icons.inactive){var F=document.createElement("i");h.addRemoveClasses(F,r.icons.inactive),F.setAttribute(r.keyId,o),F.setAttribute(s,r.viewConfig.dataSourceId),l.appendChild(F)}switch(b){case i.warning:if(r.icons&&r.icons.warning){h.addRemoveClasses(c,r.modifiers.inactive,!1),h.addRemoveClasses(c,r.modifiers.warning,!0);var N=document.createElement("i");h.addRemoveClasses(N,r.icons.warning),N.setAttribute(r.keyId,o),N.setAttribute(s,r.viewConfig.dataSourceId),l.appendChild(N)}break;case i.active:if(r.icons&&r.icons.active){var D=document.createElement("i");h.addRemoveClasses(D,r.icons.active),D.setAttribute(r.keyId,o),D.setAttribute(s,r.viewConfig.dataSourceId),l.appendChild(D)}}}}return c},t.setDisplayElementsForCollectionInContainer=function(e,t,n){var i=this;bt("view "+this.view.getName()+": creating Results"),bt(n),h.removeAllChildren(e),n.map((function(n,a){var r=i.createDisplayElementForCollectionItem(t,n);bt("view "+i.view.getName()+":  Adding child "+i.view.getIdForItemInNamedCollection(t,n)),e.appendChild(r)})),$('[data-toggle="tooltip"]').tooltip()},t.onDocumentLoaded=function(){},e}();function wt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Et(e,t){return(Et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Lt=g()("user-search"),St=g()("user-search-detail"),Ft=function(e){var t,n;function a(t){var n;return(n=e.call(this,a.DOMConfig,t,P)||this).loggedInUsers=[],n.renderer=new yt(wt(n),wt(n)),n.updateViewForNamedCollection=n.updateViewForNamedCollection.bind(wt(n)),n.eventUserSelected=n.eventUserSelected.bind(wt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(wt(n)),n.handleFavouriteUserLoggedIn=n.handleFavouriteUserLoggedIn.bind(wt(n)),n.handleFavouriteUserLoggedOut=n.handleFavouriteUserLoggedOut.bind(wt(n)),n.handleFavouriteUsersChanged=n.handleFavouriteUsersChanged.bind(wt(n)),n.handleBlockedUsersChanged=n.handleBlockedUsersChanged.bind(wt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(wt(n)),n.itemDeleted=n.itemDeleted.bind(wt(n)),n.localisedSM=new fe(!0),n.localisedSM.addChangeListenerForName(Y,wt(n)),ye.getInstance().addUserListener(wt(n)),Lt(n.localisedSM.getStateByName(Y)),n}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,Et(t,n);var r=a.prototype;return r.handleLoggedInUsersUpdated=function(e){Lt("Received new list of users who are logged in "),Lt(e),this.loggedInUsers=e,this.updateViewForNamedCollection(Y,{})},r.handleFavouriteUserLoggedIn=function(e){Lt("Handle Favourite User "+e+" logged in"),this.updateViewForNamedCollection(Y,{})},r.handleFavouriteUserLoggedOut=function(e){Lt("Handle Favourite User "+e+" logged in"),this.updateViewForNamedCollection(Y,{})},r.handleFavouriteUsersChanged=function(e){Lt("Handle Favourite Users changed to "+e),this.updateViewForNamedCollection(Y,{})},r.handleBlockedUsersChanged=function(e){Lt("Handle Blocked Users changed to "+e),this.updateViewForNamedCollection(Y,{})},r.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),$("#"+a.fastSearchInputId).on("autocompleteselect",this.eventUserSelected)},r.getIdForItemInNamedCollection=function(e,t){return t._id},r.renderDisplayForItemInNamedCollection=function(e,t,n){e.innerHTML=n.username},r.getModifierForItemInNamedCollection=function(e,t){var n=i.normal;return St("Checking for item modifiers"),St(t),pe.getInstance().isUserLoggedIn(t.username)||(n=i.inactive),n},r.getSecondaryModifierForItemInNamedCollection=function(e,t){var n=i.normal;return St("Checking for item secondary modifiers "+t.username),ye.getInstance().isFavouriteUser(t.username)&&(St("is favourite"),n=i.active),ye.getInstance().isBlockedUser(t.username)&&(St("is blocked"),n=i.warning),n},r.eventUserSelected=function(e,t){if(e.preventDefault(),e.stopPropagation(),Lt("User "+t.item.label+" with id "+t.item.value+" selected"),e.target.innerText="",!this.localisedSM.isItemInState(Y,{_id:t.item.value},V)){var n=this.localisedSM.getStateByName(Y);if(Lt("saved searches too long? recentUserSearch"),n.length>=a.dataLimit){Lt("saved searches too long - removing first");var i=n.shift();this.localisedSM.removeItemFromState(Y,i,V,!0)}this.localisedSM.addNewItemToState(Y,{_id:t.item.value,username:t.item.label},!0)}},r.updateViewForNamedCollection=function(t,n){if(t===Y&&(Lt("Updating for recent searches"),n=this.localisedSM.getStateByName(Y),Lt(n),e.prototype.updateViewForNamedCollection.call(this,t,n)),t===P){var i=Ke.getInstance().getLoggedInUsername(),r=$("#"+a.fastSearchInputId),s=[];n.forEach((function(e){var t={label:e.username,value:e._id};i!==e.username&&s.push(t)})),r.autocomplete({source:s}),r.autocomplete("option",{disabled:!1,minLength:1})}},r.itemAction=function(e,t,n){if(t===this.collectionUIConfig.extraActions[0].name){if(pe.getInstance().isUserInFavouriteList(n.username))return void Lt(n.username+" already in fav list, ignoring");pe.getInstance().addUserToFavouriteList(n.username)}if(t===this.collectionUIConfig.extraActions[1].name){if(pe.getInstance().isUserInBlockedList(n.username))return void Lt(n.username+" already in blocked list, ignoring");pe.getInstance().addUserToBlockedList(n.username)}},r.compareItemsForEquality=function(e,t){return B(e,t)},r.itemDeleted=function(e,t){St(t),Lt("Recent search user "+t.username+" with id "+t.id+" deleted - removing"),this.localisedSM.removeItemFromState(Y,t,this.compareItemsForEquality,!0)},r.itemSelected=function(e,t){var n=ye.getInstance().startChatWithUser(t.username);Ke.getInstance().handleShowChat(n)},a}(It);Ft.fastSearchInputId="fastSearchUserNames",Ft.dataLimit=10,Ft.DOMConfig={viewConfig:{resultsContainerId:"recentUserSearches",dataSourceId:"userSearch"},resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"_id",keyType:a.number,modifiers:{normal:"list-group-item-primary",inactive:"list-group-item-light",active:"list-group-item-info",warning:"list-group-item-danger"},icons:{normal:"fas fa-comment",inactive:"fas fa-comment",active:"fas fa-heart",warning:"fas fa-exclamation-circle"},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,quickDelete:!0,delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-sm",iconClasses:"fas fa-trash-alt"},drag:{type:J,from:z}},extraActions:[{name:"favourite",buttonClasses:"btn bg-info text-white btn-circle btn-sm mr-1",iconClasses:"fas fa-user-plus"},{name:"block",buttonClasses:"btn bg-warning text-white btn-circle btn-sm mr-1",iconClasses:"fas fa-user-slash"}]};const Nt=Ft;function Dt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kt(e,t){return(kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tt=g()("chat-sidebar"),Rt=function(e){var t,n;function a(){var t;return(t=e.call(this,a.DOMConfig,new F,H)||this).selectedChatLog=null,t.renderer=new yt(Dt(t),Dt(t)),t.handleChatLogsUpdated=t.handleChatLogsUpdated.bind(Dt(t)),t.handleChatLogUpdated=t.handleChatLogUpdated.bind(Dt(t)),t.handleChatStarted=t.handleChatStarted.bind(Dt(t)),ye.getInstance().addListener(Dt(t)),t}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,kt(t,n);var r=a.prototype;return r.compareItemsForEquality=function(e,t){return function(e,t){return e.roomName===t.roomName}(e,t)},r.updateStateManager=function(){Tt("Updating state with chat manager");var e=pe.getInstance().getChatLogs();Tt(e),this.stateManager.setStateByName(H,e,!0)},r.handleNewInviteReceived=function(e){return!0},r.handleChatLogUpdated=function(e){Tt("Handling chat log updates"),this.updateStateManager()},r.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.addEventCollectionListener(this),this.updateStateManager()},r.getIdForItemInNamedCollection=function(e,t){return t.roomName},r.renderDisplayForItemInNamedCollection=function(e,t,n){e.innerHTML=n.users.join(",")},r.getModifierForItemInNamedCollection=function(e,t){var n=i.inactive;return this.selectedChatLog&&this.selectedChatLog.roomName===t.roomName&&(n=i.active),n},r.getSecondaryModifierForItemInNamedCollection=function(e,t){return this.getModifierForItemInNamedCollection(e,t)},r.selectChatRoom=function(e){var t=pe.getInstance().getChatLog(e);this.selectedChatLog=t,this.eventForwarder.itemSelected(this,this.selectedChatLog),this.updateStateManager()},r.handleChatLogsUpdated=function(){this.selectedChatLog&&pe.getInstance().touchChatLog(this.selectedChatLog.roomName),this.updateStateManager()},r.handleChatStarted=function(e){this.selectedChatLog=e,this.eventForwarder.itemSelected(this,this.selectedChatLog),this.updateStateManager()},r.getBadgeValueForItemInNamedCollection=function(e,t){return t.numOfNewMessages},r.canDeleteItem=function(e,t){return!0},r.itemDeleted=function(e,t){Tt("Deleting chat "+t.roomName),pe.getInstance().leaveChat(t.roomName),this.selectedChatLog&&this.selectedChatLog.roomName===t.roomName&&(this.eventForwarder.itemDeselected(this,this.selectedChatLog),this.selectedChatLog=null),this.updateStateManager()},r.hideRequested=function(e){this.selectedChatLog&&(this.eventForwarder.itemDeselected(this,this.selectedChatLog),this.selectedChatLog=null)},r.hidden=function(){this.hideRequested(this)},r.documentLoaded=function(e){},r.itemAction=function(e,t,n){},r.itemDragStarted=function(e,t){},r.itemDropped=function(e,t){},r.itemSelected=function(e,t){this.selectedChatLog=t,this.updateStateManager()},r.itemDeselected=function(e,t){this.selectedChatLog=null,this.updateStateManager()},r.showRequested=function(e){},r.handleOfflineMessagesReceived=function(e){},r.handleInvitationDeclined=function(e,t){},r.canSelectItem=function(e,t){return!0},a}(It);Rt.DOMConfig={viewConfig:{resultsContainerId:"chatLogs",dataSourceId:"chatLogs"},resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"roomName",keyType:a.string,modifiers:{normal:"",inactive:"list-group-item-dark",active:"list-group-item-primary",warning:""},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-sm",iconClasses:"text-black fas fa-sign-out-alt"},badge:{elementType:"span",elementClasses:"badge badge-pill badge-primary mr-1"}}};const At=Rt;var Ot=g()("sidebar-container");const Ut=function(){function e(e){this.prefs=e,this.views=[],this.eventHide=this.eventHide.bind(this),this.eventShow=this.eventShow.bind(this)}var t=e.prototype;return t.addView=function(e,t){Ot("Adding view to container, with containing div of "+t.containerId);var n=document.getElementById(t.containerId);n&&(Ot("Adding view to container, with containing div of "+t.containerId+" - FOUND"),e.setContainedBy(n)),this.views.push(e),e.addEventListener(this)},t.onDocumentLoaded=function(){this.eventHide(null);var e=document.getElementById(this.prefs.id);if(null!==e){var t=e.querySelector(".close");t&&t.addEventListener("click",this.eventHide),this.views.forEach((function(e){e.onDocumentLoaded()}))}},t.eventHide=function(e){e&&e.preventDefault(),this.showHide("0%"),this.views.forEach((function(e){e.hidden()}))},t.eventShow=function(e){var t=this.prefs.expandedSize;window.innerWidth<769&&(t="50%"),window.innerWidth<415&&(t="100%"),this.showHide(t)},t.showHide=function(e){var t=document.getElementById(this.prefs.id);if(null!==t)switch(this.prefs.location){case r.left:case r.right:t.style.width=e;break;case r.bottom:case r.top:t.style.height=e}},t.documentLoaded=function(e){},t.itemAction=function(e,t,n){},t.canDeleteItem=function(e,t){return!0},t.itemDeleted=function(e,t){},t.itemDragStarted=function(e,t){},t.itemSelected=function(e,t){},t.itemDeselected=function(e,t){},t.itemDropped=function(e,t){},t.showRequested=function(e){this.eventShow(null)},t.hideRequested=function(e){this.eventHide(null)},t.canSelectItem=function(e,t){return!0},e}();function xt(e,t){return(xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Mt=function(e){var t,n;function i(){return e.call(this,i.SidebarPrefs)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,xt(t,n),i}(Ut);Mt.SidebarPrefs={id:"userSearchSideBar",expandedSize:"35%",location:r.left},Mt.SidebarContainers={recentSearches:"userSearchZone",favourites:"favouriteUsersDropZone",blocked:"blockedUsersDropZone"};const _t=Mt;function jt(e,t){return(jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Bt=function(e){var t,n;function i(){return e.call(this,i.SidebarPrefs)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,jt(t,n),i}(Ut);Bt.SidebarPrefs={id:"chatSideBar",expandedSize:"35%",location:r.right},Bt.SidebarContainers={chatLogs:"chatLogs",chatLog:"chatLogRoom"};const Vt=Bt;function Pt(e,t){return(Pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ht=function(e){var t,n;function i(){return e.call(this,i.SidebarPrefs)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Pt(t,n),i}(Ut);Ht.SidebarPrefs={id:"exerciseTypesSidebar",expandedSize:"50%",location:r.left},Ht.SidebarContainers={container:"exerciseTypesContainer"};var Wt=g()("chat-sidebar:detail"),qt=function(){function e(e){this.stateManager=e,this.selectedChatLog=null,this.handleAddMessage=this.handleAddMessage.bind(this),this.handleChatLogsUpdated=this.handleChatLogsUpdated.bind(this),this.handleChatLogUpdated=this.handleChatLogUpdated.bind(this),this.handleChatStarted=this.handleChatStarted.bind(this),this.handleUserDrop=this.handleUserDrop.bind(this),this.leaveChat=this.leaveChat.bind(this),this.eventUserSelected=this.eventUserSelected.bind(this),ye.getInstance().addListener(this),this.stateManager.addChangeListenerForName(P,this)}var t=e.prototype;return t.getListenerName=function(){return"Chat Log Details"},t.canSelectItem=function(e,t){return!0},t.hasPermissionToDeleteItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.hasPermissionToUpdateItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.hasChanged=function(){throw new Error("Method not implemented.")},t.setContainedBy=function(e){},t.addEventListener=function(e){},t.getIdForItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.getDisplayValueForItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.compareItemsForEquality=function(e,t){throw new Error("Method not implemented.")},t.getModifierForItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.getSecondaryModifierForItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.getBadgeValueForItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.getBackgroundImageForItemInNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.updateViewForNamedCollection=function(e,t){throw new Error("Method not implemented.")},t.itemDeselected=function(e,t){Wt("Chat Log with id "+t.roomName+" deselected"),this.selectedChatLog&&t.roomName===this.selectedChatLog.roomName&&(this.selectedChatLog=null,this.checkCanComment(),this.clearChatLog())},t.itemSelected=function(e,t){this.selectedChatLog=t,this.selectedChatLog&&(Wt("Chat Log with id "+t.roomName+" selected"),this.checkCanComment(),this.renderChatLog(this.selectedChatLog))},t.canDeleteItem=function(e,t){return!0},t.itemDeleted=function(e,t){Wt("Chat Log with "+t.roomName+" deleting"),this.selectedChatLog&&this.selectedChatLog.roomName===t.roomName&&(this.checkCanComment(),this.renderChatLog(this.selectedChatLog))},t.hideRequested=function(e){this.selectedChatLog=null,this.checkCanComment(),this.clearChatLog()},t.handleUserDrop=function(e){if(Wt("drop event on current chat room"),this.selectedChatLog){var t=e.dataTransfer.getData(o),n=JSON.parse(t);Wt(n),n.draggedType===J&&(pe.getInstance().sendInvite(n.username,this.selectedChatLog.roomName),se.getInstance().show("Chat","Invited "+n.username+" to the chat."))}},t.handleChatLogUpdated=function(e){Wt("Handling chat log updates"),this.checkCanComment(),this.renderChatLog(e)},t.handleAddMessage=function(e){if(e.preventDefault(),e.stopPropagation(),Wt("Handling message event"),this.selectedChatLog){if(this.commentEl&&0===this.commentEl.value.trim().length)return;var t=this.commentEl.value.trim();this.commentEl.value="";var n=pe.getInstance().sendMessage(this.selectedChatLog.roomName,t,N.Normal,{});if(n){var i=this.addChatMessage(n);h.scrollSmoothTo(i)}}},t.onDocumentLoaded=function(){var t=this;this.chatLogDiv=document.getElementById(e.chatLogId),this.commentEl=document.getElementById(e.commentId),this.chatForm=document.getElementById(e.newFormId),this.sendMessageButton=document.getElementById(e.submitCommentId),this.leaveChatButton=document.getElementById(e.leaveChatId),this.chatRoomDiv=document.getElementById(e.chatLogRoomId),this.fastUserSearch=document.getElementById(e.chatFastSearchUserNames),this.chatRoomDiv.addEventListener("dragover",(function(e){Wt("Dragged over"),t.selectedChatLog&&e.preventDefault()})),this.chatRoomDiv.addEventListener("drop",this.handleUserDrop),this.chatForm.addEventListener("submit",this.handleAddMessage),this.leaveChatButton.addEventListener("click",this.leaveChat),this.checkCanComment(),$("#"+e.chatFastSearchUserNames).on("autocompleteselect",this.eventUserSelected)},t.eventUserSelected=function(e,t){e.preventDefault(),e.stopPropagation(),Wt("User "+t.item.label+" with id "+t.item.value+" selected"),e.target.innerText="",this.selectedChatLog&&pe.getInstance().sendInvite(t.item.label,this.selectedChatLog.roomName),se.getInstance().show("Chat","Invited "+t.item.label+" to the chat.")},t.addChatMessage=function(e){var t=document.createElement("div");if(h.addRemoveClasses(t,"message"),0===e.from.trim().length){var n=document.createElement("div");h.addRemoveClasses(n,"message-sender"),n.innerText=e.message,t.appendChild(n)}else{if(e.from===pe.getInstance().getCurrentUser())h.addRemoveClasses(t,"my-message");else{var i=document.createElement("div");h.addRemoveClasses(i,"message-sender"),i.innerText=e.from+"   "+le()(e.created,"YYYYMMDDHHmmss").format("DD/MM/YYYY "),t.appendChild(i)}var a=document.createElement("div");e.from===pe.getInstance().getCurrentUser()?h.addRemoveClasses(a,"my-message-content"):h.addRemoveClasses(a,"message-content"),a.innerText=e.message,t.appendChild(a)}return this.chatLogDiv.appendChild(t),t},t.reRenderChatMessages=function(e){var t=this;h.removeAllChildren(this.chatLogDiv);var n=null;e.messages.forEach((function(e){n=t.addChatMessage(e)})),n&&h.scrollTo(n)},t.renderChatLog=function(e){Wt("Chat Log "+e.roomName+" rendering"),this.selectedChatLog&&this.selectedChatLog.roomName===e.roomName&&(this.selectedChatLog=e,pe.getInstance().touchChatLog(e.roomName),this.reRenderChatMessages(e))},t.handleChatLogsUpdated=function(){this.selectedChatLog&&(pe.getInstance().touchChatLog(this.selectedChatLog.roomName),this.reRenderChatMessages(this.selectedChatLog)),this.checkCanComment()},t.handleChatStarted=function(e){this.selectedChatLog=e,this.renderChatLog(e)},t.leaveChat=function(e){e.preventDefault(),e.stopPropagation(),this.selectedChatLog&&(pe.getInstance().leaveChat(this.selectedChatLog.roomName),this.selectedChatLog=null,this.clearChatLog(),this.checkCanComment())},t.checkCanComment=function(){this.selectedChatLog?(this.commentEl&&this.commentEl.removeAttribute("readonly"),this.commentEl&&this.commentEl.removeAttribute("disabled"),this.sendMessageButton&&this.sendMessageButton.removeAttribute("disabled"),this.leaveChatButton&&this.leaveChatButton.removeAttribute("disabled"),this.fastUserSearch&&this.fastUserSearch.removeAttribute("disabled")):(this.commentEl&&this.commentEl.setAttribute("readonly","true"),this.commentEl&&this.commentEl.setAttribute("disabled","true"),this.sendMessageButton&&this.sendMessageButton.setAttribute("disabled","true"),this.leaveChatButton&&this.leaveChatButton.setAttribute("disabled","true"),this.fastUserSearch&&this.fastUserSearch.setAttribute("disabled","true"))},t.clearChatLog=function(){h.removeAllChildren(this.chatLogDiv)},t.stateChanged=function(t,n,i){if(n===P){var a=$("#"+e.ssFastSearchUserNames),r=Ke.getInstance().getLoggedInUsername(),s=[];i.forEach((function(e){var t={label:e.username,value:e._id};r!==e.username&&s.push(t)})),a.autocomplete({source:s}),a.autocomplete("option",{disabled:!1,minLength:1})}},t.stateChangedItemAdded=function(e,t,n){this.stateChanged(e,t,this.stateManager.getStateByName(t))},t.stateChangedItemRemoved=function(e,t,n){},t.stateChangedItemUpdated=function(e,t,n,i){},t.handleOfflineMessagesReceived=function(e){},t.handleInvitationDeclined=function(e,t){},t.handleNewInviteReceived=function(e){return!0},t.itemDragStarted=function(e,t){},t.itemAction=function(e,t,n){},t.documentLoaded=function(e){},t.showRequested=function(e){},t.itemDropped=function(e,t){},t.getName=function(){return"chatLog"},t.hidden=function(){this.hideRequested(this)},t.getDataSourceKeyId=function(){return""},t.getUIConfig=function(){},t.render=function(){},t.show=function(){},t.getItemDescription=function(e,t){return""},t.getItemId=function(e,t){return""},e}();qt.newFormId="newMessage",qt.commentId="message",qt.submitCommentId="submitMessage",qt.chatLogId="chatLog",qt.chatLogRoomId="chatLogRoom",qt.leaveChatId="leaveChat",qt.chatFastSearchUserNames="chatFastSearchUserNames";const Yt=qt;function Gt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Jt(e,t){return(Jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qt=g()("user-search-sidebar"),zt=g()("user-search-sidebar:detail"),$t=function(e){var t,n;function a(t){var n;return(n=e.call(this,a.DOMConfig,t,P)||this).renderer=new yt(Gt(n),Gt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(Gt(n)),n.handleFavouriteUserLoggedIn=n.handleFavouriteUserLoggedIn.bind(Gt(n)),n.handleFavouriteUserLoggedOut=n.handleFavouriteUserLoggedOut.bind(Gt(n)),n.handleFavouriteUsersChanged=n.handleFavouriteUsersChanged.bind(Gt(n)),n.handleBlockedUsersChanged=n.handleBlockedUsersChanged.bind(Gt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(Gt(n)),ye.getInstance().addUserListener(Gt(n)),n}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,Jt(t,n);var r=a.prototype;return r.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.addEventCollectionListener(this)},r.handleLoggedInUsersUpdated=function(e){Qt("Received new list of users who are logged in "),this.updateViewForNamedCollection("",{})},r.handleFavouriteUserLoggedIn=function(e){Qt("Handle Favourite User "+e+" logged in"),this.updateViewForNamedCollection("",{})},r.handleFavouriteUserLoggedOut=function(e){Qt("Handle Favourite User "+e+" logged in"),this.updateViewForNamedCollection("",{})},r.handleFavouriteUsersChanged=function(e){Qt("Handle Favourite Users changed to "+e),this.updateViewForNamedCollection("",{})},r.getIdForItemInNamedCollection=function(e,t){return t._id},r.renderDisplayForItemInNamedCollection=function(e,t,n){e.innerHTML=n.username},r.getModifierForItemInNamedCollection=function(e,t){var n=i.normal;return pe.getInstance().isUserLoggedIn(t.username)||(n=i.inactive),n},r.getSecondaryModifierForItemInNamedCollection=function(e,t){var n=i.normal;return zt("Checking for item secondary modifiers "+t.username),ye.getInstance().isFavouriteUser(t.username)&&(zt("is favourite"),n=i.active),ye.getInstance().isBlockedUser(t.username)&&(zt("is blocked"),n=i.warning),n},r.updateViewForNamedCollection=function(t,n){var i,a=[],r=null==(i=this.stateManager)?void 0:i.getStateByName(P);r&&r.forEach((function(e){pe.getInstance().isUserInFavouriteList(e.username)&&a.push(e)})),e.prototype.updateViewForNamedCollection.call(this,t,a)},r.documentLoaded=function(e){},r.handleBlockedUsersChanged=function(e){this.updateViewForNamedCollection("",{})},r.hideRequested=function(e){},r.itemAction=function(e,t,n){if(t===this.collectionUIConfig.extraActions[0].name){if(pe.getInstance().isUserInBlockedList(n.username))return void Qt(n.username+" already in fav list, ignoring");pe.getInstance().addUserToBlockedList(n.username)}},r.canDeleteItem=function(e,t){return!0},r.itemDeleted=function(e,t){Qt("Favourite user "+t.username+" with id "+t.id+" deleted - removing"),pe.getInstance().removeUserFromFavouriteList(t.username)},r.itemDragStarted=function(e,t){},r.itemDeselected=function(e,t){},r.itemDropped=function(e,t){Qt("Handling item dropped "+t.username),pe.getInstance().isUserInFavouriteList(t.username)?Qt(t.username+" already in fav list, ignoring"):pe.getInstance().addUserToFavouriteList(t.username)},r.itemSelected=function(e,t){var n=ye.getInstance().startChatWithUser(t.username);Ke.getInstance().handleShowChat(n)},r.showRequested=function(e){},r.canSelectItem=function(e,t){return!0},a}(It);$t.DOMConfig={viewConfig:{resultsContainerId:"favouriteUsers",drop:{acceptFrom:[z],acceptTypes:[J]},dataSourceId:"favouriteUsers"},resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"_id",keyType:a.string,modifiers:{normal:"list-group-item-primary",inactive:"list-group-item-light",active:"list-group-item-info",warning:"list-group-item-danger"},icons:{normal:"fas fa-comment",inactive:"fas fa-comment",active:"fas fa-heart",warning:"fas fa-exclamation-circle"},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,quickDelete:!0,delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-sm",iconClasses:"fas fa-trash-alt"},drag:{type:J,from:K}},extraActions:[{name:"block",buttonClasses:"btn bg-warning text-white btn-circle btn-sm mr-1",iconClasses:"fas fa-user-slash"}]};const Kt=$t;function Zt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xt(e,t){return(Xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var en=g()("user-search-sidebar"),tn=function(e){var t,n;function a(t){var n;return(n=e.call(this,a.DOMConfig,t,P)||this).renderer=new yt(Zt(n),Zt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(Zt(n)),n.handleFavouriteUserLoggedIn=n.handleFavouriteUserLoggedIn.bind(Zt(n)),n.handleFavouriteUserLoggedOut=n.handleFavouriteUserLoggedOut.bind(Zt(n)),n.handleFavouriteUsersChanged=n.handleFavouriteUsersChanged.bind(Zt(n)),n.handleBlockedUsersChanged=n.handleBlockedUsersChanged.bind(Zt(n)),n.handleLoggedInUsersUpdated=n.handleLoggedInUsersUpdated.bind(Zt(n)),ye.getInstance().addUserListener(Zt(n)),n}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,Xt(t,n);var r=a.prototype;return r.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.addEventListener(this)},r.canDeleteItem=function(e,t){return!0},r.documentLoaded=function(e){},r.itemDeleted=function(e,t){en("Blocked user "+t.username+" with id "+t.id+" deleted - removing"),pe.getInstance().removeUserFromBlockedList(t.username)},r.itemSelected=function(e,t){throw new Error("Method not implemented.")},r.itemDragStarted=function(e,t){throw new Error("Method not implemented.")},r.itemAction=function(e,t,n){throw new Error("Method not implemented.")},r.hideRequested=function(e){throw new Error("Method not implemented.")},r.showRequested=function(e){throw new Error("Method not implemented.")},r.handleLoggedInUsersUpdated=function(e){},r.handleFavouriteUserLoggedIn=function(e){},r.handleFavouriteUserLoggedOut=function(e){},r.handleFavouriteUsersChanged=function(e){},r.handleBlockedUsersChanged=function(e){en("Handle Blocked Users changed to "+e),this.updateViewForNamedCollection("",{})},r.renderDisplayForItemInNamedCollection=function(e,t,n){e.innerHTML=n.username},r.getSecondaryModifierForItemInNamedCollection=function(e,t){return i.warning},r.getIdForItemInNamedCollection=function(e,t){return t._id},r.updateViewForNamedCollection=function(t,n){var i,a=[],r=null==(i=this.stateManager)?void 0:i.getStateByName(P);r&&r.forEach((function(e){pe.getInstance().isUserInBlockedList(e.username)&&a.push(e)})),e.prototype.updateViewForNamedCollection.call(this,t,a)},r.itemDropped=function(e,t){pe.getInstance().isUserInBlockedList(t.username)?en(t.username+" already in blocked list, ignoring"):pe.getInstance().addUserToBlockedList(t.username)},r.itemDeselected=function(e,t){},r.canSelectItem=function(e,t){return!1},a}(It);tn.DOMConfig={viewConfig:{resultsContainerId:"blockedUsers",dataSourceId:"blockedUsers",drop:{acceptFrom:[z,K],acceptTypes:[J]}},resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"_id",keyType:a.string,modifiers:{normal:"list-group-item-primary",inactive:"list-group-item-light",active:"list-group-item-info",warning:"list-group-item-danger"},icons:{normal:"fas fa-comment",inactive:"fas fa-comment",active:"fas fa-heart",warning:"fas fa-exclamation-circle"},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,quickDelete:!0,delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-sm",iconClasses:"fas fa-trash-alt"}}};const nn=tn;var an,rn;!function(e){e[e.checkbox=0]="checkbox",e[e.email=1]="email",e[e.hidden=2]="hidden",e[e.number=3]="number",e[e.password=4]="password",e[e.text=5]="text",e[e.textarea=6]="textarea",e[e.select=7]="select",e[e.radioGroup=8]="radioGroup"}(an||(an={})),function(e){e[e.unset=-1]="unset",e[e.create=0]="create",e[e.update=1]="update"}(rn||(rn={}));var sn,on,dn,cn="data-id";!function(e){e.SHOWN="shown",e.HIDDEN="hidden",e.CANCELLING="cancelling",e.CANCELLING_ABORTED="cancelling-aborted",e.CANCELLED="cancelled",e.SAVING="saving",e.SAVE_ABORTED="save-aborted",e.SAVED="saved",e.DELETING="deleting",e.DELETE_ABORTED="delete-aborted",e.DELETED="deleted",e.CREATING="creating",e.MODIFYING="modifying",e.RESETTING="reset"}(sn||(sn={})),function(e){e[e.equals=0]="equals",e[e.lessThan=1]="lessThan",e[e.lessThanEqual=2]="lessThanEqual",e[e.greaterThan=3]="greaterThan",e[e.greaterThanEqual=4]="greaterThanEqual",e[e.isNull=5]="isNull",e[e.isNotNull=6]="isNotNull",e[e.hasValue=7]="hasValue"}(on||(on={})),function(e){e[e.show=0]="show",e[e.hide=1]="hide",e[e.invalid=2]="invalid",e[e.valid=3]="valid"}(dn||(dn={}));var ln=g()("validation-manager"),un=g()("validation-manager-rule-failure"),hn=function(){function e(){this.formRules=[]}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getName=function(){return"Validation Manager"},t.addRuleToForm=function(e,t){var n=this;ln("Adding rule on form "+e.getId()+" for target field "+t.targetDataFieldId);var i=e.getFieldFromDataFieldId(t.targetDataFieldId);if(!i)return un("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - NOT FOUND in form"),!1;var a={targetField:i,response:t.response,fieldConditions:[],valueConditions:[]};t.conditions.forEach((function(r){if(!r.values&&!r.sourceDataFieldId)return un("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - a condition is missing both values and source field"),!1;if(r.values&&r.sourceDataFieldId){ln("Rule adding for form "+e.getId()+" for target field "+t.targetDataFieldId+" - source field "+r.sourceDataFieldId+" with values "+r.values);var s=e.getFieldFromDataFieldId(r.sourceDataFieldId);if(!s)return un("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - source field "+r.sourceDataFieldId+" NOT FOUND"),!1;a.fieldConditions.push({sourceField:s,comparison:r.comparison,values:r.values}),s.addFieldListener(n)}else if(r.values&&!r.sourceDataFieldId)ln("Rule adding for form "+e.getId()+" for target field "+t.targetDataFieldId+" - values "+r.values),a.valueConditions.push({values:r.values,comparison:r.comparison}),i.addFieldListener(n);else if(r.sourceDataFieldId&&!r.values){ln("Rule adding for form "+e.getId()+" for target field "+t.targetDataFieldId+" - source field "+r.sourceDataFieldId);var o=e.getFieldFromDataFieldId(r.sourceDataFieldId);if(!o)return un("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - source field "+r.sourceDataFieldId+" NOT FOUND"),!1;var d=o.getFieldDefinition().type;switch(i.getFieldDefinition().type){case Te.date:case Te.datetime:if(d!==Te.datetime&&d!==Te.date)return un("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - target is date(time), source is NOT"),!1;break;case Te.time:case Te.shortTime:if(d!==Te.time&&d!==Te.shortTime)return un("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - target is time, source is NOT"),!1;break;case Te.boolean:if(d!==Te.boolean)return un("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - target is boolean, source is NOT"),!1;break;case Te.integer:case Te.float:if(d!==Te.integer&&d!==Te.float)return un("Rule not added for form "+e.getId()+" for target field "+t.targetDataFieldId+" - target is number, source is NOT"),!1}a.fieldConditions.push({sourceField:o,comparison:r.comparison}),o.addFieldListener(n)}})),ln("Converted rule to "),ln(a);var r,s=this.formRules.findIndex((function(t){return t.form.getId()===e.getId()}));return s<0?((r={form:e,rules:[]}).rules.push(a),this.formRules.push(r)):(r=this.formRules[s]).rules.push(a),ln("Current set of rules for form "+e.getId()),ln(r),!0},t.areTwoFieldsEqual=function(e,t){return e.getValue()!==t.getValue()?{ruleFailed:!0,message:e.getName()+" must be equal to "+t.getName()}:{ruleFailed:!1}},t.compareTwoValuesWithTypes=function(e,t,n,i,a){if(!t||!i)return!1;switch(e){case Te.date:t+=" 00:00:00",n===Te.date&&(i+=" 00:00:00");break;case Te.datetime:n===Te.date&&(i+=" 00:00:00");break;case Te.time:n===Te.shortTime&&(i+=":00");break;case Te.shortTime:t+=":00",n===Te.shortTime&&(i+=":00")}switch(ln("Comparing "+t+" of type "+e+" against "+i+" of type "+n),a){case on.lessThan:return t<i;case on.lessThanEqual:return t<=i;case on.greaterThanEqual:return t>=i;case on.greaterThan:return t>i;case on.equals:return t===i}return!1},t.isTargetLessThanSource=function(e,t){var n=t.getFieldDefinition().type,i=e.getFieldDefinition().type,a=t.getValue(),r=e.getValue();return this.compareTwoValuesWithTypes(i,r,n,a,on.lessThan)?{ruleFailed:!1}:{ruleFailed:!0,message:e.getName()+" must be less than "+t.getName()}},t.isTargetLessThanEqualSource=function(e,t){var n=this.areTwoFieldsEqual(e,t);return n.ruleFailed&&(n=this.isTargetLessThanSource(e,t)).ruleFailed?{ruleFailed:!0,message:e.getName()+" must be less than or equal to "+t.getName()}:{ruleFailed:!1}},t.isTargetGreaterThan=function(e,t){var n=t.getFieldDefinition().type,i=e.getFieldDefinition().type,a=t.getValue(),r=e.getValue();return this.compareTwoValuesWithTypes(i,r,n,a,on.greaterThan)?{ruleFailed:!1}:{ruleFailed:!0,message:e.getName()+" must be greater than "+t.getName()}},t.isSourceNull=function(e){var t=e.getValue();return t&&t.trim().length>0?{ruleFailed:!0,message:e.getName()+" must be empty"}:{ruleFailed:!1}},t.isSourceNotNull=function(e){var t=e.getValue();return!t||t.trim().length>0?{ruleFailed:!0,message:e.getName()+" must not be empty"}:{ruleFailed:!1}},t.doesFieldHaveValue=function(e,t){var n=e.getValue();if(ln("does field "+e.getId()+" have value from "+t+" - current value is "+n),n){var i=t.split(","),a=!1;if(i.forEach((function(i){n===i&&(ln("does field "+e.getId()+" have value from "+t+" - current value is "+n+" - found in value(s)"),a=!0)})),a)return{ruleFailed:!1}}return{ruleFailed:!0,message:e.getName()+" must be have a value in "+t}},t.doesSourceFieldHaveValue=function(e,t){return this.doesFieldHaveValue(e,t)},t.isTargetGreaterThanEqualSource=function(e,t){var n=this.areTwoFieldsEqual(e,t);return n.ruleFailed&&(n=this.isTargetGreaterThan(e,t)).ruleFailed?{ruleFailed:!0,message:e.getName()+" must be greater than or equal to "+t.getName()}:{ruleFailed:!1}},t.compareFields=function(e,t,n,i){switch(n){case on.equals:return this.areTwoFieldsEqual(e,t);case on.lessThan:return this.isTargetLessThanSource(e,t);case on.lessThanEqual:return this.isTargetLessThanEqualSource(e,t);case on.greaterThan:return this.isTargetGreaterThan(e,t);case on.greaterThanEqual:return this.isTargetGreaterThanEqualSource(e,t);case on.isNull:return this.isSourceNull(t);case on.isNotNull:return this.isSourceNotNull(t);case on.hasValue:return this.doesSourceFieldHaveValue(t,i)}},t.executeRule=function(e){var t=this,n={field:e.targetField,ruleFailed:!1,response:e.response};return ln("Executing rule for target "+e.targetField.getId()),ln(e),e.fieldConditions.every((function(i){ln("field condition rule"),ln(i);var a=i.values?i.values:"",r=t.compareFields(e.targetField,i.sourceField,i.comparison,a);return r.ruleFailed?(un("field condition rule FAILED"),n.ruleFailed=!0,n.message=r.message,!1):(un("field condition rule PASSED"),!0)})),n.ruleFailed||e.valueConditions.forEach((function(i){ln("value condition rule"),ln(i);var a=t.compareFields(e.targetField,e.targetField,on.hasValue,i.values);return a.ruleFailed?(un("value condition rule FAILED"),n.ruleFailed=!0,n.message=a.message,!1):(un("value condition rule PASSED"),!0)})),n},t.getRulesForFieldChange=function(e,t,n){var i=[];ln("Finding rules for form "+e+" and data field "+t);var a=this.formRules.findIndex((function(t){return t.form.getId()===e}));return a>=0&&this.formRules[a].rules.forEach((function(e){e.targetField.getId()===t?(ln("Found rule where data field "+t+" is target"),e.targetField.isValid()?i.push(e):un("Found rule where data field "+t+" is target but value is not currently valid")):n&&e.fieldConditions.every((function(n){return n.sourceField.getId()!==t||(ln("Found rule where data field "+t+" is source"),n.sourceField.isValid()?i.push(e):un("Found rule where data field "+t+" is source but value is not currently valid"),!1)}))})),i},t.failedValidation=function(e,t,n,i){},t.applyRulesToTargetField=function(e,t,n){var i=this;ln("Checking rules for form "+e+", data field "+t.id+" of type "+n);var a=this.getRulesForFieldChange(e,t.id,!1),r={ruleFailed:!1};if(n){var s=[];a.forEach((function(e){e.response===n&&s.push(e)})),a=s}return a.forEach((function(n){var a=i.executeRule(n);a.ruleFailed&&(un("Rule failed for form "+e+" with field "+t.displayName+" with message "+a.message),r.ruleFailed=!0,r.message=a.message)})),r},t.valueChanged=function(e,t,n){var i=this;ln("Handling field change - form "+e+", data field "+t.id+", value "+n);var a=this.getRulesForFieldChange(e,t.id,!0),r=[];a.forEach((function(e){var t=i.executeRule(e);t.ruleFailed&&r.push(t)})),ln("Have "+r.length+" failed rules - applying each"),r.forEach((function(e){switch(e.response){case dn.hide:ln("Apply hide "+e.field.getId()),e.field.hide();break;case dn.show:ln("Apply show "+e.field.getId()),e.field.show();break;case dn.invalid:ln("Apply invalid "+e.field.getId()),e.message&&e.field.setInvalid(e.message);break;case dn.valid:ln("Apply valid "+e.field.getId()),e.field.setValid()}}))},e}();function mn(){return(mn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var fn=g()("abstract-form"),gn=g()("abstract-form-detail"),vn=g()("abstract-form-detail-validation"),pn=function(){function e(e,t){if(this.formListeners=[],this.fieldListeners=[],this.uiDef=null,this.isVisible=!1,this.fields=[],this.isInitialised=!1,this.hasChangedBoolean=!1,this.isDisplayOnly=!1,this.containerEl=document.getElementById(e),!this.containerEl)throw new Error("container "+e+" for form "+t.id+" does not exist");this.map=[],this.dataObjDef=t,this.currentDataObj={},this.id=(0,ge.Z)(),this.addFormListener(this)}var t=e.prototype;return t.hasChanged=function(){return this.hasChangedBoolean},t.getName=function(){return this.dataObjDef.displayName},t.valueChanged=function(e,t,n){this.hasChangedBoolean=!0,this.setUnsavedMessage(),fn("Form has changed")},t.failedValidation=function(e,t,n,i){this.hasChangedBoolean=!0,fn("Form has changed")},t.initialise=function(e,t,n){void 0===n&&(n=!1),this.isInitialised||(this.isInitialised=!0,this._initialise(e,t,n))},t.addFieldListener=function(e){this.fieldListeners.push(e)},t.addFormListener=function(e){this.formListeners.push(e)},t.informFormListeners=function(e,t){this.formListeners.forEach((function(n){return n.formChanged(e,t)}))},t.findFieldUiConfig=function(e){gn("Finding field UI Config for field "+e.displayName);var t=null;if(this.uiDef)for(var n=0;n<this.uiDef.fieldGroups.length;){if(t=this.uiDef.fieldGroups[n].fields.find((function(t){return t.field.id===e.id}))){gn("Finding field UI Config for field "+e.displayName+" - Found");break}n++}return t},t.reset=function(){if(fn("Resetting form"),this.clearUnsavedMessage(),this.isDisplayOnly=!1,this.hasChangedBoolean=!1,this.uiDef){var e={formId:this.id,target:this,eventType:sn.RESETTING};this.informFormListeners(e,this.currentDataObj)}this.currentDataObj={},this._reset(),this.fields.forEach((function(e){e.reset()})),this.hasChangedBoolean=!1},t.setIsVisible=function(e){if(fn("Changing visibility to "+e),this.isVisible=e,this.uiDef){var t=sn.HIDDEN;this.isVisible?(this._visible(),t=sn.SHOWN):this._hidden();var n={formId:this.id,target:this,eventType:t};this.informFormListeners(n,this.currentDataObj)}e&&!this.isDisplayOnly&&this.checkFormValidationOnDisplay(),e&&this.isDisplayOnly&&this.checkForVisualValidationForDisplayOnly()},t.checkForVisualValidationForDisplayOnly=function(){var e=this;fn("Checking display validation for display only"),this.fields.forEach((function(t){t.show();var n=hn.getInstance().applyRulesToTargetField(e.id,t.getFieldDefinition(),dn.hide);n.ruleFailed&&(t.hide(),vn("Field "+t.getId()+" is hidden from validation manager with message "+n.message))}))},t.checkFormValidationOnDisplay=function(){var e=this;fn("Checking display validation"),this.fields.forEach((function(t){if(t.show(),t.getValue(),t.isValid()){var n=hn.getInstance().applyRulesToTargetField(e.id,t.getFieldDefinition(),dn.invalid);n.ruleFailed&&(t.setInvalid(n.message),vn("Field "+t.getId()+" is invalid from validation manager with message "+n.message)),(n=hn.getInstance().applyRulesToTargetField(e.id,t.getFieldDefinition(),dn.hide)).ruleFailed&&(t.hide(),vn("Field "+t.getId()+" is hidden from validation manager with message "+n.message))}else fn("Field "+t.getId()+" is invalid"),t.setInvalid(t.getName()+" has an invalid format or is required.")}))},t.startCreateNew=function(){if(this.clearUnsavedMessage(),fn("Starting create new"),this.reset(),this.currentDataObj={},this.isDisplayOnly=!1,this.hasChangedBoolean=!1,this.uiDef){var e=sn.CREATING,t={formId:this.id,target:this,eventType:e};this._startCreate(),this.informFormListeners(t,this.currentDataObj)}return this.clearReadOnly(),this.currentDataObj},t.startUpdate=function(e){if(this.clearUnsavedMessage(),fn("Starting modify existing on "),this.isDisplayOnly=!1,this.hasChangedBoolean=!1,fn(e),this.currentDataObj=mn({},e),this.uiDef){var t=sn.MODIFYING,n={formId:this.id,target:this,eventType:t};this._startUpdate(),this.informFormListeners(n,this.currentDataObj)}this.clearReadOnly()},t.displayOnly=function(e){this.clearUnsavedMessage(),fn("Starting display only "),fn(e),this.isDisplayOnly=!0,this.hasChangedBoolean=!1,this.currentDataObj=mn({},e),this.uiDef&&this._displayOnly(),this.setReadOnly()},t.formChanged=function(e,t){var n=this,i=!1;switch(e.eventType){case sn.CANCELLING:if(fn("Form is cancelling"),this.hasChangedBoolean&&!this.isDisplayOnly)this.uiDef&&ct.getInstance().startAlert(this,this.uiDef.displayName,"Lose any unsaved changes?",sn.CANCELLING);else if(this.uiDef){var a={formId:this.id,target:this,eventType:sn.CANCELLED};this.informFormListeners(a,this.currentDataObj)}break;case sn.CANCELLING_ABORTED:fn("Form is cancelling - aborted");break;case sn.CANCELLED:fn("Form is cancelled - resetting"),this.isDisplayOnly=!0,this.reset(),this.setReadOnly();break;case sn.DELETING:fn("Form is deleting"),this.uiDef&&ct.getInstance().startAlert(this,this.uiDef.displayName,"Are you sure you want to delete this information?",sn.DELETING);break;case sn.DELETE_ABORTED:fn("Form is deleting - aborted");break;case sn.DELETED:fn("Form is deleted - resetting"),this.reset();break;case sn.SAVE_ABORTED:this._saveFinishedOrAborted(),fn("Form save cancelled");break;case sn.SAVED:this._saveFinishedOrAborted(),fn("Form is saved with data"),fn(t),this.isDisplayOnly=!1,this.hasChangedBoolean=!1;break;case sn.SAVING:if(fn("Form is saving, checking validation and storing values"),this._saveIsActive(),this.uiDef){var r=!0;if(this.fields.forEach((function(e){var t=e.getValue();if(e.isValid()){var i=hn.getInstance().applyRulesToTargetField(n.id,e.getFieldDefinition(),dn.invalid);i.ruleFailed?(e.setInvalid(i.message),vn("Field "+e.getId()+" is invalid from validation manager with message "+i.message),r=!1):n.setFieldValueToDataObject(n.currentDataObj,e,t)}else vn("Field "+e.getId()+" is invalid"),e.setInvalid(e.getName()+" has an invalid format or is required."),r=!1})),r){fn("formatted data object is");var s=this.getFormattedDataObject(),o={formId:this.id,target:this,eventType:sn.SAVED};this.informFormListeners(o,s)}else{fn("Form is saving, checking validation - FAILED");var d={formId:this.id,target:this,eventType:sn.SAVE_ABORTED};this.informFormListeners(d,this.currentDataObj),i=!0}break}}return i},t.getId=function(){return this.id},t.getFieldFromDataFieldId=function(e){var t=void 0;gn("Finding field for attribute "+e+" ");var n=this.map.find((function(t){return t.attributeId===e}));return n&&(gn("Mapped attribute "+n.attributeId+" to field "+n.fieldId),t=this.fields.find((function(e){return e.getId()===n.attributeId}))),t},t.completed=function(e){if(fn("Handling alert completed"),fn(e),e.context&&this.uiDef)switch(e.context){case sn.CANCELLING:if(e.outcome===it.confirmed){var t={formId:this.id,target:this,eventType:sn.CANCELLED};this.informFormListeners(t,this.currentDataObj)}else{var n={formId:this.id,target:this,eventType:sn.CANCELLING_ABORTED};this.informFormListeners(n,this.currentDataObj)}break;case sn.DELETING:if(e.outcome===it.confirmed){var i={formId:this.id,target:this,eventType:sn.DELETED};this.informFormListeners(i,this.currentDataObj)}else{var a={formId:this.id,target:this,eventType:sn.DELETE_ABORTED};this.informFormListeners(a,this.currentDataObj)}}},t.clearReadOnly=function(){this.fields.forEach((function(e){e.clearReadOnly()}))},t.setReadOnly=function(){this.fields.forEach((function(e){e.setReadOnly()}))},t.isDisplayingItem=function(e){return!!this.currentDataObj&&this._isSameObjectAsDisplayed(e)},t.isReadOnly=function(){return this.isDisplayOnly},e}(),Cn=g()("basic-field-operations-formatter"),In=g()("basic-field-operations-validator"),bn=(g()("basic-field-operations-generator"),g()("basic-field-operations-renderer")),yn=function(){function e(){this.radioButtons=[]}var t=e.prototype;return t.formatValue=function(e,t){Cn("Handling format value for RBG "+e.displayName+" with value "+t);var n=t;return this.radioButtons.forEach((function(t){t.checked&&(n=t.value,e.idType===a.number&&(n=parseInt(n)))})),Cn("Handling format value for field "+e.displayName+" with value "+t+" - result is "+n),n},t.isValidValue=function(e,t){In("Handling is valid value for field "+e.displayName+" with value "+t);var n={isValid:!1,resetOnFailure:!1};if(e.mandatory){if(this.radioButtons.forEach((function(e){e.checked&&(n.isValid=!0)})),!n.isValid)return n.message=e.displayName+" is required. Please select one of the values.",In("Handling is valid value for field "+e.displayName+" with value "+t+" - is valid is "+n.isValid+" with message "+n.message),n}else n.isValid=!0;return In("Handling is valid value for field "+e.displayName+" with value "+t+" - is valid is "+n.isValid+" with message "+n.message),n},t.renderValue=function(e,t){return bn("Rendering value for field "+e.displayName+" with new value "+t),this.radioButtons.forEach((function(e){e.value===t&&(e.checked=!0)})),null},t.generate=function(e,t){return""},t.setSubElements=function(e){this.radioButtons=e},e}(),wn=g()("bootstrap-form-config-helper"),En=function(){function e(){}return e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.generateFormConfig=function(e,t,n,i){void 0===i&&(i=!1);var a=new _e,r=new yn,s=[];e.fields.forEach((function(e,n){var o=an.text;switch(e.type){case Te.time:case Te.text:case Te.date:case Te.shortTime:case Te.duration:break;case Te.datetime:i&&(e.id===je&&(o=an.hidden),e.id===Be&&(o=an.hidden));break;case Te.userId:o=i?an.hidden:an.text;break;case Te.uuid:case Te.id:o=an.hidden;break;case Te.integer:case Te.float:o=an.number;break;case Te.email:o=an.email;break;case Te.password:o=an.password;break;case Te.boolean:o=an.checkbox;break;case Te.largeText:o=an.textarea;break;case Te.choice:o=an.select;break;case Te.limitedChoice:o=an.radioGroup}var d=t.find((function(t){return t.fieldId===e.id})),c=n;d&&(c=d.displayOrder);var l={field:e,displayOrder:c,elementType:o,elementClasses:"form-control col-sm-9",renderer:a,formatter:a};e.type!==Te.id&&e.type!==Te.uuid&&o!==an.hidden&&(l.containedBy={elementType:"div",elementClasses:"form-group row"},l.label={label:e.displayName,classes:"col-md-12 col-lg-3 col-form-label"},e.description&&(l.describedBy={message:e.description,elementType:"small",elementClasses:"text-muted col-md-12 col-lg-9 offset-lg-3 mt-1"}),e.displayOnly||(l.validator={validator:a,messageDisplay:{elementType:"div",elementClasses:"invalid-feedback col-md-12 col-lg-9 offset-lg-3"},validClasses:"is-valid",invalidClasses:"is-invalid"})),e.type===Te.largeText&&(l.textarea={rows:5,cols:20}),e.type===Te.choice&&(l.subElement={element:{elementType:"option",elementClasses:""}},l.datasource=e.dataSource),e.type===Te.limitedChoice&&(l.subElement={element:{elementType:"input",elementClasses:"form-check-input",elementAttributes:[{name:"type",value:"radio"}]},container:{elementType:"div",elementClasses:"form-check form-check-inline"},label:{label:"label",classes:"form-check-label"}},l.renderer=r,l.validator&&(l.validator.validator=r),l.formatter=r,l.datasource=e.dataSource),s.push(l)}));var o={containedBy:{elementType:"div",elementClasses:"col-sm-12"},fields:s},d={id:e.id,displayName:e.displayName,fieldGroups:[o],unsavedChanges:{elementType:"div",elementClasses:"invalid-feedback text-right col-md-12 col-lg-9 offset-lg-3",elementAttributes:[{name:"style",value:"display:block"}],innerHTML:"Pending changes to "+e.displayName},buttonsContainedBy:{elementType:"div",elementClasses:"d-flex w-100 justify-space-between"},cancelButton:{buttonText:"Cancel  ",buttonClasses:"btn-info rounded p-1 mr-2 mt-2 w-100",iconClasses:"fas fa-ban"},submitButton:{buttonText:"Save  ",buttonClasses:"btn-primary rounded p-1 mt-2 w-100",iconClasses:"fas fa-save"},activeSave:'<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;'};return d.fieldGroups.forEach((function(e){e.fields.sort((function(e,t){return e.displayOrder-t.displayOrder}))})),n&&(d.deleteButton={buttonText:"Delete  ",buttonClasses:"btn-warning rounded p-1 mr-2 mt-2 w-100",iconClasses:"fas fa-trash-alt"}),wn(d),d},e}(),Ln=function(){function e(e,t,n,i){void 0===i&&(i=null),this.formId=e,this.fieldConfig=t,this.listeners=n,this.subElements=i,this.handleEvent=this.handleEvent.bind(this)}var t=e.prototype;return t.setValidationStatusAndMessage=function(e,t,n,i,a){var r=this;if(void 0===i&&(i=void 0),void 0===a&&(a=!1),this.fieldConfig.validator&&e){var s=this.fieldConfig.field,o=e;if(this.subElements&&(this.fieldConfig.validator.validator.setSubElements(this.subElements),this.fieldConfig.subElement)){var d=e.parentElement;d&&(o=d,this.fieldConfig.subElement.container&&(d=d.parentElement)&&(o=d))}var c=document.getElementById(this.formId+".field."+this.fieldConfig.field.id+".error"),l=document.getElementById(this.formId+".field."+this.fieldConfig.field.id+".error.message");if(null==c||c.setAttribute("style","display:none"),l&&(l.innerHTML=""),this.fieldConfig.validator.invalidClasses&&h.addRemoveClasses(o,this.fieldConfig.validator.invalidClasses,!1),this.fieldConfig.validator.validClasses&&h.addRemoveClasses(o,this.fieldConfig.validator.validClasses),!t){if(this.fieldConfig.validator.invalidClasses&&h.addRemoveClasses(o,this.fieldConfig.validator.invalidClasses),this.fieldConfig.validator.validClasses&&h.addRemoveClasses(o,this.fieldConfig.validator.validClasses,!1),i||(i=s.displayName+" does not have a valid value."),null==c||c.setAttribute("style","display:block"),l&&(l.innerHTML=i),a)switch(s.type){case Te.boolean:e.checked=!1;break;case Te.integer:e.value="0";break;case Te.float:e.value="0.0";break;default:e.value=""}this.listeners.forEach((function(e){return e.failedValidation(r.formId,s,n,i)}))}}},t.processValidation=function(e){if(this.fieldConfig.validator&&e){var t=this.fieldConfig.field,n=e.value;this.fieldConfig.elementType===an.checkbox&&(n=""+e.checked),this.subElements&&(n="",this.subElements.forEach((function(e){e.checked&&(n=e.value)})));var i=this.fieldConfig.validator.validator.isValidValue(t,n);this.setValidationStatusAndMessage(e,i.isValid,n,i.message,i.resetOnFailure)}},t.handleEvent=function(e){e.preventDefault(),e.stopPropagation();var t=e.target;this.processValidation(t)},e}(),Sn=function(){function e(e,t,n){this.formId=e,this.fieldConfig=t,this.listeners=n,this.handleEvent=this.handleEvent.bind(this)}return e.prototype.handleEvent=function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=e.target;if(this.fieldConfig.editor){var i=this.fieldConfig.field,a=n.value,r=this.fieldConfig.editor.editValue(i,a);r&&(n.value=r,this.listeners.forEach((function(e){return e.valueChanged(t.formId,i,r)})))}},e}(),Fn=function(){function e(e,t,n){this.formId=e,this.parentElement=t,this.fieldUIConfig=n}return e.prototype.optionsChanged=function(e){h.removeAllChildren(this.parentElement),Nn.createSubElements(this.formId,this.parentElement,this.fieldUIConfig,e)},e}(),Nn=function(){function e(){}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.initialiseFieldElementAndEventHandlers=function(e,t,n,i,a){if(void 0===a&&(a=null),e.setAttribute("id",t+".field."+n.field.id),e.setAttribute(cn,n.field.id),e.setAttribute("name",n.field.id),n.elementAttributes&&h.addAttributes(e,n.elementAttributes),n.elementClasses&&h.addRemoveClasses(e,n.elementClasses),n.field.displayOnly&&h.addAttributes(e,[{name:"disabled",value:"true"},{name:"readonly",value:"true"}]),n.validator){var r=new Ln(t,n,i,a);a?a.forEach((function(e){e.addEventListener("blur",r)})):e.addEventListener("blur",r)}n.editor&&e.addEventListener("focus",new Sn(t,n,i)),n.field.type===Te.date&&($(e).datepicker(),$(e).datepicker("option","dateFormat","dd/mm/yy"))},e.createFieldComponentsAndContainer=function(e,t,n,i,a){var r=null;if(i.validator){(r=document.createElement("div")).setAttribute("id",t+".field."+i.field.id+".error"),r.setAttribute("style","display: none"),h.addRemoveClasses(r,i.validator.messageDisplay.elementClasses);var s=document.createElement(i.validator.messageDisplay.elementType);s&&(s.setAttribute("id",t+".field."+i.field.id+".error.message"),i.validator.messageDisplay.elementAttributes&&h.addAttributes(s,i.validator.messageDisplay.elementAttributes),r.appendChild(s))}if(i.containedBy){var o=document.createElement(i.containedBy.elementType);if(o){if(h.addRemoveClasses(o,i.containedBy.elementClasses),o.setAttribute("id",t+".field."+i.field.id+".container"),i.containedBy.elementAttributes&&h.addAttributes(n,i.containedBy.elementAttributes),i.label){var d=document.createElement("label");d.setAttribute("for",t+".field."+i.field.id),d.innerHTML=i.field.displayName,i.label.attributes&&h.addAttributes(d,i.label.attributes),i.label.classes&&h.addRemoveClasses(d,i.label.classes),o.appendChild(d)}if(i.describedBy){var c=document.createElement(i.describedBy.elementType);c?(c.setAttribute("id",t+".field."+i.field.id+".desc"),i.field.description&&(c.innerHTML=i.field.description),e.setAttribute("aria-describedby",t+".field."+i.field.id+".desc"),i.describedBy.elementClasses&&h.addRemoveClasses(c,i.describedBy.elementClasses),o.appendChild(e),o.appendChild(c),r&&o.appendChild(r)):(o.appendChild(e),r&&o.appendChild(r))}else o.appendChild(e),r&&o.appendChild(r);n.appendChild(o)}else n.appendChild(e),r&&n.appendChild(r)}else n.appendChild(e),r&&n.appendChild(r)};var t=e.prototype;return t.createInputFormFieldComponentElement=function(t,n,i,a){var r=document.createElement("input");switch(i.elementType){case an.checkbox:r.setAttribute("type","checkbox"),r.setAttribute("value",i.field.id);break;case an.email:r.setAttribute("type","email");break;case an.hidden:r.setAttribute("type","hidden");break;case an.number:r.setAttribute("type","number");break;case an.password:r.setAttribute("type","password");break;case an.text:r.setAttribute("type","text")}return e.initialiseFieldElementAndEventHandlers(r,t,i,a),e.createFieldComponentsAndContainer(r,t,n,i,a),r},t.createTAFormFieldComponentElement=function(t,n,i,a){var r=document.createElement("textarea");return i.textarea&&(r.setAttribute("rows",""+i.textarea.rows),r.setAttribute("cols",""+i.textarea.cols)),e.initialiseFieldElementAndEventHandlers(r,t,i,a),e.createFieldComponentsAndContainer(r,t,n,i,a),r},e.createSubElements=function(e,t,n,i){var a=[];return i.forEach((function(i,r){if(n.subElement){var s=t;n.subElement.container&&(s=document.createElement(n.subElement.container.elementType),h.addRemoveClasses(s,n.subElement.container.elementClasses),n.subElement.container.elementAttributes&&h.addAttributes(s,n.subElement.container.elementAttributes),t.appendChild(s));var o=document.createElement(n.subElement.element.elementType);if(o.setAttribute("value",i.value),o.setAttribute("id",e+".field."+n.field.id+"."+r),o.setAttribute("name",e+".field."+n.field.id),h.addRemoveClasses(o,n.subElement.element.elementClasses),n.subElement.element.elementAttributes&&h.addAttributes(o,n.subElement.element.elementAttributes),s.appendChild(o),n.subElement.label){var d=document.createElement("label");n.subElement.label.classes&&h.addRemoveClasses(d,n.subElement.label.classes),n.subElement.label.attributes&&h.addAttributes(d,n.subElement.label.attributes),d.innerHTML=i.name,s.appendChild(d)}else o.innerHTML=i.name;a.push(o)}})),a},t.createSelectFormFieldComponentElement=function(t,n,i,a){var r=document.createElement("select");return i.datasource&&(e.createSubElements(t,r,i,i.datasource.getOptions()),i.datasource.addListener(new Fn(t,r,i))),e.initialiseFieldElementAndEventHandlers(r,t,i,a),e.createFieldComponentsAndContainer(r,t,n,i,a),r},t.createRadioGroupFormFieldComponentElement=function(t,n,i,a){var r=document.createElement("div");i.elementAttributes&&h.addAttributes(r,i.elementAttributes),i.elementClasses&&h.addRemoveClasses(r,i.elementClasses);var s=[];return i.datasource&&(s=e.createSubElements(t,r,i,i.datasource.getOptions()),i.datasource.addListener(new Fn(t,r,i)),i.validator&&i.validator.validator.setSubElements(s),i.renderer&&i.renderer.setSubElements(s),i.formatter&&i.formatter.setSubElements(s)),e.initialiseFieldElementAndEventHandlers(r,t,i,a,s),e.createFieldComponentsAndContainer(r,t,n,i,a),{container:r,radioButtons:s}},e}(),Dn=function(){function e(){}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.createFormButton=function(e,t,n,i,a){var r=document.createElement("button");if(h.addRemoveClasses(r,i.buttonClasses),r.setAttribute("id",t.id+"."+a),i.buttonText&&(r.innerText=i.buttonText),i.iconClasses){var s=document.createElement("i");s&&(h.addRemoveClasses(s,i.iconClasses),r.appendChild(s))}return r.addEventListener("click",(function(i){i.preventDefault(),i.stopPropagation();var r={target:e,formId:t.id,eventType:a};n.forEach((function(e){return e.formChanged(r)}))})),r},t.createFormElements=function(e,t,n,i){var a=document.createElement("form");a.setAttribute("id",n.id),a.setAttribute("name",n.displayName),n.classes&&h.addRemoveClasses(a,n.classes);var r=[],s=[],o=[],d=[],c=document.createElement(n.unsavedChanges.elementType);h.addRemoveClasses(c,n.unsavedChanges.elementClasses),n.unsavedChanges.elementAttributes&&h.addAttributes(c,n.unsavedChanges.elementAttributes),a.appendChild(c),n.fieldGroups.forEach((function(e){var t=a;e.containedBy&&(t=document.createElement(e.containedBy.elementType))&&(e.containedBy.elementAttributes&&h.addAttributes(t,e.containedBy.elementAttributes),e.containedBy.elementClasses&&h.addRemoveClasses(t,e.containedBy.elementClasses),a.appendChild(t)),e.fields.forEach((function(e){switch(e.elementType){case an.textarea:var a=Nn.getInstance().createTAFormFieldComponentElement(n.id,t,e,i);s.push(a);break;case an.select:var c=Nn.getInstance().createSelectFormFieldComponentElement(n.id,t,e,i);d.push(c);break;case an.radioGroup:var l=Nn.getInstance().createRadioGroupFormFieldComponentElement(n.id,t,e,i);o.push(l);break;default:var u=Nn.getInstance().createInputFormFieldComponentElement(n.id,t,e,i);r.push(u)}}))}));var l=a;n.buttonsContainedBy&&((l=document.createElement(n.buttonsContainedBy.elementType))?(n.buttonsContainedBy.elementAttributes&&h.addAttributes(l,n.buttonsContainedBy.elementAttributes),h.addRemoveClasses(l,n.buttonsContainedBy.elementClasses),a.appendChild(l)):l=a);var u=void 0;n.deleteButton&&(u=this.createFormButton(e,n,t,n.deleteButton,sn.DELETING),l.appendChild(u));var m=this.createFormButton(e,n,t,n.cancelButton,sn.CANCELLING);l.appendChild(m);var f=this.createFormButton(e,n,t,n.submitButton,sn.SAVING);return l.appendChild(f),{form:a,unsavedMessage:c,fields:r,selectFields:d,radioButtonGroups:o,textFields:s,deleteButton:u,cancelButton:m,submitButton:f}},e}(),kn=function(){function e(e,t,n,i){void 0===i&&(i=null),this.formId=e,this.fieldConfig=t,this.listeners=n,this.subElements=i,this.handleEvent=this.handleEvent.bind(this)}var t=e.prototype;return t.processRendering=function(e){var t="";if(this.fieldConfig.renderer){var n=this.fieldConfig.field,i=e.value;this.subElements&&this.fieldConfig.renderer.setSubElements(this.subElements),(t=this.fieldConfig.renderer.renderValue(n,i))&&(e.value=t,this.listeners.forEach((function(e){return e.valueChanged(n,t)})))}return t||""},t.handleEvent=function(e){e.preventDefault(),e.stopPropagation();var t=e.target;this.processRendering(t)},e}(),Tn=g()("abstract-field"),Rn=function(){function e(e,t,n,i,a){var r=this;void 0===a&&(a=null),this.config=null,this.subElements=[],this.listeners=[],this.hidden=!1,this.formId=e,this.config=t,this.definition=n,this.element=i,a&&(this.subElements=a),this.validationHandler=new Ln(e,t,[this],a),this.renderingHandler=new kn(e,t,[this],a),this.handleChangeEvent=this.handleChangeEvent.bind(this),this.subElements?this.subElements.forEach((function(e){e.addEventListener("change",r.handleChangeEvent)})):this.element.addEventListener("change",this.handleChangeEvent)}var t=e.prototype;return t.isHidden=function(){return this.hidden},t.handleChangeEvent=function(e){var t=this;if(Tn("Handling change event"),this.config){var n=this.getValue();Tn("Handling change event - informing listeners"),this.listeners.forEach((function(e){return e.valueChanged(t.formId,t.definition,n)}))}},t.addFieldListener=function(e){Tn(this.getName()+" - adding listener "+e.getName()),this.listeners.findIndex((function(t){return t.getName()===e.getName()}))<0?this.listeners.push(e):Tn(this.getName()+" - duplicate listener "+e.getName()+" ignored")},t.getFieldDefinition=function(){return this.definition},t.setInvalid=function(e){var t=this;this.validationHandler.setValidationStatusAndMessage(this.element,!1,"",e,!1),this.listeners.forEach((function(n){return n.failedValidation(t.formId,t.definition,t.getValue(),e)}))},t.initialise=function(){},t.getValue=function(){var e=this,t=null;if(this.config&&this.element)switch(this.config.elementType){case an.radioGroup:Tn(this.definition.id+" - getting value - rbg"),this.subElements&&this.subElements.forEach((function(n){n.checked&&(Tn(e.definition.id+" - getting value - rbg - checked "+n.value),t=n.value,n.checked=!0)}));break;case an.checkbox:t=""+this.element.checked;break;default:t=this.element.value}return Tn(this.definition.id+" - getting value - "+t),t},t.getFormattedValue=function(){var e=null;return this.config&&this.element&&(e=this.element.value,this.config.elementType===an.checkbox&&(e=""+this.element.checked),this.config.formatter&&(e=this.config.formatter.formatValue(this.definition,e))),e},t.isValid=function(){var e=!0;return this.config&&this.element&&this.config.validator&&this.config.validator.validator&&(e=this.config.validator.validator.isValidValue(this.definition,this.getValue()).isValid),e},t.getId=function(){return this.definition.id},t.setValue=function(e){if(e=""+e,this.element&&this.config)switch(this.config.elementType){case an.radioGroup:this.subElements&&this.subElements.forEach((function(t){t.value===e&&(t.checked=!0)}));break;case an.checkbox:this.element.checked="true"===e.toLowerCase();break;case an.select:Tn(this.definition.id+" - setting value - "+e);for(var t=this.element,n=-1,i=0;i<t.options.length;i++){var a=t.options.item(i);Tn(this.definition.id+" - option value - "+a.value),a.value===e&&(Tn(this.definition.id+" - option value - "+a.value+" - SELECTED"),a.selected=!0,n=i)}Tn(this.definition.id+" - selected index "+n),t.selectedIndex=n;break;default:Tn(this.definition.id+" - setting value - "+e),this.element.value=e}},t.reset=function(){if(this.element)switch(this.definition.type){case Te.boolean:this.element.checked=!1;break;case Te.integer:this.element.value="0";break;case Te.float:this.element.value="0.0";break;case Te.limitedChoice:this.subElements&&this.subElements.forEach((function(e){e.checked=!1}));break;default:this.element.value=""}this.show()},t.clearValue=function(){this.reset()},t.validate=function(){this.element&&this.validationHandler.processValidation(this.element)},t.render=function(e){var t,n=e;if(null!=(t=this.config)&&t.renderer){var i=this.config.renderer.renderValue(this.definition,e);i&&(n=i)}return n},t.failedValidation=function(e,t,n,i){},t.valueChanged=function(e,t,n){},t.getName=function(){return this.definition.displayName},t.hide=function(){if(this.config)if(this.config.containedBy){var e=this.element.parentElement;e&&e.setAttribute("style","display:none")}else this.setReadOnly();this.hidden=!0},t.setValid=function(){this.validationHandler.setValidationStatusAndMessage(this.element,!0,"")},t.show=function(){if(this.config)if(this.config.containedBy){var e=this.element.parentElement;e&&e.removeAttribute("style")}else this.clearReadOnly();this.hidden=!0},t.clearReadOnly=function(){this.definition.displayOnly||(this.element.removeAttribute("readonly"),this.element.removeAttribute("disabled"),this.subElements&&this.subElements.forEach((function(e){e.removeAttribute("readonly"),e.removeAttribute("disabled")})))},t.setReadOnly=function(){this.element.setAttribute("readonly","true"),this.element.setAttribute("disabled","true"),this.subElements&&this.subElements.forEach((function(e){e.setAttribute("readonly","true"),e.setAttribute("disabled","true")}))},e}();function An(e,t){return(An=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var On=function(e){var t,n;function i(t,n,i,a){return e.call(this,t,n,i,a)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,An(t,n),i}(Rn);function Un(e,t){return(Un=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var xn=function(e){var t,n;function i(t,n,i,a,r){return e.call(this,t,n,i,a,r)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Un(t,n),i}(Rn);function Mn(e,t){return(Mn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _n=function(e){var t,n;function i(t,n,i,a){return e.call(this,t,n,i,a)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Mn(t,n),i}(Rn);function jn(e,t){return(jn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Bn=function(e){var t,n;function i(t,n,i,a){return e.call(this,t,n,i,a)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,jn(t,n),i}(Rn);function Vn(e,t){return(Vn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pn=g()("basic-form"),Hn=g()("basic-form-detail"),Wn=function(e){var t,n;function i(t,n){var i;return(i=e.call(this,t,n)||this).factoryElements=null,i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Vn(t,n);var a=i.prototype;return a._hidden=function(){var e;this.factoryElements&&(null==(e=this.containerEl)||e.removeChild(this.factoryElements.form))},a.setupFieldObject=function(e,t){void 0===t&&(t=[]);var n=e.getAttribute(cn),i=e.getAttribute("id");if(Hn("Converting field input element "+i+" with data-id of "+n),n&&i){this.dataObjDef.fields.findIndex((function(e){return e.id===n}));var a=this.dataObjDef.fields.find((function(e){return e.id===n}));if(a){Hn("Converting field input element "+i+" with data-id of "+n+" field definition is"),Pn(a);var r=this.findFieldUiConfig(a);if(Hn("Converting field input element "+i+" with data-id of "+n+" field ui config is"),Pn(r),r&&this.uiDef){var s;switch(r.elementType){case an.textarea:s=new On(this.id,r,a,e);break;case an.radioGroup:s=new xn(this.id,r,a,e,t);break;case an.select:s=new _n(this.id,r,a,e);break;default:s=new Bn(this.id,r,a,e)}this.fields.push(s),s.addFieldListener(this),this.map.push({attributeId:n,fieldId:i})}}else Hn("Converting field input element "+i+" with data-id of "+n+" field definition is NOT FOUND")}},a.clearUnsavedMessage=function(){this.factoryElements&&(this.factoryElements.unsavedMessage.innerHTML="")},a.setUnsavedMessage=function(){this.factoryElements&&this.uiDef&&this.uiDef.unsavedChanges.innerHTML?this.factoryElements.unsavedMessage.innerHTML=this.uiDef.unsavedChanges.innerHTML:this.factoryElements&&(this.factoryElements.unsavedMessage.innerHTML="Pending changes to save")},a._initialise=function(e,t,n){var i=this;void 0===n&&(n=!1),Pn("Initialising"),this.uiDef=En.getInstance().generateFormConfig(this.dataObjDef,e,t,n),Pn(this.uiDef),this.factoryElements=Dn.getInstance().createFormElements(this,this.formListeners,this.uiDef,this.fieldListeners),Pn(this.factoryElements),Pn("Converting field input elements to Field objects"),this.factoryElements.fields.forEach((function(e){e.addEventListener("keyup",(function(e){Hn("key up in form "+i.getName()),i.hasChangedBoolean=!0,i.setUnsavedMessage()})),i.setupFieldObject(e)})),Pn("Converting field text area elements to Field objects"),this.factoryElements.textFields.forEach((function(e){e.addEventListener("keyup",(function(e){Hn("key up in form "+i.getName()),i.hasChangedBoolean=!0,i.setUnsavedMessage()})),i.setupFieldObject(e)})),Pn("Converting field select elements to Field objects"),this.factoryElements.selectFields.forEach((function(e){Hn("key up in form "+i.getName())})),Pn("Converting field rbg elements to Field objects"),this.factoryElements.radioButtonGroups.forEach((function(e){i.setupFieldObject(e.container,e.radioButtons)})),Pn("field/data map is "),Pn(this.map),Pn("fields are"),Pn(this.fields)},a._reset=function(){this.clearUnsavedMessage()},a.validateField=function(e){var t=this.getFieldFromDataFieldId(e.id);t&&t.validate()},a.renderField=function(e,t){var n=t,i=this.getFieldFromDataFieldId(e.id);return i&&(n=i.render(n)),n},a._startCreate=function(){var e=this;this.clearUnsavedMessage(),this.dataObjDef.fields.forEach((function(t){if(t.generator&&t.generator.onCreation){var n=t.generator.generator.generate(t,!0);Hn("Setting default values for "+t.displayName+" to "+n),e.currentDataObj[t.id]=n}var i=e.currentDataObj[t.id];i&&(i=e.renderField(t,i),e.setFieldValueFromDataObject(t,i)),e.validateField(t)})),this.factoryElements&&this.factoryElements.deleteButton&&h.addAttributes(this.factoryElements.deleteButton,[{name:"style",value:"display:none"}])},a._startUpdate=function(){var e=this;this.clearUnsavedMessage(),Pn(this.currentDataObj),this.dataObjDef.fields.forEach((function(t){if(t.generator&&t.generator.onModify){var n=t.generator.generator.generate(t,!1);Hn("Setting default modified values for "+t.displayName+" to "+n),e.currentDataObj[t.id]=n}var i=e.currentDataObj[t.id];i&&(i=e.renderField(t,i)),e.setFieldValueFromDataObject(t,i),e.validateField(t)})),this.factoryElements&&this.factoryElements.deleteButton&&h.removeAttributes(this.factoryElements.deleteButton,["style"])},a._displayOnly=function(){var e=this;this.clearUnsavedMessage(),Pn(this.currentDataObj),this.dataObjDef.fields.forEach((function(t){var n=e.currentDataObj[t.id];n&&(n=e.renderField(t,n)),e.setFieldValueFromDataObject(t,n)})),this.factoryElements&&this.factoryElements.deleteButton&&this.factoryElements&&h.addAttributes(this.factoryElements.deleteButton,[{name:"style",value:"display:none"}])},a._visible=function(){var e;this.factoryElements&&(null==(e=this.containerEl)||e.appendChild(this.factoryElements.form))},a.setFieldValueToDataObject=function(e,t,n){var i=this.map.find((function(e){return e.attributeId===t.getId()}));i?(Hn("Mapped field "+i.fieldId+" to attribute "+i.attributeId+" with value "+n),this.currentDataObj[i.attributeId]=n):Pn("Mapped field "+t.getId()+" to attribute NOT FOUND")},a.setFieldValueFromDataObject=function(e,t){var n=this.getFieldFromDataFieldId(e.id);n&&(t?n.setValue(t):n.clearValue())},a.getFormattedFieldValue=function(e){var t=null,n=this.map.find((function(t){return t.attributeId===e.id}));if(n){Hn("Mapped attribute "+n.attributeId+" to field "+n.fieldId+" with for getting formatted value");var i=this.fields.find((function(e){return e.getId()===n.attributeId}));i&&(t=i.getFormattedValue())}return t},a.getFormattedDataObject=function(){var e=this;Pn("Getting current formatted data");var t={};return this.dataObjDef.fields.forEach((function(n){e.currentDataObj[n.id],t[n.id]=e.getFormattedFieldValue(n)})),Pn(t),t},a._isSameObjectAsDisplayed=function(e){var t=this,n=!1;return Hn("is same object as current"),Hn(e),Hn(this.currentDataObj),this.dataObjDef.fields.every((function(i){if(i.isKey){var a,r=null==(a=t.getFieldFromDataFieldId(i.id))?void 0:a.getValue(),s=e[i.id];return Hn("is same object id "+s+" as current "+r),(r&&!s||r&&!s)&&(n=!1),r&&s&&r==s&&(n=!0),!1}return!0})),n},a.enableButtons=function(){this.factoryElements&&this.uiDef&&(this.factoryElements.deleteButton&&this.factoryElements.deleteButton.removeAttribute("disabled"),this.factoryElements.cancelButton.removeAttribute("disabled"),this.factoryElements.submitButton.removeAttribute("disabled"),this.factoryElements.submitButton.innerHTML=this.uiDef.submitButton.buttonText)},a.disableButtons=function(){this.factoryElements&&(this.factoryElements.deleteButton&&this.factoryElements.deleteButton.setAttribute("disabled","true"),this.factoryElements.cancelButton.setAttribute("disabled","true"),this.factoryElements.submitButton.setAttribute("disabled","true"))},a.clearReadOnly=function(){e.prototype.clearReadOnly.call(this),this.enableButtons()},a.setReadOnly=function(){e.prototype.setReadOnly.call(this),this.disableButtons()},a._saveFinishedOrAborted=function(){Hn("save is finished or aborted"),this.enableButtons(),this.clearUnsavedMessage()},a._saveIsActive=function(){Hn("save is active"),this.disableButtons(),this.factoryElements&&this.uiDef&&this.uiDef.activeSave&&(Hn("save is active "+this.uiDef.activeSave),this.factoryElements.submitButton.innerHTML=this.uiDef.activeSave+this.uiDef.submitButton.buttonText)},i}(pn),qn=g()("form-detail-view-renderer"),Yn=function(){function e(e,t,n){this.form=null,this.containerId=e,this.objDef=t,this.currentItem={},this.isNewItem=!1,this.forwarder=null,this.view=null,this.permissionChecker=n}var t=e.prototype;return t.setEventForwarder=function(e){this.forwarder=e},t.setView=function(e){this.view=e},t.onDocumentLoaded=function(){this.form=new Wn(this.containerId,this.objDef),this.form.addFormListener(this)},t.reset=function(){this.form&&this.form.reset()},t.initialise=function(e,t,n){this.form&&this.form.initialise(e,t,n)},t.displayItemReadonly=function(e){this.isNewItem=!1,this.form&&this.form.displayOnly(e)},t.getName=function(){return this.objDef.displayName},t.setContainedBy=function(e){throw new Error("Method not implemented.")},t.addEventListener=function(e){throw new Error("Method not implemented.")},t.hasChanged=function(){var e=!1;return this.form&&(e=this.form.hasChanged()),e},t.getUIConfig=function(){throw new Error("Method not implemented.")},t.getDataSourceKeyId=function(){throw new Error("Method not implemented.")},t.clearDisplay=function(){this.isNewItem=!1,this.form&&this.form.reset()},t.clearReadOnly=function(){this.form&&this.form.clearReadOnly()},t.setReadOnly=function(){this.form&&this.form.setReadOnly()},t.isReadOnly=function(){var e=!1;return this.form&&(e=this.form.isReadOnly()),e},t.createItem=function(){var e;return this.currentItem={},qn("Creating new item with form "+(null==(e=this.form)?void 0:e.getId())),this.form&&(this.isNewItem=!0,this.currentItem=this.form.startCreateNew()),$('[data-toggle="tooltip"]').tooltip(),this.currentItem},t.displayItem=function(e){this.currentItem=e,this.isNewItem=!1,this.hasPermissionToUpdateItem(e)?this.form&&this.form.startUpdate(e):this.form&&this.form.displayOnly(e),$('[data-toggle="tooltip"]').tooltip()},t.hidden=function(){this.form&&this.form.setIsVisible(!1)},t.show=function(){this.form&&this.form.setIsVisible(!0)},t.render=function(){this.displayItem(this.currentItem),this.show()},t.hasPermissionToDeleteItem=function(e){return this.permissionChecker.hasPermissionToDeleteItem(e)},t.hasPermissionToUpdateItem=function(e){return this.permissionChecker.hasPermissionToUpdateItem(e)},t.getForm=function(){return this.form},t.handleActionItem=function(e,t){},t.isDisplayingItem=function(e){var t=!1;return this.currentItem&&this.form&&(t=this.form.isDisplayingItem(e)),t},t.formChanged=function(e,t){switch(e.eventType){case sn.CANCELLING:qn("Form is cancelling");break;case sn.CANCELLING_ABORTED:qn("Form is cancelling - aborted");break;case sn.CANCELLED:qn("Form is cancelled - resetting"),this.currentItem=t,this.forwarder&&this.view&&this.forwarder.cancelled(this.view,this.currentItem);break;case sn.DELETING:qn("Form is deleting");break;case sn.DELETE_ABORTED:qn("Form is deleting - aborted");break;case sn.DELETED:qn("Form is deleted - resetting"),this.currentItem=t,this.forwarder&&this.view&&this.forwarder.deletedItem(this.view,this.currentItem);break;case sn.SAVE_ABORTED:qn("Form save cancelled");break;case sn.SAVED:if(qn("Form is saved with data"),this.form){var n,i=null==(n=this.form)?void 0:n.getFormattedDataObject();this.isNewItem?this.forwarder&&this.view&&this.forwarder.saveNewItem(this.view,i):this.forwarder&&this.view&&this.forwarder.updateItem(this.view,i),this.isNewItem=!1}break;case sn.SAVING:qn("Form is saving")}return!1},t.getItemDescription=function(e,t){return""},t.getItemId=function(e,t){return""},e}(),Gn=function(){function e(){}var t=e.prototype;return t.hasPermissionToUpdateItem=function(e){var t=!1;return e.createdBy&&(t=e.createdBy===Ke.getInstance().getLoggedInUsername()),t},t.hasPermissionToDeleteItem=function(e){var t=!1;return e.createdBy&&(t=e.createdBy===Ke.getInstance().getLoggedInUsername()),t},e}();function Jn(e,t){return(Jn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qn=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).detailViewListeners=[],t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Jn(t,n);var a=i.prototype;return a.addListener=function(t){e.prototype.addListener.call(this,t),this.detailViewListeners.push(t)},a.saveNewItem=function(e,t){this.suppressEventEmits||this.detailViewListeners.forEach((function(n){return n.saveNewItem(e,t)}))},a.updateItem=function(e,t){this.suppressEventEmits||this.detailViewListeners.forEach((function(n){return n.updateItem(e,t)}))},a.deletedItem=function(e,t){this.suppressEventEmits||this.detailViewListeners.forEach((function(n){return n.deletedItem(e,t)}))},a.cancelled=function(e,t){this.suppressEventEmits||this.detailViewListeners.forEach((function(n){return n.cancelled(e,t)}))},i}(Ze);function zn(e,t){return(zn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $n=function(e){var t,n;function i(t,n){var i;(i=e.call(this,t)||this).currentItem=null,i.renderer=n;var a=new Qn;return i.eventForwarder=a,i.renderer.setView(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i)),i.renderer.setEventForwarder(a),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,zn(t,n);var a=i.prototype;return a.addEventDetailListener=function(e){this.eventForwarder.addListener(e)},a.getItemId=function(e,t){return""},a.getItemDescription=function(e,t){return""},a.clearDisplay=function(){this.renderer.reset()},a.clearReadOnly=function(){this.renderer.clearReadOnly()},a.setReadOnly=function(){this.renderer.setReadOnly()},a.isReadOnly=function(){return this.renderer.isReadOnly()},a.createItem=function(){return this.renderer.createItem()},a.displayItem=function(e){this.currentItem=e,this.renderer.hasPermissionToUpdateItem(e)?this.renderer.displayItem(e):this.renderer.displayItemReadonly(e),this.show()},a.hidden=function(){this.renderer.hidden()},a.show=function(){this.renderer.show()},a.render=function(){this.displayItem(this.currentItem)},a.onDocumentLoaded=function(){this.renderer.onDocumentLoaded(),e.prototype.onDocumentLoaded.call(this)},a.hasPermissionToDeleteItem=function(e){return this.renderer.hasPermissionToDeleteItem(e)},a.hasPermissionToUpdateItem=function(e){return this.renderer.hasPermissionToUpdateItem(e)},a.handleActionItem=function(e,t){this.renderer.handleActionItem(e,t)},a.isDisplayingItem=function(e){return this.renderer.isDisplayingItem(e)},a.hasChanged=function(){return this.renderer.hasChanged()},a.initialise=function(e,t,n){void 0===n&&(n=!1),this.renderer.initialise(e,t,n)},i}(tt),Kn=function(){function e(e){this.isCreatingNew=!1,this.typeName=e,this.listeners=[]}var t=e.prototype;return t.addListener=function(e){this.listeners.push(e)},t.informListenersOfCreate=function(e){var t=this;this.isCreatingNew=!1,this.listeners.forEach((function(n){return n.create(t,t.typeName,e)}))},t.informListenersOfUpdate=function(e){var t=this;this.isCreatingNew=!1,this.listeners.forEach((function(n){return n.update(t,t.typeName,e)}))},t.informListenersOfDelete=function(e){var t=this;this.isCreatingNew=!1,this.listeners.forEach((function(n){return n.delete(t,t.typeName,e)}))},t.startNewObject=function(){var e=!1;return this.isCreatingNew||(e=this._startNewObject(),this.isCreatingNew=e),e},t.isCreatingNewObject=function(){return this.isCreatingNew},e}();function Zn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xn(e,t){return(Xn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ei=g()("linked-controller"),ti=g()("linked-controller-detail"),ni=function(){function e(e){this.controller=e}var t=e.prototype;return t.addView=function(e){e.addEventListener(this)},t.canDeleteItem=function(e,t){return!0},t.documentLoaded=function(e){},t.hideRequested=function(e){},t.itemAction=function(e,t,n){},t.itemDeleted=function(e,t){},t.itemDropped=function(e,t){},t.showRequested=function(e){},t.cancelled=function(e,t){this.controller.cancelled(e,t)},t.deletedItem=function(e,t){this.controller.deletedItem(e,t)},t.saveNewItem=function(e,t){this.controller.saveNewItem(e,t)},t.updateItem=function(e,t){this.controller.updateItem(e,t)},e}(),ii=function(e){var t,n;function i(t,n){var i;return(i=e.call(this,t)||this).children=[],ei("Starting with parent view "+n.getName()),i.parentView=n,i.delegate=new ni(Zn(i)),i.parentView.addEventListener(Zn(i)),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Xn(t,n);var a=i.prototype;return a.addLinkedDetailView=function(e){ei("Adding child view "+e.getName()),this.children.push(e),this.delegate.addView(e)},a.initialise=function(){},a.canDeleteItem=function(e,t){return ei("Handling delete item from view "+e.getName()),ti(t),this.parentView.hasPermissionToDeleteItemInNamedCollection("",t)},a.documentLoaded=function(e){ei("Handling document loaded view "+e.getName()),this.children.forEach((function(e){e.onDocumentLoaded()}))},a.hideRequested=function(e){ei("Handling hide  from view "+e.getName()),this.children.forEach((function(e){e.hidden()}))},a.itemAction=function(e,t,n){ei("Handling item action "+t+" from view "+e.getName()),ti(n),this.children.forEach((function(e){e.handleActionItem(t,n)}))},a.itemDeleted=function(e,t){ei("Handling item deleted from view "+e.getName()),ti(t),this.children.forEach((function(e){e.clearDisplay(),e.setReadOnly()}))},a.itemDeselected=function(e,t){ei("Handling item deselected from view "+e.getName()),ti(t),this.children.forEach((function(e){e.clearDisplay(),e.setReadOnly()}))},a.itemDragStarted=function(e,t){},a.itemDropped=function(e,t){},a.itemSelected=function(e,t){ei("Handling item selected from view "+e.getName()),ti(t),this.children.forEach((function(e){e.displayItem(t)}))},a.showRequested=function(e){ei("Handling show from view "+e.getName()),this.children.forEach((function(e){e.show()}))},a.canSelectItem=function(e,t){if(ei("Handling can select item from view "+e.getName()),ti(t),this.isCreatingNew)return!1;var n=!0;return this.children.forEach((function(e){e.hasChanged()&&(ti("child view "+e.getName()+" has changed - cancelling"),n=!1)})),n||(n=confirm(e.getName()+" - unsaved changes.  Discard them?")),n},a.cancelled=function(e,t){ei("Handling cancelled from child view "+e.getName()),ti(t),this.isCreatingNew=!1},a.deletedItem=function(e,t){ei("Handling deleted from child view "+e.getName()),ti(t),this.informListenersOfDelete(t)},a.saveNewItem=function(e,t){ei("Handling save new from child view "+e.getName()),ti(t),this.informListenersOfCreate(t)},a.updateItem=function(e,t){ei("Handling update from child view "+e.getName()),ti(t),this.informListenersOfUpdate(t)},a._startNewObject=function(){ei("Handling start new object");var e=!0;return this.children.forEach((function(t){t.hasChanged()&&(ti("child view "+t.getName()+" has changed - cancelling"),e=!1)})),e||(e=confirm("There are unsaved changes.  Discard them?")),this.children.length>0&&(ei("Handling start new object with child view "+this.children[0].getName()),this.children[0].createItem()&&(e=!0,this.children[0].show())),e},i}(Kn),ai=function(){function e(){}return e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.setupValidationForExerciseTypeDetailsForm=function(e){var t={targetDataFieldId:"sets",response:dn.show,conditions:[{sourceDataFieldId:"type",comparison:on.hasValue,values:"cardio"}]};hn.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"reps",response:dn.show,conditions:[{sourceDataFieldId:"type",comparison:on.hasValue,values:"cardio"}]},hn.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"weight",response:dn.show,conditions:[{sourceDataFieldId:"type",comparison:on.hasValue,values:"cardio"}]},hn.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"reps",response:dn.hide,conditions:[{sourceDataFieldId:"type",comparison:on.hasValue,values:"strength"}]},hn.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"sets",response:dn.hide,conditions:[{sourceDataFieldId:"type",comparison:on.hasValue,values:"strength"}]},hn.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"weight",response:dn.hide,conditions:[{sourceDataFieldId:"type",comparison:on.hasValue,values:"strength"}]},hn.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"distance",response:dn.show,conditions:[{sourceDataFieldId:"type",comparison:on.hasValue,values:"strength"}]},hn.getInstance().addRuleToForm(e,t),t={targetDataFieldId:"distance",response:dn.hide,conditions:[{sourceDataFieldId:"type",comparison:on.hasValue,values:"cardio"}]},hn.getInstance().addRuleToForm(e,t)},e}(),ri=g()("list-view-renderer-with-context"),si=function(){function e(e,t){this.view=e,this.eventHandler=t}var t=e.prototype;return t.createDisplayElementForCollectionItem=function(e,t){var n=this,a=this.view.hasPermissionToDeleteItemInNamedCollection(e,t),r=this.view.getCollectionUIConfig();ri("view "+this.view.getName()+": creating List item"),ri(t),this.view.getIdForItemInNamedCollection(e,t);var s=document.createElement(r.resultsElementType);h.addRemoveClasses(s,r.resultsClasses),h.addAttributes(s,r.resultsElementAttributes);var o=s;if(r.detail.containerClasses){var c=document.createElement("div");if(h.addRemoveClasses(c,r.detail.containerClasses),o=document.createElement(r.detail.textElementType),h.addRemoveClasses(o,r.detail.textElementClasses),c.appendChild(o),r.detail.background){var l=document.createElement(r.detail.background.elementType);h.addRemoveClasses(l,r.detail.background.elementClasses),l.setAttribute("src",this.view.getBackgroundImageForItemInNamedCollection(e,t)),s.appendChild(l)}var u=document.createElement("div");if(c.appendChild(u),r.detail.badge){var m=this.view.getBadgeValueForItemInNamedCollection(e,t);if(m>0){var f=document.createElement(r.detail.badge.elementType);h.addRemoveClasses(f,r.detail.badge.elementClasses),h.addAttributes(f,r.detail.badge.elementAttributes),u.appendChild(f),f.innerHTML="&nbsp;&nbsp;&nbsp;"+m+"&nbsp;&nbsp;&nbsp;"}}if(r.extraActions&&r.extraActions.forEach((function(i){if(n.view.hasPermissionToActionItemInNamedCollection(i.name,e,t)){var a=document.createElement("button");if(a.setAttribute("type","button"),h.addRemoveClasses(a,i.buttonClasses),h.addAttributes(a,i.attributes),i.buttonText&&(a.innerHTML=i.buttonText),i.iconClasses){var r=document.createElement("i");h.addRemoveClasses(r,i.iconClasses),r.setAttribute(d,i.name),a.appendChild(r)}a.setAttribute(d,i.name),a.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),n.eventHandler.eventActionClicked(e)})),u.appendChild(a)}})),r.detail.delete&&a){var g=document.createElement("button");if(g.setAttribute("type","button"),h.addRemoveClasses(g,r.detail.delete.buttonClasses),h.addAttributes(g,r.detail.delete.attributes),r.detail.delete.buttonText&&(g.innerHTML=r.detail.delete.buttonText),r.detail.delete.iconClasses){var v=document.createElement("i");h.addRemoveClasses(v,r.detail.delete.iconClasses),g.appendChild(v)}g.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),n.eventHandler.eventDeleteClickItem(e)})),u.appendChild(g)}s.appendChild(c),r.detail.drag&&(s.setAttribute("draggable","true"),s.addEventListener("dragstart",this.eventHandler.eventStartDrag)),r.detail.select&&s.addEventListener("click",this.eventHandler.eventClickItem)}if(this.view.renderDisplayForItemInNamedCollection(o,e,t),r.detail.icons&&r.detail.icons(e,t).forEach((function(e){var t=document.createElement("i");h.addRemoveClasses(t,e),o.appendChild(t)})),r.modifiers){var p=this.view.getModifierForItemInNamedCollection(e,t),C=this.view.getSecondaryModifierForItemInNamedCollection(e,t);switch(p){case i.normal:if(ri("view "+this.view.getName()+": normal item"),h.addRemoveClasses(s,r.modifiers.normal),r.icons&&r.icons.normal){var I=document.createElement("i");h.addRemoveClasses(I,r.icons.normal),o.appendChild(I)}switch(C){case i.warning:if(h.addRemoveClasses(s,r.modifiers.normal,!1),h.addRemoveClasses(s,r.modifiers.warning,!0),r.icons&&r.icons.warning){var b=document.createElement("i");h.addRemoveClasses(b,r.icons.warning),o.appendChild(b)}break;case i.active:if(r.icons&&r.icons.active){var y=document.createElement("i");h.addRemoveClasses(y,r.icons.active),o.appendChild(y)}}break;case i.active:if(ri("view "+this.view.getName()+": active item"),h.addRemoveClasses(s,r.modifiers.active),r.icons&&r.icons.active){var w=document.createElement("i");h.addRemoveClasses(w,r.icons.active),o.appendChild(w)}switch(C){case i.warning:if(h.addRemoveClasses(s,r.modifiers.active,!1),h.addRemoveClasses(s,r.modifiers.warning,!0),r.icons&&r.icons.warning){var E=document.createElement("i");h.addRemoveClasses(E,r.icons.warning),o.appendChild(E)}}break;case i.inactive:if(ri("view "+this.view.getName()+": inactive item"),h.addRemoveClasses(s,r.modifiers.inactive),r.icons&&r.icons.inactive){var L=document.createElement("i");h.addRemoveClasses(L,r.icons.inactive),o.appendChild(L)}switch(C){case i.warning:if(r.icons&&r.icons.warning){h.addRemoveClasses(s,r.modifiers.inactive,!1),h.addRemoveClasses(s,r.modifiers.warning,!0);var S=document.createElement("i");h.addRemoveClasses(S,r.icons.warning),o.appendChild(S)}break;case i.active:if(r.icons&&r.icons.active){var F=document.createElement("i");h.addRemoveClasses(F,r.icons.active),o.appendChild(F)}}}}return s},t.setDisplayElementsForCollectionInContainer=function(e,t,n){var i=this;ri("view "+this.view.getName()+": creating Results"),ri(n),h.removeAllChildren(e),n.map((function(n,a){var r=i.createDisplayElementForCollectionItem(t,n);ri("view "+i.view.getName()+":  Adding child "+i.view.getIdForItemInNamedCollection(t,n)),e.appendChild(r),I.getInstance().addContextToElement(i.view.getName(),t,n,r,!0),r.addEventListener("contextmenu",I.getInstance().handleContextMenu)})),$('[data-toggle="tooltip"]').tooltip()},t.onDocumentLoaded=function(){},e}();function oi(e,t){return(oi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var di=function(e){var t,n;function i(t,n){return e.call(this,t,n)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,oi(t,n),i.prototype.getItemContext=function(e){var t=I.getInstance().findContextFromEvent(e);return t?{itemId:t.identifier,dataSource:t.source}:{itemId:"",dataSource:this.view.getName()}},i}(ut);function ci(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function li(e,t){return(li=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ui=g()("exercise-types-view"),hi=function(e){var t,n;function i(t){var n;(n=e.call(this,i.DOMConfig,t,W)||this).renderer=new si(ci(n),ci(n)),n.eventHandlerDelegate=new di(ci(n),n.eventForwarder),n.getIdForItemInNamedCollection=n.getIdForItemInNamedCollection.bind(ci(n)),n.getItemId=n.getItemId.bind(ci(n));var a=I.getInstance().addContextFromView(ci(n),W,"Exercise Types");return I.getInstance().addActionToContext(a,"addToWorkout","Add To Workout",n.eventHandlerDelegate.eventActionClicked,"fas fa-arrow-alt-circle-right"),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,li(t,n);var a=i.prototype;return a.getItemDescription=function(e,t){var n="";return n+="<strong>"+t.name+"</strong>: ","cardio"===t.type?n+=t.distance+" km in "+t.duration:n+=t.sets+" sets of "+t.reps+" reps in "+t.duration,n+"<br/>"},a.canDeleteItem=function(e,t){return ui("Can Delete "+t),ui(t.createdBy),!(!t.createdBy||t.createdBy!==Ke.getInstance().getLoggedInUsername())},a.compareItemsForEquality=function(e,t){return V(e,t)},a.getIdForItemInNamedCollection=function(e,t){return t._id},a.renderDisplayForItemInNamedCollection=function(e,t,n){e.innerHTML=n.name},a.hasPermissionToDeleteItemInNamedCollection=function(e,t){return ui("Has delete permission "+t),ui(t.createdBy),!(!t.createdBy||t.createdBy!==Ke.getInstance().getLoggedInUsername())},a.itemAction=function(t,n,a){e.prototype.itemAction.call(this,t,n,a),n===i.DOMConfig.extraActions[0].name&&Ke.getInstance().addExerciseToCurrentWorkout(a)},i}(It);hi.DOMConfig={viewConfig:{resultsContainerId:"exerciseTypes",dataSourceId:X},resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"_id",keyType:a.string,modifiers:{normal:"",inactive:"list-group-item-light",active:"list-group-item-primary",warning:""},icons:{normal:"",inactive:"",active:"",warning:""},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,icons:function(e,t){return t.type?"cardio"===t.type?["fas fa-running ml-2"]:["fas fa-dumbbell ml-2"]:[]},delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-md",iconClasses:"text-black fas fa-trash-alt",attributes:[{name:"data-toggle",value:"tooltip"},{name:"data-placement",value:"right"},{name:"title",value:"Delete this exercise type."}]},drag:{type:Q,from:Z}},extraActions:[{name:"addToWorkout",buttonClasses:"btn bg-primary text-white btn-circle btn-md mr-1",iconClasses:"fas fa-arrow-alt-circle-right",attributes:[{name:"data-toggle",value:"tooltip"},{name:"data-placement",value:"right"},{name:"data-html",value:"true"},{name:"title",value:"Add this <strong>exercise</strong> to the current workout."}]}]};var mi=g()("exercise-types-composite-view"),fi=function(){function e(e){this.sideBar=e}return e.prototype.onDocumentLoaded=function(){var e=new hi(Ke.getInstance().getStateManager());this.sideBar.addView(e,{containerId:Ht.SidebarContainers.container});var t=Ge.getInstance().findDefinition(W);if(t){var n=new Yn(te,t,new Gn),i=new $n({resultsContainerId:te,dataSourceId:X},n),a=new ii(W,e);a.addLinkedDetailView(i),this.sideBar.onDocumentLoaded();var r=qe.getInstance().generateStartingDisplayOrder(t);i.initialise(r,!1,!0);var s=n.getForm();s&&(mi("Setting up validation rules for "+s.getId()),mi(s),ai.getInstance().setupValidationForExerciseTypeDetailsForm(s));var o=document.getElementById("addNewExerciseType");mi("Setting up button for creating exercise types"),mi(o),o&&o.addEventListener("click",(function(e){mi("Asking view linker to start a new object"),a.startNewObject()})),a.addListener(Ke.getInstance())}},e}();function gi(e,t){return(gi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var vi=function(e){var t,n;function i(){return e.call(this,i.SidebarPrefs)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,gi(t,n),i}(Ut);vi.SidebarPrefs={id:"workoutSummarySidebar",expandedSize:"100%",location:r.bottom},vi.SidebarContainers={container:"workoutSummary"};var pi=n(9403),Ci=g()("workout-summary-renderer"),Ii=function(){function e(e,t){this.currentChart=null,this.view=e,this.eventHandler=t}var t=e.prototype;return t.generateRandomExerciseColourAndBorder=function(e){void 0===e&&(e=!0);var t=0,n=0,i=Math.floor(100*Math.random())+155;return e&&(t=i),e||(n=i),["rgba("+t+",50,"+n+",0.4)","rgb("+t+",50,"+n+")"]},t.createDisplayElementForCollectionItem=function(e,t){return document.createElement("a")},t.setDisplayElementsForCollectionInContainer=function(e,t,n){var i=this;Ci("view "+this.view.getName()+": creating workout summary"),Ci(n),this.currentChart&&this.currentChart.destroy();var a=n;n.length>7&&(a=n.slice(n.length-7));var r=[],s=[],o=[],d=[],c=[];a.forEach((function(e){var t=le()(e.createdOn,"YYYYMMDDHHmmss").format("ddd DD/MM/YYYY HH:mm");c.push(t),Ci("Added label "+t),e.exercises&&e.exercises.forEach((function(e){var t=e.name;if(r.findIndex((function(e){return e==t}))<0){Ci("Adding exercise "+t+" of type "+e.type+" to datasets"),r.push(t),d.push(e.type);var n=i.generateRandomExerciseColourAndBorder("strength"===e.type);s.push(n[0]),o.push(n[1])}}))}));var l=[];r.forEach((function(e,t){var n=d[t],i=s[t],r=o[t];Ci("Constructing dataset "+e+" of type "+n+" to datasets");var c=[],u=[],h=[];a.forEach((function(t){u.push(i),h.push(r),t.exercises?t.exercises.every((function(t){return t.name!=e||("strength"===n?(Ci("Found exercise "+e+" with value "+t.weight),c.push(t.weight)):(Ci("Found exercise "+e+" with value "+t.distance),c.push(t.distance)),!1)}))&&c.push(0):c.push(0)}));var m={label:e,data:c,backgroundColor:u,borderColor:h,borderWidth:1,order:1};Ci(m),l.push(m)}));var u={labels:c,datasets:l},h={type:"bar",data:u,options:{responsive:!0,animation:!0,maintainAspectRatio:!0,scales:{y:{beginAtZero:!0}}}};Ci(u),this.currentChart=new pi.Z(e,h)},t.onDocumentLoaded=function(){},e}();function bi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yi(e,t){return(yi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var wi=function(e){var t,n;function i(){var t;return(t=e.call(this,i.DOMConfig,Ke.getInstance().getStateManager(),q)||this).renderer=new Ii(bi(t),bi(t)),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,yi(t,n);var a=i.prototype;return a.canDeleteItem=function(e,t){return!1},a.compareItemsForEquality=function(e,t){return V(e,t)},a.getIdForItemInNamedCollection=function(e,t){return t._id},a.renderDisplayForItemInNamedCollection=function(e,t,n){},a.hasPermissionToDeleteItemInNamedCollection=function(e,t){return!1},a.hasPermissionToActionItemInNamedCollection=function(e,t,n){return!1},a.renderBackgroundForItemInNamedCollection=function(e,t,n){},i}(It);function Ei(e,t){return(Ei=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}wi.DOMConfig={viewConfig:{resultsContainerId:"workoutSummaryChart",dataSourceId:"workoutSummary"},resultsElementType:"canvas",resultsClasses:"",keyId:"_id",keyType:a.string,detail:{containerClasses:"",textElementType:"",textElementClasses:"",select:!1}};var Li=function(e){var t,n;function i(){return e.call(this,i.SidebarPrefs)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ei(t,n),i}(Ut);Li.SidebarPrefs={id:"currentWorkoutSidebar",expandedSize:"50%",location:r.right},Li.SidebarContainers={list:"exercises",detail:"workoutDetail"};var Si=function(){function e(){}var t=e.prototype;return t.hasPermissionToUpdateItem=function(e){return!0},t.hasPermissionToDeleteItem=function(e){return!0},e}();function Fi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ni(e,t){return(Ni=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}g()("current-workout-exercises-view");var Di=function(e){var t,n;function i(t){var n;return(n=e.call(this,i.DOMConfig,t,W)||this).renderer=new si(Fi(n),Fi(n)),n.eventHandlerDelegate=new di(Fi(n),n.eventForwarder),n.getIdForItemInNamedCollection=n.getIdForItemInNamedCollection.bind(Fi(n)),n.getItemId=n.getItemId.bind(Fi(n)),I.getInstance().addContextFromView(Fi(n),W,"Exercise Types"),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ni(t,n);var a=i.prototype;return a.getItemDescription=function(e,t){var n="";return n+="<strong>"+t.name+"</strong>: ","cardio"===t.type?n+=t.distance+" km in "+t.duration:n+=t.sets+" sets of "+t.reps+" reps in "+t.duration,n+"<br/>"},a.canDeleteItem=function(e,t){return!0},a.compareItemsForEquality=function(e,t){return V(e,t)},a.getIdForItemInNamedCollection=function(e,t){return t._id},a.renderDisplayForItemInNamedCollection=function(e,t,n){e.innerHTML=n.name},a.hasPermissionToDeleteItemInNamedCollection=function(e,t){return!0},a.itemDropped=function(e,t){Ke.getInstance().addExerciseToCurrentWorkout(t)},i}(It);Di.DOMConfig={viewConfig:{resultsContainerId:"exercises",dataSourceId:ee,drop:{acceptFrom:[Z],acceptTypes:[Q]}},resultsElementType:"a",resultsElementAttributes:[{name:"href",value:"#"}],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",keyId:"_id",keyType:a.string,modifiers:{normal:"",inactive:"list-group-item-light",active:"list-group-item-primary",warning:""},icons:{normal:"",inactive:"",active:"",warning:""},detail:{containerClasses:"d-flex w-100 justify-content-between",textElementType:"span",textElementClasses:"mb-1",select:!0,icons:function(e,t){return t.type?"cardio"===t.type?["fas fa-running ml-2"]:["fas fa-dumbbell ml-2"]:[]},delete:{buttonClasses:"btn bg-danger text-white btn-circle btn-md",iconClasses:"fas fa-trash-alt",attributes:[{name:"data-toggle",value:"tooltip"},{name:"data-placement",value:"right"},{name:"title",value:"Delete this exercise from the workout."}]}}};var ki=g()("current-workout-composite-view"),Ti=function(){function e(e){this.currentWorkout={},this.workoutDef=null,this.workoutNameEl=null,this.sideBar=e,this.stateManager=new F,this.stateManager.addChangeListenerForName(W,this),Ke.getInstance().getStateManager().addChangeListenerForName(q,this)}var t=e.prototype;return t.getListenerName=function(){return"Current Workout Composite View"},t.onDocumentLoaded=function(){var e,t=this;if(this.workoutNameEl=document.getElementById("workoutName"),null==(e=this.workoutNameEl)||e.addEventListener("blur",(function(e){e.target&&(t.currentWorkout.name=e.target.value,t.saveWorkout())})),this.workoutDef=Ge.getInstance().findDefinition(q),!this.workoutDef)throw new Error("Workout definition not found");var n=new Di(this.stateManager);this.sideBar.addView(n,{containerId:"exerciseDropZone"});var i=Ge.getInstance().findDefinition(W);if(i){var a=new Yn(ne,i,new Si),r=new $n({resultsContainerId:ne,dataSourceId:ee},a),s=new ii(W,n);s.addLinkedDetailView(r),this.sideBar.onDocumentLoaded();var o=qe.getInstance().generateStartingDisplayOrder(i);r.initialise(o,!1,!0);var d=a.getForm();d&&(ki("Setting up validation rules for "+d.getId()),ki(d),ai.getInstance().setupValidationForExerciseTypeDetailsForm(d));var c=document.getElementById("completeWorkout");ki("Setting up button for completing the workout"),ki(c),c&&c.addEventListener("click",(function(e){ki("Completing the workout"),t.currentWorkout.completed=!0,t.currentWorkout.createdOn=le()().format("YYYYMMDDHHmmss"),d&&(d.reset(),d.setReadOnly()),t.saveWorkout(),t.createWorkout(),Bi.getInstance().hideAllSideBars()})),s.addListener(this)}},t.getStateManager=function(){return this.stateManager},t.createWorkout=function(){ki("Creating new current workout"),this.currentWorkout=Ge.getInstance().createInstance(q),ki(this.currentWorkout),this.currentWorkout.name="",this.workoutNameEl&&(this.workoutNameEl.value=""),Ke.getInstance().getStateManager().addNewItemToState(q,this.currentWorkout,!1),this.stateManager.setStateByName(W,this.currentWorkout.exercises,!0)},t.saveWorkout=function(){ki("Saving current workout"),ki(this.currentWorkout),this.currentWorkout.createdOn=le()().format("YYYYMMDDHHmmss"),this.currentWorkout.modifiedOn=le()().format("YYYYMMDDHHmmss"),Ke.getInstance().getStateManager().updateItemInState(q,this.currentWorkout,V,!1)},t.stateChanged=function(e,t,n){var i=this;ki(e+","+t),t===q&&(ki("Workouts loaded"),this.currentWorkout=null,n.forEach((function(e){e.completed&&"false"!==e.completed||(i.currentWorkout=e)})),this.currentWorkout?(ki("Workouts loaded found existing current workout"),this.workoutNameEl&&this.currentWorkout.name&&(this.workoutNameEl.value=this.currentWorkout.name),this.stateManager.setStateByName(W,this.currentWorkout.exercises,!0)):(ki("Workouts loaded no existing current workout, creating and saving"),this.createWorkout()))},t.stateChangedItemAdded=function(e,t,n){t===W&&(ki("Added a new exercise to workout"),ki(n),this.currentWorkout.exercises.push(n),this.saveWorkout())},t.stateChangedItemRemoved=function(e,t,n){if(t===W){var i=this.currentWorkout.exercises.findIndex((function(e){return e._id===n._id}));ki("Removing exercise to workout at index "+i),ki(n),i>=0&&this.currentWorkout.exercises.splice(i,1),this.saveWorkout()}},t.stateChangedItemUpdated=function(e,t,n,i){if(t===W){var a=this.currentWorkout.exercises.findIndex((function(e){return e._id===i._id}));ki("Updating exercise to workout at index "+a),ki(i),a>=0&&this.currentWorkout.exercises.splice(a,1,i),this.saveWorkout()}},t.create=function(e,t,n){ki("Added a new exercise to workout from view"),ki(n),this.stateManager.addNewItemToState(W,n,!1)},t.update=function(e,t,n){ki("Updating exercise in workout from view"),ki(n),this.stateManager.updateItemInState(W,n,V,!1)},t.delete=function(e,t,n){ki("Deleting exercise from workout from view"),ki(n),this.stateManager.removeItemFromState(W,n,V,!1)},e}();function Ri(e,t){var n=/^(\d+:)?[0-5]?\d:[0-5]\d$/,i=n.test(e),a=n.test(t);if(i&&a){var r=e.split(":"),s=t.split(":"),o=0,d=parseInt(r[r.length-1])+parseInt(s[s.length-1]);d>=60&&(o=1,d-=60);var c=parseInt(r[r.length-2])+parseInt(s[s.length-2])+o;c>=60&&(o=1,c-=60);var l=0;3==r.length&&(l=parseInt(r[0]));var u=0;3==s.length&&(u=parseInt(s[0]));var h=l+u+o;return(h>0?h+":":"")+(c<10?"0"+c:c)+":"+(d<10?"0"+d:d)}return"00:00"}var Ai=g()("carousel-renderer"),Oi=function(){function e(e,t,n){this.lastRenderedContainer=null,this.lastRenderedCollectionName=null,this.lastRenderedCollection=null,this.previousWindowWidth=0,this.view=e,this.eventHandler=t,this.config=n}var t=e.prototype;return t.onDocumentLoaded=function(){var e=this;this.previousWindowWidth=window.innerWidth,window.addEventListener("resize",(function(t){var n=window.innerWidth,i=!1;n<e.previousWindowWidth?(e.previousWindowWidth>c&&n<=c&&(i=!0,Ai("window reduced and is now smaller or equal to large")),e.previousWindowWidth>l&&n<=l&&(i=!0,Ai("window reduced and is now smaller or equal to medium")),e.previousWindowWidth>u&&n<=u&&(i=!0,Ai("window reduced and is now smaller or equal to small"))):(e.previousWindowWidth<=u&&n>u&&(Ai("window increased and is now larger than small"),i=!0),e.previousWindowWidth<=l&&n>l&&(Ai("window increased and is now larger than medium"),i=!0),e.previousWindowWidth<=c&&n>c&&(Ai("window increased and is now larger than large"),i=!0)),e.previousWindowWidth=n,e.lastRenderedContainer&&e.lastRenderedCollection&&e.lastRenderedCollectionName&&i&&e.setDisplayElementsForCollectionInContainer(e.lastRenderedContainer,e.lastRenderedCollectionName,e.lastRenderedCollection)}))},t.createDisplayElementForCollectionItem=function(e,t){var n=this,a=this.view.hasPermissionToDeleteItemInNamedCollection(e,t);Ai("view "+this.view.getName()+": creating carousel item"),Ai(t);var r=this.view.getCollectionUIConfig(),s=document.createElement(r.resultsElementType);if(h.addRemoveClasses(s,r.resultsClasses),h.addAttributes(s,r.resultsElementAttributes),r.detail.background){var o=document.createElement(r.detail.background.elementType);h.addRemoveClasses(o,r.detail.background.elementClasses),h.addAttributes(o,r.detail.background.elementAttributes),s.appendChild(o),this.view.renderBackgroundForItemInNamedCollection(o,e,t)}var c=s;if(r.detail.containerClasses){var l=document.createElement("div");if(h.addRemoveClasses(l,r.detail.containerClasses),c=document.createElement(r.detail.textElementType),h.addRemoveClasses(c,r.detail.textElementClasses),l.appendChild(c),r.extraActions||r.detail.delete){var u=document.createElement(this.config.actionContainer.elementType);if(h.addRemoveClasses(u,this.config.actionContainer.elementClasses),l.appendChild(u),r.extraActions&&r.extraActions.forEach((function(i){if(n.view.hasPermissionToActionItemInNamedCollection(i.name,e,t)){var a=document.createElement("button");if(a.setAttribute("type","button"),h.addRemoveClasses(a,i.buttonClasses),h.addAttributes(a,i.attributes),i.buttonText&&(a.innerHTML=i.buttonText),i.iconClasses){var r=document.createElement("i");h.addRemoveClasses(r,i.iconClasses),r.setAttribute(d,i.name),a.appendChild(r)}a.setAttribute(d,i.name),a.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),n.eventHandler.eventActionClicked(e)})),u.appendChild(a)}})),r.detail.delete&&r&&a){var m=document.createElement("button");if(m.setAttribute("type","button"),h.addRemoveClasses(m,r.detail.delete.buttonClasses),h.addAttributes(m,r.detail.delete.attributes),r.detail.delete.buttonText&&(m.innerHTML=r.detail.delete.buttonText),r.detail.delete.iconClasses){var f=document.createElement("i");h.addRemoveClasses(f,r.detail.delete.iconClasses),m.appendChild(f)}m.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),n.eventHandler.eventDeleteClickItem(e)})),u.appendChild(m)}}s.appendChild(l),r.detail.drag&&(s.setAttribute("draggable","true"),s.addEventListener("dragstart",this.eventHandler.eventStartDrag)),r.detail.select&&s.addEventListener("click",this.eventHandler.eventClickItem)}if(this.view.renderDisplayForItemInNamedCollection(c,e,t),r.modifiers){var g=this.view.getModifierForItemInNamedCollection(e,t),v=this.view.getSecondaryModifierForItemInNamedCollection(e,t);switch(g){case i.normal:if(Ai("view "+this.view.getName()+": normal item"),h.addRemoveClasses(s,r.modifiers.normal),r.icons&&r.icons.normal){var p=document.createElement("i");h.addRemoveClasses(p,r.icons.normal),c.appendChild(p)}switch(v){case i.warning:if(h.addRemoveClasses(s,r.modifiers.normal,!1),h.addRemoveClasses(s,r.modifiers.warning,!0),r.icons&&r.icons.warning){var C=document.createElement("i");h.addRemoveClasses(C,r.icons.warning),c.appendChild(C)}break;case i.active:if(r.icons&&r.icons.active){var I=document.createElement("i");h.addRemoveClasses(I,r.icons.active),c.appendChild(I)}}break;case i.active:if(Ai("view "+this.view.getName()+": active item"),h.addRemoveClasses(s,r.modifiers.active),r.icons&&r.icons.active){var b=document.createElement("i");h.addRemoveClasses(b,r.icons.active),c.appendChild(b)}switch(v){case i.warning:if(h.addRemoveClasses(s,r.modifiers.active,!1),h.addRemoveClasses(s,r.modifiers.warning,!0),r.icons&&r.icons.warning){var y=document.createElement("i");h.addRemoveClasses(y,r.icons.warning),c.appendChild(y)}}break;case i.inactive:if(Ai("view "+this.view.getName()+": inactive item"),h.addRemoveClasses(s,r.modifiers.inactive),r.icons&&r.icons.inactive){var w=document.createElement("i");h.addRemoveClasses(w,r.icons.inactive),c.appendChild(w)}switch(v){case i.warning:if(r.icons&&r.icons.warning){h.addRemoveClasses(s,r.modifiers.inactive,!1),h.addRemoveClasses(s,r.modifiers.warning,!0);var E=document.createElement("i");h.addRemoveClasses(E,r.icons.warning),c.appendChild(E)}break;case i.active:if(r.icons&&r.icons.active){var L=document.createElement("i");h.addRemoveClasses(L,r.icons.active),c.appendChild(L)}}}}return s},t.setDisplayElementsForCollectionInContainer=function(e,t,n){Ai("view "+this.view.getName()+": creating carousel results"),Ai(n),h.removeAllChildren(e);var i=n.length,a=this.config.itemsPerRow.xlarge;window.innerWidth<=c&&(a=this.config.itemsPerRow.large),window.innerWidth<=l&&(a=this.config.itemsPerRow.medium),window.innerWidth<=u&&(a=this.config.itemsPerRow.small);var r=Math.ceil(i/a);Ai("view "+this.view.getName()+": creating carousel with number of results per row of "+a+" with rows "+r);for(var o=0;o<r;o++){var d=document.createElement(this.config.rowContainer.elementType);h.addRemoveClasses(d,this.config.rowContainer.elementClasses),h.addAttributes(d,this.config.rowContainer.elementAttributes);var f=document.createElement(this.config.row.elementType);h.addRemoveClasses(f,this.config.row.elementClasses),h.addAttributes(f,this.config.row.elementAttributes),d.appendChild(f),(0===o&&this.config.activeRowPosition===s.first||o===r-1&&this.config.activeRowPosition===s.last)&&(h.addRemoveClasses(d,this.config.activeRow.elementClasses),h.addAttributes(d,this.config.activeRow.elementAttributes));for(var g=o*a;g<(o+1)*a&&g<i;){Ai("rowIndex "+o+" item index "+g);var v=n[g],p=f;this.config.multipleItemsPerRowContainer&&(p=document.createElement(this.config.multipleItemsPerRowContainer.elementType),h.addRemoveClasses(p,this.config.multipleItemsPerRowContainer.elementClasses),h.addAttributes(p,this.config.multipleItemsPerRowContainer.elementAttributes),f.appendChild(p));var C=this.createDisplayElementForCollectionItem(t,v);p.appendChild(C),I.getInstance().addContextToElement(this.view.getName(),t,v,C,!0,m.bottom),C.addEventListener("contextmenu",I.getInstance().handleContextMenu),g++}e.appendChild(d)}$('[data-toggle="tooltip"]').tooltip(),this.lastRenderedContainer=e,this.lastRenderedCollectionName=t,this.lastRenderedCollection=n},e}();function Ui(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xi(e,t){return(xi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Mi=g()("workouts-view"),_i=function(e){var t,n;function a(){var t;(t=e.call(this,a.DOMConfig.collectionConfig,Ke.getInstance().getStateManager(),q)||this).renderer=new Oi(Ui(t),Ui(t),a.DOMConfig),t.eventHandlerDelegate=new di(Ui(t),t.eventForwarder),t.chartRefs=[],t.getIdForItemInNamedCollection=t.getIdForItemInNamedCollection.bind(Ui(t)),t.getItemId=t.getItemId.bind(Ui(t));var n=I.getInstance().addContextFromView(Ui(t),q,"Workouts");return I.getInstance().addActionToContext(n,"template","Copy exercises to Current Workout",t.eventHandlerDelegate.eventActionClicked,"fas fa-copy"),I.getInstance().addActionToContext(n,"continue","Continue Current Workout",t.eventHandlerDelegate.eventActionClicked,"fas fa-clipboard-list"),t}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,xi(t,n);var r=a.prototype;return r.getItemDescription=function(e,t){var n="";return t.exercises&&t.exercises.forEach((function(e){n+="<strong>"+e.name+"</strong>: ","cardio"===e.type?n+=e.distance+" km in "+e.duration:n+=e.sets+" sets of "+e.reps+" reps in "+e.duration,n+="<br/>"})),n},r.canDeleteItem=function(e,t){return t.completed},r.compareItemsForEquality=function(e,t){return V(e,t)},r.getItemId=function(e,t){return this.getIdForItemInNamedCollection(e,t)},r.getIdForItemInNamedCollection=function(e,t){return t._id},r.calculateExerciseSummary=function(e){var t={weight:0,distance:0,duration:"00:00"};if(e.exercises)for(var n=0;n<e.exercises.length;n++){var i=e.exercises[n];t.weight+=i.weight,t.distance+=i.distance,t.duration=Ri(t.duration,i.duration)}return t},r.renderDisplayForItemInNamedCollection=function(e,t,n){var i=this.calculateExerciseSummary(n),a="";a+='<h5 class="card-title">',n.name?(a+=n.name+"</h5>",a+='<h6 class="card-subtitle">'+le()(n.createdOn,"YYYYMMDDHHmmss").format("ddd, DD/MM/YYYY HH:mm")+"</h6>"):n.completed?a+=le()(n.createdOn,"YYYYMMDDHHmmss").format("ddd, DD/MM/YYYY HH:mm")+"</h5>":a+="Current</h5>",a+='<ul class="list-group list-group-flush">',a+='<li class="list-group-item"><strong>Duration:</strong> '+i.duration+"</li>",i.weight>0&&(a+='<li class="list-group-item"><strong>Total Weight:</strong> '+i.weight+"</li>"),i.distance>0&&(a+='<li class="list-group-item"><strong>Total Distance: </strong> '+i.distance+"</li>"),a+="</ul>",e.innerHTML=a},r.hasPermissionToDeleteItemInNamedCollection=function(e,t){return t.completed},r.hasPermissionToActionItemInNamedCollection=function(e,t,n){var i=!1;return"template"===e&&n.completed&&!0===n.completed&&(i=!0),"continue"===e&&!1===n.completed&&(i=!0),i},r.getModifierForItemInNamedCollection=function(e,t){var n=i.inactive;return t.completed&&!0!==t.completed&&(n=i.active),n},r.renderBackgroundForItemInNamedCollection=function(e,t,n){var i=this.chartRefs.findIndex((function(e){return e._id===n._id}));if(i&&(Mi("Removing old chart reference for workout "+n._id),this.chartRefs.splice(i,1)),Mi("Rendering chart for"),Mi(n),n.exercises){var r=this.getDataSourceKeyId(),s=this.getIdForItemInNamedCollection(t,n),o=document.createElement("canvas");o.setAttribute(this.collectionUIConfig.keyId,s),o.setAttribute(r,this.collectionUIConfig.viewConfig.dataSourceId);var d=[],c=[],l=[],u=[];n.exercises.forEach((function(e){var t;d.push((10,(t=e.name).length<=10?t:t.slice(0,10)+"...")),"cardio"===e.type?(c.push(e.distance),l.push(a.bgCardio),u.push(a.borderCardio)):(c.push(e.weight),l.push(a.bgStrength),u.push(a.borderStrength))}));var h={type:"bar",data:{labels:d,datasets:[{label:"Exercises",data:c,backgroundColor:l,borderColor:u,borderWidth:1}]},options:{responsive:!1,animation:!1,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}};Mi(h);try{var m={_id:n._id,chart:new pi.Z(o,h)};this.chartRefs.push(m),e.appendChild(o)}catch(e){console.log(e)}}},r.itemAction=function(t,n,i){e.prototype.itemAction.call(this,t,n,i),n===a.DOMConfig.collectionConfig.extraActions[0].name&&Ke.getInstance().addWorkoutExercisesToCurrentWorkout(i),n===a.DOMConfig.collectionConfig.extraActions[1].name&&Bi.getInstance().showCurrentWorkout()},a}(It);_i.DOMConfig={itemsPerRow:{small:1,medium:2,large:3,xlarge:4},rowContainer:{elementClasses:"carousel-item",elementType:"div"},activeRow:{elementType:"",elementClasses:"active"},activeRowPosition:s.last,row:{elementClasses:"row",elementType:"div"},multipleItemsPerRowContainer:{elementType:"div",elementClasses:"col-sm-12 col-md-4 col-lg-3 mb-2"},actionContainer:{elementType:"div",elementClasses:"card-footer d-flex w-100 justify-content-end"},collectionConfig:{viewConfig:{resultsContainerId:"workouts",dataSourceId:"workouts",drop:{acceptTypes:[Q],acceptFrom:[Z]}},resultsElementType:"div",resultsClasses:"card",keyId:"_id",keyType:a.string,modifiers:{normal:"bg-light",inactive:"bg-light",active:"bg-light",warning:"bg-light"},detail:{containerClasses:"card-body",textElementType:"div",textElementClasses:"",select:!0,delete:{buttonClasses:"btn btn-danger btn-circle btn-md",iconClasses:"fas fa-trash-alt text-white",attributes:[{name:"data-toggle",value:"tooltip"},{name:"data-placement",value:"top"},{name:"title",value:"Delete this workout"}]},background:{elementType:"div",elementClasses:""}},extraActions:[{name:"template",buttonText:"",buttonClasses:"btn btn-primary btn-circle btn-md mr-2",iconClasses:"fas fa-copy",attributes:[{name:"data-toggle",value:"tooltip"},{name:"data-placement",value:"top"},{name:"title",value:"Add the exercises from this workout to the current workout."}]},{name:"continue",buttonText:"",iconClasses:"text-white fas fa-clipboard-list",buttonClasses:"btn btn-warning btn-circle btn-md mr-2",attributes:[{name:"data-toggle",value:"tooltip"},{name:"data-placement",value:"top"},{name:"title",value:"Continue this current workout"}]}]}},_i.bgStrength="rgba(255, 0, 0, 0.2)",_i.bgCardio="rgba(0, 50, 255, 0.2)",_i.borderStrength="rgb(255, 50, 0)",_i.borderCardio="rgb(0, 50 , 255)",localStorage.debug="context-helper",g().log=console.info.bind(console);var ji=g()("app"),Bi=function(){function e(){this.handleShowUserSearch=this.handleShowUserSearch.bind(this),this.handleShowExerciseTypes=this.handleShowExerciseTypes.bind(this),this.handleShowChat=this.handleShowChat.bind(this),this.handleShowWorkoutSummary=this.handleShowWorkoutSummary.bind(this),this.handleShowCurrentWorkout=this.handleShowCurrentWorkout.bind(this),Ke.getInstance().connectToApplication(this,window.localStorage)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getCurrentUser=function(){return Ke.getInstance().getLoggedInUserId()},t.setupNavigationItemHandling=function(){document.getElementById("navigationItemUserSearch").addEventListener("click",this.handleShowUserSearch),document.getElementById("navigationItemExerciseTypes").addEventListener("click",this.handleShowExerciseTypes),document.getElementById("navigationItemWorkoutSummary").addEventListener("click",this.handleShowWorkoutSummary),document.getElementById("navigationItemCurrentWorkout").addEventListener("click",this.handleShowCurrentWorkout),this.chatNavigationItem=document.getElementById("navigationItemChat"),this.chatNavigationItem.addEventListener("click",this.handleShowChat)},t.setupUserSearchViews=function(){this.userSearchSidebar=new _t;var e=new Nt(Ke.getInstance().getStateManager());this.userSearchSidebar.addView(e,{containerId:_t.SidebarContainers.recentSearches});var t=new Kt(Ke.getInstance().getStateManager());this.userSearchSidebar.addView(t,{containerId:_t.SidebarContainers.favourites});var n=new nn(Ke.getInstance().getStateManager());this.userSearchSidebar.addView(n,{containerId:_t.SidebarContainers.blocked}),this.userSearchSidebar.onDocumentLoaded()},t.setupChatViews=function(){this.chatSidebar=new Vt,this.chatView=new At,this.chatSidebar.addView(this.chatView,{containerId:Vt.SidebarContainers.chatLogs});var e=new Yt(Ke.getInstance().getStateManager());this.chatSidebar.addView(e,{containerId:Vt.SidebarContainers.chatLog}),this.chatView.addEventListener(e),this.chatSidebar.onDocumentLoaded()},t.onDocumentLoad=function(){ji("document loaded"),this.thisEl=document.getElementById("root"),this.setupUserSearchViews(),this.setupChatViews(),this.setupNavigationItemHandling(),this.exerciseTypesSidebar=new Ht,new fi(this.exerciseTypesSidebar).onDocumentLoaded(),(new _i).onDocumentLoaded(),this.workoutSummarySidebar=new vi,this.workoutSummarySidebar.addView(new wi,{containerId:vi.SidebarContainers.container}),this.workoutSummarySidebar.onDocumentLoaded(),this.currentWorkoutSidebar=new Li,this.currentWorkoutView=new Ti(this.currentWorkoutSidebar),this.currentWorkoutView.onDocumentLoaded(),I.getInstance().onDocumentLoaded(),Ke.getInstance().onDocumentLoaded()},t.hideAllSideBars=function(){this.chatSidebar.eventHide(null),this.userSearchSidebar.eventHide(null),this.exerciseTypesSidebar.eventHide(null),this.currentWorkoutSidebar.eventHide(null)},t.handleShowUserSearch=function(e){ji("Handling Show User Search"),e.preventDefault(),Ke.getInstance().isLoggedIn()?this.userSearchSidebar.eventShow(e):window.location.href=G},t.handleShowWorkoutSummary=function(e){ji("Handling Show Workout Summary"),e.preventDefault(),Ke.getInstance().isLoggedIn()?(this.hideAllSideBars(),this.workoutSummarySidebar.eventShow(e)):window.location.href=G},t.handleShowCurrentWorkout=function(e){ji("Handling Show Current Workout"),e.preventDefault(),Ke.getInstance().isLoggedIn()?this.currentWorkoutSidebar.eventShow(e):window.location.href=G},t.handleShowExerciseTypes=function(e){ji("Handling Show Exercise Types"),e.preventDefault(),Ke.getInstance().isLoggedIn()?this.exerciseTypesSidebar.eventShow(e):window.location.href=G},t.handleShowChat=function(e){ji("Handling Show Chat"),Ke.getInstance().isLoggedIn()?(this.chatSidebar.eventShow(null),e&&this.chatView.selectChatRoom(e)):window.location.href=G},t.countChanged=function(e){var t='Chat <i class="fas fa-inbox"></i>';e>0&&(t+=' <span class="badge badge-pill badge-primary">&nbsp;'+e+"&nbsp;</span>"),this.chatNavigationItem&&(this.chatNavigationItem.innerHTML=""+t)},t.addingExerciseToCurrentWorkout=function(e){this.exerciseTypesSidebar.eventHide(null),this.currentWorkoutSidebar.eventShow(null),this.currentWorkoutView.getStateManager().addNewItemToState(W,e,!1)},t.showCurrentWorkout=function(){this.currentWorkoutSidebar.eventShow(null)},e}();$((function(){Bi.getInstance().onDocumentLoad()}))},6700:(e,t,n)=>{var i={"./af":2786,"./af.js":2786,"./ar":867,"./ar-dz":4130,"./ar-dz.js":4130,"./ar-kw":6135,"./ar-kw.js":6135,"./ar-ly":6440,"./ar-ly.js":6440,"./ar-ma":7702,"./ar-ma.js":7702,"./ar-sa":6040,"./ar-sa.js":6040,"./ar-tn":7100,"./ar-tn.js":7100,"./ar.js":867,"./az":1083,"./az.js":1083,"./be":9808,"./be.js":9808,"./bg":8338,"./bg.js":8338,"./bm":7438,"./bm.js":7438,"./bn":8905,"./bn-bd":6225,"./bn-bd.js":6225,"./bn.js":8905,"./bo":1560,"./bo.js":1560,"./br":1278,"./br.js":1278,"./bs":622,"./bs.js":622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":877,"./cv.js":877,"./cy":7373,"./cy.js":7373,"./da":4780,"./da.js":4780,"./de":9740,"./de-at":217,"./de-at.js":217,"./de-ch":894,"./de-ch.js":894,"./de.js":9740,"./dv":5300,"./dv.js":5300,"./el":837,"./el.js":837,"./en-au":8348,"./en-au.js":8348,"./en-ca":7925,"./en-ca.js":7925,"./en-gb":2243,"./en-gb.js":2243,"./en-ie":6436,"./en-ie.js":6436,"./en-il":7207,"./en-il.js":7207,"./en-in":4175,"./en-in.js":4175,"./en-nz":6319,"./en-nz.js":6319,"./en-sg":1662,"./en-sg.js":1662,"./eo":2915,"./eo.js":2915,"./es":5655,"./es-do":5251,"./es-do.js":5251,"./es-mx":6112,"./es-mx.js":6112,"./es-us":1146,"./es-us.js":1146,"./es.js":5655,"./et":5603,"./et.js":5603,"./eu":7763,"./eu.js":7763,"./fa":6959,"./fa.js":6959,"./fi":1897,"./fi.js":1897,"./fil":2549,"./fil.js":2549,"./fo":4694,"./fo.js":4694,"./fr":4470,"./fr-ca":3049,"./fr-ca.js":3049,"./fr-ch":2330,"./fr-ch.js":2330,"./fr.js":4470,"./fy":5044,"./fy.js":5044,"./ga":9295,"./ga.js":9295,"./gd":2101,"./gd.js":2101,"./gl":8794,"./gl.js":8794,"./gom-deva":7884,"./gom-deva.js":7884,"./gom-latn":3168,"./gom-latn.js":3168,"./gu":5349,"./gu.js":5349,"./he":4206,"./he.js":4206,"./hi":94,"./hi.js":94,"./hr":316,"./hr.js":316,"./hu":2138,"./hu.js":2138,"./hy-am":1423,"./hy-am.js":1423,"./id":9218,"./id.js":9218,"./is":135,"./is.js":135,"./it":626,"./it-ch":150,"./it-ch.js":150,"./it.js":626,"./ja":9183,"./ja.js":9183,"./jv":4286,"./jv.js":4286,"./ka":2105,"./ka.js":2105,"./kk":7772,"./kk.js":7772,"./km":8758,"./km.js":8758,"./kn":9282,"./kn.js":9282,"./ko":3730,"./ko.js":3730,"./ku":1408,"./ku.js":1408,"./ky":3291,"./ky.js":3291,"./lb":6841,"./lb.js":6841,"./lo":5466,"./lo.js":5466,"./lt":7010,"./lt.js":7010,"./lv":7595,"./lv.js":7595,"./me":9861,"./me.js":9861,"./mi":5493,"./mi.js":5493,"./mk":5966,"./mk.js":5966,"./ml":7341,"./ml.js":7341,"./mn":5115,"./mn.js":5115,"./mr":370,"./mr.js":370,"./ms":9847,"./ms-my":1237,"./ms-my.js":1237,"./ms.js":9847,"./mt":2126,"./mt.js":2126,"./my":6165,"./my.js":6165,"./nb":4924,"./nb.js":4924,"./ne":6744,"./ne.js":6744,"./nl":3901,"./nl-be":9814,"./nl-be.js":9814,"./nl.js":3901,"./nn":3877,"./nn.js":3877,"./oc-lnc":2135,"./oc-lnc.js":2135,"./pa-in":5858,"./pa-in.js":5858,"./pl":4495,"./pl.js":4495,"./pt":9520,"./pt-br":7971,"./pt-br.js":7971,"./pt.js":9520,"./ro":6459,"./ro.js":6459,"./ru":1793,"./ru.js":1793,"./sd":950,"./sd.js":950,"./se":490,"./se.js":490,"./si":124,"./si.js":124,"./sk":4249,"./sk.js":4249,"./sl":4985,"./sl.js":4985,"./sq":1104,"./sq.js":1104,"./sr":9131,"./sr-cyrl":9915,"./sr-cyrl.js":9915,"./sr.js":9131,"./ss":5893,"./ss.js":5893,"./sv":8760,"./sv.js":8760,"./sw":1172,"./sw.js":1172,"./ta":7333,"./ta.js":7333,"./te":3110,"./te.js":3110,"./tet":2095,"./tet.js":2095,"./tg":7321,"./tg.js":7321,"./th":9041,"./th.js":9041,"./tk":9005,"./tk.js":9005,"./tl-ph":5768,"./tl-ph.js":5768,"./tlh":9444,"./tlh.js":9444,"./tr":2397,"./tr.js":2397,"./tzl":8254,"./tzl.js":8254,"./tzm":1106,"./tzm-latn":699,"./tzm-latn.js":699,"./tzm.js":1106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":7691,"./uk.js":7691,"./ur":3795,"./ur.js":3795,"./uz":6791,"./uz-latn":588,"./uz-latn.js":588,"./uz.js":6791,"./vi":5666,"./vi.js":5666,"./x-pseudo":4378,"./x-pseudo.js":4378,"./yo":5805,"./yo.js":5805,"./zh-cn":3839,"./zh-cn.js":3839,"./zh-hk":5726,"./zh-hk.js":5726,"./zh-mo":9807,"./zh-mo.js":9807,"./zh-tw":4152,"./zh-tw.js":4152};function a(e){var t=r(e);return n(t)}function r(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=r,e.exports=a,a.id=6700}},n={};function i(e){var a=n[e];if(void 0!==a)return a.exports;var r=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}i.m=t,e=[],i.O=(t,n,a,r)=>{if(!n){var s=1/0;for(l=0;l<e.length;l++){for(var[n,a,r]=e[l],o=!0,d=0;d<n.length;d++)(!1&r||s>=r)&&Object.keys(i.O).every((e=>i.O[e](n[d])))?n.splice(d--,1):(o=!1,r<s&&(s=r));if(o){e.splice(l--,1);var c=a();void 0!==c&&(t=c)}}return t}r=r||0;for(var l=e.length;l>0&&e[l-1][2]>r;l--)e[l]=e[l-1];e[l]=[n,a,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={143:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var a,r,[s,o,d]=n,c=0;if(s.some((t=>0!==e[t]))){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(d)var l=d(i)}for(t&&t(n);c<s.length;c++)r=s[c],i.o(e,r)&&e[r]&&e[r][0](),e[s[c]]=0;return i.O(l)},n=self.webpackChunktemplate_feo_react_babel=self.webpackChunktemplate_feo_react_babel||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=i.O(void 0,[736],(()=>i(8362)));a=i.O(a)})();
//# sourceMappingURL=app.bundle.js.map